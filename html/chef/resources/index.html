<div id="col-content" data-swiftype-index="true"> <h1 id="all-infra-resources">All Infra Resources</h1>  <div class="prose"> <p>This reference describes each of the resources available to Chef Infra Client, including a list of actions, properties, and usage examples.</p> <h2 id="common-functionality">Common Functionality</h2> <p>The properties and actions in this section apply to all resources.</p> <h3 id="actions">Actions</h3> <p>The following actions may be used with any resource:</p> <dl> <dt><code>:nothing</code></dt> <dd> <p>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</p> </dd> </dl> <h4 id="examples">Examples</h4> <p>The following examples show how to use common actions in a recipe.</p> <p><strong>Use the :nothing action</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'memcached'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="properties">Properties</h3> <p>The following properties are common to every resource:</p> <dl> <dt><code>ignore_failure</code></dt> <dd>
<strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> <dt><code>retries</code></dt> <dd>
<strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd>
<strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd>
<strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="examples-1">Examples</h4> <p>The following examples show how to use common properties in a recipe.</p> <p><strong>Use the ignore_failure common property</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">gem_package <span style="color:#4070a0">'syntax'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  ignore_failure <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Use the retries and retry_delay common properties</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'apache'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#666">[</span> <span style="color:#517918">:enable</span>, <span style="color:#517918">:start</span> <span style="color:#666">]</span>
  retries <span style="color:#40a070">3</span>
  retry_delay <span style="color:#40a070">5</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="guards">Guards</h3> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <h4 id="properties-1">Properties</h4> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h4 id="arguments">Arguments</h4> <p>The following arguments can be used with the <code>not_if</code> or <code>only_if</code> guard properties:</p> <dl> <dt><code>:user</code></dt> <dd> <p>Specify the user that a command will run as. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">not_if <span style="color:#4070a0">'grep adam /etc/passwd'</span>, <span style="color:#517918">user</span>: <span style="color:#4070a0">'adam'</span>
</code></pre></div>
</dd> <dt><code>:group</code></dt> <dd> <p>Specify the group that a command will run as. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">not_if <span style="color:#4070a0">'grep adam /etc/passwd'</span>, <span style="color:#517918">group</span>: <span style="color:#4070a0">'adam'</span>
</code></pre></div>
</dd> <dt><code>:environment</code></dt> <dd> <p>Specify a Hash of environment variables to be set. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">not_if <span style="color:#4070a0">'grep adam /etc/passwd'</span>, <span style="color:#517918">environment</span>: {
  <span style="color:#4070a0">'HOME'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/home/adam'</span>,
}
</code></pre></div>
</dd> <dt><code>:cwd</code></dt> <dd> <p>Set the current working directory before running a command. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">not_if <span style="color:#4070a0">'grep adam passwd'</span>, <span style="color:#517918">cwd</span>: <span style="color:#4070a0">'/etc'</span>
</code></pre></div>
</dd> <dt><code>:timeout</code></dt> <dd> <p>Set a timeout for a command. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">not_if <span style="color:#4070a0">'sleep 10000'</span>, <span style="color:#517918">timeout</span>: <span style="color:#40a070">10</span>
</code></pre></div>
</dd> </dl> <h4 id="not_if-examples">not_if Examples</h4> <p>The following examples show how to use <code>not_if</code> as a condition in a recipe:</p> <p><strong>Create a file, but not if an attribute has a specific value</strong></p> <p>The following example shows how to use the <code>not_if</code> condition to create a file based on a template and using the presence of an attribute value on the node to specify the condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  not_if { node<span style="color:#666">[</span><span style="color:#4070a0">'some_value'</span><span style="color:#666">]</span> }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a file with a Ruby block, but not if “/etc/passwd” exists</strong></p> <p>The following example shows how to use the <code>not_if</code> condition to create a file based on a template and then Ruby code to specify the condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  not_if <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(<span style="color:#4070a0">'/etc/passwd'</span>)
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a file with Ruby block that has curly braces, but not if “/etc/passwd” exists</strong></p> <p>The following example shows how to use the <code>not_if</code> condition to create a file based on a template and using a Ruby block (with curly braces) to specify the condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(<span style="color:#4070a0">'/etc/passwd'</span>) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a file using a string, but not if “/etc/passwd” exists</strong></p> <p>The following example shows how to use the <code>not_if</code> condition to create a file based on a template and using a string to specify the condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/some_config'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0640'</span>
  source <span style="color:#4070a0">'some_config.erb'</span>
  not_if <span style="color:#4070a0">'some_app --check-config'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h4 id="only_if-examples">only_if Examples</h4> <p>The following examples show how to use <code>only_if</code> as a condition in a recipe:</p> <p><strong>Create a file, but only if an attribute has a specific value</strong></p> <p>The following example shows how to use the <code>only_if</code> condition to create a file based on a template and using the presence of an attribute on the node to specify the condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  only_if { node<span style="color:#666">[</span><span style="color:#4070a0">'some_value'</span><span style="color:#666">]</span> }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a file with a Ruby block, but only if “/etc/passwd” does not exist</strong></p> <p>The following example shows how to use the <code>only_if</code> condition to create a file based on a template, and then use Ruby to specify a condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/some_app/some_config'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0640'</span>
  source <span style="color:#4070a0">'some_config.erb'</span>
  only_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(<span style="color:#4070a0">'/etc/some_app/'</span>) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a file using a string, but only if “/etc/passwd” exists</strong></p> <p>The following example shows how to use the <code>only_if</code> condition to create a file based on a template and using a string to specify the condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  only_if <span style="color:#4070a0">'test -f /etc/passwd'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="guard-interpreters">Guard Interpreters</h3> <p>Any resource that passes a string command may also specify the interpreter that will be used to evaluate that string command. This is done by using the <code>guard_interpreter</code> property to specify a <strong>script</strong>-based resource.</p> <h4 id="attributes">Attributes</h4> <p>The <code>guard_interpreter</code> property may be set to any of the following values:</p> <dl> <dt><code>:bash</code></dt> <dd> <p>Evaluates a string command using the <strong>bash</strong> resource.</p> </dd> <dt><code>:batch</code></dt> <dd> <p>Evaluates a string command using the <strong>batch</strong> resource. Default value (within a <strong>batch</strong> resource block): <code>:batch</code>.</p> </dd> <dt><code>:csh</code></dt> <dd> <p>Evaluates a string command using the <strong>csh</strong> resource.</p> </dd> <dt><code>:default</code></dt> <dd> <p>Default. Executes the default interpreter as identified by Chef Infra Client.</p> </dd> <dt><code>:perl</code></dt> <dd> <p>Evaluates a string command using the <strong>perl</strong> resource.</p> </dd> <dt><code>:powershell_script</code></dt> <dd> <p>Evaluates a string command using the <strong>powershell_script</strong> resource. Default value (within a <strong>powershell_script</strong> resource block): <code>:powershell_script</code>.</p> </dd> <dt><code>:python</code></dt> <dd> <p>Evaluates a string command using the <strong>python</strong> resource.</p> </dd> <dt><code>:ruby</code></dt> <dd> <p>Evaluates a string command using the <strong>ruby</strong> resource.</p> </dd> </dl> <h4 id="inheritance">Inheritance</h4> <p>The <code>guard_interpreter</code> property is set to <code>:default</code> by default for the <strong>bash</strong>, <strong>csh</strong>, <strong>perl</strong>, <strong>python</strong>, and <strong>ruby</strong> resources. When the <code>guard_interpreter</code> property is set to <code>:default</code>, <code>not_if</code> or <code>only_if</code> guard statements <strong>do not inherit</strong> properties that are defined by the <strong>script</strong>-based resource.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>The <strong>batch</strong> and <strong>powershell_script</strong> resources inherit properties by default. The <code>guard_interpreter</code> property is set to <code>:batch</code> or <code>:powershell_script</code> automatically when using a <code>not_if</code> or <code>only_if</code> guard statement within a <strong>batch</strong> or <strong>powershell_script</strong> resource, respectively.</p> </div> </div> <p>For example, the <code>not_if</code> guard statement in the following resource example <strong>does not inherit</strong> the <code>environment</code> property:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'javatooling'</span> <span style="color:#007020;font-weight:700">do</span>
  environment <span style="color:#4070a0">'JAVA_HOME'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/usr/lib/java/jdk1.7/home'</span>
  code <span style="color:#4070a0">'java-based-daemon-ctl.sh -start'</span>
  not_if <span style="color:#4070a0">'java-based-daemon-ctl.sh -test-started'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and requires adding the <code>environment</code> property to the <code>not_if</code> guard statement so that it may use the <code>JAVA_HOME</code> path as part of its evaluation:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'javatooling'</span> <span style="color:#007020;font-weight:700">do</span>
  environment <span style="color:#4070a0">'JAVA_HOME'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/usr/lib/java/jdk1.7/home'</span>
  code <span style="color:#4070a0">'java-based-daemon-ctl.sh -start'</span>
  not_if <span style="color:#4070a0">'java-based-daemon-ctl.sh -test-started'</span>, <span style="color:#517918">:environment</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'JAVA_HOME'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/usr/lib/java/jdk1.7/home'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>To inherit properties, add the <code>guard_interpreter</code> property to the resource block and set it to the appropriate value:</p> <ul> <li>
<code>:bash</code> for <strong>bash</strong>
</li> <li>
<code>:csh</code> for <strong>csh</strong>
</li> <li>
<code>:perl</code> for <strong>perl</strong>
</li> <li>
<code>:python</code> for <strong>python</strong>
</li> <li>
<code>:ruby</code> for <strong>ruby</strong>
</li> </ul> <p>For example, using the same example as from above, but this time adding the <code>guard_interpreter</code> property and setting it to <code>:bash</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'javatooling'</span> <span style="color:#007020;font-weight:700">do</span>
  guard_interpreter <span style="color:#517918">:bash</span>
  environment <span style="color:#4070a0">'JAVA_HOME'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/usr/lib/java/jdk1.7/home'</span>
  code <span style="color:#4070a0">'java-based-daemon-ctl.sh -start'</span>
  not_if <span style="color:#4070a0">'java-based-daemon-ctl.sh -test-started'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The <code>not_if</code> statement now inherits the <code>environment</code> property and will use the <code>JAVA_HOME</code> path as part of its evaluation.</p> <h4 id="examples-2">Examples</h4> <p>For example, the following code block will ensure the command is evaluated using the default interpreter as identified by Chef Infra Client:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  guard_interpreter <span style="color:#517918">:default</span>
  <span style="color:#60a0b0;font-style:italic"># code</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="lazy-evaluation">Lazy Evaluation</h3> <p>In some cases, the value for a property cannot be known until the execution phase of a Chef Infra Client run. In this situation, using lazy evaluation of property values can be helpful. Instead of a property being assigned a value, it may instead be assigned a code block. The syntax for using lazy evaluation is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">property_name lazy { code_block }
</code></pre></div>
<p>where <code>lazy</code> is used to tell Chef Infra Client to evaluate the contents of the code block later on in the resource evaluation process (instead of immediately) and <code>{ code_block }</code> is arbitrary Ruby code that provides the value.</p> <p>For example, a resource that is <strong>not</strong> doing lazy evaluation:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'template_name'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic"># some properties</span>
  path <span style="color:#4070a0">'/foo/bar'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and a resource block that is doing lazy evaluation:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'template_name'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic"># some properties</span>
  path lazy { <span style="color:#4070a0">' some Ruby code '</span> }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In the previous examples, the first resource uses the value <code>/foo/bar</code> and the second resource uses the value provided by the code block, as long as the contents of that code block are a valid resource property.</p> <p>The following example shows how to use lazy evaluation with template variables:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/canvey_island.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'canvey_island.txt.erb'</span>
  variables(
    lazy <span style="color:#007020;font-weight:700">do</span>
      { <span style="color:#517918">canvey_island</span>: node<span style="color:#666">.</span>run_state<span style="color:#666">[</span><span style="color:#4070a0">'sea_power'</span><span style="color:#666">]</span> }
    <span style="color:#007020;font-weight:700">end</span>
  )
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="notifications">Notifications</h3> <p>A notification is a property on a resource that listens to other resources in the resource collection and then takes actions based on the notification type (<code>notifies</code> or <code>subscribes</code>).</p> <h4 id="timers">Timers</h4> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <h4 id="notifies">Notifies</h4> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div>
<h5 id="examples-3">Examples</h5> <p>The following examples show how to use the <code>notifies</code> notification in a recipe.</p> <p><strong>Delay notifications</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/nagios3/configures-nagios.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic"># other parameters</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[test-nagios-config]'</span>, <span style="color:#517918">:delayed</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Notify immediately</strong></p> <p>By default, notifications are <code>:delayed</code>, that is they are queued up as they are triggered, and then executed at the very end of a Chef Infra Client run. To run an action immediately, use <code>:immediately</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/nagios3/configures-nagios.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic"># other parameters</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[test-nagios-config]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then Chef Infra Client would immediately run the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'test-nagios-config'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'nagios3 --verify-config'</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Notify multiple resources</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/chef/server.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'server.rb.erb'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[chef-elasticsearch]'</span>, <span style="color:#517918">:delayed</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[chef-server]'</span>, <span style="color:#517918">:delayed</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Notify in a specific order</strong></p> <p>To notify multiple resources, and then have these resources run in a certain order, do something like the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'foo'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'...'</span>
  notifies <span style="color:#517918">:create</span>, <span style="color:#4070a0">'template[baz]'</span>, <span style="color:#517918">:immediately</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[bar]'</span>, <span style="color:#517918">:immediately</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[final]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>

template <span style="color:#4070a0">'baz'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#666">...</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[restart_baz]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>

package <span style="color:#4070a0">'bar'</span>

execute <span style="color:#4070a0">'restart_baz'</span>

execute <span style="color:#4070a0">'final'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'...'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the sequencing will be in the same order as the resources are listed in the recipe: <code>execute 'foo'</code>, <code>template 'baz'</code>, <code>execute [restart_baz]</code>, <code>package 'bar'</code>, and <code>execute 'final'</code>.</p> <p><strong>Reload a service</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  notifies <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'service[apache]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Restart a service when a template is modified</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/www/configures-apache.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[apache]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Send notifications to multiple resources</strong></p> <p>To send notifications to multiple resources, just use multiple attributes. Multiple attributes will get sent to the notified resources in the order specified.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/netatalk/netatalk.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[afpd]'</span>, <span style="color:#517918">:immediately</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[cnid]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'afpd'</span>
service <span style="color:#4070a0">'cnid'</span>
</code></pre></div>
<p><strong>Execute a command using a template</strong></p> <p>The following example shows how to set up IPv4 packet forwarding using the <strong>execute</strong> resource to run a command named <code>forward_ipv4</code> that uses a template defined by the <strong>template</strong> resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'forward_ipv4'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'echo &gt; /proc/.../ipv4/ip_forward'</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

template <span style="color:#4070a0">'/etc/file_name.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'routing/file_name.conf.erb'</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[forward_ipv4]'</span>, <span style="color:#517918">:delayed</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the <code>command</code> property for the <strong>execute</strong> resource contains the command that is to be run and the <code>source</code> property for the <strong>template</strong> resource specifies which template to use. The <code>notifies</code> property for the <strong>template</strong> specifies that the <code>execute[forward_ipv4]</code> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of a Chef Infra Client run.</p> <p><strong>Restart a service, and then notify a different service</strong></p> <p>The following example shows how start a service named <code>example_service</code> and immediately notify the Nginx service to restart.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'example_service'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:start</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[nginx]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Restart one service before restarting another</strong></p> <p>This example uses the <code>:before</code> notification to restart the <code>php-fpm</code> service before restarting <code>nginx</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:restart</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[php-fpm]'</span>, <span style="color:#517918">:before</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>With the <code>:before</code> notification, the action specified for the <code>nginx</code> resource will not run until action has been taken on the notified resource (<code>php-fpm</code>).</p> <p><strong>Notify when a remote source changes</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'/tmp/couch.png'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'http://couchdb.apache.org/img/sketch.png'</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

http_request <span style="color:#4070a0">'HEAD http://couchdb.apache.org/img/sketch.png'</span> <span style="color:#007020;font-weight:700">do</span>
  message <span style="color:#4070a0">''</span>
  url <span style="color:#4070a0">'http://couchdb.apache.org/img/sketch.png'</span>
  action <span style="color:#517918">:head</span>
  <span style="color:#007020;font-weight:700">if</span> <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(<span style="color:#4070a0">'/tmp/couch.png'</span>)
    headers <span style="color:#4070a0">'If-Modified-Since'</span> <span style="color:#666">=&gt;</span> <span style="color:#60add5">File</span><span style="color:#666">.</span>mtime(<span style="color:#4070a0">'/tmp/couch.png'</span>)<span style="color:#666">.</span>httpdate
  <span style="color:#007020;font-weight:700">end</span>
  notifies <span style="color:#517918">:create</span>, <span style="color:#4070a0">'remote_file[/tmp/couch.png]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h4 id="subscribes">Subscribes</h4> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div>
<h5 id="examples-4">Examples</h5> <p>The following examples show how to use the <code>subscribes</code> notification in a recipe.</p> <p><strong>Prevent restart and reconfigure if configuration is broken</strong></p> <p>Use the <code>:nothing</code> action (common to all resources) to prevent the test from starting automatically, and then use the <code>subscribes</code> notification to run a configuration test when a change to the template is detected:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'test-nagios-config'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'nagios3 --verify-config'</span>
  action <span style="color:#517918">:nothing</span>
  subscribes <span style="color:#517918">:run</span>, <span style="color:#4070a0">'template[/etc/nagios3/configures-nagios.conf]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Reload a service using a template</strong></p> <p>To reload a service that is based on a template, use the <strong>template</strong> and <strong>service</strong> resources together in the same recipe, similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'apache'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:enable</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'template[/tmp/somefile]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the <code>subscribes</code> notification is used to reload the service whenever the template is modified.</p> <p><strong>Stash a file in a data bag</strong></p> <p>The following example shows how to use the <strong>ruby_block</strong> resource to stash a BitTorrent file in a data bag so that it can be distributed to nodes in the organization.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># the following code sample comes from the ``seed`` recipe</span>
<span style="color:#60a0b0;font-style:italic"># in the following cookbook: https://github.com/mattray/bittorrent-cookbook</span>

ruby_block <span style="color:#4070a0">'share the torrent file'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    f <span style="color:#666">=</span> <span style="color:#60add5">File</span><span style="color:#666">.</span>open(node<span style="color:#666">[</span><span style="color:#4070a0">'bittorrent'</span><span style="color:#666">][</span><span style="color:#4070a0">'torrent'</span><span style="color:#666">]</span>, <span style="color:#4070a0">'rb'</span>)
    <span style="color:#60a0b0;font-style:italic">#read the .torrent file and base64 encode it</span>
    enc <span style="color:#666">=</span> <span style="color:#60add5">Base64</span><span style="color:#666">.</span>encode64(f<span style="color:#666">.</span>read)
    data <span style="color:#666">=</span> {
      <span style="color:#4070a0">'id'</span> <span style="color:#666">=&gt;</span> bittorrent_item_id(node<span style="color:#666">[</span><span style="color:#4070a0">'bittorrent'</span><span style="color:#666">][</span><span style="color:#4070a0">'file'</span><span style="color:#666">]</span>),
      <span style="color:#4070a0">'seed'</span> <span style="color:#666">=&gt;</span> node<span style="color:#666">[</span><span style="color:#4070a0">'ipaddress'</span><span style="color:#666">]</span>,
      <span style="color:#4070a0">'torrent'</span> <span style="color:#666">=&gt;</span> enc,
    }
    item <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">DataBagItem</span><span style="color:#666">.</span>new
    item<span style="color:#666">.</span>data_bag(<span style="color:#4070a0">'bittorrent'</span>)
    item<span style="color:#666">.</span>raw_data <span style="color:#666">=</span> data
    item<span style="color:#666">.</span>save
  <span style="color:#007020;font-weight:700">end</span>
  action <span style="color:#517918">:nothing</span>
  subscribes <span style="color:#517918">:create</span>, <span style="color:#4070a0">"bittorrent_torrent[</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'bittorrent'</span><span style="color:#666">][</span><span style="color:#4070a0">'torrent'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">]"</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="relative-paths">Relative Paths</h3> <p>The following relative paths can be used with any resource:</p> <dl> <dt><code>#{ENV['HOME']}</code></dt> <dd> <p>Use to return the <code>~</code> path in Linux and macOS or the <code>%HOMEPATH%</code> in Microsoft Windows.</p> </dd> </dl> <h4 id="examples-5">Examples</h4> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">ENV</span><span style="color:#666">[</span><span style="color:#4070a0">'HOME'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/chef-getting-started.txt"</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef-getting-started.txt.erb'</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="run-in-compile-phase">Run in Compile Phase</h3> <p>Chef Infra Client processes recipes in two phases:</p> <ol> <li>First, each resource in the node object is identified and a resource collection is built. All recipes are loaded in a specific order, and then the actions specified within each of them are identified. This is also referred to as the “compile phase”.</li> <li>Next, Chef Infra Client configures the system based on the order of the resources in the resource collection. Each resource then examines the node and performs the necessary steps to complete the action. This is also referred to as the “execution phase”.</li> </ol> <p>Typically, actions are processed during the execution phase of a Chef Infra Client run. However, sometimes it is necessary to run an action during the compile phase. For example, a resource can be configured to install a package during the compile phase to ensure that application is available to other resources during the execution phase.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Use the <strong>chef_gem</strong> resource to install gems that are needed by Chef Infra Client during the execution phase.</p> </div> </div> <h4 id="run_action">run_action</h4> <p>Use <code>.run_action(:some_action)</code> at the end of a resource block to run the specified action during the compile phase. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">build_essential <span style="color:#4070a0">'Install compilers'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span><span style="color:#666">.</span>run_action(<span style="color:#517918">:install</span>)
</code></pre></div>
<p>where <code>action</code> is set to <code>:nothing</code> to ensure the <code>run_action</code> is run during the compile phase and not later during the execution phase.</p> <p>This can be simplified by using the <code>compile_time</code> flag in Chef Infra Client 16 and later versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">build_essential <span style="color:#4070a0">'Install compilers'</span> <span style="color:#007020;font-weight:700">do</span>
  compile_time <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>That flag both forces the resource to run at compile time and sets the converge action to <code>:nothing</code>.</p> <p>The following examples show when (and when not) to use <code>run_action</code>.</p> <p><strong>Using Custom Resources preferred to forcing to compile time</strong></p> <p>Compile time execution is often used to install gems before requiring them in recipe code.</p> <p>This is a poor pattern since gems may depend on native gems which may require installing compilers at compile time.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">build_essential <span style="color:#4070a0">'Install compilers'</span> <span style="color:#007020;font-weight:700">do</span>
  compile_time <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>

chef_gem <span style="color:#4070a0">'aws-dsk'</span> <span style="color:#007020;font-weight:700">do</span>
  compile_time <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#007020">require</span> <span style="color:#4070a0">'aws-sdk'</span>
</code></pre></div>
<p>A better strategy is to move the code, which requires the gem, into a custom resource. Since all the actions of custom resources run at converge time, this defers requiring the gem until later in the overall Chef Infra Client execution. Unified mode can also be used in the resource to eliminate compile/converge mode issues entirely:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">unified_mode <span style="color:#007020">true</span>

action <span style="color:#517918">:run</span> <span style="color:#007020;font-weight:700">do</span>
  build_essential <span style="color:#4070a0">'Install compilers'</span>

  chef_gem <span style="color:#4070a0">'aws-sdk'</span>

  <span style="color:#007020">require</span> <span style="color:#4070a0">'aws-sdk'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Download and parse a configuration file</strong></p> <p>A common use case is to download a configuration file, parse it, and then use the values in templates and to control other configuration.</p> <p>An important distinction to make is that the downloaded configuration file only exists in a temporary state to be used by the Chef Infra Client. It will not be used directly by the system or applications that are managed by the Chef Infra Client.</p> <p>To download and parse a JSON file and render it in a template, it makes sense to download the file during compile time:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  <span style="color:#60a0b0;font-style:italic"># the remote_file is being downloaded to a temporary file</span>
  remote_file <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/users.json"</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">"https://jsonplaceholder.typicode.com/users"</span>
    compile_time <span style="color:#007020">true</span>
  <span style="color:#007020;font-weight:700">end</span>

  <span style="color:#60a0b0;font-style:italic"># this parsing needs to happen after the remote_file is downloaded, but will</span>
  <span style="color:#60a0b0;font-style:italic"># be executed at compile time.</span>
  array <span style="color:#666">=</span> <span style="color:#60add5">JSON</span><span style="color:#666">.</span>parse(<span style="color:#60add5">IO</span><span style="color:#666">.</span>read(<span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/users.json"</span>)

  <span style="color:#60a0b0;font-style:italic"># the `array.last["phone"]` expression here will also be evaluated at compile</span>
  <span style="color:#60a0b0;font-style:italic"># time and must be lazied via wrapping the expresssion in `lazy {}`</span>
  file <span style="color:#4070a0">"/tmp/phone_number.txt"</span> <span style="color:#007020;font-weight:700">do</span>
    content array<span style="color:#666">.</span>last<span style="color:#666">[</span><span style="color:#4070a0">"phone"</span><span style="color:#666">]</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This is considerably cleaner than the alternative of lazy evaluating both the parsing of the JSON and the rendering of the data into the file template, which will happen if the <code>remote_file</code> resource is not run at compile time:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  <span style="color:#60a0b0;font-style:italic"># the execution of this is now deferred</span>
  remote_file <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/users.json"</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">"https://jsonplaceholder.typicode.com/users"</span>
  <span style="color:#007020;font-weight:700">end</span>

  <span style="color:#60a0b0;font-style:italic"># it is necessary due to lexical scoping issues to create this variable here</span>
  array <span style="color:#666">=</span> <span style="color:#007020">nil</span>

  <span style="color:#60a0b0;font-style:italic"># the parsing of the JSON is now deferred due to the ruby_block</span>
  ruby_block <span style="color:#4070a0">"parse JSON"</span> <span style="color:#007020;font-weight:700">do</span>
    block <span style="color:#007020;font-weight:700">do</span>
      array <span style="color:#666">=</span> <span style="color:#60add5">JSON</span><span style="color:#666">.</span>parse(<span style="color:#60add5">IO</span><span style="color:#666">.</span>read(<span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/users.json"</span>)
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>

  <span style="color:#60a0b0;font-style:italic"># the argument to the content property must now also be deferred</span>
  file <span style="color:#4070a0">"/tmp/phone_number.txt"</span> <span style="color:#007020;font-weight:700">do</span>
    content lazy { array<span style="color:#666">.</span>last<span style="color:#666">[</span><span style="color:#4070a0">"phone"</span><span style="color:#666">]</span> }
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This is an example of code that overuses deferred execution, uses more “lazy” evaluation, and is considerably harder to understand and write correctly.</p> <p><strong>Notifications will not work</strong></p> <p>Resources that are executed during the compile phase cannot notify other resources. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'ifconfig'</span>

package <span style="color:#4070a0">'vim-enhanced'</span> <span style="color:#007020;font-weight:700">do</span>
  compile_time <span style="color:#007020">true</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[ifconfig]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>A better approach in this type of situation is to install the package before the resource collection is built to ensure that it is available to other resources later on.</p> <p>The best approach to this problem is to use <code>unified mode</code> which eliminates the compile time and converge time distinction, while allowing notifications to work correctly.</p> <p><strong>Resources that are forced to compile time by default</strong></p> <p>The <code>ohai_hint</code> and <code>hostname</code> resources run at compile time by default.</p> <p>This is due to the fact that later resources may consume the node attributes which are set by those resources leading to excessive use of <code>lazy</code> in subsequent resources (and similar issues to the <code>remote_file</code> example above).</p> <p>The <code>chef_gem</code> resource used to execute at compile time by default, but now we recommend that users move code that executes at compile time to custom resources.</p> <h3 id="atomic-file-updates">Atomic File Updates</h3> <p>Atomic updates are used with <strong>file</strong>-based resources to help ensure that file updates can be made when updating a binary or if disk space runs out.</p> <p>Atomic updates are enabled by default. They can be managed globally using the <code>file_atomic_update</code> setting in the client.rb file. They can be managed on a per-resource basis using the <code>atomic_update</code> property that is available with the <strong>cookbook_file</strong>, <strong>file</strong>, <strong>remote_file</strong>, and <strong>template</strong> resources.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>On certain platforms, and after a file has been moved into place, Chef Infra Client may modify file permissions to support features specific to those platforms. On platforms with SELinux enabled, Chef Infra Client will fix up the security contexts after a file has been moved into the correct location by running the <code>restorecon</code> command. On the Microsoft Windows platform, Chef Infra Client will create files so that ACL inheritance works as expected.</p> </div> </div> <h3 id="windows-file-security">Windows File Security</h3> <p>To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes.</p> <p><strong>Access Control Lists (ACLs)</strong></p> <p>The <code>rights</code> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <code>rights</code> property can be used as many times as necessary; Chef Infra Client will apply them to the file or directory as required. The syntax for the <code>rights</code> property is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights permission, principal, option_type <span style="color:#666">=&gt;</span> value
</code></pre></div>
<p>where</p> <dl> <dt><code>permission</code></dt> <dd> <p>Use to specify which rights are granted to the <code>principal</code>. The possible values are: <code>:read</code>, <code>:write</code>, <code>read_execute</code>, <code>:modify</code>, <code>:full_control</code>, or an integer.</p> </dd> <dd> <p>Integers used for permissions must match the following list <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.accesscontrol.filesystemrights?view=windowsdesktop-5.0#fields">FileSystemRights Enum</a> fields.</p> </dd> </dl> <pre class="highlight" data-language="ruby"><code>These permissions are cumulative. If `:write` is specified, then it
includes `:read`. If `:full_control` is specified, then it includes
both `:write` and `:read`.

(For those who know the Microsoft Windows API: `:read` corresponds
to `GENERIC_READ`; `:write` corresponds to `GENERIC_WRITE`;
`:read_execute` corresponds to `GENERIC_READ` and `GENERIC_EXECUTE`;
`:modify` corresponds to `GENERIC_WRITE`, `GENERIC_READ`,
`GENERIC_EXECUTE`, and `DELETE`; `:full_control` corresponds to
`GENERIC_ALL`, which allows a user to change the owner and other
metadata about a file.)
</code></pre> <dl> <dt><code>principal</code></dt> <dd> <p>Use to specify a group or user. The principal can be specified by either name or SID. When using name, this is identical to what is entered in the login box for Microsoft Windows, such as <code>user_name</code>, <code>domain\user_name</code>, or <code>user_name@fully_qualified_domain_name</code>. When using a SID, you may use either the standard string representation of a SID (S-R-I-S-S) or one of the <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/sid-strings">SDDL string constants</a>. Chef Infra Client does not need to know if a principal is a user or a group.</p> </dd> <dt><code>option_type</code></dt> <dd> <p>A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <code>rights :write, 'domain\group_name', :one_level_deep =&gt; true</code>. Possible option types:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Option Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>:applies_to_children</code></td> <td>Specify how permissions are applied to children. Possible values: <code>true</code> to inherit both child directories and files; <code>false</code> to not inherit any child directories or files; <code>:containers_only</code> to inherit only child directories (and not files); <code>:objects_only</code> to recursively inherit files (and not child directories).</td> </tr> <tr> <td><code>:applies_to_self</code></td> <td>Indicates whether a permission is applied to the parent directory. Possible values: <code>true</code> to apply to the parent directory or file and its children; <code>false</code> to not apply only to child directories and files.</td> </tr> <tr> <td><code>:one_level_deep</code></td> <td>Indicates the depth to which permissions will be applied. Possible values: <code>true</code> to apply only to the first level of children; <code>false</code> to apply to all children.</td> </tr> </tbody> </table> </dd> </dl> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'S-1-1-0'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Administrators Everyone)</span>
rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'Users'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'Sally'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#517918">:containers_only</span>, <span style="color:#517918">applies_to_self</span>: <span style="color:#007020">false</span>, <span style="color:#517918">one_level_deep</span>: <span style="color:#007020">true</span>
</code></pre></div>
<p>Some other important things to know when using the <code>rights</code> attribute:</p> <ul> <li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li> <li>If rights are not specified, nothing will be changed. Chef Infra Client does not clear out the rights on a file or directory if rights are not specified.</li> <li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li> </ul> <p>Use the <code>deny_rights</code> property to deny specific rights to specific users. The ordering is independent of using the <code>rights</code> property. For example, it doesn’t matter if rights are granted to everyone is placed before or after <code>deny_rights :read, ['Julian', 'Lewis']</code>, both Julian and Lewis will be unable to read the document. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'Everyone'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Julian Lewis)</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">deny_rights <span style="color:#517918">:full_control</span>, <span style="color:#666">[</span><span style="color:#4070a0">'Sally'</span><span style="color:#666">]</span>
</code></pre></div>
<p><strong>Inheritance</strong></p> <p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <code>inherits</code> property can be used to specifically tell Chef Infra Client to apply (or not apply) inherited rights from its parent directory.</p> <p>For example, the following example specifies the rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  inherits <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># Sauron is the only person who should have any sort of access</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>If the <code>deny_rights</code> permission were to be used instead, something could slip through unless all users and groups were denied.</p> <p>Another example also shows how to specify rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'SHIRE\Frodo'</span> <span style="color:#60a0b0;font-style:italic"># Who put that there I didn't put that there</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>but then not use the <code>inherits</code> property to deny those rights on a child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span> <span style="color:#60a0b0;font-style:italic"># Oops, not specific enough</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Because the <code>inherits</code> property is not specified, Chef Infra Client will default it to <code>true</code>, which will ensure that security settings for existing files remain unchanged.</p> <h2 id="resources">Resources</h2> <p>The following resources are built into the Chef Infra Client:</p> <h2 id="alternatives-resource">alternatives resource</h2> <a href="alternatives/index.html">alternatives resource page</a> <hr> <p>Use the <strong>alternatives</strong> resource to configure command alternatives in Linux using the alternatives or update-alternatives packages.</p> <p><strong>New in Chef Infra Client 16.0.</strong></p> <h3 id="syntax-alternatives">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>alternatives</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">alternatives <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  link           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/usr/bin/LINK_NAME"</span>
  link_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  path           <span style="color:#007020">String</span>
  priority       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action         <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>alternatives</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>link</code>, <code>link_name</code>, <code>path</code>, and <code>priority</code> are the properties available to this resource.</li> </ul> <h3 id="actions-alternatives">Actions</h3> <hr> <p>The <strong>alternatives</strong> resource has the following actions:</p> <dl> <dt><code>:auto</code></dt> <dd>Set an alternative up in automatic mode with the highest priority automatically selected.</dd> <dt><code>:install</code></dt> <dd>Install an alternative on the system including symlinks. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:refresh</code></dt> <dd>Refresh alternatives.</dd> <dt><code>:remove</code></dt> <dd>Remove an alternative and all associated links.</dd> <dt><code>:set</code></dt> <dd>Set the symlink for an alternative.</dd> </dl> <h3 id="properties-alternatives">Properties</h3> <hr> <p>The <strong>alternatives</strong> resource has the following properties:</p> <dl> <dt> <code>link</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/usr/bin/LINK_NAME</code> <p>The path to the alternatives link.</p> </dd> </dl> <dl> <dt> <code>link_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the link to create. This will be the command you type on the command line such as <code>ruby</code> or <code>gcc</code>.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The absolute path to the original application binary such as <code>/usr/bin/ruby27</code>.</p> </dd> </dl> <dl> <dt> <code>priority</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The priority of the alternative.</p> </dd> </dl> <br> <h3 id="functionality-alternatives">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-alternatives">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-alternatives">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-alternatives">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-alternatives">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>alternatives</strong> resource in recipes:</p> <p><strong>Install an alternative</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">alternatives <span style="color:#4070a0">'python install 2'</span> <span style="color:#007020;font-weight:700">do</span>
  link_name <span style="color:#4070a0">'python'</span>
  path <span style="color:#4070a0">'/usr/bin/python2.7'</span>
  priority <span style="color:#40a070">100</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Set an alternative</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">alternatives <span style="color:#4070a0">'python set version 3'</span> <span style="color:#007020;font-weight:700">do</span>
  link_name <span style="color:#4070a0">'python'</span>
  path <span style="color:#4070a0">'/usr/bin/python3'</span>
  action <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Set the automatic alternative state</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">alternatives <span style="color:#4070a0">'python auto'</span> <span style="color:#007020;font-weight:700">do</span>
  link_name <span style="color:#4070a0">'python'</span>
  action <span style="color:#517918">:auto</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Refresh an alternative</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">alternatives <span style="color:#4070a0">'python refresh'</span> <span style="color:#007020;font-weight:700">do</span>
  link_name <span style="color:#4070a0">'python'</span>
  action <span style="color:#517918">:refresh</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove an alternative</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">alternatives <span style="color:#4070a0">'python remove'</span> <span style="color:#007020;font-weight:700">do</span>
  link_name <span style="color:#4070a0">'python'</span>
  path <span style="color:#4070a0">'/usr/bin/python3'</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="apt-package-resource">apt_package resource</h2> <a href="apt_package/index.html">apt_package resource page</a> <hr> <p>Use the <strong>apt_package</strong> resource to manage packages on Debian, Ubuntu, and other platforms that use the APT package system.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <h3 id="syntax-apt-package">Syntax</h3> <hr> <p>A <strong>apt_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>apt_package</strong> resource is: <code>apt_package 'package_name'</code> which will install the named package using all of the default options and the default action of <code>:install</code>.</p> <p>The full syntax for all of the properties that are available to the <strong>apt_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  default_release              <span style="color:#007020">String</span>
  options                      <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  overwrite_config_files       <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  package_name                 <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  response_file                <span style="color:#007020">String</span>
  response_file_variables      <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {}</span>
  timeout                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version                      <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action                       <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>apt_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>default_release</code>, <code>options</code>, <code>overwrite_config_files</code>, <code>package_name</code>, <code>response_file</code>, <code>response_file_variables</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-apt-package">Actions</h3> <hr> <p>The <strong>apt_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install a package. If a version is specified, install the specified version of the package. (default)</dd> <dt><code>:lock</code></dt> <dd>Locks the apt package to a specific version.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:reconfig</code></dt> <dd>Reconfigure a package. This action requires a response file.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:unlock</code></dt> <dd>Unlocks the apt package so that it can be upgraded to a newer version.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-apt-package">Properties</h3> <hr> <p>The <strong>apt_package</strong> resource has the following properties:</p> <dl> <dt> <code>default_release</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The default release. For example: <code>stable</code>.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional options that are passed to the command. For example, common apt-get directives, such as <code>--no-install-recommends</code>. See the <a href="http://manpages.ubuntu.com/manpages/jammy/en/man8/apt-get.8.html">apt-get man page</a> for the full list.</p> </dd> </dl> <dl> <dt> <code>overwrite_config_files</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Overwrite existing configuration files with those supplied by the package, if prompted by APT.</p> <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>response_file</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The direct path to the file used to pre-seed a package.</p> </dd> </dl> <dl> <dt> <code>response_file_variables</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> <p>A Hash of response file variables in the form of {‘VARIABLE’ =&gt; ‘VALUE’}.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <h4 id="multiple-packages-properties-apt-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <br> <h3 id="functionality-apt-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-apt-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-apt-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-apt-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h4 id="multiple-packages-common-apt-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <h3 id="examples-apt-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>apt_package</strong> resource in recipes:</p> <p><strong>Install a package using package manager</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install a package without specifying the default action</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_package <span style="color:#4070a0">'name of package'</span>
</code></pre></div>
<p><strong>Install multiple packages at once</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_package <span style="color:#c65d09">%w(package1 package2 package3)</span>
</code></pre></div>
<p><strong>Install without using recommend packages as a dependency</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'apache2'</span> <span style="color:#007020;font-weight:700">do</span>
  options <span style="color:#4070a0">'--no-install-recommends'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="apt-preference-resource">apt_preference resource</h2> <a href="apt_preference/index.html">apt_preference resource page</a> <hr> <p>Use the <strong>apt_preference</strong> resource to create APT <a href="https://wiki.debian.org/AptPreferences">preference files</a>. Preference files are used to control which package versions and sources are prioritized during installation.</p> <p><strong>New in Chef Infra Client 13.3.</strong></p> <h3 id="syntax-apt-preference">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>apt_preference</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_preference <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  glob              <span style="color:#007020">String</span>
  package_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  pin               <span style="color:#007020">String</span>
  pin_priority      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>apt_preference</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>glob</code>, <code>package_name</code>, <code>pin</code>, and <code>pin_priority</code> are the properties available to this resource.</li> </ul> <h3 id="actions-apt-preference">Actions</h3> <hr> <p>The <strong>apt_preference</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Creates a preferences file under <code>/etc/apt/preferences.d</code>. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Removes the preferences file, thus unpinning the package.</dd> </dl> <h3 id="properties-apt-preference">Properties</h3> <hr> <p>The <strong>apt_preference</strong> resource has the following properties:</p> <dl> <dt> <code>glob</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Pin by a <code>glob()</code> expression or with a regular expression surrounded by <code>/</code>.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>pin</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The package version or repository to pin.</p> </dd> </dl> <dl> <dt> <code>pin_priority</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <code>REQUIRED</code> <p>Sets the Pin-Priority for a package. See <a href="https://wiki.debian.org/AptPreferences">https://wiki.debian.org/AptPreferences</a> for more details.</p> </dd> </dl> <br> <h3 id="functionality-apt-preference">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-apt-preference">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-apt-preference">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-apt-preference">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-apt-preference">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>apt_preference</strong> resource in recipes:</p> <p><strong>Pin libmysqlclient16 to a version 5.1.49-3</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_preference <span style="color:#4070a0">'libmysqlclient16'</span> <span style="color:#007020;font-weight:700">do</span>
  pin          <span style="color:#4070a0">'version 5.1.49-3'</span>
  pin_priority <span style="color:#4070a0">'700'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Note: The <code>pin_priority</code> of <code>700</code> ensures that this version will be preferred over any other available versions.</p> <p><strong>Unpin a libmysqlclient16</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_preference <span style="color:#4070a0">'libmysqlclient16'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Pin all packages to prefer the packages.dotdeb.org repository</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_preference <span style="color:#4070a0">'dotdeb'</span> <span style="color:#007020;font-weight:700">do</span>
  glob         <span style="color:#4070a0">'*'</span>
  pin          <span style="color:#4070a0">'origin packages.dotdeb.org'</span>
  pin_priority <span style="color:#4070a0">'700'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="apt-repository-resource">apt_repository resource</h2> <a href="apt_repository/index.html">apt_repository resource page</a> <hr> <p>Use the <strong>apt_repository</strong> resource to specify additional APT repositories. Adding a new repository will update the APT package cache immediately.</p> <p><strong>New in Chef Infra Client 12.9.</strong></p> <h3 id="syntax-apt-repository">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>apt_repository</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_repository <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  arch               <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  cache_rebuild      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  components         <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: `main` if using a PPA repository.</span>
  cookbook           <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  deb_src            <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  distribution       <span style="color:#007020">String</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: The LSB codename of the node such as 'focal'.</span>
  key                <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  key_proxy          <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  keyserver          <span style="color:#007020">String</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: "keyserver.ubuntu.com"</span>
  repo_name          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  trusted            <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  uri                <span style="color:#007020">String</span>
  action             <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>apt_repository</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>arch</code>, <code>cache_rebuild</code>, <code>components</code>, <code>cookbook</code>, <code>deb_src</code>, <code>distribution</code>, <code>key</code>, <code>key_proxy</code>, <code>keyserver</code>, <code>repo_name</code>, <code>trusted</code>, and <code>uri</code> are the properties available to this resource.</li> </ul> <h3 id="actions-apt-repository">Actions</h3> <hr> <p>The <strong>apt_repository</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Creates a repository file at <code>/etc/apt/sources.list.d/</code> and builds the repository listing. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Removes the repository listing.</dd> </dl> <h3 id="properties-apt-repository">Properties</h3> <hr> <p>The <strong>apt_repository</strong> resource has the following properties:</p> <dl> <dt> <code>arch</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>Constrain packages to a particular CPU architecture such as <code>i386</code> or <code>amd64</code>.</p> </dd> </dl> <dl> <dt> <code>cache_rebuild</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Determines whether to rebuild the APT package cache.</p> </dd> </dl> <dl> <dt> <code>components</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>`main` if using a PPA repository.</code> <p>Package groupings, such as ‘main’ and ‘stable’.</p> </dd> </dl> <dl> <dt> <code>cookbook</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>If key should be a cookbook_file, specify a cookbook where the key is located for files/default. Default value is nil, so it will use the cookbook where the resource is used.</p> </dd> </dl> <dl> <dt> <code>deb_src</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Determines whether or not to add the repository as a source repo as well.</p> </dd> </dl> <dl> <dt> <code>distribution</code> </dt> <dd> <strong>Ruby Type:</strong> String, false | <strong>Default Value:</strong> <code>The LSB codename of the node such as 'focal'.</code> <p>Usually a distribution’s codename, such as <code>xenial</code>, <code>bionic</code>, or <code>focal</code>.</p> </dd> </dl> <dl> <dt> <code>key</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array, false | <strong>Default Value:</strong> <code>[]</code> <p>If a keyserver is provided, this is assumed to be the fingerprint; otherwise it can be either the URI of GPG key for the repo, or a cookbook_file.</p> </dd> </dl> <dl> <dt> <code>key_proxy</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>If set, a specified proxy is passed to GPG via <code>http-proxy=</code>.</p> </dd> </dl> <dl> <dt> <code>keyserver</code> </dt> <dd> <strong>Ruby Type:</strong> String, false | <strong>Default Value:</strong> <code>keyserver.ubuntu.com</code> <p>The GPG keyserver where the key for the repo should be retrieved.</p> </dd> </dl> <dl> <dt> <code>repo_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the repository name if it differs from the resource block’s name. The value of this setting must not contain spaces.</p> <p> New in Chef Client 14.1 </p> </dd> </dl> <dl> <dt> <code>trusted</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Determines whether you should treat all packages from this repository as authenticated regardless of signature.</p> </dd> </dl> <dl> <dt> <code>uri</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The base of the Debian distribution.</p> </dd> </dl> <br> <h3 id="functionality-apt-repository">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-apt-repository">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-apt-repository">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-apt-repository">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-apt-repository">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>apt_repository</strong> resource in recipes:</p> <p><strong>Add repository with basic settings</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_repository <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  uri        <span style="color:#4070a0">'http://nginx.org/packages/ubuntu/'</span>
  components <span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Enable Ubuntu multiverse repositories</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_repository <span style="color:#4070a0">'security-ubuntu-multiverse'</span> <span style="color:#007020;font-weight:700">do</span>
  uri          <span style="color:#4070a0">'http://security.ubuntu.com/ubuntu'</span>
  distribution <span style="color:#4070a0">'xenial-security'</span>
  components   <span style="color:#666">[</span><span style="color:#4070a0">'multiverse'</span><span style="color:#666">]</span>
  deb_src      <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add the Nginx PPA, autodetect the key and repository url</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_repository <span style="color:#4070a0">'nginx-php'</span> <span style="color:#007020;font-weight:700">do</span>
  uri          <span style="color:#4070a0">'ppa:nginx/stable'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add the JuJu PPA, grab the key from the Ubuntu keyserver, and add source repo</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_repository <span style="color:#4070a0">'juju'</span> <span style="color:#007020;font-weight:700">do</span>
  uri <span style="color:#4070a0">'ppa:juju/stable'</span>
  components <span style="color:#666">[</span><span style="color:#4070a0">'main'</span><span style="color:#666">]</span>
  distribution <span style="color:#4070a0">'xenial'</span>
  key <span style="color:#4070a0">'C8068B11'</span>
  action <span style="color:#517918">:add</span>
  deb_src <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add repository that requires multiple keys to authenticate packages</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_repository <span style="color:#4070a0">'rundeck'</span> <span style="color:#007020;font-weight:700">do</span>
  uri <span style="color:#4070a0">'https://dl.bintray.com/rundeck/rundeck-deb'</span>
  distribution <span style="color:#4070a0">'/'</span>
  key <span style="color:#666">[</span><span style="color:#4070a0">'379CE192D401AB61'</span>, <span style="color:#4070a0">'http://rundeck.org/keys/BUILD-GPG-KEY-Rundeck.org.key'</span><span style="color:#666">]</span>
  keyserver <span style="color:#4070a0">'keyserver.ubuntu.com'</span>
  action <span style="color:#517918">:add</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add the Cloudera Repo of CDH4 packages for Ubuntu 16.04 on AMD64</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_repository <span style="color:#4070a0">'cloudera'</span> <span style="color:#007020;font-weight:700">do</span>
  uri          <span style="color:#4070a0">'http://archive.cloudera.com/cdh4/ubuntu/xenial/amd64/cdh'</span>
  arch         <span style="color:#4070a0">'amd64'</span>
  distribution <span style="color:#4070a0">'xenial-cdh4'</span>
  components   <span style="color:#666">[</span><span style="color:#4070a0">'contrib'</span><span style="color:#666">]</span>
  key          <span style="color:#4070a0">'http://archive.cloudera.com/debian/archive.key'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove a repository from the list</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_repository <span style="color:#4070a0">'zenoss'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="apt-update-resource">apt_update resource</h2> <a href="apt_update/index.html">apt_update resource page</a> <hr> <p>Use the <strong>apt_update</strong> resource to manage APT repository updates on Debian and Ubuntu platforms.</p> <p><strong>New in Chef Infra Client 12.7.</strong></p> <h3 id="syntax-apt-update">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>apt_update</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_update <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  frequency      <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 86400</span>
  action         <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :periodic if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>apt_update</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>frequency</code> is the property available to this resource.</li> </ul> <h3 id="nameless-apt-update">Nameless</h3> <p>This resource can be <strong>nameless</strong>. Add the resource itself to your recipe to get the default behavior:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_update
</code></pre></div>
<p>will behave the same as:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_update <span style="color:#4070a0">'update'</span>
</code></pre></div> <h3 id="actions-apt-update">Actions</h3> <hr> <p>The <strong>apt_update</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:periodic</code></dt> <dd>Update the Apt repository at the interval specified by the <code>frequency</code> property. (default)</dd> <dt><code>:update</code></dt> <dd>Update the Apt repository at the start of a Chef Infra Client run.</dd> </dl> <h3 id="properties-apt-update">Properties</h3> <hr> <p>The <strong>apt_update</strong> resource has the following properties:</p> <dl> <dt> <code>frequency</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>86400</code> <p>Determines how frequently (in seconds) APT repository updates are made. Use this property when the <code>:periodic</code> action is specified.</p> </dd> </dl> <br> <h3 id="functionality-apt-update">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-apt-update">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-apt-update">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-apt-update">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-apt-update">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>apt_update</strong> resource in recipes:</p> <p><strong>Update the Apt repository at a specified interval</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_update <span style="color:#4070a0">'all platforms'</span> <span style="color:#007020;font-weight:700">do</span>
  frequency <span style="color:#40a070">86400</span>
  action <span style="color:#517918">:periodic</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Update the Apt repository at the start of a Chef Infra Client run</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_update <span style="color:#4070a0">'update'</span>
</code></pre></div> <h2 id="archive-file-resource">archive_file resource</h2> <a href="archive_file/index.html">archive_file resource page</a> <hr> <p>Use the <strong>archive_file</strong> resource to extract archive files to disk. This resource uses the libarchive library to extract multiple archive formats including tar, gzip, bzip, and zip formats.</p> <p><strong>New in Chef Infra Client 15.0.</strong></p> <h3 id="syntax-archive-file">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>archive_file</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">archive_file <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  destination           <span style="color:#007020">String</span>
  group                 <span style="color:#007020">String</span>
  mode                  <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: "'755'"</span>
  options               <span style="color:#007020">Array</span>, <span style="color:#60add5">Symbol</span>
  overwrite             <span style="color:#007020">true</span>, <span style="color:#007020">false</span>, auto <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  owner                 <span style="color:#007020">String</span>
  path                  <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  strip_components      <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 0</span>
  action                <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :extract if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>archive_file</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>destination</code>, <code>group</code>, <code>mode</code>, <code>options</code>, <code>overwrite</code>, <code>owner</code>, <code>path</code>, and <code>strip_components</code> are the properties available to this resource.</li> </ul> <h3 id="actions-archive-file">Actions</h3> <hr> <p>The <strong>archive_file</strong> resource has the following actions:</p> <dl> <dt><code>:extract</code></dt> <dd>Extract and archive file. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-archive-file">Properties</h3> <hr> <p>The <strong>archive_file</strong> resource has the following properties:</p> <dl> <dt> <code>destination</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The file path to extract the archive file to.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The group of the extracted files.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>'755'</code> <p>The mode of the extracted files. Integer values are deprecated as octal values (ex. 0755) would not be interpreted correctly.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> Array, Symbol | <strong>Default Value:</strong> <code>lazy default</code> <p>An array of symbols representing extraction flags. Example: <code>:no_overwrite</code> to prevent overwriting files on disk. By default, this properly sets <code>:time</code> which preserves the modification timestamps of files in the archive when writing them to disk.</p> </dd> </dl> <dl> <dt> <code>overwrite</code> </dt> <dd> <strong>Ruby Type:</strong> true, false, auto | <strong>Default Value:</strong> <code>false</code> <p>Should the resource overwrite the destination file contents if they already exist? If set to <code>:auto</code> the date stamp of files within the archive will be compared to those on disk and disk contents will be overwritten if they differ. This may cause unintended consequences if disk date stamps are changed between runs, which will result in the files being overwritten during each client run. Make sure to properly test any change to this property.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The owner of the extracted files.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the file path to the archive to extract if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>strip_components</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code> <p>Remove the specified number of leading path elements. Pathnames with fewer elements will be silently skipped. This behaves similarly to tar’s –strip-components command line argument.</p> <p> New in Chef Infra Client 17.5 </p> </dd> </dl> <br> <h3 id="functionality-archive-file">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-archive-file">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-archive-file">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-archive-file">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-archive-file">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>archive_file</strong> resource in recipes:</p> <p><strong>Extract a zip file to a specified directory</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">archive_file <span style="color:#4070a0">'Precompiled.zip'</span> <span style="color:#007020;font-weight:700">do</span>
  path <span style="color:#4070a0">'/tmp/Precompiled.zip'</span>
  destination <span style="color:#4070a0">'/srv/files'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Set specific permissions on the extracted files</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">archive_file <span style="color:#4070a0">'Precompiled.zip'</span> <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'tsmith'</span>
  group <span style="color:#4070a0">'staff'</span>
  mode <span style="color:#4070a0">'700'</span>
  path <span style="color:#4070a0">'/tmp/Precompiled.zip'</span>
  destination <span style="color:#4070a0">'/srv/files'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="bash-resource">bash resource</h2> <a href="bash/index.html">bash resource page</a> <hr> <p>Use the <strong>bash</strong> resource to execute scripts using the Bash interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <code>not_if</code> and <code>only_if</code> to guard this resource for idempotence.</p> <h3 id="syntax-bash">Syntax</h3> <hr> 
<p>A <strong>bash</strong> resource block executes scripts using Bash:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'extract_module'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>dirname(src_filepath)
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    mkdir <span style="color:#666">-</span><span style="color:#007020">p</span> <span style="color:#60a0b0;font-style:italic">#{extract_path}</span>
    tar xzf <span style="color:#60a0b0;font-style:italic">#{src_filename} -C #{extract_path}</span>
    mv <span style="color:#60a0b0;font-style:italic">#{extract_path}/*/* #{extract_path}/</span>
  <span style="color:#60add5">EOH</span>
  not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(extract_path) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>cwd</code> specifies the directory from which the command is run</li> <li>
<code>code</code> specifies the command to run</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>bash</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  code                       <span style="color:#007020">String</span>
  creates                    <span style="color:#007020">String</span>
  cwd                        <span style="color:#007020">String</span>
  environment                <span style="color:#60add5">Hash</span>
  flags                      <span style="color:#007020">String</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                       <span style="color:#007020">Array</span>
  returns                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span>
  timeout                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Float</span>
  user                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  umask                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>bash</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>code</code>, <code>creates</code>, <code>cwd</code>, <code>environment</code>, <code>flags</code>, <code>group</code>, <code>path</code>, <code>returns</code>, <code>timeout</code>, <code>user</code>, and <code>umask</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-bash">Actions</h3> <hr> <p>The <strong>bash</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:run</code></dt> <dd>Default. Run a script.</dd> </dl> <h3 id="properties-bash">Properties</h3> <hr> <p>The <strong>bash</strong> resource has the following properties:</p> <dl> <dt> <code>code</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>A quoted (" “) string of code to be executed.</p> </dd> </dl> <dl> <dt> <code>creates</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Prevent a command from creating a file when that file already exists.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The current working directory from which the command will be run.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of environment variables in the form of <code>({'ENV_VARIABLE' =&gt; 'VALUE'})</code>. <strong>Note</strong>: These variables must exist for a command to be run successfully.</p> </dd> </dl> <dl> <dt> <code>flags</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One or more command line flags that are passed to the interpreter when a command is invoked.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group name or group ID that must be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>returns</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Array | <strong>Default Value:</strong> <code>0</code> <p>The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String, Float | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) a command is to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The user name or user ID that should be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>umask</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The file mode creation mask, or umask.</p> </dd> </dl> <br> <h3 id="functionality-bash">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-bash">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-bash">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-bash">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-bash">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>bash</strong> resource in recipes:</p> <p>Use a named provider to run a script</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'install_something'</span> <span style="color:#007020;font-weight:700">do</span>
  user <span style="color:#4070a0">'root'</span>
  cwd <span style="color:#4070a0">'/tmp'</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    wget <span style="color:#517918">http</span>:<span style="color:#235388">//</span>www<span style="color:#666">.</span>example<span style="color:#666">.</span>com<span style="color:#666">/</span>tarball<span style="color:#666">.</span>tar<span style="color:#666">.</span>gz
    tar <span style="color:#666">-</span>zxf tarball<span style="color:#666">.</span>tar<span style="color:#666">.</span>gz
    cd tarball
    <span style="color:#666">.</span>/configure
    make
    make install
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install a file from a remote location using bash</p> <p>The following is an example of how to install the <code>foo123</code> module for Nginx. This module adds shell-style functionality to an Nginx configuration file and does the following:</p> <ul> <li>Declares three variables</li> <li>Gets the Nginx file from a remote location</li> <li>Installs the file using Bash to the path specified by the <code>src_filepath</code> variable</li> </ul> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># the following code sample is similar to the ``upload_progress_module``</span>
<span style="color:#60a0b0;font-style:italic"># recipe in the ``nginx`` cookbook:</span>
<span style="color:#60a0b0;font-style:italic"># https://github.com/chef-cookbooks/nginx</span>

src_filename <span style="color:#666">=</span> <span style="color:#4070a0">"foo123-nginx-module-v</span><span style="color:#70a0d0;font-style:italic">#{</span>
  node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'foo123'</span><span style="color:#666">][</span><span style="color:#4070a0">'version'</span><span style="color:#666">]</span>
<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.tar.gz"</span>
src_filepath <span style="color:#666">=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#4070a0">'file_cache_path'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span>src_filename<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
extract_path <span style="color:#666">=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>
  <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#4070a0">'file_cache_path'</span><span style="color:#666">]</span>
  <span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/nginx_foo123_module/</span><span style="color:#70a0d0;font-style:italic">#{</span>
  node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'foo123'</span><span style="color:#666">][</span><span style="color:#4070a0">'checksum'</span><span style="color:#666">]</span>
<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>

remote_file <span style="color:#4070a0">'src_filepath'</span> <span style="color:#007020;font-weight:700">do</span>
  source node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'foo123'</span><span style="color:#666">][</span><span style="color:#4070a0">'url'</span><span style="color:#666">]</span>
  checksum node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'foo123'</span><span style="color:#666">][</span><span style="color:#4070a0">'checksum'</span><span style="color:#666">]</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>

bash <span style="color:#4070a0">'extract_module'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>dirname(src_filepath)
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    mkdir <span style="color:#666">-</span><span style="color:#007020">p</span> <span style="color:#60a0b0;font-style:italic">#{extract_path}</span>
    tar xzf <span style="color:#60a0b0;font-style:italic">#{src_filename} -C #{extract_path}</span>
    mv <span style="color:#60a0b0;font-style:italic">#{extract_path}/*/* #{extract_path}/</span>
  <span style="color:#60add5">EOH</span>
  not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(extract_path) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install an application from git using bash</p> <p>The following example shows how Bash can be used to install a plug-in for rbenv named <code>ruby-build</code>, which is located in git version source control. First, the application is synchronized, and then Bash changes its working directory to the location in which <code>ruby-build</code> is located, and then runs a command.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">git <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/ruby-build"</span> <span style="color:#007020;font-weight:700">do</span>
  repository <span style="color:#4070a0">'git://github.com/sstephenson/ruby-build.git'</span>
  revision <span style="color:#4070a0">'master'</span>
  action <span style="color:#517918">:sync</span>
<span style="color:#007020;font-weight:700">end</span>

bash <span style="color:#4070a0">'install_ruby_build'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/ruby-build"</span>
  user <span style="color:#4070a0">'rbenv'</span>
  group <span style="color:#4070a0">'rbenv'</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span style="color:#666">.</span>/install<span style="color:#666">.</span>sh
  <span style="color:#60add5">EOH</span>
  environment <span style="color:#4070a0">'PREFIX'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/usr/local'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>To read more about <code>ruby-build</code>, see here: <a href="https://github.com/sstephenson/ruby-build">https://github.com/sstephenson/ruby-build</a>.</p> <p>Store certain settings</p> <p>The following recipe shows how an attributes file can be used to store certain settings. An attributes file is located in the <code>attributes/</code> directory in the same cookbook as the recipe which calls the attributes file. In this example, the attributes file specifies certain settings for Python that are then used across all nodes against which this recipe will run.</p> <p>Python packages have versions, installation directories, URLs, and checksum files. An attributes file that exists to support this type of recipe would include settings like the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'version'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'2.7.1'</span>

<span style="color:#007020;font-weight:700">if</span> python<span style="color:#666">[</span><span style="color:#4070a0">'install_method'</span><span style="color:#666">]</span> <span style="color:#666">==</span> <span style="color:#4070a0">'package'</span>
  default<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'prefix_dir'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'/usr'</span>
<span style="color:#007020;font-weight:700">else</span>
  default<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'prefix_dir'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'/usr/local'</span>
<span style="color:#007020;font-weight:700">end</span>

default<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'url'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'http://www.python.org/ftp/python'</span>
default<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'checksum'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'80e387...85fd61'</span>
</code></pre></div>
<p>and then the methods in the recipe may refer to these values. A recipe that is used to install Python will need to do the following:</p> <ul> <li>Identify each package to be installed (implied in this example, not shown)</li> <li>Define variables for the package <code>version</code> and the <code>install_path</code>
</li> <li>Get the package from a remote location, but only if the package does not already exist on the target system</li> <li>Use the <strong>bash</strong> resource to install the package on the node, but only when the package is not already installed</li> </ul> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic">#  the following code sample comes from the ``oc-nginx`` cookbook on |github|: https://github.com/cookbooks/oc-nginx</span>

version <span style="color:#666">=</span> node<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'version'</span><span style="color:#666">]</span>
install_path <span style="color:#666">=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'prefix_dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/lib/python</span><span style="color:#70a0d0;font-style:italic">#{</span>version<span style="color:#666">.</span>split(<span style="color:#235388">/(^\d+\.\d+)/</span>)<span style="color:#666">[</span><span style="color:#40a070">1</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>

remote_file <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/Python-</span><span style="color:#70a0d0;font-style:italic">#{</span>version<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.tar.bz2"</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'url'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span>version<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/Python-</span><span style="color:#70a0d0;font-style:italic">#{</span>version<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.tar.bz2"</span>
  checksum node<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'checksum'</span><span style="color:#666">]</span>
  mode <span style="color:#4070a0">'0755'</span>
  not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(install_path) }
<span style="color:#007020;font-weight:700">end</span>

bash <span style="color:#4070a0">'build-and-install-python'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
  code <span style="color:#4070a0">&lt;&lt;-EOF
</span>    tar <span style="color:#666">-</span>jxvf <span style="color:#60add5">Python</span><span style="color:#666">-</span><span style="color:#60a0b0;font-style:italic">#{version}.tar.bz2</span>
    (cd <span style="color:#60add5">Python</span><span style="color:#666">-</span><span style="color:#60a0b0;font-style:italic">#{version} &amp;&amp; ./configure #{configure_options})</span>
    (cd <span style="color:#60add5">Python</span><span style="color:#666">-</span><span style="color:#60a0b0;font-style:italic">#{version} &amp;&amp; make &amp;&amp; make install)</span>
  <span style="color:#60add5">EOF</span>
  not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(install_path) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="batch-resource">batch resource</h2> <a href="batch/index.html">batch resource page</a> <hr> <p>Use the <strong>batch</strong> resource to execute a batch script using the cmd.exe interpreter on Windows. The batch resource creates and executes a temporary file (similar to how the script resource behaves), rather than running the command inline. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <code>not_if</code> and <code>only_if</code> to guard this resource for idempotence.</p> <h3 id="syntax-batch">Syntax</h3> <hr> 
<p>A <strong>batch</strong> resource block executes a batch script using the cmd.exe interpreter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">batch <span style="color:#4070a0">'echo some env vars'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    echo <span style="color:#666">%</span><span style="color:#60add5">TEMP</span><span style="color:#666">%</span>
    echo <span style="color:#666">%</span><span style="color:#60add5">SYSTEMDRIVE</span><span style="color:#666">%</span>
    echo <span style="color:#666">%</span><span style="color:#60add5">PATH</span><span style="color:#666">%</span>
    echo <span style="color:#666">%</span><span style="color:#60add5">WINDIR</span><span style="color:#666">%</span>
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>The full syntax for all of the properties that are available to the <strong>batch</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">batch <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  architecture               <span style="color:#60add5">Symbol</span>
  code                       <span style="color:#007020">String</span>
  command                    <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  creates                    <span style="color:#007020">String</span>
  cwd                        <span style="color:#007020">String</span>
  flags                      <span style="color:#007020">String</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  guard_interpreter          <span style="color:#60add5">Symbol</span>
  interpreter                <span style="color:#007020">String</span>
  returns                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span>
  timeout                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Float</span>
  user                       <span style="color:#007020">String</span>
  password                   <span style="color:#007020">String</span>
  domain                     <span style="color:#007020">String</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>batch</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>architecture</code>, <code>code</code>, <code>command</code>, <code>creates</code>, <code>cwd</code>, <code>flags</code>, <code>group</code>, <code>guard_interpreter</code>, <code>interpreter</code>, <code>returns</code>, <code>timeout</code>, <code>user</code>, <code>password</code> and <code>domain</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-batch">Actions</h3> <hr> <p>The <strong>batch</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:run</code></dt> <dd>Run a batch file.</dd> </dl> <h3 id="properties-batch">Properties</h3> <hr> <p>The <strong>batch</strong> resource has the following properties:</p> <dl> <dt> <code>architecture</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol <p>The architecture of the process under which a script is executed. If a value is not provided, Chef Infra Client defaults to the correct value for the architecture, as determined by Ohai. An exception is raised when anything other than <code>:i386</code> is specified for a 32-bit process. Possible values: <code>:i386</code> (for 32-bit processes) and <code>:x86_64</code> (for 64-bit processes).</p> </dd> </dl> <dl> <dt> <code>code</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>A quoted string of code to be executed.</p> </dd> </dl> <dl> <dt> <code>command</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The name of the command to be executed.</p> </dd> </dl> <dl> <dt> <code>creates</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Prevent a command from creating a file when that file already exists.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The current working directory from which the command will be run.</p> </dd> </dl> <dl> <dt> <code>flags</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One or more command line flags that are passed to the interpreter when a command is invoked.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group name or group ID that must be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>guard_interpreter</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:batch</code> <p>When this property is set to <code>:batch</code>, the 64-bit version of the cmd.exe shell will be used to evaluate strings values for the <code>not_if</code> and <code>only_if</code> properties. Set this value to <code>:default</code> to use the 32-bit version of the cmd.exe shell.</p> </dd> </dl> <dl> <dt> <code>interpreter</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The script interpreter to use during code execution. Changing the default value of this property is not supported.</p> </dd> </dl> <dl> <dt> <code>returns</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Array | <strong>Default Value:</strong> <code>0</code> <p>The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String, Float | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) a command is to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The user name of the user identity with which to launch the new process. The user name may optionally be specified with a domain, i.e. <span class="title-ref">domainuser</span> or <span class="title-ref"><a href="mailto:user@my.dns.domain.com.html">user@my.dns.domain.com</a></span> via Universal Principal Name (UPN)format. It can also be specified without a domain simply as user if the domain is instead specified using the <span class="title-ref">domain</span> attribute. On Windows only, if this property is specified, the <span class="title-ref">password</span> property must be specified.</p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p><em>Windows only</em>: The password of the user specified by the <span class="title-ref">user</span> property. This property is mandatory if <span class="title-ref">user</span> is specified on Windows and may only be specified if <span class="title-ref">user</span> is specified. The <span class="title-ref">sensitive</span> property for this resource will automatically be set to true if password is specified.</p> </dd> </dl> <dl> <dt> <code>domain</code> </dt> <dd> <strong>Ruby Type:</strong> String <p><em>Windows only</em>: The domain of the user user specified by the <span class="title-ref">user</span> property. If not specified, the user name and password specified by the <span class="title-ref">user</span> and <span class="title-ref">password</span> properties will be used to resolve that user against the domain in which the system running Chef Infra Client is joined, or if that system is not joined to a domain it will resolve the user as a local account on that system. An alternative way to specify the domain is to leave this property unspecified and specify the domain as part of the <span class="title-ref">user</span> property.</p> </dd> </dl> <br> <h3 id="functionality-batch">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-batch">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-batch">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-batch">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-batch">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>batch</strong> resource in recipes:</p> <p>Unzip a file, and then move it</p> <p>To run a batch file that unzips and then moves Ruby, do something like:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">batch <span style="color:#4070a0">'unzip_and_move_ruby'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span style="color:#40a070">7</span>z<span style="color:#666">.</span>exe x <span style="color:#60a0b0;font-style:italic">#{Chef::Config[:file_cache_path]}/ruby-1.8.7-p352-i386-mingw32.7z</span>
      <span style="color:#666">-</span><span style="color:#517918">oC</span>:\\source <span style="color:#666">-</span>r <span style="color:#666">-</span>y
    xcopy <span style="color:#517918">C</span>:\\source\\ruby<span style="color:#666">-</span><span style="color:#40a070">1</span><span style="color:#666">.</span><span style="color:#40a070">8</span><span style="color:#666">.</span><span style="color:#40a070">7</span><span style="color:#666">-</span>p352<span style="color:#666">-</span>i386<span style="color:#666">-</span>mingw32 <span style="color:#517918">C</span>:\\ruby <span style="color:#235388">/e /</span>y
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>

batch <span style="color:#4070a0">'echo some env vars'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    echo <span style="color:#666">%</span><span style="color:#60add5">TEMP</span><span style="color:#666">%</span>
    echo <span style="color:#666">%</span><span style="color:#60add5">SYSTEMDRIVE</span><span style="color:#666">%</span>
    echo <span style="color:#666">%</span><span style="color:#60add5">PATH</span><span style="color:#666">%</span>
    echo <span style="color:#666">%</span><span style="color:#60add5">WINDIR</span><span style="color:#666">%</span>
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">batch <span style="color:#4070a0">'unzip_and_move_ruby'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span style="color:#40a070">7</span>z<span style="color:#666">.</span>exe x <span style="color:#60a0b0;font-style:italic">#{Chef::Config[:file_cache_path]}/ruby-1.8.7-p352-i386-mingw32.7z</span>
      <span style="color:#666">-</span><span style="color:#517918">oC</span>:\\source <span style="color:#666">-</span>r <span style="color:#666">-</span>y
    xcopy <span style="color:#517918">C</span>:\\source\\ruby<span style="color:#666">-</span><span style="color:#40a070">1</span><span style="color:#666">.</span><span style="color:#40a070">8</span><span style="color:#666">.</span><span style="color:#40a070">7</span><span style="color:#666">-</span>p352<span style="color:#666">-</span>i386<span style="color:#666">-</span>mingw32 <span style="color:#517918">C</span>:\\ruby <span style="color:#235388">/e /</span>y
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>

batch <span style="color:#4070a0">'echo some env vars'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">'echo %TEMP%\\necho %SYSTEMDRIVE%\\necho %PATH%\\necho %WINDIR%'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Run a command as an alternate user</p> <p><em>Note</em>: When Chef is running as a service, this feature requires that the user that Chef runs as has ‘SeAssignPrimaryTokenPrivilege’ (aka ‘SE_ASSIGNPRIMARYTOKEN_NAME’) user right. By default only LocalSystem and NetworkService have this right when running as a service. This is necessary even if the user is an Administrator.</p> <p>This right can be added and checked in a recipe using this example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># Add 'SeAssignPrimaryTokenPrivilege' for the user</span>
<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">ReservedNames</span><span style="color:#666">::</span><span style="color:#60add5">Win32</span><span style="color:#666">::</span><span style="color:#60add5">Security</span><span style="color:#666">.</span>add_account_right(<span style="color:#4070a0">'&lt;user&gt;'</span>, <span style="color:#4070a0">'SeAssignPrimaryTokenPrivilege'</span>)

<span style="color:#60a0b0;font-style:italic"># Check if the user has 'SeAssignPrimaryTokenPrivilege' rights</span>
<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">ReservedNames</span><span style="color:#666">::</span><span style="color:#60add5">Win32</span><span style="color:#666">::</span><span style="color:#60add5">Security</span><span style="color:#666">.</span>get_account_right(<span style="color:#4070a0">'&lt;user&gt;'</span>)<span style="color:#666">.</span>include?(<span style="color:#4070a0">'SeAssignPrimaryTokenPrivilege'</span>)
</code></pre></div>
<p>The following example shows how to run <code>mkdir test_dir</code> from a Chef Infra Client run as an alternate user.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># Passing only username and password</span>
batch <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 code <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 user <span style="color:#4070a0">"username"</span>
 password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Passing username and domain</span>
batch <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 code <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 domain <span style="color:#4070a0">"domain"</span>
 user <span style="color:#4070a0">"username"</span>
 password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Passing username = 'domain-name\\username'. No domain is passed</span>
batch <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 code <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 user <span style="color:#4070a0">"domain-name</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">username"</span>
 password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Passing username = 'username@domain-name'. No domain is passed</span>
batch <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 code <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 user <span style="color:#4070a0">"username@domain-name"</span>
 password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="bff-package-resource">bff_package resource</h2> <a href="bff_package/index.html">bff_package resource page</a> <hr> <p>Use the <strong>bff_package</strong> resource to manage packages for the AIX platform using the installp utility. When a package is installed from a local file, it must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>A Backup File Format (BFF) package may not have a <code>.bff</code> file extension. Chef Infra Client will still identify the correct provider to use based on the platform, regardless of the file extension.</p> </div> </div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <h3 id="syntax-bff-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>bff_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bff_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  options           <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name      <span style="color:#007020">String</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version           <span style="color:#007020">String</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>bff_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-bff-package">Actions</h3> <hr> <p>The <strong>bff_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> </dl> <h3 id="properties-bff-package">Properties</h3> <hr> <p>The <strong>bff_package</strong> resource has the following properties:</p> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Required. The path to a package in the local file system. The AIX platform requires <code>source</code> to be a local file system path because <code>installp</code> does not retrieve packages using HTTP or FTP.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-bff-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-bff-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-bff-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-bff-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-bff-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>bff_package</strong> resource in recipes:</p> <p>The <strong>bff_package</strong> resource is the default package provider on the AIX platform. The base <strong>package</strong> resource may be used, and then when the platform is AIX, Chef Infra Client will identify the correct package provider. The following examples show how to install part of the IBM XL C/C++ compiler.</p> <p><strong>Installing using the base package resource</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'xlccmp.13.1.0'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'/var/tmp/IBM_XL_C_13.1.0/usr/sys/inst.images/xlccmp.13.1.0'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Installing using the bff_package resource</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bff_package <span style="color:#4070a0">'xlccmp.13.1.0'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'/var/tmp/IBM_XL_C_13.1.0/usr/sys/inst.images/xlccmp.13.1.0'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="breakpoint-resource">breakpoint resource</h2> <a href="breakpoint/index.html">breakpoint resource page</a> <hr> <p>Use the <strong>breakpoint</strong> resource to add breakpoints to recipes. Run the chef-shell in Chef Infra Client mode, and then use those breakpoints to debug recipes. Breakpoints are ignored by the chef-client during an actual chef-client run. That said, breakpoints are typically used to debug recipes only when running them in a non-production environment, after which they are removed from those recipes before the parent cookbook is uploaded to the Chef server.</p> <p><strong>New in Chef Infra Client 12.0.</strong></p> <h3 id="syntax-breakpoint">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>breakpoint</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">breakpoint <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  action      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :break if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>breakpoint</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> </ul> <h3 id="actions-breakpoint">Actions</h3> <hr> <p>The <strong>breakpoint</strong> resource has the following actions:</p> <dl> <dt><code>:break</code></dt> <dd>Add a breakpoint for use with chef-shell (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-breakpoint">Properties</h3> <hr> <p>This resource does not have any properties.</p> <h3 id="debug-recipes-chef-shell">Debug Recipes with chef-shell</h3> chef-shell is a recipe debugging tool that allows the use of breakpoints within recipes. chef-shell runs as an Interactive Ruby (IRb) session. chef-shell supports both recipe and attribute file syntax, as well as interactive debugging features. <h4 id="chef-shell-modes">Modes</h4> <p>chef-shell is tool that is run using an Interactive Ruby (IRb) session. chef-shell currently supports recipe and attribute file syntax, as well as interactive debugging features. chef-shell has three run modes:</p> <table> <col style="width:40%"> <col style="width:60%"> <thead> <tr class="header"> <th>Mode</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>Standalone</td> <td>Default. No cookbooks are loaded, and the run-list is empty.</td> </tr> <tr> <td>Solo</td> <td>chef-shell acts as a Chef Solo Client. It attempts to load the chef-solo configuration file at <code>~/.chef/config.rb</code> and any JSON attributes passed. If the JSON attributes set a run-list, it will be honored. Cookbooks will be loaded in the same way that chef-solo loads them. chef-solo mode is activated with the <code>-s</code> or <code>--solo</code> command line option, and JSON attributes are specified in the same way as for chef-solo, with <code>-j /path/to/chef-solo.json</code>.</td> </tr> <tr> <td>Client</td> <td>chef-shell acts as a Chef Infra Client. During startup, it reads the Chef Infra Client configuration file from <code>~/.chef/client.rb</code> and contacts the Chef Infra Server to get the node's run_list, attributes, and cookbooks. Chef Infra Client mode is activated with the <code>-z</code> or <code>--client</code> options. You can also specify the configuration file with <code>-c CONFIG</code> and the server URL with <code>-S SERVER_URL</code>.</td> </tr> </tbody> </table> <h4 id="debug-recipes-config">Configure</h4> <p>chef-shell determines which configuration file to load based on the following:</p> <ol> <li>If a configuration file is specified using the <code>-c</code> option, chef-shell will use the specified configuration file</li> <li>If a NAMED_CONF is given, chef-shell will load ~/.chef/NAMED_CONF/chef_shell.rb</li> <li>If no NAMED_CONF is given chef-shell will load ~/.chef/chef_shell.rb if it exists</li> <li>If no chef_shell.rb can be found, chef-shell falls back to load: <ul> <li>/etc/chef/client.rb if -z option is given.</li> <li>/etc/chef/solo.rb if –solo-legacy-mode option is given.</li> <li>.chef/config.rb if -s option is given.</li> <li>.chef/knife.rb if -s option is given.</li> </ul> </li> </ol> <h5 id="chef-shell-config-rb">chef-shell.rb</h5> <p>The chef-shell.rb file can be used to configure chef-shell in the same way as the client.rb file is used to configure Chef Infra Client. For example, to configure chef-shell to authenticate to the Chef Infra Server, copy the <code>node_name</code>, <code>client_key</code>, and <code>chef_server_url</code> settings from the config.rb file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node_name                <span style="color:#4070a0">'your-knife-clientname'</span>
client_key               <span style="color:#60add5">File</span><span style="color:#666">.</span>expand_path(<span style="color:#4070a0">'~/.chef/my-client.pem'</span>)
chef_server_url          <span style="color:#4070a0">'https://api.opscode.com/organizations/myorg'</span>
</code></pre></div>
<p>and then add them to the chef-shell.rb file. Other configuration possibilities include disabling Ohai plugins (which will speed up the chef-shell boot process) or including arbitrary Ruby code in the chef-shell.rb file.</p> <h5 id="chef-shell-run-as-chef-client">Run as a Chef Infra Client</h5> <p>By default, chef-shell loads in standalone mode and does not connect to the Chef Infra Server. The chef-shell can be run as a Chef Infra Client to verify functionality that is only available when Chef Infra Client connects to the Chef Infra Server, such as search functionality or accessing data stored in data bags.</p> <p>chef-shell can use the same credentials as knife when connecting to a Chef Infra Server. Make sure that the settings in chef-shell.rb are the same as those in config.rb, and then use the <code>-z</code> option as part of the command. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-shell -z
</code></pre></div> <h4 id="chef-shell-manage">Manage</h4> <p>When chef-shell is configured to access a Chef Infra Server, chef-shell can list, show, search for and edit cookbooks, clients, nodes, roles, environments, policyfiles, and data bags.</p> <p>The syntax for managing objects on the Chef Infra Server is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-shell -z named_configuration
</code></pre></div>
<p>Where:</p> <ul> <li>
<code>named_configuration</code> is an existing configuration file in <code>~/.chef/named_configuration/chef_shell.rb</code>, such as <code>production</code>, <code>staging</code>, or <code>test</code>.</li> </ul> <p>Once in chef-shell, commands can be run against objects as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; items.command
</code></pre></div>
<p>Where:</p> <ul> <li>
<code>items</code> is the type of item to search for: <code>cookbooks</code>, <code>clients</code>, <code>nodes</code>, <code>roles</code>, <code>environments</code> or a data bag.</li> <li>
<code>command</code> is the command: <code>list</code>, <code>show</code>, <code>find</code>, or <code>edit</code>.</li> </ul> <p>For example, to list all of the nodes in a configuration named “preprod”, enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; nodes.list
</code></pre></div>
<p>Which will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; <span style="color:#666">[</span>node<span style="color:#666">[</span>i-f09a939b<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-049a936f<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-eaaaa581<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-9154b1fb<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-6a213101<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-c2687aa9<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-7abeaa11<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-4eb8ac25<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-9a2030f1<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-a06875cb<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-145f457f<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-e032398b<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-dc8c98b7<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-6afdf401<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-f49b119c<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-5abfab31<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-78b8ac13<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-d99678b3<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-02322269<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-feb4a695<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-9e2232f5<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-6e213105<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-cdde3ba7<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-e8bfb083<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-743c2c1f<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-2eaca345<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-aa7f74c1<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-72fdf419<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-140e1e7f<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-f9d43193<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-bd2dc8d7<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-8e7f70e5<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-78f2e213<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-962232fd<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-4c322227<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-922232f9<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-c02728ab<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-f06c7b9b<span style="color:#666">]]</span>
</code></pre></div>
<p>The <code>list</code> command can take a code block, which will applied (but not saved), to each object that is returned from the server. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; nodes.list <span style="color:#666">{</span>|n| puts <span style="color:#4070a0">"#{n.name}: #{n.run_list}"</span> <span style="color:#666">}</span>
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; i-f09a939b: role<span style="color:#666">[</span>lb<span style="color:#666">]</span>, role<span style="color:#666">[</span>preprod<span style="color:#666">]</span>, recipe<span style="color:#666">[</span>aws<span style="color:#666">]</span>
   i-049a936f: role<span style="color:#666">[</span>lb<span style="color:#666">]</span>, role<span style="color:#666">[</span>preprod<span style="color:#666">]</span>, recipe<span style="color:#666">[</span>aws<span style="color:#666">]</span>
   i-9154b1fb: recipe<span style="color:#666">[</span>erlang<span style="color:#666">]</span>, role<span style="color:#666">[</span>base<span style="color:#666">]</span>, role<span style="color:#666">[</span>couchdb<span style="color:#666">]</span>, role<span style="color:#666">[</span>preprod<span style="color:#666">]</span>,
   i-6a213101: role<span style="color:#666">[</span>chef<span style="color:#666">]</span>, role<span style="color:#666">[</span>preprod<span style="color:#666">]</span>
   <span style="color:#60a0b0;font-style:italic"># more...</span>
</code></pre></div>
<p>The <code>show</code> command can be used to display a specific node. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; <span style="color:#bb60d5">load_balancer</span> <span style="color:#666">=</span> nodes.show<span style="color:#666">(</span><span style="color:#4070a0">'i-f09a939b'</span><span style="color:#666">)</span>
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; node<span style="color:#666">[</span>i-f09a939b<span style="color:#666">]</span>
</code></pre></div>
<p>Or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; load_balancer.ec2.public_hostname
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; <span style="color:#4070a0">"ec2-111-22-333-44.compute-1.amazonaws.com"</span>
</code></pre></div>
<p>The <code>find</code> command can be used to search the Chef Infra Server from the chef-shell. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; pp nodes.find<span style="color:#666">(</span>:ec2_public_hostname <span style="color:#666">=</span>&gt; <span style="color:#4070a0">'ec2*'</span><span style="color:#666">)</span>
</code></pre></div>
<p>You can also format the results with a code block. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; pp nodes.find<span style="color:#666">(</span>:ec2_public_hostname <span style="color:#666">=</span>&gt; <span style="color:#4070a0">'ec2*'</span><span style="color:#666">)</span> <span style="color:#666">{</span>|n| n.ec2.ami_id <span style="color:#666">}</span> and nil
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; <span style="color:#666">[</span><span style="color:#4070a0">"ami-f8927a91"</span>,
    <span style="color:#4070a0">"ami-f8927a91"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>
    <span style="color:#60a0b0;font-style:italic"># and more...</span>
</code></pre></div>
<p>Or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; <span style="color:#bb60d5">amis</span> <span style="color:#666">=</span> nodes.find<span style="color:#666">(</span>:ec2_public_hostname <span style="color:#666">=</span>&gt; <span style="color:#4070a0">'ec2*'</span><span style="color:#666">)</span> <span style="color:#666">{</span>|n| n.ec2.ami_id <span style="color:#666">}</span>
chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; puts amis.uniq.sort
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; ami-4b4ba522
   ami-a89870c1
   ami-eef61587
   ami-f8927a91
</code></pre></div> <h4 id="chef-shell-breakpoints">Use Breakpoints</h4> chef-shell allows the current position in a run-list to be manipulated during a Chef Infra Client run. Add breakpoints to a recipe to take advantage of this functionality. <h5 id="chef-shell-step-through-run-list">Step Through Run-list</h5> <p>To explore how using the <strong>breakpoint</strong> to manually step through a Chef Infra Client run, create a simple recipe in chef-shell:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; recipe_mode
  chef:recipe &gt; <span style="color:#007020">echo</span> off
  chef:recipe &gt; file <span style="color:#4070a0">"/tmp/before-breakpoint"</span>
  chef:recipe &gt; breakpoint <span style="color:#4070a0">"foo"</span>
  chef:recipe &gt; file <span style="color:#4070a0">"/tmp/after-breakpoint"</span>
</code></pre></div>
<p>and then run Chef Infra Client:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; run_chef
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> at /tmp/before-breakpoint
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> DEBUG: Processing <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> DEBUG: <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span> using Chef::Provider::Breakpoint
</code></pre></div>
<p>Chef Infra Client ran the first resource before the breakpoint (<code>file[/tmp/before-breakpoint]</code>), but then stopped after execution. Chef Infra Client attempted to name the breakpoint after its position in the source file, but Chef Infra Client was confused because the resource was entered interactively. From here, chef-shell can resume the interrupted Chef Infra Client run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; chef_run.resume
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:27:08 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span> at /tmp/after-breakpoint
</code></pre></div>
<p>A quick view of the <code>/tmp</code> directory shows that the following files were created:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">after-breakpoint
before-breakpoint
</code></pre></div>
<p>You can rewind and step through a Chef Infra Client run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; Chef::Log.level <span style="color:#666">=</span> :debug <span style="color:#60a0b0;font-style:italic"># debug logging won't turn on automatically in this case</span>
    <span style="color:#666">=</span>&gt; :debug
  chef:recipe &gt; chef_run.rewind
    <span style="color:#666">=</span>&gt; <span style="color:#40a070">0</span>
  chef:recipe &gt; chef_run.step
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:52 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:52 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
    <span style="color:#666">=</span>&gt; <span style="color:#40a070">1</span>
  chef:recipe &gt; chef_run.step
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:54 -0800<span style="color:#666">]</span> DEBUG: Processing <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:54 -0800<span style="color:#666">]</span> DEBUG: <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span> using Chef::Provider::Breakpoint
    <span style="color:#666">=</span>&gt; <span style="color:#40a070">2</span>
  chef:recipe &gt; chef_run.step
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:56 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:56 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
    <span style="color:#666">=</span>&gt; <span style="color:#40a070">3</span>
</code></pre></div>
<p>From the output, the rewound run-list is shown, but when the resources are executed again, they will repeat their checks for the existence of files. If they exist, Chef Infra Client will skip creating them. If the files are deleted, then:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; ls<span style="color:#666">(</span><span style="color:#4070a0">"/tmp"</span><span style="color:#666">)</span>.grep<span style="color:#666">(</span>/breakpoint/<span style="color:#666">)</span>.each <span style="color:#666">{</span>|f| rm <span style="color:#4070a0">"/tmp/#{f}"</span> <span style="color:#666">}</span>
    <span style="color:#666">=</span>&gt; <span style="color:#666">[</span><span style="color:#4070a0">"after-breakpoint"</span>, <span style="color:#4070a0">"before-breakpoint"</span><span style="color:#666">]</span>
</code></pre></div>
<p>Rewind, and then resume your Chef Infra Client run to get the expected results:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; chef_run.rewind
  chef:recipe &gt; chef_run.resume
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> at /tmp/before-breakpoint
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> DEBUG: Processing <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> DEBUG: <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span> using Chef::Provider::Breakpoint
  chef:recipe &gt; chef_run.resume
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:49:20 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:49:20 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:49:20 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span> at /tmp/after-breakpoint
</code></pre></div> <h5 id="chef-shell-debug-existing-recipe">Debug Existing Recipe</h5> <p>chef-shell can be used to debug existing recipes. The recipe first needs to be added to a run-list for the node, so that it is cached when starting chef-shell and then used for debugging. chef-shell will report which recipes are being cached when it is started:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">loading configuration: none <span style="color:#666">(</span>standalone session<span style="color:#666">)</span>
Session type: standalone
Loading.............done.

Welcome to the chef-shell 15.8.23
For usage see https://docs.chef.io/chef_shell.html

run <span style="color:#4070a0">`</span>help<span style="color:#4070a0">' for help, `exit'</span> or ^D to quit.

chef <span style="color:#666">(</span>15.8.23<span style="color:#666">)</span>&gt;
</code></pre></div>
<p>To just load one recipe from the run-list, go into the recipe and use the <code>include_recipe</code> command. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; recipe_mode
  chef:recipe &gt; include_recipe <span style="color:#4070a0">"getting-started"</span>
    <span style="color:#666">=</span>&gt; <span style="color:#666">[</span><span style="color:#60a0b0;font-style:italic">#&lt; Chef::Recipe:0x10256f9e8 @cookbook_name="getting-started",</span>
  ... output truncated ...
</code></pre></div>
<p>To load all of the recipes from a run-list, use code similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>run_list<span style="color:#666">.</span>expand(node<span style="color:#666">.</span>chef_environment)<span style="color:#666">.</span>recipes<span style="color:#666">.</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>r<span style="color:#666">|</span>
  include_recipe r
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>After the recipes that are to be debugged have been loaded, use the <code>run_chef</code> command to run them.</p> <h5 id="chef-shell-advanced-debug">Advanced Debugging</h5> <p>In chef-shell, it is possible to get verbose debugging using the tracing feature in Interactive Ruby (IRb). chef-shell provides a shortcut for turning tracing on and off. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; tracing on
tracing is <span style="color:#bb60d5">on</span>
<span style="color:#666">=</span>&gt; nil
chef &gt;
</code></pre></div>
<p>and:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; tracing off
<span style="color:#60a0b0;font-style:italic">#0:(irb):2:Object:-: tracing off</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:109:Shell::Extensions::ObjectCoreExtensions:&gt;:       def off</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:110:Shell::Extensions::ObjectCoreExtensions:-:         :off</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:111:Shell::Extensions::ObjectCoreExtensions:&lt;:       end</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:272:main:&gt;:       def tracing(on_or_off)</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:273:main:-:         conf.use_tracer = on_or_off.on_off_to_bool</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:162:Shell::Extensions::Symbol:&gt;:       def on_off_to_bool</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:163:Shell::Extensions::Symbol:-:         to_s.on_off_to_bool</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:149:Shell::Extensions::String:&gt;:       def on_off_to_bool</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:150:Shell::Extensions::String:-:         case self</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:154:Shell::Extensions::String:-:           false</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:158:Shell::Extensions::String:&lt;:       end</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:164:Shell::Extensions::Symbol:&lt;:       end</span>
tracing is <span style="color:#bb60d5">off</span>
<span style="color:#666">=</span>&gt; nil
chef &gt;
</code></pre></div> <h4 id="chef-shell-debug-examples">Debug Examples</h4> <p>The following examples show how to use chef-shell. </p> <h5 id="chef-shell-debug-example-hello-world">"Hello World"</h5> <p>This example shows how to run chef-shell in standalone mode. (For chef-solo or Chef Infra Client modes, you would need to run chef-shell using the <code>-s</code> or <code>-z</code> command line options, and then take into consideration the necessary configuration settings.)</p> <p>When Chef Infra Client is installed using RubyGems or a package manager, chef-shell should already be installed. When Chef Infra Client is run from a git clone, it will be located in <code>chef/bin/chef shell</code>. To start chef-shell, just run it without any options. You’ll see the loading message, then the banner, and then the chef-shell prompt:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">bin/chef-shell

  loading configuration: none <span style="color:#666">(</span>standalone session<span style="color:#666">)</span>
  Session type: standalone
  Loading.............done.

  Welcome to the chef-shell 15.8.23
  For usage see https://docs.chef.io/chef_shell.html

  run <span style="color:#4070a0">`</span>help<span style="color:#4070a0">' for help, `exit'</span> or ^D to quit.

  chef <span style="color:#666">(</span>15.8.23<span style="color:#666">)</span>&gt;
</code></pre></div>
<p>(Use the help command to print a list of supported commands.) Use the recipe_mode command to switch to recipe context:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; recipe_mode
  chef:recipe_mode &gt;
</code></pre></div>
<p>Typing is evaluated in the same context as recipes. Create a file resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe_mode &gt; file <span style="color:#4070a0">"/tmp/ohai2u_shef"</span>
    <span style="color:#666">=</span>&gt; <span style="color:#60a0b0;font-style:italic">#&lt; Chef::Resource::File:0x1b691ac</span>
       @enclosing_provider<span style="color:#666">=</span>nil,
       @resource_name<span style="color:#666">=</span>:file,
       @before<span style="color:#666">=</span>nil,
       @supports<span style="color:#666">={}</span>,
       @backup<span style="color:#666">=</span>5,
       @allowed_actions<span style="color:#666">=[</span>:nothing, :create, :delete, :touch, :create_if_missing<span style="color:#666">]</span>,
       @only_if<span style="color:#666">=</span>nil,
       @noop<span style="color:#666">=</span>nil,
       @collection<span style="color:#666">=</span><span style="color:#60a0b0;font-style:italic">#&lt; Chef::ResourceCollection:0x1b9926c</span>
       @insert_after_idx<span style="color:#666">=</span>nil,
       @resources_by_name<span style="color:#666">={</span><span style="color:#4070a0">"file[/tmp/ohai2u_shef]"</span><span style="color:#666">=</span>&gt;0<span style="color:#666">}</span>,
       @resources<span style="color:#666">=[</span><span style="color:#60a0b0;font-style:italic">#&lt; Chef::Resource::File:0x1b691ac ...&gt;]&gt;,</span>
       @updated<span style="color:#666">=</span>false,
       @provider<span style="color:#666">=</span>nil,
       @node<span style="color:#666">=</span>&lt; Chef::Node:0xdeeaae
       @name<span style="color:#666">=</span><span style="color:#4070a0">"eigenstate.local"</span>&gt;,
       @recipe_name<span style="color:#666">=</span>nil,
       @not_if<span style="color:#666">=</span>nil,
       @name<span style="color:#666">=</span><span style="color:#4070a0">"/tmp/ohai2u_shef"</span>,
       @action<span style="color:#666">=</span><span style="color:#4070a0">"create"</span>,
       @path<span style="color:#666">=</span><span style="color:#4070a0">"/tmp/ohai2u_shef"</span>,
       @source_line<span style="color:#666">=</span><span style="color:#4070a0">"/Users/username/ruby/chef/chef/(irb#1) line 1"</span>,
       @params<span style="color:#666">={}</span>,
       @actions<span style="color:#666">={}</span>,
       @cookbook_name<span style="color:#666">=</span>nil,
       @ignore_failure<span style="color:#666">=</span>false&gt;
</code></pre></div>
<p>(The previous example was formatted for presentation.) At this point, chef-shell has created the resource and put it in the run-list, but not yet created the file. To initiate a Chef Infra Client run, use the <code>run_chef</code> command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe_mode &gt; run_chef
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:42:47 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/ohai2u_shef<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:42:47 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/ohai2u_shef<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:42:47 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/ohai2u_shef<span style="color:#666">]</span> at /tmp/ohai2u_shef
    <span style="color:#666">=</span>&gt; <span style="color:#007020">true</span>
</code></pre></div>
<p>chef-shell can also switch to the same context as attribute files. Set an attribute with the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe_mode &gt; attributes_mode
  chef:attributes &gt; default<span style="color:#666">[</span>:hello<span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">"ohai2u-again"</span>
    <span style="color:#666">=</span>&gt; <span style="color:#4070a0">"ohai2u-again"</span>
  chef:attributes &gt;
</code></pre></div>
<p>Switch back to recipe_mode context and use the attributes:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:attributes &gt; <span style="color:#bb60d5">recipe_mode</span>
    <span style="color:#666">=</span>&gt; :attributes
  chef:recipe_mode &gt; file <span style="color:#4070a0">"/tmp/#{node.hello}"</span>
</code></pre></div>
<p>Now, run Chef Infra Client again:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe_mode &gt; run_chef
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:53:22 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/ohai2u_shef<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:53:22 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/ohai2u_shef<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:53:22 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/ohai2u-again<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:53:22 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/ohai2u-again<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:53:22 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/ohai2u-again<span style="color:#666">]</span> at /tmp/ohai2u-again
    <span style="color:#666">=</span>&gt; <span style="color:#007020">true</span>
  chef:recipe_mode &gt;
</code></pre></div>
<p>Because the first resource (<code>file[/tmp/ohai2u_shef]</code>) is still in the run-list, it gets executed again. And because that file already exists, Chef Infra Client doesn’t attempt to re-create it. Finally, the files were created using the <code>ls</code> method:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe_mode &gt; ls<span style="color:#666">(</span><span style="color:#4070a0">"/tmp"</span><span style="color:#666">)</span>.grep<span style="color:#666">(</span>/ohai/<span style="color:#666">)</span>
    <span style="color:#666">=</span>&gt; <span style="color:#666">[</span><span style="color:#4070a0">"ohai2u-again"</span>, <span style="color:#4070a0">"ohai2u_shef"</span><span style="color:#666">]</span>
  Shell Tutorial
</code></pre></div> <h5 id="chef-shell-debug-examples-specific-nodes">Get Specific Nodes</h5> <p>To get a list of nodes using a recipe named <code>postfix</code> use <code>search(:node,"recipe:postfix")</code>. To get a list of nodes using a sub-recipe named <code>delivery</code>, use chef-shell. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">search(<span style="color:#517918">:node</span>, <span style="color:#4070a0">'recipes:postfix\:\:delivery'</span>)
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Single (' ‘) vs. double (" “) is important. This is because a backslash () needs to be included in the string, instead of having Ruby interpret it as an escape.</p> </div> </div> <h3 id="examples-breakpoint">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>breakpoint</strong> resource in recipes:</p> <p><strong>A recipe without a breakpoint</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_key node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'elrepo'</span><span style="color:#666">][</span><span style="color:#4070a0">'key'</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:700">do</span>
  url  node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'elrepo'</span><span style="color:#666">][</span><span style="color:#4070a0">'key_url'</span><span style="color:#666">]</span>
  action <span style="color:#517918">:add</span>
<span style="color:#007020;font-weight:700">end</span>

yum_repository <span style="color:#4070a0">'elrepo'</span> <span style="color:#007020;font-weight:700">do</span>
  description <span style="color:#4070a0">'ELRepo.org Community Enterprise Linux Extras Repository'</span>
  key node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'elrepo'</span><span style="color:#666">][</span><span style="color:#4070a0">'key'</span><span style="color:#666">]</span>
  mirrorlist node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'elrepo'</span><span style="color:#666">][</span><span style="color:#4070a0">'url'</span><span style="color:#666">]</span>
  includepkgs node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'elrepo'</span><span style="color:#666">][</span><span style="color:#4070a0">'includepkgs'</span><span style="color:#666">]</span>
  exclude node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'elrepo'</span><span style="color:#666">][</span><span style="color:#4070a0">'exclude'</span><span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>The same recipe with breakpoints</strong></p> <p>In the following example, the name of each breakpoint is an arbitrary string.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">breakpoint <span style="color:#4070a0">"before yum_key node['yum']['repo_name']['key']"</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:break</span>
<span style="color:#007020;font-weight:700">end</span>

yum_key node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'repo_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'key'</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:700">do</span>
  url  node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'repo_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'key_url'</span><span style="color:#666">]</span>
  action <span style="color:#517918">:add</span>
<span style="color:#007020;font-weight:700">end</span>

breakpoint <span style="color:#4070a0">"after yum_key node['yum']['repo_name']['key']"</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:break</span>
<span style="color:#007020;font-weight:700">end</span>

breakpoint <span style="color:#4070a0">"before yum_repository 'repo_name'"</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:break</span>
<span style="color:#007020;font-weight:700">end</span>

yum_repository <span style="color:#4070a0">'repo_name'</span> <span style="color:#007020;font-weight:700">do</span>
  description <span style="color:#4070a0">'description'</span>
  key node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'repo_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'key'</span><span style="color:#666">]</span>
  mirrorlist node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'repo_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'url'</span><span style="color:#666">]</span>
  includepkgs node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'repo_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'includepkgs'</span><span style="color:#666">]</span>
  exclude node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'repo_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'exclude'</span><span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>

breakpoint <span style="color:#4070a0">"after yum_repository 'repo_name'"</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:break</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In the previous examples, the names are used to indicate if the breakpoint is before or after a resource and also to specify which resource it is before or after.</p> <h2 id="build-essential-resource">build_essential resource</h2> <a href="build_essential/index.html">build_essential resource page</a> <hr> <p>Use the <strong>build_essential</strong> resource to install the packages required for compiling C software from source.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-build-essential">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>build_essential</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">build_essential <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  raise_if_unsupported      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  action                    <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>build_essential</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>raise_if_unsupported</code> is the property available to this resource.</li> </ul> <h3 id="nameless-build-essential">Nameless</h3> <p>This resource can be <strong>nameless</strong>. Add the resource itself to your recipe to get the default behavior:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">build_essential
</code></pre></div>
<p>will behave the same as:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">build_essential <span style="color:#4070a0">'install tools'</span>
</code></pre></div> <h3 id="actions-build-essential">Actions</h3> <hr> <p>The <strong>build_essential</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install build essential packages. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:upgrade</code></dt> <dd>Upgrade the Xcode CLI Tools on macOS hosts. <strong>New in Chef Infra Client 16</strong>
</dd> </dl> <h3 id="properties-build-essential">Properties</h3> <hr> <p>The <strong>build_essential</strong> resource has the following properties:</p> <dl> <dt> <code>raise_if_unsupported</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Raise a hard error on platforms where this resource is unsupported.</p> <p> New in Chef Infra Client 15.5 </p> </dd> </dl> <br> <h3 id="functionality-build-essential">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-build-essential">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-build-essential">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-build-essential">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-build-essential">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>build_essential</strong> resource in recipes:</p> <p><strong>Install compilation packages</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">build_essential
</code></pre></div>
<p><strong>Install compilation packages during the compilation phase</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">build_essential <span style="color:#4070a0">'Install compilation tools'</span> <span style="color:#007020;font-weight:700">do</span>
  compile_time <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Upgrade compilation packages on macOS systems</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">build_essential <span style="color:#4070a0">'Install compilation tools'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="cab-package-resource">cab_package resource</h2> <a href="cab_package/index.html">cab_package resource page</a> <hr> <p>Use the <strong>cab_package</strong> resource to install or remove Microsoft Windows cabinet (.cab) packages.</p> <p><strong>New in Chef Infra Client 12.15.</strong></p> <h3 id="syntax-cab-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>cab_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cab_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  options           <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name      <span style="color:#007020">String</span>
  source            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: The package name.</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version           <span style="color:#007020">String</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>cab_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-cab-package">Actions</h3> <hr> <p>The <strong>cab_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Installs the cabinet package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Removes the cabinet package.</dd> </dl> <h3 id="properties-cab-package">Properties</h3> <hr> <p>The <strong>cab_package</strong> resource has the following properties:</p> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The package name.</code> <p>The local file path or URL for the CAB package.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-cab-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-cab-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-cab-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-cab-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-cab-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>cab_package</strong> resource in recipes:</p> <p><strong>Using local path in source</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cab_package <span style="color:#4070a0">'Install .NET 3.5 sp1 via KB958488'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'C:\Users\xyz\AppData\Local\Temp\Windows6.1-KB958488-x64.cab'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>

cab_package <span style="color:#4070a0">'Remove .NET 3.5 sp1 via KB958488'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'C:\Users\xyz\AppData\Local\Temp\Windows6.1-KB958488-x64.cab'</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Using URL in source</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cab_package <span style="color:#4070a0">'Install .NET 3.5 sp1 via KB958488'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'https://s3.amazonaws.com/my_bucket/Windows6.1-KB958488-x64.cab'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>

cab_package <span style="color:#4070a0">'Remove .NET 3.5 sp1 via KB958488'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'https://s3.amazonaws.com/my_bucket/Temp\Windows6.1-KB958488-x64.cab'</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chef-acl-resource">chef_acl resource</h2> <a href="chef_acl/index.html">chef_acl resource page</a> <hr> <p>Use the <strong>chef_acl</strong> resource to interact with access control lists (ACLs) that exist on the Chef Infra Server.</p> <h3 id="syntax-chef-acl">Syntax</h3> <hr> 
<p>The syntax for using the <strong>chef_acl</strong> resource in a recipe is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_acl <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  attribute <span style="color:#4070a0">'value'</span> <span style="color:#60a0b0;font-style:italic"># see properties section below</span>
  <span style="color:#666">...</span>
  action <span style="color:#517918">:action</span> <span style="color:#60a0b0;font-style:italic"># see actions section below</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>chef_acl</code> tells Chef Infra Client to use the <code>Chef::Provider::ChefAcl</code> provider during a Chef Infra Client run</li> <li>
<code>name</code> is the name of the resource block; when the <code>path</code> property is not specified as part of a recipe, <code>name</code> is also the name of the Chef Infra Client.</li> <li>
<code>attribute</code> is zero (or more) of the properties that are available for this resource</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state</li> </ul> <h3 id="actions-chef-acl">Actions</h3> <hr> <p>The <strong>chef_acl</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-acl">Properties</h3> <hr> <p>The <strong>chef_acl</strong> resource has the following properties:</p> <dl> <dt> <code>chef_server</code> </dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>complete</code> </dt> <dd> <p>Use to specify if this resource defines a chef-client completely. When <code>true</code>, any property not specified by this resource will be reset to default property values.</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <p>A path to a directory in the chef-repo against which the ACL is applied. For example: <code>nodes</code>, <code>nodes/*</code>, <code>nodes/my_node</code>, <code>*/*</code>, <code>**</code>, <code>roles/base</code>, <code>data/secrets</code>, <code>cookbooks/apache2</code>, <code>/users/*</code>, and so on.</p> </dd> </dl> <dl> <dt> <code>raw_json</code> </dt> <dd> 
<p>Chef Infra Client as JSON data. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"clientname"</span><span style="color:#666">:</span> <span style="color:#4070a0">"client_name"</span>,
  <span style="color:#4070a0">"orgname"</span><span style="color:#666">:</span> <span style="color:#4070a0">"org_name"</span>,
  <span style="color:#4070a0">"validator"</span><span style="color:#666">:</span> <span style="color:#007020;font-weight:700">false</span>,
  <span style="color:#4070a0">"certificate"</span><span style="color:#666">:</span> <span style="color:#4070a0">"-----BEGIN CERTIFICATE-----\n
</span><span style="color:#4070a0">                  ...
</span><span style="color:#4070a0">                  1234567890abcdefghijklmnopq\n
</span><span style="color:#4070a0">                  ...
</span><span style="color:#4070a0">                  -----END CERTIFICATE-----\n"</span>,
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"node_name"</span>
}
</code></pre></div> </dd> </dl> <dl> <dt> <code>recursive</code> </dt> <dd> <p>Use to apply changes to child objects. Use <code>:on_change</code> to apply changes to child objects only if the parent object changes. Set to <code>true</code> to apply changes even if the parent object does not change. Set to <code>false</code> to prevent any changes. Default value: <code>:on_change</code>.</p> </dd> </dl> <dl> <dt> <code>remove_rights</code> </dt> <dd> 
<p>Use to remove rights. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remove_rights <span style="color:#517918">:read</span>, <span style="color:#517918">:users</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'jkeiser'</span>, <span style="color:#517918">:groups</span> <span style="color:#666">=&gt;</span> <span style="color:#666">[</span> <span style="color:#4070a0">'admins'</span>, <span style="color:#4070a0">'users'</span> <span style="color:#666">]</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remove_rights <span style="color:#666">[</span> <span style="color:#517918">:create</span>, <span style="color:#517918">:read</span> <span style="color:#666">]</span>, <span style="color:#517918">:users</span> <span style="color:#666">=&gt;</span> <span style="color:#666">[</span> <span style="color:#4070a0">'jkeiser'</span>, <span style="color:#4070a0">'adam'</span> <span style="color:#666">]</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remove_rights <span style="color:#517918">:all</span>, <span style="color:#517918">:users</span> <span style="color:#666">=&gt;</span> <span style="color:#666">[</span> <span style="color:#4070a0">'jkeiser'</span>, <span style="color:#4070a0">'adam'</span> <span style="color:#666">]</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>rights</code> </dt> <dd> 
<p>Use to add rights. Syntax: <code>:right, :right =&gt; 'user', :groups =&gt; [ 'group', 'group']</code>. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights <span style="color:#517918">:read</span>, <span style="color:#517918">:users</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'jkeiser'</span>, <span style="color:#517918">:groups</span> <span style="color:#666">=&gt;</span> <span style="color:#666">[</span> <span style="color:#4070a0">'admins'</span>, <span style="color:#4070a0">'users'</span> <span style="color:#666">]</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights <span style="color:#666">[</span> <span style="color:#517918">:create</span>, <span style="color:#517918">:read</span> <span style="color:#666">]</span>, <span style="color:#517918">:users</span> <span style="color:#666">=&gt;</span> <span style="color:#666">[</span> <span style="color:#4070a0">'jkeiser'</span>, <span style="color:#4070a0">'adam'</span> <span style="color:#666">]</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights <span style="color:#517918">:all</span>, <span style="color:#517918">:users</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'jkeiser'</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <h3 id="examples-chef-acl">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="chef-client-resource">chef_client resource</h2> <a href="chef_client/index.html">chef_client resource page</a> <hr> <p>Use the <strong>chef_client</strong> resource to create clients on your Chef Infra Server from within Chef Infra cookbook code.</p> <h3 id="syntax-chef-client">Syntax</h3> <hr> 
<p>The syntax for using the <strong>chef_client</strong> resource in a recipe is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  attribute <span style="color:#4070a0">'value'</span> <span style="color:#60a0b0;font-style:italic"># see properties section below</span>
  <span style="color:#666">...</span>
  action <span style="color:#517918">:action</span> <span style="color:#60a0b0;font-style:italic"># see actions section below</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>chef_client</code> tells Chef Infra Client to use the <code>Chef::Provider::ChefClient</code> provider during a Chef Infra Client run</li> <li>
<code>name</code> is the name of the resource block; when the <code>name</code> property is not specified as part of a recipe, <code>name</code> is also the name of the Chef Infra Client</li> <li>
<code>attribute</code> is zero (or more) of the properties that are available for this resource</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state</li> </ul> <h3 id="actions-chef-client">Actions</h3> <hr> <p>The <strong>chef_client</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Use to create a chef-client.</dd> <dt><code>:delete</code></dt> <dd>Use to delete a chef-client.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:regenerate_keys</code></dt> <dd>Use to regenerate the RSA public key for a chef-client.</dd> </dl> <h3 id="properties-chef-client">Properties</h3> <hr> <p>The <strong>chef_client</strong> resource has the following properties:</p> <dl> <dt> <code>admin</code> </dt> <dd> <p>Use to specify whether Chef Infra Client is an API client.</p> </dd> </dl> <dl> <dt> <code>chef_server</code> </dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>complete</code> </dt> <dd> <p>Use to specify if this resource defines a chef-client completely. When <code>true</code>, any property not specified by this resource will be reset to default property values.</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>name</code> </dt> <dd> <p>The name of Chef Infra Client.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>output_key_format</code> </dt> <dd> <p>Use to specify the format of a public key. Possible values: <code>pem</code>, <code>der</code>, or <code>openssh</code>. Default value: <code>openssh</code>.</p> </dd> </dl> <dl> <dt> <code>output_key_path</code> </dt> <dd> <p>Use to specify the path to the location in which a public key will be written.</p> </dd> </dl> <dl> <dt> <code>raw_json</code> </dt> <dd> 
<p>Chef Infra Client as JSON data. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"clientname"</span><span style="color:#666">:</span> <span style="color:#4070a0">"client_name"</span>,
  <span style="color:#4070a0">"orgname"</span><span style="color:#666">:</span> <span style="color:#4070a0">"org_name"</span>,
  <span style="color:#4070a0">"validator"</span><span style="color:#666">:</span> <span style="color:#007020;font-weight:700">false</span>,
  <span style="color:#4070a0">"certificate"</span><span style="color:#666">:</span> <span style="color:#4070a0">"-----BEGIN CERTIFICATE-----\n
</span><span style="color:#4070a0">                  ...
</span><span style="color:#4070a0">                  1234567890abcdefghijklmnopq\n
</span><span style="color:#4070a0">                  ...
</span><span style="color:#4070a0">                  -----END CERTIFICATE-----\n"</span>,
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"node_name"</span>
}
</code></pre></div> </dd> </dl> <dl> <dt> <code>source_key</code> </dt> <dd> <p>Use to copy a public or private key, but apply a different <code>format</code> and <code>password</code>. Use in conjunction with <code>source_key_pass_phrase</code> and <code>source_key_path</code>.</p> </dd> </dl> <dl> <dt> <code>source_key_pass_phrase</code> </dt> <dd> <p>The pass phrase for the public key. Use in conjunction with <code>source_key</code> and <code>source_key_path</code>.</p> </dd> </dl> <dl> <dt> <code>source_key_path</code> </dt> <dd> <p>The path to the public key. Use in conjunction with <code>source_key</code> and <code>source_key_pass_phrase</code>.</p> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>validator</code> </dt> <dd> <p>Use to specify if Chef Infra Client is a chef-validator.</p> </dd> </dl> <h3 id="examples-chef-client">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="chef-client-config-resource">chef_client_config resource</h2> <a href="chef_client_config/index.html">chef_client_config resource page</a> <hr> <p>Use the <strong>chef_client_config</strong> resource to create a client.rb file in the Chef Infra Client configuration directory. See the <a href="../config_rb_client/index.html">client.rb docs</a> for more details on options available in the client.rb configuration file.</p> <p><strong>New in Chef Infra Client 16.6.</strong></p> <h3 id="syntax-chef-client-config">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chef_client_config</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_config <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  additional_config              <span style="color:#007020">String</span>
  chef_license                   <span style="color:#007020">String</span>
  chef_server_url                <span style="color:#007020">String</span>
  config_directory               <span style="color:#007020">String</span>
  data_collector_server_url      <span style="color:#007020">String</span>
  data_collector_token           <span style="color:#007020">String</span>
  event_loggers                  <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  exception_handlers             <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  file_backup_path               <span style="color:#007020">String</span>
  file_cache_path                <span style="color:#007020">String</span>
  file_staging_uses_destdir      <span style="color:#007020">String</span>
  formatters                     <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  ftp_proxy                      <span style="color:#007020">String</span>
  group                          <span style="color:#007020">String</span>
  http_proxy                     <span style="color:#007020">String</span>
  https_proxy                    <span style="color:#007020">String</span>
  log_level                      <span style="color:#60add5">Symbol</span>
  log_location                   <span style="color:#007020">String</span>, <span style="color:#60add5">Symbol</span>
  minimal_ohai                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  named_run_list                 <span style="color:#007020">String</span>
  no_proxy                       <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  node_name                      <span style="color:#007020">String</span>
  ohai_disabled_plugins          <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  ohai_optional_plugins          <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  pid_file                       <span style="color:#007020">String</span>
  policy_group                   <span style="color:#007020">String</span>
  policy_name                    <span style="color:#007020">String</span>
  policy_persist_run_list        <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  report_handlers                <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  ssl_verify_mode                <span style="color:#60add5">Symbol</span>, <span style="color:#007020">String</span>
  start_handlers                 <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  user                           <span style="color:#007020">String</span>
  action                         <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chef_client_config</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>additional_config</code>, <code>chef_license</code>, <code>chef_server_url</code>, <code>config_directory</code>, <code>data_collector_server_url</code>, <code>data_collector_token</code>, <code>event_loggers</code>, <code>exception_handlers</code>, <code>file_backup_path</code>, <code>file_cache_path</code>, <code>file_staging_uses_destdir</code>, <code>formatters</code>, <code>ftp_proxy</code>, <code>group</code>, <code>http_proxy</code>, <code>https_proxy</code>, <code>log_level</code>, <code>log_location</code>, <code>minimal_ohai</code>, <code>named_run_list</code>, <code>no_proxy</code>, <code>node_name</code>, <code>ohai_disabled_plugins</code>, <code>ohai_optional_plugins</code>, <code>pid_file</code>, <code>policy_group</code>, <code>policy_name</code>, <code>policy_persist_run_list</code>, <code>report_handlers</code>, <code>ssl_verify_mode</code>, <code>start_handlers</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h3 id="actions-chef-client-config">Actions</h3> <hr> <p>The <strong>chef_client_config</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create a client.rb config file for configuring Chef Infra Client. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a client.rb config file for configuring Chef Infra Client.</dd> </dl> <h3 id="properties-chef-client-config">Properties</h3> <hr> <p>The <strong>chef_client_config</strong> resource has the following properties:</p> <dl> <dt> <code>additional_config</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Additional text to add at the bottom of the client.rb config. This can be used to run custom Ruby or to add less common config options</p> </dd> </dl> <dl> <dt> <code>chef_license</code> </dt> <dd> <strong>Ruby Type:</strong> String <strong>Allowed Values:</strong> <code>"accept", "accept-no-persist", "accept-silent"</code> <p>Accept the <a href="https://www.chef.io/end-user-license-agreement/">Chef EULA</a></p> </dd> </dl> <dl> <dt> <code>chef_server_url</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The URL for the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>config_directory</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>`/etc/chef/` on *nix-like systems and `C:\chef\` on Windows</code> <p>The directory to store the client.rb in.</p> </dd> </dl> <dl> <dt> <code>data_collector_server_url</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The data collector URL (typically automate) to send node, converge, and compliance data.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If possible, use Chef Infra Server to do all data collection reporting, as this removes the need to distribute tokens to individual nodes.</p> </div> </div> <p> New in Chef Infra Client 17.8 </p> </dd> </dl> <dl> <dt> <code>data_collector_token</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The data collector token to interact with the data collector server URL (Automate).</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If possible, use Chef Infra Server to do all data collection reporting, as this removes the need to distribute tokens to individual nodes.</p> </div> </div> <p> New in Chef Infra Client 17.8 </p> </dd> </dl> <dl> <dt> <code>event_loggers</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> </dd> </dl> <dl> <dt> <code>exception_handlers</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of hashes that contain a exception handler class and the arguments to pass to that class on initialization. The hash should include <code>class</code> and <code>argument</code> keys where <code>class</code> is a String and <code>argument</code> is an array of quoted String values. For example: <code>[{'class' =&gt; 'MyHandler', %w('"argument1"', '"argument2"')}]</code></p> </dd> </dl> <dl> <dt> <code>file_backup_path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The location in which backup files are stored. If this value is empty, backup files are stored in the directory of the target file</p> </dd> </dl> <dl> <dt> <code>file_cache_path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The location in which cookbooks (and other transient data) files are stored when they are synchronized. This value can also be used in recipes to download files with the <code>remote_file</code> resource.</p> </dd> </dl> <dl> <dt> <code>file_staging_uses_destdir</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>How file staging (via temporary files) is done. When <code>true</code>, temporary files are created in the directory in which files will reside. When <code>false</code>, temporary files are created under <code>ENV['TMP']</code></p> </dd> </dl> <dl> <dt> <code>formatters</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>Client logging formatters to load.</p> </dd> </dl> <dl> <dt> <code>ftp_proxy</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The proxy server to use for FTP connections.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The group that should own the client.rb file and the configuration directory if it needs to be created.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The configuration directory will not be created if it already exists, which allows you to further control the setup of that directory outside of this resource.</p> </div> </div> </dd> </dl> <dl> <dt> <code>http_proxy</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The proxy server to use for HTTP connections.</p> </dd> </dl> <dl> <dt> <code>https_proxy</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The proxy server to use for HTTPS connections.</p> </dd> </dl> <dl> <dt> <code>log_level</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol <strong>Allowed Values:</strong> <code>:auto, :debug, :fatal, :info, :trace, :warn</code> <p>The level of logging performed by the Chef Infra Client.</p> </dd> </dl> <dl> <dt> <code>log_location</code> </dt> <dd> <strong>Ruby Type:</strong> String, Symbol <p>The location to save logs to. This can either by a path to a log file on disk <code>:syslog</code> to log to Syslog, <code>:win_evt</code> to log to the Windows Event Log, or <code>'STDERR'</code>/<code>'STDOUT'</code> to log to the *nix text streams.</p> </dd> </dl> <dl> <dt> <code>minimal_ohai</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Run a minimal set of Ohai plugins providing data necessary for the execution of Chef Infra Client’s built-in resources. Setting this to true will skip many large and time consuming data sets such as <code>cloud</code> or <code>packages</code>. Setting this this to true may break cookbooks that assume all Ohai data will be present.</p> </dd> </dl> <dl> <dt> <code>named_run_list</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A specific named runlist defined in the node’s applied Policyfile, which the should be used when running Chef Infra Client.</p> </dd> </dl> <dl> <dt> <code>no_proxy</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>[]</code> <p>A comma-separated list or an array of URLs that do not need a proxy.</p> </dd> </dl> <dl> <dt> <code>node_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The `node.name` value reported by Chef Infra Client.</code> <p>The name of the node. This configuration sets the <code>node.name</code> value used in cookbooks and the <code>client_name</code> value used when authenticating to a Chef Infra Server to determine what configuration to apply.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>By default this configuration uses the <code>node.name</code> value which would be set during bootstrap. Hard coding this value in the <code>client.rb</code> config avoids logic within Chef Infra Server that performs DNS lookups and may fail in the event of a DNS outage. To skip this default value and instead use the built-in Chef Infra Server logic, set this property to <code>nil</code></p> </div> </div> </dd> </dl> <dl> <dt> <code>ohai_disabled_plugins</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>Ohai plugins that should be disabled in order to speed up the Chef Infra Client run and reduce the size of node data sent to Chef Infra Client</p> </dd> </dl> <dl> <dt> <code>ohai_optional_plugins</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>Optional Ohai plugins that should be enabled to provide additional Ohai data for use in cookbooks.</p> </dd> </dl> <dl> <dt> <code>pid_file</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The location in which a process identification number (pid) is saved. An executable, when started as a daemon, writes the pid to the specified file.</p> </dd> </dl> <dl> <dt> <code>policy_group</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of a <code>policy group</code> that exists on the Chef Infra Server. <code>policy_name</code> must also be specified when setting this property.</p> </dd> </dl> <dl> <dt> <code>policy_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of a policy, as identified by the <code>name</code> setting in a Policyfile.rb file. <code>policy_group</code> when setting this property.</p> </dd> </dl> <dl> <dt> <code>policy_persist_run_list</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Override run lists defined in a Policyfile with the <code>run_list</code> defined on the Chef Infra Server.</p> <p> New in Chef Infra Client 17.3 </p> </dd> </dl> <dl> <dt> <code>report_handlers</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of hashes that contain a report handler class and the arguments to pass to that class on initialization. The hash should include <code>class</code> and <code>argument</code> keys where <code>class</code> is a String and <code>argument</code> is an array of quoted String values. For example: <code>[{'class' =&gt; 'MyHandler', %w('"argument1"', '"argument2"')}]</code></p> </dd> </dl> <dl> <dt> <code>ssl_verify_mode</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, String <strong>Allowed Values:</strong> <code>:verify_none, :verify_peer</code> 
<p>Set the verify mode for HTTPS requests.</p> <ul> <li>Use :verify_none for no validation of SSL certificates.</li> <li>Use :verify_peer for validation of all SSL certificates, including the Chef Infra Server connections, S3 connections, and any HTTPS remote_file resource URLs used in Chef Infra Client runs. This is the recommended setting.</li> </ul> </dd> </dl> <dl> <dt> <code>start_handlers</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of hashes that contain a report handler class and the arguments to pass to that class on initialization. The hash should include <code>class</code> and <code>argument</code> keys where <code>class</code> is a String and <code>argument</code> is an array of quoted String values. For example: <code>[{'class' =&gt; 'MyHandler', %w('"argument1"', '"argument2"')}]</code></p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The user that should own the client.rb file and the configuration directory if it needs to be created.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The configuration directory will not be created if it already exists, which allows you to further control the setup of that directory outside of this resource.</p> </div> </div> </dd> </dl> <br> <h3 id="functionality-chef-client-config">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chef-client-config">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chef-client-config">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chef-client-config">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chef-client-config">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chef_client_config</strong> resource in recipes:</p> <p><strong>Bare minimum Chef Infra Client client.rb</strong>:</p> <p>The absolute minimum configuration necessary for a node to communicate with the Chef Infra Server is the URL of the Chef Infra Server. All other configuration options either have values at the server side (Policyfiles, Roles, Environments, etc) or have default values determined at client startup.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_config <span style="color:#4070a0">'Create client.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  chef_server_url <span style="color:#4070a0">'https://chef.example.dmz'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>More complex Chef Infra Client client.rb</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_config <span style="color:#4070a0">'Create client.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  chef_server_url <span style="color:#4070a0">'https://chef.example.dmz'</span>
  log_level <span style="color:#517918">:info</span>
  log_location <span style="color:#517918">:syslog</span>
  http_proxy <span style="color:#4070a0">'proxy.example.dmz'</span>
  https_proxy <span style="color:#4070a0">'proxy.example.dmz'</span>
  no_proxy <span style="color:#c65d09">%w(internal.example.dmz)</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Adding additional config content to the client.rb</strong>:</p> <p>This resource aims to provide common configuration options. Some configuration options are missing and some users may want to use arbitrary Ruby code within their configuration. For this we offer an <code>additional_config</code> property that can be used to add any configuration or code to the bottom of the <code>client.rb</code> file. Also keep in mind that within the configuration directory is a <code>client.d</code> directory where you can put additional <code>.rb</code> files containing configuration options. These can be created using <code>file</code> or <code>template</code> resources within your cookbooks as necessary.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_config <span style="color:#4070a0">'Create client.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  chef_server_url <span style="color:#4070a0">'https://chef.example.dmz'</span>
  additional_config <span style="color:#666">&lt;&lt;~</span><span style="color:#60add5">CONFIG</span>
    <span style="color:#60a0b0;font-style:italic"># Extra config code to safely load a gem into the client run.</span>
    <span style="color:#60a0b0;font-style:italic"># Since the config is Ruby you can run any Ruby code you want via the client.rb.</span>
    <span style="color:#60a0b0;font-style:italic"># It's a great way to break things, so be careful</span>
    <span style="color:#007020;font-weight:700">begin</span>
      <span style="color:#007020">require</span> <span style="color:#4070a0">'aws-sdk'</span>
    <span style="color:#007020;font-weight:700">rescue</span> <span style="color:#60add5">LoadError</span>
      <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>warn <span style="color:#4070a0">"Failed to load aws-sdk."</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#60add5">CONFIG</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Setup two report handlers in the client.rb</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_config <span style="color:#4070a0">'Create client.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  chef_server_url <span style="color:#4070a0">'https://chef.example.dmz'</span>
  report_handlers <span style="color:#666">[</span>
    {
     <span style="color:#4070a0">'class'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'ReportHandler1Class'</span>,
     <span style="color:#4070a0">'arguments'</span> <span style="color:#666">=&gt;</span> <span style="color:#666">[</span><span style="color:#4070a0">"'FirstArgument'"</span>, <span style="color:#4070a0">"'SecondArgument'"</span><span style="color:#666">]</span>,
    },
    {
     <span style="color:#4070a0">'class'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'ReportHandler2Class'</span>,
     <span style="color:#4070a0">'arguments'</span> <span style="color:#666">=&gt;</span> <span style="color:#666">[</span><span style="color:#4070a0">"'FirstArgument'"</span>, <span style="color:#4070a0">"'SecondArgument'"</span><span style="color:#666">]</span>,
    },
  <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Report directly to the <a href="../automate/data_collection/index.html#configure-chef-infra-client-to-use-the-data-collector-endpoint-in-chef-automate">Chef Automate data collector endpoint</a>.</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_config <span style="color:#4070a0">'Create client.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  chef_server_url <span style="color:#4070a0">'https://chef.example.dmz'</span>
  data_collector_server_url <span style="color:#4070a0">'https://automate.example.dmz'</span>
  data_collector_token <span style="color:#4070a0">'TEST_TOKEN_TEST'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chef-client-cron-resource">chef_client_cron resource</h2> <a href="chef_client_cron/index.html">chef_client_cron resource page</a> <hr> <p>Use the <strong>chef_client_cron</strong> resource to setup the Chef Infra Client to run as a cron job. This resource will also create the specified log directory if it doesn’t already exist.</p> <p><strong>New in Chef Infra Client 16.0.</strong></p> <h3 id="syntax-chef-client-cron">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chef_client_cron</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_cron <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  accept_chef_license      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  append_log_file          <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  chef_binary_path         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/opt/chef/bin/chef-client"</span>
  comment                  <span style="color:#007020">String</span>
  config_directory         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/etc/chef"</span>
  daemon_options           <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  day                      <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  environment              <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {}</span>
  hour                     <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  job_name                 <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "chef-client"</span>
  log_directory            <span style="color:#007020">String</span>
  log_file_name            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "client.log"</span>
  mailto                   <span style="color:#007020">String</span>
  minute                   <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "0,30"</span>
  month                    <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  nice                     <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>
  splay                    <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 300</span>
  user                     <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "root"</span>
  weekday                  <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  action                   <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chef_client_cron</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>accept_chef_license</code>, <code>append_log_file</code>, <code>chef_binary_path</code>, <code>comment</code>, <code>config_directory</code>, <code>daemon_options</code>, <code>day</code>, <code>environment</code>, <code>hour</code>, <code>job_name</code>, <code>log_directory</code>, <code>log_file_name</code>, <code>mailto</code>, <code>minute</code>, <code>month</code>, <code>nice</code>, <code>splay</code>, <code>user</code>, and <code>weekday</code> are the properties available to this resource.</li> </ul> <h3 id="actions-chef-client-cron">Actions</h3> <hr> <p>The <strong>chef_client_cron</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Add a cron job to run Chef Infra Client. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a cron job for Chef Infra Client.</dd> </dl> <h3 id="properties-chef-client-cron">Properties</h3> <hr> <p>The <strong>chef_client_cron</strong> resource has the following properties:</p> <dl> <dt> <code>accept_chef_license</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Accept the Chef Online Master License and Services Agreement. See <a href="https://www.chef.io/online-master-agreement">https://www.chef.io/online-master-agreement</a></p> </dd> </dl> <dl> <dt> <code>append_log_file</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Append to the log file instead of overwriting the log file on each run.</p> </dd> </dl> <dl> <dt> <code>chef_binary_path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/opt/chef/bin/chef-client</code> <p>The path to the chef-client binary.</p> </dd> </dl> <dl> <dt> <code>comment</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A comment to place in the cron.d file.</p> </dd> </dl> <dl> <dt> <code>config_directory</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/etc/chef</code> <p>The path of the config directory.</p> </dd> </dl> <dl> <dt> <code>daemon_options</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of options to pass to the chef-client command.</p> </dd> </dl> <dl> <dt> <code>day</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>*</code> <p>The day of month at which Chef Infra Client is to run (1 - 31) or a cron pattern such as ‘1,7,14,21,28’.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> <p>A Hash containing additional arbitrary environment variables under which the cron job will be run in the form of <code>({'ENV_VARIABLE' =&gt; 'VALUE'})</code>.</p> </dd> </dl> <dl> <dt> <code>hour</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>*</code> <p>The hour at which Chef Infra Client is to run (0 - 23) or a cron pattern such as ‘0,12’.</p> </dd> </dl> <dl> <dt> <code>job_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>chef-client</code> <p>The name of the cron job to create.</p> </dd> </dl> <dl> <dt> <code>log_directory</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/Library/Logs/Chef on macOS and /var/log/chef otherwise</code> <p>The path of the directory to create the log file in.</p> </dd> </dl> <dl> <dt> <code>log_file_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>client.log</code> <p>The name of the log file to use.</p> </dd> </dl> <dl> <dt> <code>mailto</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The e-mail address to e-mail any cron task failures to.</p> </dd> </dl> <dl> <dt> <code>minute</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>0,30</code> <p>The minute at which Chef Infra Client is to run (0 - 59) or a cron pattern such as ‘0,30’.</p> </dd> </dl> <dl> <dt> <code>month</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>*</code> <p>The month in the year on which Chef Infra Client is to run (1 - 12, jan-dec, or *).</p> </dd> </dl> <dl> <dt> <code>nice</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>The process priority to run the chef-client process at. A value of -20 is the highest priority and 19 is the lowest priority.</p> <p> New in Chef Infra Client 16.5 </p> </dd> </dl> <dl> <dt> <code>splay</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>300</code> <p>A random number of seconds between 0 and X to add to interval so that all chef-client commands don’t execute at the same time.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>root</code> <p>The name of the user that Chef Infra Client runs as.</p> </dd> </dl> <dl> <dt> <code>weekday</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>*</code> <p>The day of the week on which Chef Infra Client is to run (0-7, mon-sun, or *), where Sunday is both 0 and 7.</p> </dd> </dl> <br> <h3 id="functionality-chef-client-cron">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chef-client-cron">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chef-client-cron">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chef-client-cron">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chef-client-cron">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chef_client_cron</strong> resource in recipes:</p> <p><strong>Setup Chef Infra Client to run using the default 30 minute cadence</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_cron <span style="color:#4070a0">'Run Chef Infra Client as a cron job'</span>
</code></pre></div>
<p><strong>Run Chef Infra Client twice a day</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_cron <span style="color:#4070a0">'Run Chef Infra Client every 12 hours'</span> <span style="color:#007020;font-weight:700">do</span>
  minute <span style="color:#40a070">0</span>
  hour <span style="color:#4070a0">'0,12'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run Chef Infra Client with extra options passed to the client</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_cron <span style="color:#4070a0">'Run an override recipe'</span> <span style="color:#007020;font-weight:700">do</span>
  daemon_options <span style="color:#666">[</span><span style="color:#4070a0">'--override-runlist mycorp_base::default'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chef-client-launchd-resource">chef_client_launchd resource</h2> <a href="chef_client_launchd/index.html">chef_client_launchd resource page</a> <hr> <p>Use the <strong>chef_client_launchd</strong> resource to configure the Chef Infra Client to run on a schedule on macOS systems.</p> <p><strong>New in Chef Infra Client 16.5.</strong></p> <h3 id="syntax-chef-client-launchd">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chef_client_launchd</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_launchd <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  accept_chef_license      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  chef_binary_path         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/opt/chef/bin/chef-client"</span>
  config_directory         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/etc/chef"</span>
  daemon_options           <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  environment              <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {}</span>
  interval                 <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 30</span>
  log_directory            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/Library/Logs/Chef"</span>
  log_file_name            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "client.log"</span>
  low_priority_io          <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  nice                     <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>
  splay                    <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 300</span>
  user                     <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "root"</span>
  working_directory        <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/var/root"</span>
  action                   <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :enable if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chef_client_launchd</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>accept_chef_license</code>, <code>chef_binary_path</code>, <code>config_directory</code>, <code>daemon_options</code>, <code>environment</code>, <code>interval</code>, <code>log_directory</code>, <code>log_file_name</code>, <code>low_priority_io</code>, <code>nice</code>, <code>splay</code>, <code>user</code>, and <code>working_directory</code> are the properties available to this resource.</li> </ul> <h3 id="actions-chef-client-launchd">Actions</h3> <hr> <p>The <strong>chef_client_launchd</strong> resource has the following actions:</p> <dl> <dt><code>:disable</code></dt> <dd>Disable running Chef Infra Client on a schedule using launchd</dd> <dt><code>:enable</code></dt> <dd>Enable running Chef Infra Client on a schedule using launchd. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-client-launchd">Properties</h3> <hr> <p>The <strong>chef_client_launchd</strong> resource has the following properties:</p> <dl> <dt> <code>accept_chef_license</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Accept the Chef Online Master License and Services Agreement. See <a href="https://www.chef.io/online-master-agreement">https://www.chef.io/online-master-agreement</a></p> </dd> </dl> <dl> <dt> <code>chef_binary_path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/opt/chef/bin/chef-client</code> <p>The path to the chef-client binary.</p> </dd> </dl> <dl> <dt> <code>config_directory</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/etc/chef</code> <p>The path of the config directory.</p> </dd> </dl> <dl> <dt> <code>daemon_options</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of options to pass to the chef-client command.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> <p>A Hash containing additional arbitrary environment variables under which the launchd daemon will be run in the form of <code>({'ENV_VARIABLE' =&gt; 'VALUE'})</code>.</p> </dd> </dl> <dl> <dt> <code>interval</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>30</code> <p>Time in minutes between Chef Infra Client executions.</p> </dd> </dl> <dl> <dt> <code>log_directory</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/Library/Logs/Chef</code> <p>The path of the directory to create the log file in.</p> </dd> </dl> <dl> <dt> <code>log_file_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>client.log</code> <p>The name of the log file to use.</p> </dd> </dl> <dl> <dt> <code>low_priority_io</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Run the chef-client process with low priority disk IO</p> </dd> </dl> <dl> <dt> <code>nice</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>The process priority to run the chef-client process at. A value of -20 is the highest priority and 19 is the lowest priority.</p> </dd> </dl> <dl> <dt> <code>splay</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>300</code> <p>A random number of seconds between 0 and X to add to interval so that all chef-client commands don’t execute at the same time.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>root</code> <p>The name of the user that Chef Infra Client runs as.</p> </dd> </dl> <dl> <dt> <code>working_directory</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/var/root</code> <p>The working directory to run the Chef Infra Client from.</p> </dd> </dl> <br> <h3 id="functionality-chef-client-launchd">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chef-client-launchd">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chef-client-launchd">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chef-client-launchd">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chef-client-launchd">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chef_client_launchd</strong> resource in recipes:</p> <p><strong>Set the Chef Infra Client to run on a schedule</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_launchd <span style="color:#4070a0">'Setup the Chef Infra Client to run every 30 minutes'</span> <span style="color:#007020;font-weight:700">do</span>
  interval <span style="color:#40a070">30</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Disable the Chef Infra Client running on a schedule</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_launchd <span style="color:#4070a0">'Prevent the Chef Infra Client from running on a schedule'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:disable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chef-client-scheduled-task-resource">chef_client_scheduled_task resource</h2> <a href="chef_client_scheduled_task/index.html">chef_client_scheduled_task resource page</a> <hr> <p>Use the <strong>chef_client_scheduled_task</strong> resource to setup the Chef Infra Client to run as a Windows scheduled task. This resource will also create the specified log directory if it doesn’t already exist.</p> <p><strong>New in Chef Infra Client 16.0.</strong></p> <h3 id="syntax-chef-client-scheduled-task">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chef_client_scheduled_task</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_scheduled_task <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  accept_chef_license       <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  chef_binary_path          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "C:/opscode/chef/bin/chef-client"</span>
  config_directory          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/etc/chef"</span>
  daemon_options            <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  frequency                 <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "minute"</span>
  frequency_modifier        <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "30 if frequency is 'minute', 1 otherwise"</span>
  log_directory             <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "CONFIG_DIRECTORY/log"</span>
  log_file_name             <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "client.log"</span>
  password                  <span style="color:#007020">String</span>
  priority                  <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 7</span>
  run_on_battery            <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  splay                     <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 300</span>
  start_date                <span style="color:#007020">String</span>
  start_time                <span style="color:#007020">String</span>
  task_name                 <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "chef-client"</span>
  use_consistent_splay      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  user                      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "System"</span>
  action                    <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chef_client_scheduled_task</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>accept_chef_license</code>, <code>chef_binary_path</code>, <code>config_directory</code>, <code>daemon_options</code>, <code>frequency</code>, <code>frequency_modifier</code>, <code>log_directory</code>, <code>log_file_name</code>, <code>password</code>, <code>priority</code>, <code>run_on_battery</code>, <code>splay</code>, <code>start_date</code>, <code>start_time</code>, <code>task_name</code>, <code>use_consistent_splay</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h3 id="actions-chef-client-scheduled-task">Actions</h3> <hr> <p>The <strong>chef_client_scheduled_task</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Add a Windows Scheduled Task that runs Chef Infra Client. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a Windows Scheduled Task that runs Chef Infra Client.</dd> </dl> <h3 id="properties-chef-client-scheduled-task">Properties</h3> <hr> <p>The <strong>chef_client_scheduled_task</strong> resource has the following properties:</p> <dl> <dt> <code>accept_chef_license</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Accept the Chef Online Master License and Services Agreement. See <a href="https://www.chef.io/online-master-agreement">https://www.chef.io/online-master-agreement</a></p> </dd> </dl> <dl> <dt> <code>chef_binary_path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>C:/opscode/chef/bin/chef-client</code> <p>The path to the chef-client binary.</p> </dd> </dl> <dl> <dt> <code>config_directory</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/etc/chef</code> <p>The path of the config directory.</p> </dd> </dl> <dl> <dt> <code>daemon_options</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of options to pass to the chef-client command.</p> </dd> </dl> <dl> <dt> <code>frequency</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>minute</code> <strong>Allowed Values:</strong> <code>"daily", "hourly", "minute", "monthly", "on_idle", "on_logon", "once", "onstart"</code> <p>Frequency with which to run the task.</p> </dd> </dl> <dl> <dt> <code>frequency_modifier</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>30 if frequency is 'minute', 1 otherwise</code> <p>Numeric value to go with the scheduled task frequency</p> </dd> </dl> <dl> <dt> <code>log_directory</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>CONFIG_DIRECTORY/log</code> <p>The path of the directory to create the log file in.</p> </dd> </dl> <dl> <dt> <code>log_file_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>client.log</code> <p>The name of the log file to use.</p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The password for the user that Chef Infra Client runs as.</p> </dd> </dl> <dl> <dt> <code>priority</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>7</code> <p>Use to set Priority Levels range from 0 to 10.</p> <p> New in Chef Infra Client 17.5 </p> </dd> </dl> <dl> <dt> <code>run_on_battery</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Run the Chef Infra Client task when the system is on batteries.</p> </dd> </dl> <dl> <dt> <code>splay</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>300</code> <p>A random number of seconds between 0 and X to add to interval so that all chef-client commands don’t execute at the same time.</p> </dd> </dl> <dl> <dt> <code>start_date</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The start date for the task in m:d:Y format (ex: 12/17/2020).</p> </dd> </dl> <dl> <dt> <code>start_time</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The start time for the task in HH:mm format (ex: 14:00). If the frequency is minute default start time will be Time.now plus the frequency_modifier number of minutes.</p> </dd> </dl> <dl> <dt> <code>task_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>chef-client</code> <p>The name of the scheduled task to create.</p> </dd> </dl> <dl> <dt> <code>use_consistent_splay</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Always use the same random splay amount for each node to ensure consistent frequencies between chef-client execution.</p> <p> New in Chef Infra Client 17.5 </p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>System</code> <p>The name of the user that Chef Infra Client runs as.</p> </dd> </dl> <br> <h3 id="functionality-chef-client-scheduled-task">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chef-client-scheduled-task">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chef-client-scheduled-task">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chef-client-scheduled-task">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chef-client-scheduled-task">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chef_client_scheduled_task</strong> resource in recipes:</p> <p><strong>Setup Chef Infra Client to run using the default 30 minute cadence</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_scheduled_task <span style="color:#4070a0">'Run Chef Infra Client as a scheduled task'</span>
</code></pre></div>
<p><strong>Run Chef Infra Client on system start</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_scheduled_task <span style="color:#4070a0">'Chef Infra Client on start'</span> <span style="color:#007020;font-weight:700">do</span>
  frequency <span style="color:#4070a0">'onstart'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run Chef Infra Client with extra options passed to the client</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_scheduled_task <span style="color:#4070a0">'Run an override recipe'</span> <span style="color:#007020;font-weight:700">do</span>
  daemon_options <span style="color:#666">[</span><span style="color:#4070a0">'--override-runlist mycorp_base::default'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run Chef Infra Client daily at 01:00 am, specifying a named run-list</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_scheduled_task <span style="color:#4070a0">'Run chef-client named run-list daily'</span> <span style="color:#007020;font-weight:700">do</span>
  frequency <span style="color:#4070a0">'daily'</span>
  start_time <span style="color:#4070a0">'01:00'</span>
  daemon_options <span style="color:#666">[</span><span style="color:#4070a0">'-n audit_only'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run Chef Infra Client with a persistent delay on every run calculated once, similar to how chef_client_cron resource works</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_scheduled_task <span style="color:#4070a0">'Run chef-client with persistent splay'</span> <span style="color:#007020;font-weight:700">do</span>
  use_consistent_splay <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chef-client-systemd-timer-resource">chef_client_systemd_timer resource</h2> <a href="chef_client_systemd_timer/index.html">chef_client_systemd_timer resource page</a> <hr> <p>Use the <strong>chef_client_systemd_timer</strong> resource to setup the Chef Infra Client to run as a systemd timer.</p> <p><strong>New in Chef Infra Client 16.0.</strong></p> <h3 id="syntax-chef-client-systemd-timer">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chef_client_systemd_timer</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_systemd_timer <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  accept_chef_license      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  chef_binary_path         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/opt/chef/bin/chef-client"</span>
  config_directory         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/etc/chef"</span>
  cpu_quota                <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>
  daemon_options           <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  delay_after_boot         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "1min"</span>
  description              <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "Chef Infra Client periodic execution"</span>
  environment              <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {}</span>
  interval                 <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "30min"</span>
  job_name                 <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "chef-client"</span>
  run_on_battery           <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  splay                    <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "5min"</span>
  user                     <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "root"</span>
  action                   <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chef_client_systemd_timer</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>accept_chef_license</code>, <code>chef_binary_path</code>, <code>config_directory</code>, <code>cpu_quota</code>, <code>daemon_options</code>, <code>delay_after_boot</code>, <code>description</code>, <code>environment</code>, <code>interval</code>, <code>job_name</code>, <code>run_on_battery</code>, <code>splay</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h3 id="actions-chef-client-systemd-timer">Actions</h3> <hr> <p>The <strong>chef_client_systemd_timer</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Add a systemd timer that runs Chef Infra Client. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a systemd timer that runs Chef Infra Client.</dd> </dl> <h3 id="properties-chef-client-systemd-timer">Properties</h3> <hr> <p>The <strong>chef_client_systemd_timer</strong> resource has the following properties:</p> <dl> <dt> <code>accept_chef_license</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Accept the Chef Online Master License and Services Agreement. See <a href="https://www.chef.io/online-master-agreement">https://www.chef.io/online-master-agreement</a></p> </dd> </dl> <dl> <dt> <code>chef_binary_path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/opt/chef/bin/chef-client</code> <p>The path to the chef-client binary.</p> </dd> </dl> <dl> <dt> <code>config_directory</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/etc/chef</code> <p>The path of the config directory.</p> </dd> </dl> <dl> <dt> <code>cpu_quota</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>The systemd CPUQuota to run the chef-client process with. This is a percentage value of the total CPU time available on the system. If the system has more than 1 core this may be a value greater than 100.</p> <p> New in Chef Infra Client 16.5 </p> </dd> </dl> <dl> <dt> <code>daemon_options</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of options to pass to the chef-client command.</p> </dd> </dl> <dl> <dt> <code>delay_after_boot</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>1min</code> <p>The time to wait after booting before the interval starts. This is expressed as a systemd time span such as <code>300seconds</code>, <code>1hr</code>, or <code>1m</code>. See <a href="https://www.freedesktop.org/software/systemd/man/systemd.time.html">https://www.freedesktop.org/software/systemd/man/systemd.time.html</a> for a complete list of allowed time span values.</p> </dd> </dl> <dl> <dt> <code>description</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>Chef Infra Client periodic execution</code> <p>The description to add to the systemd timer. This will be displayed when running <code>systemctl status</code> for the timer.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> <p>A Hash containing additional arbitrary environment variables under which the systemd timer will be run in the form of <code>({'ENV_VARIABLE' =&gt; 'VALUE'})</code>.</p> </dd> </dl> <dl> <dt> <code>interval</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>30min</code> <p>The interval to wait between executions. This is expressed as a systemd time span such as <code>300seconds</code>, <code>1hr</code>, or <code>1m</code>. See <a href="https://www.freedesktop.org/software/systemd/man/systemd.time.html">https://www.freedesktop.org/software/systemd/man/systemd.time.html</a> for a complete list of allowed time span values.</p> </dd> </dl> <dl> <dt> <code>job_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>chef-client</code> <p>The name of the system timer to create.</p> </dd> </dl> <dl> <dt> <code>run_on_battery</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Run the timer for Chef Infra Client if the system is on battery.</p> </dd> </dl> <dl> <dt> <code>splay</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>5min</code> <p>A interval between 0 and X to add to the interval so that all chef-client commands don’t execute at the same time. This is expressed as a systemd time span such as <code>300seconds</code>, <code>1hr</code>, or <code>1m</code>. See <a href="https://www.freedesktop.org/software/systemd/man/systemd.time.html">https://www.freedesktop.org/software/systemd/man/systemd.time.html</a> for a complete list of allowed time span values.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>root</code> <p>The name of the user that Chef Infra Client runs as.</p> </dd> </dl> <br> <h3 id="functionality-chef-client-systemd-timer">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chef-client-systemd-timer">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chef-client-systemd-timer">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chef-client-systemd-timer">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chef-client-systemd-timer">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chef_client_systemd_timer</strong> resource in recipes:</p> <p><strong>Setup Chef Infra Client to run using the default 30 minute cadence</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_systemd_timer <span style="color:#4070a0">'Run Chef Infra Client as a systemd timer'</span>
</code></pre></div>
<p><strong>Run Chef Infra Client every 1 hour</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_systemd_timer <span style="color:#4070a0">'Run Chef Infra Client every 1 hour'</span> <span style="color:#007020;font-weight:700">do</span>
  interval <span style="color:#4070a0">'1hr'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run Chef Infra Client with extra options passed to the client</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_systemd_timer <span style="color:#4070a0">'Run an override recipe'</span> <span style="color:#007020;font-weight:700">do</span>
  daemon_options <span style="color:#666">[</span><span style="color:#4070a0">'--override-runlist mycorp_base::default'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chef-client-trusted-certificate-resource">chef_client_trusted_certificate resource</h2> <a href="chef_client_trusted_certificate/index.html">chef_client_trusted_certificate resource page</a> <hr> <p>Use the <strong>chef_client_trusted_certificate</strong> resource to add certificates to Chef Infra Client’s trusted certificate directory. This allows the Chef Infra Client to communicate with internal encrypted resources without errors.</p> <p><strong>New in Chef Infra Client 16.5.</strong></p> <h3 id="syntax-chef-client-trusted-certificate">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chef_client_trusted_certificate</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_trusted_certificate <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  cert_name        <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  certificate      <span style="color:#007020">String</span>
  action           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chef_client_trusted_certificate</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>cert_name</code> and <code>certificate</code> are the properties available to this resource.</li> </ul> <h3 id="actions-chef-client-trusted-certificate">Actions</h3> <hr> <p>The <strong>chef_client_trusted_certificate</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Add a trusted certificate to Chef Infra Client’s trusted certificate directory (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a trusted certificate from Chef Infra Client’s trusted certificate directory</dd> </dl> <h3 id="properties-chef-client-trusted-certificate">Properties</h3> <hr> <p>The <strong>chef_client_trusted_certificate</strong> resource has the following properties:</p> <dl> <dt> <code>cert_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name to use for the certificate file on disk. If not provided the name of the resource block will be used instead.</p> </dd> </dl> <dl> <dt> <code>certificate</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The text of the certificate file including the BEGIN/END comment lines.</p> </dd> </dl> <br> <h3 id="functionality-chef-client-trusted-certificate">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chef-client-trusted-certificate">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chef-client-trusted-certificate">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chef-client-trusted-certificate">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chef-client-trusted-certificate">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chef_client_trusted_certificate</strong> resource in recipes:</p> <p><strong>Trust a self signed certificate</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_trusted_certificate <span style="color:#4070a0">'self-signed.badssl.com'</span> <span style="color:#007020;font-weight:700">do</span>
  certificate <span style="color:#666">&lt;&lt;~</span><span style="color:#60add5">CERT</span>
  <span style="color:#666">-----</span><span style="color:#007020;font-weight:700">BEGIN</span> <span style="color:#60add5">CERTIFICATE</span><span style="color:#666">-----</span>
  <span style="color:#60add5">MIIDeTCCAmGgAwIBAgIJAPziuikCTox4MA0GCSqGSIb3DQEBCwUAMGIxCzAJBgNV</span>
  <span style="color:#60add5">BAYTAlVTMRMwEQYDVQQIDApDYWxpZm9ybmlhMRYwFAYDVQQHDA1TYW4gRnJhbmNp</span>
  c2NvMQ8wDQYDVQQKDAZCYWRTU0wxFTATBgNVBAMMDCouYmFkc3NsLmNvbTAeFw0x
  <span style="color:#60add5">OTEwMDkyMzQxNTJaFw0yMTEwMDgyMzQxNTJaMGIxCzAJBgNVBAYTAlVTMRMwEQYD</span>
  <span style="color:#60add5">VQQIDApDYWxpZm9ybmlhMRYwFAYDVQQHDA1TYW4gRnJhbmNpc2NvMQ8wDQYDVQQK</span>
  <span style="color:#60add5">DAZCYWRTU0wxFTATBgNVBAMMDCouYmFkc3NsLmNvbTCCASIwDQYJKoZIhvcNAQEB</span>
  <span style="color:#60add5">BQADggEPADCCAQoCggEBAMIE7PiM7gTCs9hQ1XBYzJMY61yoaEmwIrX5lZ6xKyx2</span>
  <span style="color:#60add5">PmzAS2BMTOqytMAPgLaw</span><span style="color:#666">+</span><span style="color:#60add5">XLJhgL5XEFdEyt</span><span style="color:#666">/</span>ccRLvOmULlA3pmccYYz2QULFRtMW
  hyefdOsKnRFSJiFzbIRMeVXk0WvoBj1IFVKtsyjbqv9u<span style="color:#666">/</span><span style="color:#40a070">2</span><span style="color:#60add5">CVSndrOfEk0TG23U3A</span>
  xPxTuW1CrbV8<span style="color:#666">/</span>q71FdIzSOciccfCFHpsKOo3St<span style="color:#666">/</span>qbLVytH5aohbcabFXRNsKEqve
  ww9HdFxBIuGa<span style="color:#666">+</span><span style="color:#60add5">RuT5q0iBikusbpJHAwnnqP7i</span><span style="color:#666">/</span>dAcgCskgjZjFeEU4EFy<span style="color:#666">+</span>b<span style="color:#666">+</span>a1SY
  <span style="color:#60add5">QCeFxxC7c3DvaRhBB0VVfPlkPz0sw6l865MaTIbRyoUCAwEAAaMyMDAwCQYDVR0T</span>
  <span style="color:#60add5">BAIwADAjBgNVHREEHDAaggwqLmJhZHNzbC5jb22CCmJhZHNzbC5jb20wDQYJKoZI</span>
  hvcNAQELBQADggEBAGlwCdbPxflZfYOaukZGCaxYK6gpincX4Lla4Ui2WdeQxE95
  w7fChXvP3YkE3UYUE7mupZ0eg4ZILr<span style="color:#666">/</span><span style="color:#60add5">A0e7JQDsgIu</span><span style="color:#666">/</span><span style="color:#60add5">SRTUE0domCKgPZ8v99k3A</span>
  vka4LpLK51jHJJK7EFgo3ca2nldd97GM0MU41xHFk8qaK1tWJkfrrfcGwDJ4GQPI
  iLlm6i0yHq1Qg1RypAXJy5dTlRXlCLd8ufWhhiwW0W75Va5AEnJuqpQrKwl3KQVe
  wGj67WWRgLfSr<span style="color:#666">+</span><span style="color:#40a070">4</span><span style="color:#60add5">QG1mNvCZb2CkjZWmxkGPuoP40</span><span style="color:#666">/</span>y7Yu5OFqxP5tAjj4YixCYTW
  <span style="color:#60add5">EVA0pmzIzgBg</span><span style="color:#666">+</span><span style="color:#60add5">JIe3PdRy27T0asgQW</span><span style="color:#666">/</span><span style="color:#60add5">F4TY61Yk</span><span style="color:#666">=</span>
  <span style="color:#666">-----</span><span style="color:#007020;font-weight:700">END</span> <span style="color:#60add5">CERTIFICATE</span><span style="color:#666">-----</span>
  <span style="color:#60add5">CERT</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chef-container-resource">chef_container resource</h2> <a href="chef_container/index.html">chef_container resource page</a> <hr> <p>Use the <strong>chef_container</strong> resource to interact with container objects that exist on the Chef Infra Server.</p> <h3 id="syntax-chef-container">Syntax</h3> <hr> 
<p>The syntax for using the <strong>chef_container</strong> resource in a recipe is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_container <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  attribute <span style="color:#4070a0">'value'</span> <span style="color:#60a0b0;font-style:italic"># see properties section below</span>
  <span style="color:#666">...</span>
  action <span style="color:#517918">:action</span> <span style="color:#60a0b0;font-style:italic"># see actions section below</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>chef_container</code> tells Chef Infra Client to use the <code>Chef::Provider::ChefContainer</code> provider during a Chef Infra Client run</li> <li>
<code>name</code> is the name of the resource block</li> <li>
<code>attribute</code> is zero (or more) of the properties that are available for this resource</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state</li> </ul> <h3 id="actions-chef-container">Actions</h3> <hr> <p>The <strong>chef_container</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default.</dd> <dt><code>:delete</code></dt>  <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-container">Properties</h3> <hr> <p>The <strong>chef_container</strong> resource has the following properties:</p> <dl> <dt> <code>chef_server</code> </dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>name</code> </dt> <dd> <p>The name of the container.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <h3 id="examples-chef-container">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="chef-data-bag-resource">chef_data_bag resource</h2> <a href="chef_data_bag/index.html">chef_data_bag resource page</a> <hr> <p> Data bags store global variables as JSON data. Data bags are indexed for searching and can be loaded by a cookbook or accessed during a search. </p> <p>Use the <strong>chef_data_bag</strong> resource to manage data bags.</p> <h3 id="syntax-chef-data-bag">Syntax</h3> <hr> 
<p>The syntax for using the <strong>chef_data_bag</strong> resource in a recipe is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_data_bag <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  attribute <span style="color:#4070a0">'value'</span> <span style="color:#60a0b0;font-style:italic"># see properties section below</span>
  <span style="color:#666">...</span>
  action <span style="color:#517918">:action</span> <span style="color:#60a0b0;font-style:italic"># see actions section below</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>chef_data_bag</code> tells Chef Infra Client to use the <code>Chef::Provider::ChefDataBag</code> provider during a Chef Infra Client run</li> <li>
<code>name</code> is the name of the resource block and also the name of the data bag</li> <li>
<code>attribute</code> is zero (or more) of the properties that are available for this resource</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state</li> </ul> <h3 id="actions-chef-data-bag">Actions</h3> <hr> <p>The <strong>chef_data_bag</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Use to create a data bag.</dd> <dt><code>:delete</code></dt> <dd>Use to delete a data bag.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-data-bag">Properties</h3> <hr> <p>The <strong>chef_data_bag</strong> resource has the following properties:</p> <dl> <dt> <code>chef_server</code> </dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>name</code> </dt> <dd> <p>The name of the data bag.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <h3 id="examples-chef-data-bag">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="chef-data-bag-item-resource">chef_data_bag_item resource</h2> <a href="chef_data_bag_item/index.html">chef_data_bag_item resource page</a> <hr> 
<p>A data bag is a container of related data bag items, where each individual data bag item is a JSON file. knife can load a data bag item by specifying the name of the data bag to which the item belongs and then the filename of the data bag item. The only structural requirement of a data bag item is that it must have an <code>id</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#60a0b0;font-style:italic">/* This is a supported comment style */</span>
  <span style="color:#60a0b0;font-style:italic">// This style is also supported
</span>  <span style="color:#4070a0">"id"</span><span style="color:#666">:</span> <span style="color:#4070a0">"ITEM_NAME"</span>,
  <span style="color:#4070a0">"key"</span><span style="color:#666">:</span> <span style="color:#4070a0">"value"</span>
}
</code></pre></div>
<p>where</p> <ul> <li>
<code>key</code> and <code>value</code> are the <code>key:value</code> pair for each additional attribute within the data bag item</li> <li>
<code>/* ... */</code> and <code>// ...</code> show two ways to add comments to the data bag item</li> </ul> <p>Use the <strong>chef_data_bag_item</strong> resource to manage data bag items.</p> <h3 id="syntax-chef-data-bag-item">Syntax</h3> <hr> 
<p>The syntax for using the <strong>chef_data_bag_item</strong> resource in a recipe is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_data_bag_item <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  attribute <span style="color:#4070a0">'value'</span> <span style="color:#60a0b0;font-style:italic"># see properties section below</span>
  <span style="color:#666">...</span>
  action <span style="color:#517918">:action</span> <span style="color:#60a0b0;font-style:italic"># see actions section below</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>chef_data_bag_item</code> tells Chef Infra Client to use the <code>Chef::Provider::ChefDataBagItem</code> provider during a Chef Infra Client run</li> <li>
<code>name</code> is the name of the resource block and also the name of the data bag item</li> <li>
<code>attribute</code> is zero (or more) of the properties that are available for this resource</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state</li> </ul> <h3 id="actions-chef-data-bag-item">Actions</h3> <hr> <p>The <strong>chef_data_bag_item</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Use to create a data bag item.</dd> <dt><code>:delete</code></dt> <dd>Use to delete a data bag item.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-data-bag-item">Properties</h3> <hr> <p>The <strong>chef_data_bag_item</strong> resource has the following properties:</p> <dl> <dt> <code>chef_server</code> </dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>complete</code> </dt> <dd> <p>Use to specify if this resource defines a data bag item completely. When <code>true</code>, any property not specified by this resource will be reset to default property values.</p> </dd> </dl> <dl> <dt> <code>encrypt</code> </dt> <dd> <p>Use to specify whether encryption is used for a data bag item.</p> </dd> </dl> <dl> <dt> <code>encryption_version</code> </dt> <dd> <p>The minimum required version of data bag encryption. Possible values: <code>0</code>, <code>1</code>, <code>2</code>, and <code>3</code>. When all of the machines in an organization are running chef-client version 13.0.113 (or higher), it is recommended that this value be set to <code>3</code>.</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>raw_data</code> </dt> <dd> <p>Use to create a data bag from a local file from <code>./data_bags/bag_name/file</code>.</p> </dd> </dl> <dl> <dt> <code>raw_json</code> </dt> <dd> 
<p>The data bag item as JSON data. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"id"</span><span style="color:#666">:</span> <span style="color:#4070a0">"adam"</span>,
  <span style="color:#4070a0">"real_name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"Adam Brent Jacob"</span>
}
</code></pre></div> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <h3 id="examples-chef-data-bag-item">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="chef-environment-resource">chef_environment resource</h2> <a href="chef_environment/index.html">chef_environment resource page</a> <hr> <p> An environment is a way to map an organization’s real-life workflow to what can be configured and managed when using Chef Infra. This mapping is accomplished by setting attributes and pinning cookbooks at the environment level. With environments, you can change cookbook configurations depending on the system’s designation. For example, by designating different staging and production environments, you can then define the correct URL of a database server for each environment. Environments also allow organizations to move new cookbook releases from staging to production with confidence by stepping releases through testing environments before entering production. </p> <p>Use the <strong>chef_environment</strong> resource to manage environments.</p> <h3 id="syntax-chef-environment">Syntax</h3> <hr> 
<p>The syntax for using the <strong>chef_environment</strong> resource in a recipe is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_environment <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  attribute <span style="color:#4070a0">'value'</span> <span style="color:#60a0b0;font-style:italic"># see properties section below</span>
  <span style="color:#666">...</span>
  action <span style="color:#517918">:action</span> <span style="color:#60a0b0;font-style:italic"># see actions section below</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>chef_environment</code> tells Chef Infra Client to use the <code>Chef::Provider::ChefEnvironment</code> provider during a Chef Infra Client run</li> <li>
<code>name</code> is the name of the resource block; when the <code>name</code> property is not specified as part of a recipe, <code>name</code> is also the name of the environment</li> <li>
<code>attribute</code> is zero (or more) of the properties that are available for this resource</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state</li> </ul> <h3 id="actions-chef-environment">Actions</h3> <hr> <p>The <strong>chef_environment</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Use to create an environment.</dd> <dt><code>:delete</code></dt> <dd>Use to delete an environment.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-environment">Properties</h3> <hr> <p>The <strong>chef_environment</strong> resource has the following properties:</p> <dl> <dt> <code>chef_server</code> </dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>complete</code> </dt> <dd> <p>Use to specify if this resource defines an environment completely. When <code>true</code>, any property not specified by this resource will be reset to default property values.</p> </dd> </dl> <dl> <dt> <code>cookbook_versions</code> </dt> <dd> <p>The cookbook versions used with the environment. Default value: <code>{}</code>.</p> </dd> </dl> <dl> <dt> <code>default_attributes</code> </dt> <dd> <p> A <code>default</code> attribute is automatically reset at the start of every Chef Infra Client run and has the lowest attribute precedence. Use <code>default</code> attributes as often as possible in cookbooks. </p> <p>Default value: <code>{}</code>.</p> </dd> </dl> <dl> <dt> <code>description</code> </dt> <dd> <p>The description of the environment. This value populates the description field for the environment on the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>name</code> </dt> <dd> <p>The name of the environment.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>override_attributes</code> </dt> <dd> <p> An <code>override</code> attribute is automatically reset at the start of every Chef Infra Client run and has a higher attribute precedence than <code>default</code>, <code>force_default</code>, and <code>normal</code> attributes. An <code>override</code> attribute is most often specified in a recipe, but can be specified in an attribute file, for a role, and/or for an environment. A cookbook should be authored so that it uses <code>override</code> attributes only when required. </p> <p>Default value: <code>{}</code>.</p> </dd> </dl> <dl> <dt> <code>raw_json</code> </dt> <dd> 
<p>The environment as JSON data. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span><span style="color:#4070a0">"backend"</span>,
  <span style="color:#4070a0">"description"</span><span style="color:#666">:</span><span style="color:#4070a0">""</span>,
  <span style="color:#4070a0">"cookbook_versions"</span><span style="color:#666">:</span>{},
  <span style="color:#4070a0">"json_class"</span><span style="color:#666">:</span><span style="color:#4070a0">"Chef::Environment"</span>,
  <span style="color:#4070a0">"chef_type"</span><span style="color:#666">:</span><span style="color:#4070a0">"environment"</span>,
  <span style="color:#4070a0">"default_attributes"</span><span style="color:#666">:</span>{},
  <span style="color:#4070a0">"override_attributes"</span><span style="color:#666">:</span>{}
}
</code></pre></div> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <h3 id="examples-chef-environment">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="chef-gem-resource">chef_gem resource</h2> <a href="chef_gem/index.html">chef_gem resource page</a> <hr> 
<p>Use the <strong>chef_gem</strong> resource to install a gem only for the instance of Ruby that is dedicated to the chef-client. When a gem is installed from a local file, it must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p> <p>The <strong>chef_gem</strong> resource works with all of the same properties and options as the <strong>gem_package</strong> resource, but does not accept the <code>gem_binary</code> property because it always uses the <code>CurrentGemEnvironment</code> under which the <code>chef-client</code> is running. In addition to performing actions similar to the <strong>gem_package</strong> resource, the <strong>chef_gem</strong> resource does the following:</p> <ul> <li>Runs its actions immediately, before convergence, allowing a gem to be used in a recipe immediately after it is installed.</li> <li>Runs <code>Gem.clear_paths</code> after the action, ensuring that gem is aware of changes so that it can be required immediately after it is installed.</li> </ul> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>The <strong>chef_gem</strong> and <strong>gem_package</strong> resources are both used to install Ruby gems. For any machine on which Chef Infra Client is installed, there are two instances of Ruby. One is the standard, system-wide instance of Ruby and the other is a dedicated instance that is available only to Chef Infra Client. Use the <strong>chef_gem</strong> resource to install gems into the instance of Ruby that is dedicated to Chef Infra Client. Use the <strong>gem_package</strong> resource to install all other gems (i.e. install gems system-wide).</p> </div> </div> <h3 id="syntax-chef-gem">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chef_gem</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_gem <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  clear_sources               <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  gem_binary                  <span style="color:#007020">String</span>
  include_default_source      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  options                     <span style="color:#007020">String</span>, <span style="color:#60add5">Hash</span>, <span style="color:#007020">Array</span>
  package_name                <span style="color:#007020">String</span>
  source                      <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  timeout                     <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version                     <span style="color:#007020">String</span>
  action                      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chef_gem</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>clear_sources</code>, <code>gem_binary</code>, <code>include_default_source</code>, <code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-chef-gem">Actions</h3> <hr> <p>The <strong>chef_gem</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a gem. If a version is specified, install the specified version of the gem.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a gem. This action typically removes the configuration files as well as the gem.</dd> <dt><code>:reconfig</code></dt> <dd>Reconfigure a gem. This action requires a response file.</dd> <dt><code>:remove</code></dt> <dd>Remove a gem.</dd> <dt><code>:upgrade</code></dt> <dd>Install a gem and/or ensure that a gem is the latest version.</dd> </dl> <h3 id="properties-chef-gem">Properties</h3> <hr> <p>The <strong>chef_gem</strong> resource has the following properties:</p> <dl> <dt> <code>clear_sources</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false unless `clear_gem_sources` set to true in the `client.rb` config.</code> <p>Set to <code>true</code> to download a gem from the path specified by the <code>source</code> property (and not from RubyGems).</p> </dd> </dl> <dl> <dt> <code>gem_binary</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The `gem` binary included with Chef Infra Client.</code> <p>The path of a gem binary to use for the installation. By default, the same version of Ruby that is used by Chef Infra Client will be used.</p> </dd> </dl> <dl> <dt> <code>include_default_source</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Set to <code>false</code> to not include <code>Chef::Config[:rubygems_url]</code> in the sources.</p> <p> New in Chef Client 13.0 </p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Hash, Array <p>Options for the gem install, either a Hash or a String. When a hash is given, the options are passed to <code>Gem::DependencyInstaller.new</code>, and the gem will be installed via the gems API. When a String is given, the gem will be installed by shelling out to the gem command. Using a Hash of options with an explicit gem_binary will result in undefined behavior.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>Optional. The URL, or list of URLs, at which the gem package is located. This list is added to the source configured in <code>Chef::Config[:rubygems_url]</code> (see also include_default_source) to construct the complete list of rubygems sources. Users in an ‘airgapped’ environment should set Chef::Config[:rubygems_url] to their local RubyGems mirror.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-chef-gem">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chef-gem">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chef-gem">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chef-gem">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chef-gem">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chef_gem</strong> resource in recipes:</p> <p><strong>Compile time vs. converge time installation of gems</strong></p> <p>To install a gem while Chef Infra Client is configuring the node (the converge phase), set the <code>compile_time</code> property to <code>false</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_gem <span style="color:#4070a0">'loofah'</span> <span style="color:#007020;font-weight:700">do</span>
  compile_time <span style="color:#007020">false</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>To install a gem while the resource collection is being built (the compile phase), set the <code>compile_time</code> property to <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_gem <span style="color:#4070a0">'loofah'</span> <span style="color:#007020;font-weight:700">do</span>
  compile_time <span style="color:#007020">true</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install MySQL gem into Chef Infra Client</strong>*</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">apt_update

build_essential <span style="color:#4070a0">'install compilation tools'</span> <span style="color:#007020;font-weight:700">do</span>
  compile_time <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>

chef_gem <span style="color:#4070a0">'mysql'</span>
</code></pre></div> <h2 id="chef-group-resource">chef_group resource</h2> <a href="chef_group/index.html">chef_group resource page</a> <hr> <p>Use the <strong>chef_group</strong> resource to interact with group objects that exist on the Chef server.</p> <h3 id="syntax-chef-group">Syntax</h3> <hr> 
<p>The syntax for using the <strong>chef_group</strong> resource in a recipe is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_group <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  attribute <span style="color:#4070a0">'value'</span> <span style="color:#60a0b0;font-style:italic"># see properties section below</span>
  <span style="color:#666">...</span>
  action <span style="color:#517918">:action</span> <span style="color:#60a0b0;font-style:italic"># see actions section below</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>chef_group</code> tells Chef Infra Client to use the <code>Chef::Provider::ChefGroup</code> provider during a Chef Infra Client run</li> <li>
<code>name</code> is the name of the resource block</li> <li>
<code>attribute</code> is zero (or more) of the properties that are available for this resource</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state</li> </ul> <h3 id="actions-chef-group">Actions</h3> <hr> <p>The <strong>chef_group</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default.</dd> <dt><code>:delete</code></dt>  <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-group">Properties</h3> <hr> <p>The <strong>chef_group</strong> resource has the following properties:</p> <dl> <dt> <code>chef_server</code> </dt> <dd> <p>The URL for the Chef server.</p> </dd> </dl> <dl> <dt> <code>clients</code> </dt> <dd> <p>&amp;mldr;</p> </dd> </dl> <dl> <dt> <code>complete</code> </dt> <dd> <p>Use to specify if this resource defines a chef-client completely. When <code>true</code>, any property not specified by this resource will be reset to default property values.</p> </dd> </dl> <dl> <dt> <code>groups</code> </dt> <dd> <p>&amp;mldr;</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>raw_json</code> </dt> <dd> 
<p>The group as JSON data. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#666">:</span>groupname =&gt; <span style="color:#4070a0">"chef"</span>
}
</code></pre></div> </dd> </dl> <dl> <dt> <code>remove_clients</code> </dt> <dd> <p>&amp;mldr;</p> </dd> </dl> <dl> <dt> <code>remove_groups</code> </dt> <dd> <p>&amp;mldr;</p> </dd> </dl> <dl> <dt> <code>remove_users</code> </dt> <dd> <p>&amp;mldr;</p> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>users</code> </dt> <dd> <p>&amp;mldr;</p> </dd> </dl> <h3 id="examples-chef-group">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="chef-handler-resource">chef_handler resource</h2> <a href="chef_handler/index.html">chef_handler resource page</a> <hr> <p>Use the <strong>chef_handler</strong> resource to enable handlers during a Chef Infra Client run. The resource allows arguments to be passed to Chef Infra Client, which then applies the conditions defined by the custom handler to the node attribute data collected during a Chef Infra Client run, and then processes the handler based on that data. The <strong>chef_handler</strong> resource is typically defined early in a node’s run-list (often being the first item). This ensures that all of the handlers will be available for the entire Chef Infra Client run.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="handler-types">Handler Types</h3> <p>There are three types of handlers:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Handler</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>exception</td> <td>An exception handler is used to identify situations that have caused a Chef Infra Client run to fail. An exception handler can be loaded at the start of a Chef Infra Client run by adding a recipe that contains the <strong>chef_handler</strong> resource to a node's run-list. An exception handler runs when the <code>failed?</code> property for the <code>run_status</code> object returns <code>true</code>.</td> </tr> <tr> <td>report</td> <td>A report handler is used when a Chef Infra Client run succeeds and reports back on certain details about that Chef Infra Client run. A report handler can be loaded at the start of a Chef Infra Client run by adding a recipe that contains the <strong>chef_handler</strong> resource to a node's run-list. A report handler runs when the <code>success?</code> property for the <code>run_status</code> object returns <code>true</code>.</td> </tr> <tr> <td>start</td> <td>A start handler is used to run events at the beginning of a Chef Infra Client run. A start handler can be loaded at the start of a Chef Infra Client run by adding the start handler to the <code>start_handlers</code> setting in the client.rb file or by installing the gem that contains the start handler by using the <strong>chef_gem</strong> resource in a recipe in the <strong>chef-client</strong> cookbook. (A start handler may not be loaded using the <code>chef_handler</code> resource.)</td> </tr> </tbody> </table> <h4 id="handler-type-exception-report">Exception / Report</h4> <p>Exception and report handlers are used to trigger certain behaviors in response to specific situations, typically identified during a Chef Infra Client run.</p> <ul> <li>An exception handler is used to trigger behaviors when a defined aspect of a Chef Infra Client run fails.</li> <li>A report handler is used to trigger behaviors when a defined aspect of a Chef Infra Client run is successful.</li> </ul> <p>Both types of handlers can be used to gather data about a Chef Infra Client run and can provide rich levels of data about all types of usage, which can be used later for trending and analysis across the entire organization.</p> <p>Exception and report handlers are made available to a Chef Infra Client run in one of the following ways:</p> <ul> <li>By adding the <strong>chef_handler</strong> resource to a recipe, and then adding that recipe to the run-list for a node. (The <strong>chef_handler</strong> resource is available from the <strong>chef_handler</strong> cookbook.)</li> <li>By adding the handler to one of the following settings in the node’s client.rb file: <code>exception_handlers</code> and/or <code>report_handlers</code>
</li> </ul> <p>The <strong>chef_handler</strong> resource allows exception and report handlers to be enabled from within recipes, which can then added to the run-list for any node on which the exception or report handler should run. The <strong>chef_handler</strong> resource is available from the <strong>chef_handler</strong> cookbook.</p> <p>To use the <strong>chef_handler</strong> resource in a recipe, add code similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'name_of_handler'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'/path/to/handler/handler_name'</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>For example, a handler for Growl needs to be enabled at the beginning of a Chef Infra Client run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_gem <span style="color:#4070a0">'chef-handler-growl'</span>
</code></pre></div>
<p>and then is activated in a recipe by using the <strong>chef_handler</strong> resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'Chef::Handler::Growl'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef/handler/growl'</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h4 id="handler-type-start">Start</h4> <p>A start handler is not loaded into a Chef Infra Client run from a recipe, but is instead listed in the client.rb file using the <code>start_handlers</code> attribute. The start handler must be installed on the node and be available to Chef Infra Client prior to the start of a Chef Infra Client run. Use the <strong>chef-client</strong> cookbook to install the start handler.</p> <p>Start handlers are made available to a Chef Infra Client run in one of the following ways:</p> <ul> <li>By adding a start handler to the <strong>chef-client</strong> cookbook, which installs the handler on the node so that it is available to Chef Infra Client at the start of a Chef Infra Client run</li> <li>By adding the handler to one of the following settings in the node’s client.rb file: <code>start_handlers</code>
</li> </ul> <p>The <strong>chef-client</strong> cookbook can be configured to automatically install and configure gems that are required by a start handler. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'load_gems'</span><span style="color:#666">][</span><span style="color:#4070a0">'chef-reporting'</span><span style="color:#666">]</span> <span style="color:#666">=</span> {
  <span style="color:#517918">require_name</span>: <span style="color:#4070a0">'chef_reporting'</span>,
  <span style="color:#517918">action</span>: <span style="color:#517918">:install</span>,
}

node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'start_handlers'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#666">[</span>
  {
    <span style="color:#517918">class</span>: <span style="color:#4070a0">'Chef::Reporting::StartHandler'</span>,
    <span style="color:#517918">arguments</span>: <span style="color:#666">[]</span>,
  },
<span style="color:#666">]</span>

include_recipe <span style="color:#4070a0">'chef-client::config'</span>
</code></pre></div> <h3 id="syntax-chef-handler">Syntax</h3> <hr> 
<p>A <strong>chef_handler</strong> resource block enables handlers during a chef-client run. Two handlers—<code>JsonFile</code> and <code>ErrorReport</code>—are built into Chef:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'Chef::Handler::JsonFile'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef/handler/json_file'</span>
  arguments <span style="color:#517918">:path</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/var/chef/reports'</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'Chef::Handler::ErrorReport'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef/handler/error_report'</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>show how to enable those handlers in a recipe.</p> <p>The full syntax for all of the properties that are available to the <strong>chef_handler</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  arguments       <span style="color:#007020">Array</span>, <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  class_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  source          <span style="color:#007020">String</span>
  type            <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {"report"=&gt;true, "exception"=&gt;true}</span>
  action          <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :enable if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chef_handler</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>arguments</code>, <code>class_name</code>, <code>source</code>, and <code>type</code> are the properties available to this resource.</li> </ul> <h3 id="actions-chef-handler">Actions</h3> <hr> <p>The <strong>chef_handler</strong> resource has the following actions:</p> <dl> <dt><code>:disable</code></dt> <dd>Disables the handler for the current Chef Infra Client run on the current node.</dd> <dt><code>:enable</code></dt> <dd>Enables the handler for the current Chef Infra Client run on the current node. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-handler">Properties</h3> <hr> <p>The <strong>chef_handler</strong> resource has the following properties:</p> <dl> <dt> <code>arguments</code> </dt> <dd> <strong>Ruby Type:</strong> Array, Hash | <strong>Default Value:</strong> <code>[]</code> 
<p>An array of arguments that are passed to the initializer for the handler class. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">arguments <span style="color:#517918">:key1</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'val1'</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">arguments <span style="color:#666">[</span><span style="color:#517918">:key1</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'val1'</span>, <span style="color:#517918">:key2</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'val2'</span><span style="color:#666">]</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>class_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the handler class. This can be module name-spaced.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The full path to the handler file. Can also be a gem path if the handler ships as part of a Ruby gem.</p> </dd> </dl> <dl> <dt> <code>type</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{"report"=&gt;true, "exception"=&gt;true}</code> <p>The type of handler to register as, i.e. :report, :exception or both.</p> </dd> </dl> <br> <h3 id="functionality-chef-handler">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chef-handler">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chef-handler">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chef-handler">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chef-handler">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chef_handler</strong> resource in recipes:</p> <p><strong>Enable the ‘MyHandler’ handler</strong></p> <p>The following example shows how to enable a fictional ‘MyHandler’ handler which is located on disk at <code>/etc/chef/my_handler.rb</code>. The handler will be configured to run with Chef Infra Client and will be passed values to the handler’s initializer method:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'MyHandler'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'/etc/chef/my_handler.rb'</span> <span style="color:#60a0b0;font-style:italic"># the file should already be at this path</span>
  arguments <span style="color:#517918">path</span>: <span style="color:#4070a0">'/var/chef/reports'</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Enable handlers during the compile phase</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'Chef::Handler::JsonFile'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef/handler/json_file'</span>
  arguments <span style="color:#517918">path</span>: <span style="color:#4070a0">'/var/chef/reports'</span>
  action <span style="color:#517918">:enable</span>
  compile_time <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Handle only exceptions</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'Chef::Handler::JsonFile'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef/handler/json_file'</span>
  arguments <span style="color:#517918">path</span>: <span style="color:#4070a0">'/var/chef/reports'</span>
  type <span style="color:#517918">exception</span>: <span style="color:#007020">true</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Cookbook Versions (a custom handler)</strong></p> <p><a href="https://github.com/juliandunn">@juliandunn</a> created a custom report handler that logs all of the cookbooks and cookbook versions that were used during a Chef Infra Client run, and then reports after the run is complete.</p> <p>cookbook_versions.rb:</p> <p>The following custom handler defines how cookbooks and cookbook versions that are used during a Chef Infra Client run will be compiled into a report using the <code>Chef::Log</code> class in Chef Infra Client:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/log'</span>

<span style="color:#007020;font-weight:700">module</span> <span style="color:#0e84b5;font-weight:700">Chef</span>
  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">CookbookVersionsHandler</span> <span style="color:#666">&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span>
    <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">report</span>
      cookbooks <span style="color:#666">=</span> run_context<span style="color:#666">.</span>cookbook_collection
      <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>info(<span style="color:#4070a0">'Cookbooks and versions run: #{cookbooks.map {|x| x.name.to_s + '</span> <span style="color:#4070a0">' + x.version }}'</span>)
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>default.rb:</p> <p>The following recipe is added to the run-list for every node on which a list of cookbooks and versions will be generated as report output after every Chef Infra Client run.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'/etc/chef/cookbook_versions.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'cookbook_versions.rb'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>

chef_handler <span style="color:#4070a0">'Chef::CookbookVersionsHandler'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'/etc/chef/cookbook_versions.rb'</span>
  type <span style="color:#517918">report</span>: <span style="color:#007020">true</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This recipe will generate report output similar to the following:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code>[2013-11-26T03:11:06+00:00] INFO: Chef Infra Client Run complete in 0.300029878 seconds
[2013-11-26T03:11:06+00:00] INFO: Running report handlers
[2013-11-26T03:11:06+00:00] INFO: Cookbooks and versions run: ["cookbook_versions_handler 1.0.0"]
[2013-11-26T03:11:06+00:00] INFO: Report handlers complete
</code></pre>
<p><strong>JsonFile Handler</strong></p> <p>The JsonFile handler is available from the <code>chef_handler</code> cookbook and can be used with exceptions and reports. It serializes run status data to a JSON file. This handler may be enabled in one of the following ways.</p> <p>By adding the following lines of Ruby code to either the client.rb file or the solo.rb file, depending on how Chef Infra Client is being run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/handler/json_file'</span>
report_handlers <span style="color:#666">&lt;&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span><span style="color:#666">::</span><span style="color:#60add5">JsonFile</span><span style="color:#666">.</span>new(<span style="color:#517918">path</span>: <span style="color:#4070a0">'/var/chef/reports'</span>)
exception_handlers <span style="color:#666">&lt;&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span><span style="color:#666">::</span><span style="color:#60add5">JsonFile</span><span style="color:#666">.</span>new(<span style="color:#517918">path</span>: <span style="color:#4070a0">'/var/chef/reports'</span>)
</code></pre></div>
<p>By using the <code>chef_handler</code> resource in a recipe, similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'Chef::Handler::JsonFile'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef/handler/json_file'</span>
  arguments <span style="color:#517918">path</span>: <span style="color:#4070a0">'/var/chef/reports'</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>After it has run, the run status data can be loaded and inspected via Interactive Ruby (IRb):</p> <pre tabindex="0" class="highlight" data-language="ruby"><code>irb(main):002:0&gt; require 'json' =&gt; true
irb(main):003:0&gt; require 'chef' =&gt; true
irb(main):004:0&gt; r = JSON.parse(IO.read('/var/chef/reports/chef-run-report-20110322060731.json')) =&gt; ... output truncated
irb(main):005:0&gt; r.keys =&gt; ['end_time', 'node', 'updated_resources', 'exception', 'all_resources', 'success', 'elapsed_time', 'start_time', 'backtrace']
irb(main):006:0&gt; r['elapsed_time'] =&gt; 0.00246
</code></pre>
<p>Register the JsonFile handler</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'Chef::Handler::JsonFile'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef/handler/json_file'</span>
  arguments <span style="color:#517918">path</span>: <span style="color:#4070a0">'/var/chef/reports'</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>ErrorReport Handler</strong></p> <p>The ErrorReport handler is built into Chef Infra Client and can be used for both exceptions and reports. It serializes error report data to a JSON file. This handler may be enabled in one of the following ways.</p> <p>By adding the following lines of Ruby code to either the client.rb file or the solo.rb file, depending on how Chef Infra Client is being run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/handler/error_report'</span>
report_handlers <span style="color:#666">&lt;&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span><span style="color:#666">::</span><span style="color:#60add5">ErrorReport</span><span style="color:#666">.</span>new
exception_handlers <span style="color:#666">&lt;&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span><span style="color:#666">::</span><span style="color:#60add5">ErrorReport</span><span style="color:#666">.</span>new
</code></pre></div>
<p>By using the <code>chef_handler</code> resource in a recipe, similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'Chef::Handler::ErrorReport'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef/handler/error_report'</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chef-node-resource">chef_node resource</h2> <a href="chef_node/index.html">chef_node resource page</a> <hr> <p> A node is any device—physical, virtual, cloud, network device, etc.—that is under management by Chef Infra. </p> <p>Use the <strong>chef_node</strong> resource to manage nodes.</p> <h3 id="syntax-chef-node">Syntax</h3> <hr> 
<p>The syntax for using the <strong>chef_node</strong> resource in a recipe is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_node <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  attribute <span style="color:#4070a0">'value'</span> <span style="color:#60a0b0;font-style:italic"># see properties section below</span>
  <span style="color:#666">...</span>
  action <span style="color:#517918">:action</span> <span style="color:#60a0b0;font-style:italic"># see actions section below</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>chef_node</code> tells Chef Infra Client to use the <code>Chef::Provider::ChefNode</code> provider during a Chef Infra Client run</li> <li>
<code>name</code> is the name of the resource block</li> <li>
<code>attribute</code> is zero (or more) of the properties that are available for this resource</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state</li> </ul> <h3 id="actions-chef-node">Actions</h3> <hr> <p>The <strong>chef_node</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Use to create a node.</dd> <dt><code>:delete</code></dt> <dd>Use to delete a node.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-node">Properties</h3> <hr> <p>The <strong>chef_node</strong> resource has the following properties:</p> <dl> <dt> <code>automatic_attributes</code> </dt> <dd> <p> An <code>automatic</code> attribute contains data that is identified by Ohai at the beginning of every Chef Infra Client run. An <code>automatic</code> attribute cannot be modified and always has the highest attribute precedence. </p> <p>Default value: <code>{}</code>.</p> </dd> </dl> <dl> <dt> <code>chef_environment</code> </dt> <dd> <p>The Chef Infra Server environment in which this node should exist (or does exist).</p> </dd> </dl> <dl> <dt> <code>chef_server</code> </dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>complete</code> </dt> <dd> <p>Use to specify if this resource defines a node completely. When <code>true</code>, any property not specified by this resource will be reset to default property values.</p> </dd> </dl> <dl> <dt> <code>default_attributes</code> </dt> <dd> <p> A <code>default</code> attribute is automatically reset at the start of every Chef Infra Client run and has the lowest attribute precedence. Use <code>default</code> attributes as often as possible in cookbooks. </p> <p>Default value: <code>{}</code>.</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>name</code> </dt> <dd> <p>The unique identifier of the node.</p> </dd> </dl> <dl> <dt> <code>normal_attributes</code> </dt> <dd> <p> A <code>normal</code> attribute is a setting that persists in the node object. A <code>normal</code> attribute has a higher attribute precedence than a <code>default</code> attribute. </p> <p>Default value: <code>{}</code>.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>override_attributes</code> </dt> <dd> <p> An <code>override</code> attribute is automatically reset at the start of every Chef Infra Client run and has a higher attribute precedence than <code>default</code>, <code>force_default</code>, and <code>normal</code> attributes. An <code>override</code> attribute is most often specified in a recipe, but can be specified in an attribute file, for a role, and/or for an environment. A cookbook should be authored so that it uses <code>override</code> attributes only when required. </p> <p>Default value: <code>{}</code>.</p> </dd> </dl> <dl> <dt> <code>raw_json</code> </dt> <dd> 
<p>The node as JSON data. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"overrides"</span><span style="color:#666">:</span> {},
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"latte"</span>,
  <span style="color:#4070a0">"chef_type"</span><span style="color:#666">:</span> <span style="color:#4070a0">"node"</span>,
  <span style="color:#4070a0">"json_class"</span><span style="color:#666">:</span> <span style="color:#4070a0">"Chef::Node"</span>,
  <span style="color:#4070a0">"attributes"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"hardware_type"</span><span style="color:#666">:</span> <span style="color:#4070a0">"laptop"</span>
  },
  <span style="color:#4070a0">"run_list"</span><span style="color:#666">:</span> [
    <span style="color:#4070a0">"recipe[apache2]"</span>
  ],
  <span style="color:#4070a0">"defaults"</span><span style="color:#666">:</span> {}
}
</code></pre></div> </dd> </dl> <dl> <dt> <code>run_list</code> </dt> <dd> <p>A comma-separated list of roles and/or recipes to be applied. Default value: <code>[]</code>. For example: <code>["recipe[default]","recipe[apache2]"]</code></p> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <h3 id="examples-chef-node">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="chef-organization-resource">chef_organization resource</h2> <a href="chef_organization/index.html">chef_organization resource page</a> <hr> <p>Use the <strong>chef_organization</strong> resource to interact with organization objects that exist on the Chef Infra Server.</p> <h3 id="syntax-chef-organization">Syntax</h3> <hr> 
<p>The syntax for using the <strong>chef_organization</strong> resource in a recipe is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_organization <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  attribute <span style="color:#4070a0">'value'</span> <span style="color:#60a0b0;font-style:italic"># see attributes section below</span>
  <span style="color:#666">...</span>
  action <span style="color:#517918">:action</span> <span style="color:#60a0b0;font-style:italic"># see actions section below</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>chef_organization</code> tells Chef Infra Client to use the <code>Chef::Provider::ChefOrganization</code> provider during a Chef Infra Client run</li> <li>
<code>name</code> is the name of the resource block</li> <li>
<code>attribute</code> is zero (or more) of the attributes that are available for this resource</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state</li> </ul> <h3 id="actions-chef-organization">Actions</h3> <hr> <p>The <strong>chef_organization</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default.</dd> <dt><code>:delete</code></dt>  <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-organization">Properties</h3> <hr> <p>The <strong>chef_organization</strong> resource has the following properties:</p> <dl> <dt> <code>chef_server</code> </dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>complete</code> </dt> <dd> <p>Use to specify if this resource defines an organization completely. When <code>true</code>, any property not specified by this resource will be reset to default property values.</p> </dd> </dl> <dl> <dt> <code>full_name</code> </dt> <dd> <p>The full name must begin with a non-white space character and must be between 1 and 1023 characters. For example: <code>Chef Software, Inc.</code>.</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>invites</code> </dt> <dd> <p>Use to specify a list of users to be invited to the organization. An invitation is sent to any user in this list who is not already a member of the organization.</p> </dd> </dl> <dl> <dt> <code>members</code> </dt> <dd> <p>Use to specify a list of users who MUST be members of the organization. These users will be added directly to the organization. The user who initiates this operation MUST also have permission to add users to the specified organization.</p> </dd> </dl> <dl> <dt> <code>members_specified</code> </dt> <dd> <p>Use to discover if a user is a member of an organization. Will return <code>true</code> if the user is a member.</p> </dd> </dl> <dl> <dt> <code>name</code> </dt> <dd> <p>The name must begin with a lower-case letter or digit, may only contain lower-case letters, digits, hyphens, and underscores, and must be between 1 and 255 characters. For example: <code>chef</code>.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>raw_json</code> </dt> <dd> 
<p>The organization as JSON data. For example:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">{
  "name": "chef",
  "full_name": "Chef Software, Inc",
  "guid": "f980d1asdfda0331235s00ff36862
  ...
}
</code></pre> </dd> </dl> <dl> <dt> <code>remove_members</code> </dt> <dd> <p>Use to remove the specified users from an organization. Invitations that have not been accepted will be cancelled.</p> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <h3 id="examples-chef-organization">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="chef-role-resource">chef_role resource</h2> <a href="chef_role/index.html">chef_role resource page</a> <hr> <p> A role is a way to define certain patterns and processes that exist across nodes in an organization as belonging to a single job function. Each role consists of zero (or more) attributes and a run-list. Each node can have zero (or more) roles assigned to it. When a role is run against a node, the configuration details of that node are compared against the attributes of the role, and then the contents of that role’s run-list are applied to the node’s configuration details. When a Chef Infra Client runs, it merges its own attributes and run-lists with those contained within each assigned role. </p> <p>Use the <strong>chef_role</strong> resource to manage roles.</p> <h3 id="syntax-chef-role">Syntax</h3> <hr> 
<p>The syntax for using the <strong>chef_role</strong> resource in a recipe is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_role <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  attribute <span style="color:#4070a0">'value'</span> <span style="color:#60a0b0;font-style:italic"># see properties section below</span>
  <span style="color:#666">...</span>
  action <span style="color:#517918">:action</span> <span style="color:#60a0b0;font-style:italic"># see actions section below</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>chef_role</code> tells Chef Infra Client to use the <code>Chef::Provider::ChefRole</code> provider during a Chef Infra Client run</li> <li>
<code>name</code> is the name of the resource block; when the <code>name</code> property is not specified as part of a recipe, <code>name</code> is also the name of the role</li> <li>
<code>attribute</code> is zero (or more) of the properties that are available for this resource</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state</li> </ul> <h3 id="actions-chef-role">Actions</h3> <hr> <p>The <strong>chef_role</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Use to create a role.</dd> <dt><code>:delete</code></dt> <dd>Use to delete a role.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-role">Properties</h3> <hr> <p>The <strong>chef_role</strong> resource has the following properties:</p> <dl> <dt> <code>chef_server</code> </dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>complete</code> </dt> <dd> <p>Use to specify if this resource defines a role completely. When <code>true</code>, any property not specified by this resource will be reset to default property values.</p> </dd> </dl> <dl> <dt> <code>default_attributes</code> </dt> <dd> <p> A <code>default</code> attribute is automatically reset at the start of every Chef Infra Client run and has the lowest attribute precedence. Use <code>default</code> attributes as often as possible in cookbooks. </p> <p>Default value: <code>{}</code>.</p> </dd> </dl> <dl> <dt> <code>description</code> </dt> <dd> <p>The description of the role. This value populates the description field for the role on the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>env_run_lists</code> </dt> <dd> <p>The environment-specific run-list for a role. Default value: <code>[]</code>. For example: <code>["env_run_lists[webserver]"]</code></p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>name</code> </dt> <dd> <p>The name of the role.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>override_attributes</code> </dt> <dd> <p> An <code>override</code> attribute is automatically reset at the start of every Chef Infra Client run and has a higher attribute precedence than <code>default</code>, <code>force_default</code>, and <code>normal</code> attributes. An <code>override</code> attribute is most often specified in a recipe, but can be specified in an attribute file, for a role, and/or for an environment. A cookbook should be authored so that it uses <code>override</code> attributes only when required. </p> <p>Default value: <code>{}</code>.</p> </dd> </dl> <dl> <dt> <code>raw_json</code> </dt> <dd> 
<p>The role as JSON data. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"webserver"</span>,
  <span style="color:#4070a0">"chef_type"</span><span style="color:#666">:</span> <span style="color:#4070a0">"role"</span>,
  <span style="color:#4070a0">"json_class"</span><span style="color:#666">:</span> <span style="color:#4070a0">"Chef::Role"</span>,
  <span style="color:#4070a0">"default_attributes"</span><span style="color:#666">:</span> {},
  <span style="color:#4070a0">"description"</span><span style="color:#666">:</span> <span style="color:#4070a0">"A webserver"</span>,
  <span style="color:#4070a0">"run_list"</span><span style="color:#666">:</span> [
    <span style="color:#4070a0">"recipe[apache2]"</span>
  ],
  <span style="color:#4070a0">"override_attributes"</span><span style="color:#666">:</span> {}
}
</code></pre></div> </dd> </dl> <dl> <dt> <code>run_list</code> </dt> <dd> <p>A comma-separated list of roles and/or recipes to be applied. Default value: <code>[]</code>. For example: <code>["recipe[default]","recipe[apache2]"]</code></p> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <h3 id="examples-chef-role">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="chef-sleep-resource">chef_sleep resource</h2> <a href="chef_sleep/index.html">chef_sleep resource page</a> <hr> <p>Use the <strong>chef_sleep</strong> resource to pause (sleep) for a number of seconds during a Chef Infra Client run. Only use this resource when a command or service exits successfully but is not ready for the next step in a recipe.</p> <p><strong>New in Chef Infra Client 15.5.</strong></p> <h3 id="syntax-chef-sleep">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chef_sleep</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_sleep <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  seconds      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action       <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :sleep if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chef_sleep</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>seconds</code> is the property available to this resource.</li> </ul> <h3 id="actions-chef-sleep">Actions</h3> <hr> <p>The <strong>chef_sleep</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:sleep</code></dt> <dd>Pause the Chef Infra Client run for a specified number of seconds. (default)</dd> </dl> <h3 id="properties-chef-sleep">Properties</h3> <hr> <p>The <strong>chef_sleep</strong> resource has the following properties:</p> <dl> <dt> <code>seconds</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The number of seconds to sleep.</p> </dd> </dl> <br> <h3 id="functionality-chef-sleep">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chef-sleep">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chef-sleep">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chef-sleep">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chef-sleep">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chef_sleep</strong> resource in recipes:</p> <p><strong>Sleep for 10 seconds</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_sleep <span style="color:#4070a0">'10'</span>
</code></pre></div>
<p><strong>Sleep for 10 seconds with a descriptive resource name for logging</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_sleep <span style="color:#4070a0">'wait for the service to start'</span> <span style="color:#007020;font-weight:700">do</span>
  seconds <span style="color:#40a070">10</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Use a notification from another resource to sleep only when necessary</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'Service that is slow to start and reports as started'</span> <span style="color:#007020;font-weight:700">do</span>
  service_name <span style="color:#4070a0">'my_database'</span>
  action <span style="color:#517918">:start</span>
  notifies <span style="color:#517918">:sleep</span>, <span style="color:#4070a0">'chef_sleep[wait for service start]'</span>
<span style="color:#007020;font-weight:700">end</span>

chef_sleep <span style="color:#4070a0">'wait for service start'</span> <span style="color:#007020;font-weight:700">do</span>
  seconds <span style="color:#40a070">30</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chef-user-resource">chef_user resource</h2> <a href="chef_user/index.html">chef_user resource page</a> <hr> <p>Use the <strong>chef_user</strong> resource to manage users.</p> <h3 id="syntax-chef-user">Syntax</h3> <hr> 
<p>The syntax for using the <strong>chef_user</strong> resource in a recipe is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_user <span style="color:#4070a0">'value'</span> <span style="color:#60a0b0;font-style:italic"># see properties section below</span>
  <span style="color:#666">...</span>
  action <span style="color:#517918">:action</span> <span style="color:#60a0b0;font-style:italic"># see actions section below</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>chef_user</code> tells Chef Infra Client to use the <code>Chef::Provider::ChefUser</code> provider during a Chef Infra Client run</li> <li>
<code>name</code> is the name of the resource block; when the <code>name</code> property is not specified as part of a recipe, <code>name</code> is also the name of the user</li> <li>
<code>attribute</code> is zero (or more) of the properties that are available for this resource</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state</li> </ul> <h3 id="actions-chef-user">Actions</h3> <hr> <p>The <strong>chef_user</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Use to create a user.</dd> <dt><code>:delete</code></dt> <dd>Use to delete a user.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-user">Properties</h3> <hr> <p>The <strong>chef_user</strong> resource has the following properties:</p> <dl> <dt> <code>admin</code> </dt> <dd> <p>Create a client as an admin client. This is required for any user to access Chef as an administrator.</p> </dd> </dl> <dl> <dt> <code>chef_server</code> </dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>complete</code> </dt> <dd> <p>Use to specify if this resource defines a user completely. When <code>true</code>, any property not specified by this resource will be reset to default property values.</p> </dd> </dl> <dl> <dt> <code>email</code> </dt> <dd> <p>The email address for the user.</p> </dd> </dl> <dl> <dt> <code>external_authentication_uid</code> </dt> <dd> <p>&amp;mldr;</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>name</code> </dt> <dd> <p>The name of the user.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>output_key_format</code> </dt> <dd> <p>Use to specify the format of a public key. Possible values: <code>pem</code>, <code>der</code>, or <code>openssh</code>. Default value: <code>openssh</code>.</p> </dd> </dl> <dl> <dt> <code>output_key_path</code> </dt> <dd> <p>Use to specify the path to the location in which a public key will be written.</p> </dd> </dl> <dl> <dt> <code>raw_json</code> </dt> <dd> 
<p>The user as JSON data. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"Robert Forster"</span>
}
</code></pre></div> </dd> </dl> <dl> <dt> <code>recovery_authentication_enabled</code> </dt> <dd> <p>&amp;mldr;</p> </dd> </dl> <dl> <dt> <code>source_key</code> </dt> <dd> <p>Use to copy a public or private key, but apply a different <code>format</code> and <code>password</code>. Use in conjunction with <code>source_key_pass_phrase</code> and <code>source_key_path</code>.</p> </dd> </dl> <dl> <dt> <code>source_key_pass_phrase</code> </dt> <dd> <p>The pass phrase for the public key. Use in conjunction with <code>source_key</code> and <code>source_key_path</code>.</p> </dd> </dl> <dl> <dt> <code>source_key_path</code> </dt> <dd> <p>The path to the public key. Use in conjunction with <code>source_key</code> and <code>source_key_pass_phrase</code>.</p> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <h3 id="examples-chef-user">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="chef-vault-secret-resource">chef_vault_secret resource</h2> <a href="chef_vault_secret/index.html">chef_vault_secret resource page</a> <hr> <p>Use the <strong>chef_vault_secret</strong> resource to store secrets in Chef Vault items. Where possible and relevant, this resource attempts to map behavior and functionality to the knife vault sub-commands.</p> <p><strong>New in Chef Infra Client 16.0.</strong></p> <h3 id="syntax-chef-vault-secret">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chef_vault_secret</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_vault_secret <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  admins           <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  clients          <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  data_bag         <span style="color:#007020">String</span>
  environment      <span style="color:#007020">String</span>
  <span style="color:#007020">id</span>               <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  raw_data         <span style="color:#60add5">Hash</span>, <span style="color:#60add5">Mash</span> (<span style="color:#60add5">Hash</span><span style="color:#666">-</span>like) <span style="color:#60a0b0;font-style:italic"># default value: {}</span>
  search           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*:*"</span>
  action           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chef_vault_secret</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>admins</code>, <code>clients</code>, <code>data_bag</code>, <code>environment</code>, <code>id</code>, <code>raw_data</code>, and <code>search</code> are the properties available to this resource.</li> </ul> <h3 id="actions-chef-vault-secret">Actions</h3> <hr> <p>The <strong>chef_vault_secret</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Creates the item, or updates it if it already exists. (default)</dd> <dt><code>:create_if_missing</code></dt> <dd>Calls the create action unless it exists.</dd> <dt><code>:delete</code></dt> <dd>Deletes the item and the item’s keys (‘id’_keys).</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chef-vault-secret">Properties</h3> <hr> <p>The <strong>chef_vault_secret</strong> resource has the following properties:</p> <dl> <dt> <code>admins</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <code>REQUIRED</code> <p>A list of admin users who should have access to the item. Corresponds to the ‘admin’ option when using the chef-vault knife plugin. Can be specified as a comma separated string or an array.</p> </dd> </dl> <dl> <dt> <code>clients</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>A search query for the nodes' API clients that should have access to the item.</p> </dd> </dl> <dl> <dt> <code>data_bag</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The data bag that contains the item.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The Chef environment of the data if storing per environment values.</p> </dd> </dl> <dl> <dt> <code>id</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the data bag item if it differs from the name of the resource block</p> </dd> </dl> <dl> <dt> <code>raw_data</code> </dt> <dd> <strong>Ruby Type:</strong> Hash, Mash (Hash-like) | <strong>Default Value:</strong> <code>{}</code> <p>The raw data, as a Ruby Hash, that will be stored in the item.</p> </dd> </dl> <dl> <dt> <code>search</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>*:*</code> <p>Search query that would match the same used for the clients, gets stored as a field in the item.</p> </dd> </dl> <br> <h3 id="functionality-chef-vault-secret">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chef-vault-secret">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chef-vault-secret">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chef-vault-secret">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chef-vault-secret">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chef_vault_secret</strong> resource in recipes:</p> <p><strong>To create a ‘foo’ item in an existing ‘bar’ data bag</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_vault_secret <span style="color:#4070a0">'foo'</span> <span style="color:#007020;font-weight:700">do</span>
  data_bag <span style="color:#4070a0">'bar'</span>
  raw_data({ <span style="color:#4070a0">'auth'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'baz'</span> })
  admins <span style="color:#4070a0">'jtimberman'</span>
  search <span style="color:#4070a0">'*:*'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>To allow multiple admins access to an item</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_vault_secret <span style="color:#4070a0">'root-password'</span> <span style="color:#007020;font-weight:700">do</span>
  admins <span style="color:#4070a0">'jtimberman,paulmooring'</span>
  data_bag <span style="color:#4070a0">'secrets'</span>
  raw_data({ <span style="color:#4070a0">'auth'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'DoNotUseThisPasswordForRoot'</span> })
  search <span style="color:#4070a0">'*:*'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chocolatey-config-resource">chocolatey_config resource</h2> <a href="chocolatey_config/index.html">chocolatey_config resource page</a> <hr> <p>Use the <strong>chocolatey_config</strong> resource to add or remove Chocolatey configuration keys.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The Chocolatey package manager is not installed on Windows by default. You will need to install it prior to using this resource by adding the <a href="https://supermarket.chef.io/cookbooks/chocolatey/">Chocolatey cookbook</a> to your node’s run list.</p> </div> </div> <p><strong>New in Chef Infra Client 14.3.</strong></p> <h3 id="syntax-chocolatey-config">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chocolatey_config</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chocolatey_config <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  config_key      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  value           <span style="color:#007020">String</span>
  action          <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :set if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chocolatey_config</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>config_key</code> and <code>value</code> are the properties available to this resource.</li> </ul> <h3 id="actions-chocolatey-config">Actions</h3> <hr> <p>The <strong>chocolatey_config</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:set</code></dt> <dd>Sets a Chocolatey config value. (default)</dd> <dt><code>:unset</code></dt> <dd>Unsets a Chocolatey config value.</dd> </dl> <h3 id="properties-chocolatey-config">Properties</h3> <hr> <p>The <strong>chocolatey_config</strong> resource has the following properties:</p> <dl> <dt> <code>config_key</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the config key name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>value</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The value to set.</p> </dd> </dl> <br> <h3 id="functionality-chocolatey-config">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chocolatey-config">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chocolatey-config">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chocolatey-config">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chocolatey-config">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chocolatey_config</strong> resource in recipes:</p> <p><strong>Set the Chocolatey cacheLocation config</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chocolatey_config <span style="color:#4070a0">'Set cacheLocation config'</span> <span style="color:#007020;font-weight:700">do</span>
  config_key <span style="color:#4070a0">'cacheLocation'</span>
  value <span style="color:#4070a0">'C:\temp\choco'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Unset a Chocolatey config</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chocolatey_config <span style="color:#4070a0">'BogusConfig'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:unset</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chocolatey-feature-resource">chocolatey_feature resource</h2> <a href="chocolatey_feature/index.html">chocolatey_feature resource page</a> <hr> <p>Use the <strong>chocolatey_feature</strong> resource to enable and disable Chocolatey features.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The Chocolatey package manager is not installed on Windows by default. You will need to install it prior to using this resource by adding the <a href="https://supermarket.chef.io/cookbooks/chocolatey/">Chocolatey cookbook</a> to your node’s run list.</p> </div> </div> <p><strong>New in Chef Infra Client 15.1.</strong></p> <h3 id="syntax-chocolatey-feature">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chocolatey_feature</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chocolatey_feature <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  feature_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :enable if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chocolatey_feature</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>feature_name</code> is the property available to this resource.</li> </ul> <h3 id="actions-chocolatey-feature">Actions</h3> <hr> <p>The <strong>chocolatey_feature</strong> resource has the following actions:</p> <dl> <dt><code>:disable</code></dt> <dd>Disables a named Chocolatey feature.</dd> <dt><code>:enable</code></dt> <dd>Enables a named Chocolatey feature. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-chocolatey-feature">Properties</h3> <hr> <p>The <strong>chocolatey_feature</strong> resource has the following properties:</p> <dl> <dt> <code>feature_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the Chocolatey feature to enable or disable.</p> </dd> </dl> <br> <h3 id="functionality-chocolatey-feature">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chocolatey-feature">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chocolatey-feature">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chocolatey-feature">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chocolatey-feature">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chocolatey_feature</strong> resource in recipes:</p> <p><strong>Enable the checksumFiles Chocolatey feature</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chocolatey_feature <span style="color:#4070a0">'checksumFiles'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Disable the checksumFiles Chocolatey feature</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chocolatey_feature <span style="color:#4070a0">'checksumFiles'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:disable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chocolatey-package-resource">chocolatey_package resource</h2> <a href="chocolatey_package/index.html">chocolatey_package resource page</a> <hr> <p>Use the <strong>chocolatey_package</strong> resource to manage packages using the Chocolatey package manager on the Microsoft Windows platform.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The Chocolatey package manager is not installed on Windows by default. You will need to install it prior to using this resource by adding the <a href="https://supermarket.chef.io/cookbooks/chocolatey/">chocolatey cookbook</a> to your node’s run list.</p> </div> </div> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>The <strong>chocolatey_package</strong> resource must be specified as <code>chocolatey_package</code> and cannot be shortened to <code>package</code> in a recipe.</p> </div> </div> <p><strong>New in Chef Infra Client 12.7.</strong></p> <h3 id="syntax-chocolatey-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chocolatey_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chocolatey_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  list_options      <span style="color:#007020">String</span>
  options           <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name      <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  password          <span style="color:#007020">String</span>
  returns           <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: [0, 2]</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  user              <span style="color:#007020">String</span>
  version           <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chocolatey_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>list_options</code>, <code>options</code>, <code>package_name</code>, <code>password</code>, <code>returns</code>, <code>source</code>, <code>timeout</code>, <code>user</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-chocolatey-package">Actions</h3> <hr> <p>The <strong>chocolatey_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install a package. If a version is specified, install the specified version of the package. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and ensure that a package is the latest version.</dd> </dl> <h3 id="properties-chocolatey-package">Properties</h3> <hr> <p>The <strong>chocolatey_package</strong> resource has the following properties:</p> <dl> <dt> <code>list_options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One (or more) additional list options that are passed to the command.</p> <p> New in Chef Infra Client 15.3 </p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The name of the package. Default value: the name of the resource block.</p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The password to authenticate to the source.</p> <p> New in Chef Infra Client 15.3 </p> </dd> </dl> <dl> <dt> <code>returns</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Array | <strong>Default Value:</strong> <code>[0, 2]</code> <p>The exit code(s) returned by the <code>choco</code> command that indicate a successful action. See <a href="https://docs.chocolatey.org/en-us/choco/commands/info#exit-codes">Chocolatey Exit Codes</a> for a complete list of exit codes used by Chocolatey.</p> <p> New in Chef Client 12.18 </p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system or a reachable UNC path. Ensure that the path specified is to the <strong>folder</strong> containing the chocolatey package(s), not to the package itself.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The username to authenticate feeds.</p> <p> New in Chef Infra Client 15.3 </p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-chocolatey-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chocolatey-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chocolatey-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chocolatey-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chocolatey-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chocolatey_package</strong> resource in recipes:</p> <p><strong>Install a Chocolatey package</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chocolatey_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install a package with options with Chocolatey’s <code>--checksum</code> option</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chocolatey_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  options <span style="color:#4070a0">'--checksum 1234567890'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="chocolatey-source-resource">chocolatey_source resource</h2> <a href="chocolatey_source/index.html">chocolatey_source resource page</a> <hr> <p>Use the <strong>chocolatey_source</strong> resource to add, remove, enable, or disable Chocolatey sources.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The Chocolatey package manager is not installed on Windows by default. You will need to install it prior to using this resource by adding the <a href="https://supermarket.chef.io/cookbooks/chocolatey/">Chocolatey cookbook</a> to your node’s run list.</p> </div> </div> <p><strong>New in Chef Infra Client 14.3.</strong></p> <h3 id="syntax-chocolatey-source">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chocolatey_source</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chocolatey_source <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  admin_only              <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  allow_self_service      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  bypass_proxy            <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  cert                    <span style="color:#007020">String</span>
  cert_password           <span style="color:#007020">String</span>
  password                <span style="color:#007020">String</span>
  priority                <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 0</span>
  source                  <span style="color:#007020">String</span>
  source_name             <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  username                <span style="color:#007020">String</span>
  action                  <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chocolatey_source</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>admin_only</code>, <code>allow_self_service</code>, <code>bypass_proxy</code>, <code>cert</code>, <code>cert_password</code>, <code>password</code>, <code>priority</code>, <code>source</code>, <code>source_name</code>, and <code>username</code> are the properties available to this resource.</li> </ul> <h3 id="actions-chocolatey-source">Actions</h3> <hr> <p>The <strong>chocolatey_source</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Adds a Chocolatey source (default)</dd> <dt><code>:disable</code></dt> <dd>Disables a Chocolatey source. <strong>New in Chef Infra Client 15.1.</strong>
</dd> <dt><code>:enable</code></dt> <dd>Enables a Chocolatey source. <strong>New in Chef Infra Client 15.1.</strong>
</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Removes a Chocolatey source.</dd> </dl> <h3 id="properties-chocolatey-source">Properties</h3> <hr> <p>The <strong>chocolatey_source</strong> resource has the following properties:</p> <dl> <dt> <code>admin_only</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Whether or not to set the source to be accessible to only admins.</p> <p> New in Chef Infra Client 15.1 </p> </dd> </dl> <dl> <dt> <code>allow_self_service</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Whether or not to set the source to be used for self service.</p> <p> New in Chef Infra Client 15.1 </p> </dd> </dl> <dl> <dt> <code>bypass_proxy</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Whether or not to bypass the system’s proxy settings to access the source.</p> </dd> </dl> <dl> <dt> <code>cert</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The certificate to use when authenticating against the source</p> <p> New in Chef Infra Client 17.7 </p> </dd> </dl> <dl> <dt> <code>cert_password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The password for the certificate to use when authenticating against the source</p> <p> New in Chef Infra Client 17.7 </p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The password to use when authenticating against the source</p> <p> New in Chef Infra Client 17.7 </p> </dd> </dl> <dl> <dt> <code>priority</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code> <p>The priority level of the source.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The source URL.</p> </dd> </dl> <dl> <dt> <code>source_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the source name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>username</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The username to use when authenticating against the source</p> <p> New in Chef Infra Client 17.7 </p> </dd> </dl> <br> <h3 id="functionality-chocolatey-source">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-chocolatey-source">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-chocolatey-source">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-chocolatey-source">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-chocolatey-source">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>chocolatey_source</strong> resource in recipes:</p> <p><strong>Add a Chocolatey source</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chocolatey_source <span style="color:#4070a0">'MySource'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'http://example.com/something'</span>
  action <span style="color:#517918">:add</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove a Chocolatey source</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chocolatey_source <span style="color:#4070a0">'MySource'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="cookbook-file-resource">cookbook_file resource</h2> <a href="cookbook_file/index.html">cookbook_file resource page</a> <hr> <p> Use the <strong>cookbook_file</strong> resource to transfer files from a sub-directory of <code>COOKBOOK_NAME/files/</code> to a specified path located on a host that is running Chef Infra Client. The file is selected according to file specificity, which allows different source files to be used based on the hostname, host platform (operating system, distro, or as appropriate), or platform version. Files that are located in the <code>COOKBOOK_NAME/files/default</code> sub-directory may be used on any platform. </p> <p>During a Chef Infra Client run, the checksum for each local file is calculated and then compared against the checksum for the same file as it currently exists in the cookbook on the Chef Infra Server. A file is not transferred when the checksums match. Only files that require an update are transferred from the Chef Infra Server to a node.</p> <h3 id="syntax-cookbook-file">Syntax</h3> <hr> 
<p>A <strong>cookbook_file</strong> resource block manages files by using files that exist within a cookbook’s <code>/files</code> directory. For example, to write the home page for an Apache website:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'/var/www/customers/public_html/index.php'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'index.php'</span>
  owner <span style="color:#4070a0">'web_admin'</span>
  group <span style="color:#4070a0">'web_admin'</span>
  mode <span style="color:#4070a0">'0755'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>'/var/www/customers/public_html/index.php'</code> is path to the file to be created</li> <li>
<code>'index.php'</code> is a file in the <code>/files</code> directory in a cookbook that is used to create that file (the contents of the file in the cookbook will become the contents of the file on the node)</li> <li>
<code>owner</code>, <code>group</code>, and <code>mode</code> define the permissions</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>cookbook_file</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  atomic_update              <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  backup                     <span style="color:#007020">Integer</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: 5</span>
  cookbook                   <span style="color:#007020">String</span>
  force_unlink               <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  inherits                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  manage_symlink_source      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  mode                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  owner                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                       <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  rights                     <span style="color:#60add5">Hash</span>
  source                     <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  verify                     <span style="color:#007020">String</span>, <span style="color:#60add5">Block</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>cookbook_file</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>atomic_update</code>, <code>backup</code>, <code>cookbook</code>, <code>force_unlink</code>, <code>group</code>, <code>inherits</code>, <code>manage_symlink_source</code>, <code>mode</code>, <code>owner</code>, <code>path</code>, <code>rights</code>, <code>source</code>, and <code>verify</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-cookbook-file">Actions</h3> <hr> <p>The <strong>cookbook_file</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Create a file. If a file already exists (but does not match), update that file to match.</dd> <dt><code>:create_if_missing</code></dt> <dd>Create a file only if the file does not exist. When the file exists, nothing happens.</dd> <dt><code>:delete</code></dt> <dd>Delete a file.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:touch</code></dt> <dd>Touch a file. This updates the access (atime) and file modification (mtime) times for a file. (This action may be used with this resource, but is typically only used with the <strong>file</strong> resource.)</dd> </dl> <h3 id="properties-cookbook-file">Properties</h3> <hr> <p>The <strong>cookbook_file</strong> resource has the following properties:</p> <dl> <dt> <code>atomic_update</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>False if modifying /etc/hosts, /etc/hostname, or /etc/resolv.conf within Docker containers. Otherwise default to the client.rb 'file_atomic_update' config value.</code> <p>Perform atomic file updates on a per-resource basis. Set to true for atomic file updates. Set to false for non-atomic file updates. This setting overrides <code>file_atomic_update</code>, which is a global setting found in the <code>client.rb</code> file.</p> </dd> </dl> <dl> <dt> <code>backup</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, false | <strong>Default Value:</strong> <code>5</code> <p>The number of backups to be kept in <code>/var/chef/backup</code> (for UNIX- and Linux-based platforms) or <code>C:/chef/backup</code> (for the Microsoft Windows platform). Set to <code>false</code> to prevent backups from being kept.</p> </dd> </dl> <dl> <dt> <code>cookbook</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The current cookbook name</code> <p>The cookbook in which a file is located (if it is not located in the current cookbook).</p> </dd> </dl> <dl> <dt> <code>force_unlink</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>How Chef Infra Client handles certain situations when the target file turns out not to be a file. For example, when a target file is actually a symlink. Set to <code>true</code> for Chef Infra Client to delete the non-file target and replace it with the specified file. Set to <code>false</code> for Chef Infra Client to raise an error.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>A string or ID that identifies the group owner by group name or SID, including fully qualified group names such as <code>domain\group</code> or <code>group@domain</code>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <code>POSIX</code> group (if available).</p> </dd> </dl> <dl> <dt> <code>inherits</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Microsoft Windows only. Whether a file inherits rights from its parent directory.</p> </dd> </dl> <dl> <dt> <code>manage_symlink_source</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> 
<p>(with warning)</p> <p>Change the behavior of the file resource if it is pointed at a symlink. When this value is set to <code>true</code>, Chef Infra Client will manage the symlink’s permissions or will replace the symlink with a normal file if the resource has content. When this value is set to <code>false</code>, Chef will follow the symlink and will manage the permissions and content of the symlink’s target file.</p> <p>The default behavior is <code>true</code> but emits a warning that the default value will be changed to <code>false</code> in a future version; setting this explicitly to <code>true</code> or <code>false</code> suppresses this warning.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String 
<p>If <code>mode</code> is not specified and if the file already exists, the existing mode on the file is used. If <code>mode</code> is not specified, the file does not exist, and the <code>:create</code> action is specified, Chef Infra Client assumes a mask value of <code>'0777'</code> and then applies the umask for the system on which the file is to be created to the <code>mask</code> value. For example, if the umask on a system is <code>'022'</code>, Chef Infra Client uses the default value of <code>'0755'</code>.</p> <p>The behavior is different depending on the platform.</p> <p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If the value is specified as a quoted string, it works exactly as if the <code>chmod</code> command was passed. If the value is specified as an integer, prepend a zero (<code>0</code>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <code>'0777'</code> or <code>'777'</code>; for the same rights, plus the sticky bit, use <code>01777</code> or <code>'1777'</code>.</p> <p>Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. Values up to <code>'0777'</code> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <code>4</code> equals <code>GENERIC_READ</code>, <code>2</code> equals <code>GENERIC_WRITE</code>, and <code>1</code> equals <code>GENERIC_EXECUTE</code>. This property cannot be used to set <code>:full_control</code>. This property has no effect if not specified, but when it and <code>rights</code> are both specified, the effects are cumulative.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>A string or ID that identifies the group owner by user name or SID, including fully qualified user names such as <code>domain\user</code> or <code>user@domain</code>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String 
<p>The path to the destination at which a file is to be created. For example: <code>file.txt</code>.</p> <p>Microsoft Windows: A path that begins with a forward slash (<code>/</code>) will point to the root of the current working directory of Chef Infra Client process. This path can vary from system to system. Therefore, using a path that begins with a forward slash (<code>/</code>) is not recommended.</p> </dd> </dl> <dl> <dt> <code>rights</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <code>rights &lt;permissions&gt;, &lt;principal&gt;, &lt;options&gt;</code> where <code>&lt;permissions&gt;</code> specifies the rights granted to the principal, <code>&lt;principal&gt;</code> is the group or user name, and <code>&lt;options&gt;</code> is a Hash with one (or more) advanced rights options.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the file in <code>COOKBOOK_NAME/files/default</code> or the path to a file located in <code>COOKBOOK_NAME/files</code>. The path must include the file name and its extension. This can be used to distribute specific files depending upon the platform used - see <a href="#cookbook-file-specificity">File Specificity</a> for more information.</p> </dd> </dl> <dl> <dt> <code>verify</code> </dt> <dd> <strong>Ruby Type:</strong> String, Block 
<p>A block or a string that returns <code>true</code> or <code>false</code>. A string, when <code>true</code> is executed as a system command.</p> <p>A block is arbitrary Ruby defined within the resource block by using the <code>verify</code> property. When a block is <code>true</code>, Chef Infra Client will continue to update the file as appropriate.</p> <p>For example, this should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'/tmp/baz'</span> <span style="color:#007020;font-weight:700">do</span>
  verify { <span style="color:#40a070">1</span> <span style="color:#666">==</span> <span style="color:#40a070">1</span> }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'/etc/nginx.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  verify <span style="color:#4070a0">'nginx -t -c %{path}'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> 
<p>This should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'/tmp/bar'</span> <span style="color:#007020;font-weight:700">do</span>
  verify { <span style="color:#40a070">1</span> <span style="color:#666">==</span> <span style="color:#40a070">1</span>}
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>And this should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'/tmp/foo'</span> <span style="color:#007020;font-weight:700">do</span>
  verify <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>path<span style="color:#666">|</span>
    <span style="color:#007020">true</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Whereas, this should return <code>false</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'/tmp/turtle'</span> <span style="color:#007020;font-weight:700">do</span>
  verify <span style="color:#4070a0">'/usr/bin/false'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>If a string or a block return <code>false</code>, the Chef Infra Client run will stop and an error is returned.</p> </dd> </dl> <h4 id="common-atomic-update-cookbook-file">Atomic File Updates</h4> <p>Atomic updates are used with <strong>file</strong>-based resources to help ensure that file updates can be made when updating a binary or if disk space runs out.</p> <p>Atomic updates are enabled by default. They can be managed globally using the <code>file_atomic_update</code> setting in the client.rb file. They can be managed on a per-resource basis using the <code>atomic_update</code> property that is available with the <strong>cookbook_file</strong>, <strong>file</strong>, <strong>remote_file</strong>, and <strong>template</strong> resources.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>On certain platforms, and after a file has been moved into place, Chef Infra Client may modify file permissions to support features specific to those platforms. On platforms with SELinux enabled, Chef Infra Client will fix up the security contexts after a file has been moved into the correct location by running the <code>restorecon</code> command. On the Microsoft Windows platform, Chef Infra Client will create files so that ACL inheritance works as expected.</p> </div> </div> <h4 id="common-windows-security-cookbook-file">Windows File Security</h4> To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes. <strong>Access Control Lists (ACLs)</strong> <p>The <code>rights</code> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <code>rights</code> property can be used as many times as necessary; Chef Infra Client will apply them to the file or directory as required. The syntax for the <code>rights</code> property is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights permission, principal, option_type <span style="color:#666">=&gt;</span> value
</code></pre></div>
<p>where</p> <dl> <dt><code>permission</code></dt> <dd> <p>Use to specify which rights are granted to the <code>principal</code>. The possible values are: <code>:read</code>, <code>:write</code>, <code>read_execute</code>, <code>:modify</code>, <code>:full_control</code>, or an integer.</p> </dd> <dd> <p>Integers used for permissions must match the following list <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.accesscontrol.filesystemrights?view=windowsdesktop-5.0#fields">FileSystemRights Enum</a> fields.</p> </dd> </dl> <pre class="highlight" data-language="ruby"><code>These permissions are cumulative. If `:write` is specified, then it
includes `:read`. If `:full_control` is specified, then it includes
both `:write` and `:read`.

(For those who know the Microsoft Windows API: `:read` corresponds
to `GENERIC_READ`; `:write` corresponds to `GENERIC_WRITE`;
`:read_execute` corresponds to `GENERIC_READ` and `GENERIC_EXECUTE`;
`:modify` corresponds to `GENERIC_WRITE`, `GENERIC_READ`,
`GENERIC_EXECUTE`, and `DELETE`; `:full_control` corresponds to
`GENERIC_ALL`, which allows a user to change the owner and other
metadata about a file.)
</code></pre> <dl> <dt><code>principal</code></dt> <dd> <p>Use to specify a group or user. The principal can be specified by either name or SID. When using name, this is identical to what is entered in the login box for Microsoft Windows, such as <code>user_name</code>, <code>domain\user_name</code>, or <code>user_name@fully_qualified_domain_name</code>. When using a SID, you may use either the standard string representation of a SID (S-R-I-S-S) or one of the <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/sid-strings">SDDL string constants</a>. Chef Infra Client does not need to know if a principal is a user or a group.</p> </dd> <dt><code>option_type</code></dt> <dd> <p>A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <code>rights :write, 'domain\group_name', :one_level_deep =&gt; true</code>. Possible option types:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Option Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>:applies_to_children</code></td> <td>Specify how permissions are applied to children. Possible values: <code>true</code> to inherit both child directories and files; <code>false</code> to not inherit any child directories or files; <code>:containers_only</code> to inherit only child directories (and not files); <code>:objects_only</code> to recursively inherit files (and not child directories).</td> </tr> <tr> <td><code>:applies_to_self</code></td> <td>Indicates whether a permission is applied to the parent directory. Possible values: <code>true</code> to apply to the parent directory or file and its children; <code>false</code> to not apply only to child directories and files.</td> </tr> <tr> <td><code>:one_level_deep</code></td> <td>Indicates the depth to which permissions will be applied. Possible values: <code>true</code> to apply only to the first level of children; <code>false</code> to apply to all children.</td> </tr> </tbody> </table> </dd> </dl> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'S-1-1-0'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Administrators Everyone)</span>
rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'Users'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'Sally'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#517918">:containers_only</span>, <span style="color:#517918">applies_to_self</span>: <span style="color:#007020">false</span>, <span style="color:#517918">one_level_deep</span>: <span style="color:#007020">true</span>
</code></pre></div>
<p>Some other important things to know when using the <code>rights</code> attribute:</p> <ul> <li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li> <li>If rights are not specified, nothing will be changed. Chef Infra Client does not clear out the rights on a file or directory if rights are not specified.</li> <li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li> </ul> <p>Use the <code>deny_rights</code> property to deny specific rights to specific users. The ordering is independent of using the <code>rights</code> property. For example, it doesn’t matter if rights are granted to everyone is placed before or after <code>deny_rights :read, ['Julian', 'Lewis']</code>, both Julian and Lewis will be unable to read the document. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'Everyone'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Julian Lewis)</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">deny_rights <span style="color:#517918">:full_control</span>, <span style="color:#666">[</span><span style="color:#4070a0">'Sally'</span><span style="color:#666">]</span>
</code></pre></div> <strong>Inheritance</strong> <p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <code>inherits</code> property can be used to specifically tell Chef Infra Client to apply (or not apply) inherited rights from its parent directory.</p> <p>For example, the following example specifies the rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  inherits <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># Sauron is the only person who should have any sort of access</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>If the <code>deny_rights</code> permission were to be used instead, something could slip through unless all users and groups were denied.</p> <p>Another example also shows how to specify rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'SHIRE\Frodo'</span> <span style="color:#60a0b0;font-style:italic"># Who put that there I didn't put that there</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>but then not use the <code>inherits</code> property to deny those rights on a child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span> <span style="color:#60a0b0;font-style:italic"># Oops, not specific enough</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Because the <code>inherits</code> property is not specified, Chef Infra Client will default it to <code>true</code>, which will ensure that security settings for existing files remain unchanged.</p> <br> <h3 id="functionality-cookbook-file">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-cookbook-file">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-cookbook-file">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-cookbook-file">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="cookbook-file-specificity-cookbook-file">File Specificity</h3> <p>A cookbook is frequently designed to work across many platforms and is often required to distribute a specific file to a specific platform. A cookbook can be designed to support the distribution of files across platforms, while ensuring that the correct file ends up on each system.</p> <p>The pattern for file specificity depends on two things: the lookup path and the source attribute. The first pattern that matches is used:</p> <ol> <li>/host-$fqdn/$source</li> <li>/$platform-$platform_version/$source</li> <li>/$platform/$source</li> <li>/default/$source</li> <li>/$source</li> </ol> <p>Use an array with the <code>source</code> attribute to define an explicit lookup path. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/conf.py'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#666">[</span><span style="color:#4070a0">'#{node.chef_environment}.py'</span>, <span style="color:#4070a0">'conf.py'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The following example emulates the entire file specificity pattern by defining it as an explicit path:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/conf.py'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#c65d09">%W(
</span><span style="color:#c65d09">    host-</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'fqdn'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">/conf.py
</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'platform'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">-</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'platform_version'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">/conf.py
</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'platform'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">/conf.py
</span><span style="color:#c65d09">    default/conf.py
</span><span style="color:#c65d09">  )</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>A cookbook may have a <code>/files</code> directory structure like this:</p> <pre class="highlight" data-language="ruby"><code>files/
   host-foo.example.com
   ubuntu-20.04
   ubuntu-20
   ubuntu
   redhat-8.2
   redhat-7.8
   ...
   default
</code></pre> <p>and a resource that looks something like the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'/usr/local/bin/apache2_module_conf_generate.pl'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'apache2_module_conf_generate.pl'</span>
  mode <span style="color:#4070a0">'0755'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This resource is matched in the same order as the <code>/files</code> directory structure. For a node that is running Ubuntu 20.04, the second item would be the matching item and the location to which the file identified in the <strong>cookbook_file</strong> resource would be distributed:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">host<span style="color:#666">-</span>foo<span style="color:#666">.</span>example<span style="color:#666">.</span>com<span style="color:#666">/</span>apache2_module_conf_generate<span style="color:#666">.</span>pl
ubuntu<span style="color:#666">-</span><span style="color:#40a070">20</span><span style="color:#666">.</span><span style="color:#40a070">04</span><span style="color:#666">/</span>apache2_module_conf_generate<span style="color:#666">.</span>pl
ubuntu<span style="color:#666">-</span><span style="color:#40a070">20</span><span style="color:#666">/</span>apache2_module_conf_generate<span style="color:#666">.</span>pl
ubuntu<span style="color:#666">/</span>apache2_module_conf_generate<span style="color:#666">.</span>pl
default<span style="color:#666">/</span>apache2_module_conf_generate<span style="color:#666">.</span>pl
</code></pre></div>
<p>If the <code>apache2_module_conf_generate.pl</code> file was located in the cookbook directory under <code>files/host-foo.example.com/</code>, the specified file(s) would only be copied to the machine with the domain name foo.example.com.</p> <p><strong>Host Notation</strong></p> <p>The naming of folders within cookbook directories must literally match the host notation used for file specificity matching. For example, if a host is named <code>foo.example.com</code>, the folder must be named <code>host-foo.example.com</code>.</p> <h3 id="examples-cookbook-file">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>cookbook_file</strong> resource in recipes:</p> <p>Transfer a file</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'file.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Handle cookbook_file and package resources in the same recipe</p> <p>When a <strong>cookbook_file</strong> resource and a <strong>package</strong> resource are both called from within the same recipe, use the <code>flush_cache</code> attribute to dump the in-memory Yum cache, and then use the repository immediately to ensure that the correct package is installed:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'/etc/yum.repos.d/custom.repo'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'custom'</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>

package <span style="color:#4070a0">'only-in-custom-repo'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  flush_cache <span style="color:#666">[</span> <span style="color:#517918">:before</span> <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install repositories from a file, trigger a command, and force the internal cache to reload</p> <p>The following example shows how to install new Yum repositories from a file, where the installation of the repository triggers a creation of the Yum cache that forces the internal cache for Chef Infra Client to reload:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'create-yum-cache'</span> <span style="color:#007020;font-weight:700">do</span>
 command <span style="color:#4070a0">'yum -q makecache'</span>
 action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

ruby_block <span style="color:#4070a0">'reload-internal-yum-cache'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Provider</span><span style="color:#666">::</span><span style="color:#60add5">Package</span><span style="color:#666">::</span><span style="color:#60add5">Yum</span><span style="color:#666">::</span><span style="color:#60add5">YumCache</span><span style="color:#666">.</span>instance<span style="color:#666">.</span>reload
  <span style="color:#007020;font-weight:700">end</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

cookbook_file <span style="color:#4070a0">'/etc/yum.repos.d/custom.repo'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'custom'</span>
  mode <span style="color:#4070a0">'0755'</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[create-yum-cache]'</span>, <span style="color:#517918">:immediately</span>
  notifies <span style="color:#517918">:create</span>, <span style="color:#4070a0">'ruby_block[reload-internal-yum-cache]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use a case statement</p> <p>The following example shows how a case statement can be used to handle a situation where an application needs to be installed on multiple platforms, but where the install directories are different paths, depending on the platform:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'application.pm'</span> <span style="color:#007020;font-weight:700">do</span>
  path <span style="color:#007020;font-weight:700">case</span> node<span style="color:#666">[</span><span style="color:#4070a0">'platform'</span><span style="color:#666">]</span>
    <span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'centos'</span>,<span style="color:#4070a0">'redhat'</span>
      <span style="color:#4070a0">'/usr/lib/version/1.2.3/dir/application.pm'</span>
    <span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'arch'</span>
      <span style="color:#4070a0">'/usr/share/version/core_version/dir/application.pm'</span>
    <span style="color:#007020;font-weight:700">else</span>
      <span style="color:#4070a0">'/etc/version/dir/application.pm'</span>
    <span style="color:#007020;font-weight:700">end</span>
  source <span style="color:#4070a0">"application-</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'languages'</span><span style="color:#666">][</span><span style="color:#4070a0">'perl'</span><span style="color:#666">][</span><span style="color:#4070a0">'version'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.pm"</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Manage dotfiles</p> <p>The following example shows using the <strong>directory</strong> and <strong>cookbook_file</strong> resources to manage dotfiles. The dotfiles are defined by a JSON data structure similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript"><span style="color:#4070a0">"files"</span><span style="color:#666">:</span> {
  <span style="color:#4070a0">".zshrc"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"mode"</span><span style="color:#666">:</span> <span style="color:#4070a0">'0755'</span>,
    <span style="color:#4070a0">"source"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dot-zshrc"</span>
    },
  <span style="color:#4070a0">".bashrc"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"mode"</span><span style="color:#666">:</span> <span style="color:#4070a0">'0755'</span>,
    <span style="color:#4070a0">"source"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dot-bashrc"</span>
     },
  <span style="color:#4070a0">".bash_profile"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"mode"</span><span style="color:#666">:</span> <span style="color:#4070a0">'0755'</span>,
    <span style="color:#4070a0">"source"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dot-bash_profile"</span>
    },
  }
</code></pre></div>
<p>and then the following resources manage the dotfiles:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">if</span> u<span style="color:#666">.</span>has_key?(<span style="color:#4070a0">'files'</span>)
  u<span style="color:#666">[</span><span style="color:#4070a0">'files'</span><span style="color:#666">].</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>filename, file_data<span style="color:#666">|</span>

  directory <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>home_dir<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">File</span><span style="color:#666">.</span>dirname(filename)<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#007020;font-weight:700">do</span>
    recursive <span style="color:#007020">true</span>
    mode <span style="color:#4070a0">'0755'</span>
  <span style="color:#007020;font-weight:700">end</span> <span style="color:#007020;font-weight:700">if</span> file_data<span style="color:#666">[</span><span style="color:#4070a0">'subdir'</span><span style="color:#666">]</span>

  cookbook_file <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>home_dir<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span>filename<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>u<span style="color:#666">[</span><span style="color:#4070a0">'id'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span>file_data<span style="color:#666">[</span><span style="color:#4070a0">'source'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
    owner <span style="color:#4070a0">'u['</span><span style="color:#007020">id</span><span style="color:#4070a0">']'</span>
    group <span style="color:#4070a0">'group_id'</span>
    mode <span style="color:#4070a0">'file_data['</span>mode<span style="color:#4070a0">']'</span>
    ignore_failure <span style="color:#007020">true</span>
    backup <span style="color:#40a070">0</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="cron-resource">cron resource</h2> <a href="cron/index.html">cron resource page</a> <hr> <p>Use the <strong>cron</strong> resource to manage cron entries for time-based job scheduling. Properties for a schedule will default to * if not provided. The cron resource requires access to a crontab program, typically cron.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>The cron resource should only be used to modify an entry in a crontab file. The <code>cron_d</code> resource directly manages <code>cron.d</code> files. This resource ships in Chef Infra Client 14.4 or later and can also be found in the <a href="https://github.com/chef-cookbooks/cron">cron</a> cookbook) for previous Chef Infra Client releases.</p> </div> </div> <h3 id="syntax-cron">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>cron</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  command          <span style="color:#007020">String</span>
  day              <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  environment      <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {}</span>
  home             <span style="color:#007020">String</span>
  hour             <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  mailto           <span style="color:#007020">String</span>
  minute           <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  month            <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  path             <span style="color:#007020">String</span>
  shell            <span style="color:#007020">String</span>
  time             <span style="color:#60add5">Symbol</span>
  time_out         <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {}</span>
  user             <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "root"</span>
  weekday          <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>, <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  action           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>cron</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>command</code>, <code>day</code>, <code>environment</code>, <code>home</code>, <code>hour</code>, <code>mailto</code>, <code>minute</code>, <code>month</code>, <code>path</code>, <code>shell</code>, <code>time</code>, <code>time_out</code>, <code>user</code>, and <code>weekday</code> are the properties available to this resource.</li> </ul> <h3 id="actions-cron">Actions</h3> <hr> <p>The <strong>cron</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create an entry in a cron table file (crontab). If an entry already exists (but does not match), update that entry to match. (default)</dd> <dt><code>:delete</code></dt> <dd>Delete an entry from a cron table file (crontab).</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-cron">Properties</h3> <hr> <p>The <strong>cron</strong> resource has the following properties:</p> <dl> <dt> <code>command</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The command to be run, or the path to a file that contains the command to be run.</p> </dd> </dl> <dl> <dt> <code>day</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>*</code> <p>The day of month at which the cron entry should run (<code>1 - 31</code>).</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> <p>A Hash containing additional arbitrary environment variables under which the cron job will be run in the form of <code>({'ENV_VARIABLE' =&gt; 'VALUE'})</code>. <strong>Note</strong>: These variables must exist for a command to be run successfully.</p> </dd> </dl> <dl> <dt> <code>home</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Set the <code>HOME</code> environment variable.</p> </dd> </dl> <dl> <dt> <code>hour</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>*</code> <p>The hour at which the cron entry is to run (<code>0 - 23</code>).</p> </dd> </dl> <dl> <dt> <code>mailto</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Set the <code>MAILTO</code> environment variable.</p> </dd> </dl> <dl> <dt> <code>minute</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>*</code> <p>The minute at which the cron entry should run (<code>0 - 59</code>).</p> </dd> </dl> <dl> <dt> <code>month</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>*</code> <p>The month in the year on which a cron entry is to run (<code>1 - 12</code>, <code>jan-dec</code>, or <code>*</code>).</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Set the <code>PATH</code> environment variable.</p> </dd> </dl> <dl> <dt> <code>shell</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Set the <code>SHELL</code> environment variable.</p> </dd> </dl> <dl> <dt> <code>time</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol <strong>Allowed Values:</strong> <code>:annually, :daily, :hourly, :midnight, :monthly, :reboot, :weekly, :yearly</code> <p>A time interval.</p> </dd> </dl> <dl> <dt> <code>time_out</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> 
<p>A Hash of timeouts in the form of <code>({'OPTION' =&gt; 'VALUE'})</code>. Accepted valid options are:</p> <ul> <li>
<code>preserve-status</code> (BOOL, default: ‘false’),</li> <li>
<code>foreground</code> (BOOL, default: ‘false’),</li> <li>
<code>kill-after</code> (in seconds),</li> <li>
<code>signal</code> (a name like ‘HUP’ or a number)</li> </ul> <p> New in Chef Infra Client 15.7 </p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>root</code> <p>The name of the user that runs the command. If the user property is changed, the original user for the crontab program continues to run until that crontab program is deleted. This property is not applicable on the AIX platform.</p> </dd> </dl> <dl> <dt> <code>weekday</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String, Symbol | <strong>Default Value:</strong> <code>*</code> <p>The day of the week on which this entry is to run (<code>0-7</code>, <code>mon-sun</code>, <code>monday-sunday</code>, or <code>*</code>), where Sunday is both <code>0</code> and <code>7</code>.</p> </dd> </dl> <br> <h3 id="functionality-cron">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-cron">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-cron">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-cron">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-cron">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>cron</strong> resource in recipes:</p> <p><strong>Run a program at a specified interval</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron <span style="color:#4070a0">'noop'</span> <span style="color:#007020;font-weight:700">do</span>
  hour <span style="color:#4070a0">'5'</span>
  minute <span style="color:#4070a0">'0'</span>
  command <span style="color:#4070a0">'/bin/true'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run an entry if a folder exists</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron <span style="color:#4070a0">'ganglia_tomcat_thread_max'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">"/usr/bin/gmetric
</span><span style="color:#4070a0">    -n 'tomcat threads max'
</span><span style="color:#4070a0">    -t uint32
</span><span style="color:#4070a0">    -v '/usr/local/bin/tomcat-stat --thread-max'"</span>
  only_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(<span style="color:#4070a0">'/home/jboss'</span>) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run every Saturday, 8:00 AM</strong></p> <p>The following example shows a schedule that will run every hour at 8:00 each Saturday morning, and will then send an email to “admin@example.com” after each run.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron <span style="color:#4070a0">'name_of_cron_entry'</span> <span style="color:#007020;font-weight:700">do</span>
  minute <span style="color:#4070a0">'0'</span>
  hour <span style="color:#4070a0">'8'</span>
  weekday <span style="color:#4070a0">'6'</span>
  mailto <span style="color:#4070a0">'admin@example.com'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run once a week</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron <span style="color:#4070a0">'cookbooks_report'</span> <span style="color:#007020;font-weight:700">do</span>
  minute <span style="color:#4070a0">'0'</span>
  hour <span style="color:#4070a0">'0'</span>
  weekday <span style="color:#4070a0">'1'</span>
  user <span style="color:#4070a0">'chefio'</span>
  mailto <span style="color:#4070a0">'sysadmin@example.com'</span>
  home <span style="color:#4070a0">'/srv/supermarket/shared/system'</span>
  command <span style="color:#c65d09">%W{
</span><span style="color:#c65d09">    cd /srv/supermarket/current &amp;&amp;
</span><span style="color:#c65d09">    env RUBYLIB="/srv/supermarket/current/lib"
</span><span style="color:#c65d09">    RAILS_ASSET_ID=`git rev-parse HEAD` RAILS_ENV="</span><span style="color:#70a0d0;font-style:italic">#{</span>rails_env<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">"
</span><span style="color:#c65d09">    bundle exec rake cookbooks_report
</span><span style="color:#c65d09">  }</span><span style="color:#666">.</span>join(<span style="color:#4070a0">' '</span>)
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run only in November</strong></p> <p>The following example shows a schedule that will run at 8:00 PM, every weekday (Monday through Friday), but only in November:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron <span style="color:#4070a0">'name_of_cron_entry'</span> <span style="color:#007020;font-weight:700">do</span>
  minute <span style="color:#4070a0">'0'</span>
  hour <span style="color:#4070a0">'20'</span>
  day <span style="color:#4070a0">'*'</span>
  month <span style="color:#4070a0">'11'</span>
  weekday <span style="color:#4070a0">'1-5'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="cron-access-resource">cron_access resource</h2> <a href="cron_access/index.html">cron_access resource page</a> <hr> <p>Use the <strong>cron_access</strong> resource to manage cron’s cron.allow and cron.deny files.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>This resource previously shipped in the <code>cron</code> cookbook as <code>cron_manage</code>, which it can still be used as for backwards compatibility with existing Chef Infra Client releases.</p> </div> </div> <p><strong>New in Chef Infra Client 14.4.</strong></p> <h3 id="syntax-cron-access">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>cron_access</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron_access <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  user      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action    <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :allow if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>cron_access</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>user</code> is the property available to this resource.</li> </ul> <h3 id="actions-cron-access">Actions</h3> <hr> <p>The <strong>cron_access</strong> resource has the following actions:</p> <dl> <dt><code>:allow</code></dt> <dd>Add the user to the cron.allow file. (default)</dd> <dt><code>:deny</code></dt> <dd>Add the user to the cron.deny file.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-cron-access">Properties</h3> <hr> <p>The <strong>cron_access</strong> resource has the following properties:</p> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the user name if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-cron-access">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-cron-access">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-cron-access">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-cron-access">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-cron-access">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>cron_access</strong> resource in recipes:</p> <p><strong>Add the mike user to cron.allow</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron_access <span style="color:#4070a0">'mike'</span>
</code></pre></div>
<p><strong>Add the mike user to cron.deny</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron_access <span style="color:#4070a0">'mike'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:deny</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Specify the username with the user property</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron_access <span style="color:#4070a0">'Deny the jenkins user access to cron for security purposes'</span> <span style="color:#007020;font-weight:700">do</span>
  user <span style="color:#4070a0">'jenkins'</span>
  action <span style="color:#517918">:deny</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="cron-d-resource">cron_d resource</h2> <a href="cron_d/index.html">cron_d resource page</a> <hr> <p>Use the <strong>cron_d</strong> resource to manage cron job files in the <code>/etc/cron.d</code> directory.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>Chef Infra Client also ships with the <strong>cron</strong> resource for managing the monolithic <code>/etc/crontab</code> file on platforms that lack cron.d support. See the <a href="cron/index.html">cron resource</a> for information on using that resource.</p> </div> </div> <p><strong>New in Chef Infra Client 14.4.</strong></p> <h3 id="syntax-cron-d">Syntax</h3> <hr> 
<p>A <strong>cron_d</strong> resource block manages cron.d files. For example, to get a weekly cookbook report from the Chef Supermarket:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron_d <span style="color:#4070a0">'cookbooks_report'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:create</span>
  minute <span style="color:#4070a0">'0'</span>
  hour <span style="color:#4070a0">'0'</span>
  weekday <span style="color:#4070a0">'1'</span>
  user <span style="color:#4070a0">'getchef'</span>
  mailto <span style="color:#4070a0">'sysadmin@example.com'</span>
  home <span style="color:#4070a0">'/srv/supermarket/shared/system'</span>
  command <span style="color:#c65d09">%W{
</span><span style="color:#c65d09">    cd /srv/supermarket/current &amp;&amp;
</span><span style="color:#c65d09">    env RUBYLIB="/srv/supermarket/current/lib"
</span><span style="color:#c65d09">    RAILS_ASSET_ID=`git rev-parse HEAD` RAILS_ENV="</span><span style="color:#70a0d0;font-style:italic">#{</span>rails_env<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">"
</span><span style="color:#c65d09">    bundle exec rake cookbooks_report
</span><span style="color:#c65d09">  }</span><span style="color:#666">.</span>join(<span style="color:#4070a0">' '</span>)
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>The full syntax for all of the properties that are available to the <strong>cron_d</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron_d <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  command               <span style="color:#007020">String</span>
  comment               <span style="color:#007020">String</span>
  cron_name             <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  day                   <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  environment           <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {}</span>
  home                  <span style="color:#007020">String</span>
  hour                  <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  mailto                <span style="color:#007020">String</span>
  minute                <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  mode                  <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: "0600"</span>
  month                 <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  path                  <span style="color:#007020">String</span>
  predefined_value      <span style="color:#007020">String</span>
  random_delay          <span style="color:#007020">Integer</span>
  shell                 <span style="color:#007020">String</span>
  time_out              <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {}</span>
  user                  <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "root"</span>
  weekday               <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>, <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  action                <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>cron_d</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>command</code>, <code>comment</code>, <code>cron_name</code>, <code>day</code>, <code>environment</code>, <code>home</code>, <code>hour</code>, <code>mailto</code>, <code>minute</code>, <code>mode</code>, <code>month</code>, <code>path</code>, <code>predefined_value</code>, <code>random_delay</code>, <code>shell</code>, <code>time_out</code>, <code>user</code>, and <code>weekday</code> are the properties available to this resource.</li> </ul> <h3 id="actions-cron-d">Actions</h3> <hr> <p>The <strong>cron_d</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>(default)</dd> <dt><code>:create_if_missing</code></dt> <dd>Add a cron definition file to <code>/etc/cron.d</code>, but do not update an existing file.</dd> <dt><code>:delete</code></dt> <dd>Remove a cron definition file from <code>/etc/cron.d</code> if it exists.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-cron-d">Properties</h3> <hr> <p>The <strong>cron_d</strong> resource has the following properties:</p> <dl> <dt> <code>command</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The command to be run, or the path to a file that contains the command to be run.</p> </dd> </dl> <dl> <dt> <code>comment</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A comment to place in the cron.d file.</p> </dd> </dl> <dl> <dt> <code>cron_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the cron name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>day</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>*</code> <p>The day of month at which the cron entry should run (<code>1 - 31</code>).</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> <p>A Hash containing additional arbitrary environment variables under which the cron job will be run in the form of <code>({'ENV_VARIABLE' =&gt; 'VALUE'})</code>. <strong>Note</strong>: These variables must exist for a command to be run successfully.</p> </dd> </dl> <dl> <dt> <code>home</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Set the <code>HOME</code> environment variable.</p> </dd> </dl> <dl> <dt> <code>hour</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>*</code> <p>The hour at which the cron entry is to run (<code>0 - 23</code>).</p> </dd> </dl> <dl> <dt> <code>mailto</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Set the <code>MAILTO</code> environment variable.</p> </dd> </dl> <dl> <dt> <code>minute</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>*</code> <p>The minute at which the cron entry should run (<code>0 - 59</code>).</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>0600</code> <p>The octal mode of the generated crontab file.</p> </dd> </dl> <dl> <dt> <code>month</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>*</code> <p>The month in the year on which a cron entry is to run (<code>1 - 12</code>, <code>jan-dec</code>, or <code>*</code>).</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Set the <code>PATH</code> environment variable.</p> </dd> </dl> <dl> <dt> <code>predefined_value</code> </dt> <dd> <strong>Ruby Type:</strong> String <strong>Allowed Values:</strong> <code>"@annually", "@daily", "@hourly", "@midnight", "@monthly", "@reboot", "@weekly", "@yearly"</code> <p>Schedule your cron job with one of the special predefined value instead of ** * pattern.</p> </dd> </dl> <dl> <dt> <code>random_delay</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>Set the <code>RANDOM_DELAY</code> environment variable in the cron.d file.</p> </dd> </dl> <dl> <dt> <code>shell</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Set the <code>SHELL</code> environment variable.</p> </dd> </dl> <dl> <dt> <code>time_out</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> 
<p>A Hash of timeouts in the form of <code>({'OPTION' =&gt; 'VALUE'})</code>. Accepted valid options are:</p> <ul> <li>
<code>preserve-status</code> (BOOL, default: ‘false’),</li> <li>
<code>foreground</code> (BOOL, default: ‘false’),</li> <li>
<code>kill-after</code> (in seconds),</li> <li>
<code>signal</code> (a name like ‘HUP’ or a number)</li> </ul> <p> New in Chef Infra Client 15.7 </p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>root</code> <p>The name of the user that runs the command.</p> </dd> </dl> <dl> <dt> <code>weekday</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String, Symbol | <strong>Default Value:</strong> <code>*</code> <p>The day of the week on which this entry is to run (<code>0-7</code>, <code>mon-sun</code>, <code>monday-sunday</code>, or <code>*</code>), where Sunday is both <code>0</code> and <code>7</code>.</p> </dd> </dl> <br> <h3 id="functionality-cron-d">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-cron-d">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-cron-d">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-cron-d">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-cron-d">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>cron_d</strong> resource in recipes:</p> <p><strong>Run a program on the fifth hour of the day</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron_d <span style="color:#4070a0">'noop'</span> <span style="color:#007020;font-weight:700">do</span>
  hour <span style="color:#4070a0">'5'</span>
  minute <span style="color:#4070a0">'0'</span>
  command <span style="color:#4070a0">'/bin/true'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run an entry if a folder exists</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron_d <span style="color:#4070a0">'ganglia_tomcat_thread_max'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">"/usr/bin/gmetric
</span><span style="color:#4070a0">    -n 'tomcat threads max'
</span><span style="color:#4070a0">    -t uint32
</span><span style="color:#4070a0">    -v '/usr/local/bin/tomcat-stat
</span><span style="color:#4070a0">    --thread-max'"</span>
  only_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(<span style="color:#4070a0">'/home/jboss'</span>) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run an entry every Saturday, 8:00 AM</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron_d <span style="color:#4070a0">'name_of_cron_entry'</span> <span style="color:#007020;font-weight:700">do</span>
  minute <span style="color:#4070a0">'0'</span>
  hour <span style="color:#4070a0">'8'</span>
  weekday <span style="color:#4070a0">'6'</span>
  mailto <span style="color:#4070a0">'admin@example.com'</span>
  command <span style="color:#4070a0">'/bin/true'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run an entry at 8:00 PM, every weekday (Monday through Friday), but only in November</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron_d <span style="color:#4070a0">'name_of_cron_entry'</span> <span style="color:#007020;font-weight:700">do</span>
  minute <span style="color:#4070a0">'0'</span>
  hour <span style="color:#4070a0">'20'</span>
  day <span style="color:#4070a0">'*'</span>
  month <span style="color:#4070a0">'11'</span>
  weekday <span style="color:#4070a0">'1-5'</span>
  command <span style="color:#4070a0">'/bin/true'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove a cron job by name</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cron_d <span style="color:#4070a0">'job_to_remove'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="csh-resource">csh resource</h2> <a href="csh/index.html">csh resource page</a> <hr> <p>Use the <strong>csh</strong> resource to execute scripts using the csh interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <code>not_if</code> and <code>only_if</code> to guard this resource for idempotence.</p> <h3 id="syntax-csh">Syntax</h3> <hr> 
<p>A <strong>csh</strong> resource block executes scripts using csh:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">csh <span style="color:#4070a0">'hello world'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    echo <span style="color:#4070a0">"Hello world!"</span>
    echo <span style="color:#4070a0">"Current directory: "</span> $cwd
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>code</code> specifies the command to run</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>csh</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">csh <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  code                       <span style="color:#007020">String</span>
  creates                    <span style="color:#007020">String</span>
  cwd                        <span style="color:#007020">String</span>
  environment                <span style="color:#60add5">Hash</span>
  flags                      <span style="color:#007020">String</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                       <span style="color:#007020">Array</span>
  returns                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span>
  timeout                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Float</span>
  user                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  umask                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>csh</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>code</code>, <code>creates</code>, <code>cwd</code>, <code>environment</code>, <code>flags</code>, <code>group</code>, <code>path</code>, <code>returns</code>, <code>timeout</code>, <code>user</code>, and <code>umask</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-csh">Actions</h3> <hr> <p>The <strong>csh</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>Prevent a command from running. This action is used to specify that a command is run only when another resource notifies it.</dd> <dt><code>:run</code></dt> <dd>Default. Run a script.</dd> </dl> <h3 id="properties-csh">Properties</h3> <hr> <p>The <strong>csh</strong> resource has the following properties:</p> <dl> <dt> <code>code</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>A quoted (" “) string of code to be executed.</p> </dd> </dl> <dl> <dt> <code>creates</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Prevent a command from creating a file when that file already exists.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The current working directory from which the command will be run.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of environment variables in the form of <code>({'ENV_VARIABLE' =&gt; 'VALUE'})</code>. <strong>Note</strong>: These variables must exist for a command to be run successfully.</p> </dd> </dl> <dl> <dt> <code>flags</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One or more command line flags that are passed to the interpreter when a command is invoked.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group name or group ID that must be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>returns</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Array | <strong>Default Value:</strong> <code>0</code> <p>The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Float | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) a command is to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The user name or user ID that should be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>umask</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The file mode creation mask, or umask.</p> </dd> </dl> <br> <h3 id="functionality-csh">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-csh">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-csh">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-csh">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-csh">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="directory-resource">directory resource</h2> <a href="directory/index.html">directory resource page</a> <hr> <p>Use the <strong>directory</strong> resource to manage a directory, which is a hierarchy of folders that comprises all of the information stored on a computer. The root directory is the top-level, under which the rest of the directory is organized. The directory resource uses the name property to specify the path to a location in a directory. Typically, permission to access that location in the directory is required.</p> <h3 id="syntax-directory">Syntax</h3> <hr> 
<p>A <strong>directory</strong> resource block declares a directory and the permissions needed on that directory. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'/etc/apache2'</span> <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>'/etc/apache2'</code> specifies the directory</li> <li>
<code>owner</code>, <code>group</code>, and <code>mode</code> define the permissions</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>directory</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  inherits                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  mode                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  owner                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                       <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># defaults to 'name' if not specified</span>
  recursive                  <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  rights                     <span style="color:#60add5">Hash</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>directory</code> is the resource.</li> <li>
<code>name</code> is the name of the resource block; when the <code>path</code> property is not specified, <code>name</code> is also the path to the directory, from the root</li> <li>
<code>action</code> identifies the steps Chef Infra Client will take to bring the node into the desired state</li> <li>
<code>group</code>, <code>inherits</code>, <code>mode</code>, <code>owner</code>, <code>path</code>, <code>recursive</code>, and <code>rights</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-directory">Actions</h3> <hr> <p>The <strong>directory</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Create a directory. If a directory already exists (but does not match), update that directory to match.</dd> <dt><code>:delete</code></dt> <dd>Delete a directory.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-directory">Properties</h3> <hr> <p>The <strong>directory</strong> resource has the following properties:</p> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>A string or ID that identifies the group owner by group name or SID, including fully qualified group names such as <code>domain\group</code> or <code>group@domain</code>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <code>POSIX</code> group (if available).</p> </dd> </dl> <dl> <dt> <code>inherits</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Microsoft Windows only. Whether a file inherits rights from its parent directory.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String 
<p>A quoted 3-5 character string that defines the octal mode. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If <code>mode</code> is not specified and if the directory already exists, the existing mode on the directory is used. If <code>mode</code> is not specified, the directory does not exist, and the <code>:create</code> action is specified, Chef Infra Client assumes a mask value of <code>'0777'</code>, and then applies the umask for the system on which the directory is to be created to the <code>mask</code> value. For example, if the umask on a system is <code>'022'</code>, Chef Infra Client uses the default value of <code>'0755'</code>.</p> <p>The behavior is different depending on the platform.</p> <p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If the value is specified as a quoted string, it works exactly as if the <code>chmod</code> command was passed. If the value is specified as an integer, prepend a zero (<code>0</code>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <code>'0777'</code> or <code>'777'</code>; for the same rights, plus the sticky bit, use <code>01777</code> or <code>'1777'</code>.</p> <p>Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. Values up to <code>'0777'</code> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <code>4</code> equals <code>GENERIC_READ</code>, <code>2</code> equals <code>GENERIC_WRITE</code>, and <code>1</code> equals <code>GENERIC_EXECUTE</code>. This property cannot be used to set <code>:full_control</code>. This property has no effect if not specified, but when it and <code>rights</code> are both specified, the effects are cumulative.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>A string or ID that identifies the group owner by user name or SID, including fully qualified user names such as <code>domain\user</code> or <code>user@domain</code>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The path to the directory. Using a fully qualified path is recommended, but is not always required. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <dl> <dt> <code>recursive</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Create or delete parent directories recursively. For the owner, group, and mode properties, the value of this property applies only to the leaf directory.</p> </dd> </dl> <dl> <dt> <code>rights</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <code>rights &lt;permissions&gt;, &lt;principal&gt;, &lt;options&gt;</code> where <code>&lt;permissions&gt;</code> specifies the rights granted to the principal, <code>&lt;principal&gt;</code> is the group or user name, and <code>&lt;options&gt;</code> is a Hash with one (or more) advanced rights options.</p> </dd> </dl> <h4 id="directory-recursive-directories-directory">Recursive Directories</h4> <p>The <strong>remote_directory</strong> resource can be used to recursively create the path outside of remote directory structures, but the permissions of those outside paths are not managed. This is because the <code>recursive</code> attribute only applies <code>group</code>, <code>mode</code>, and <code>owner</code> attribute values to the remote directory itself and any inner directories the resource copies.</p> <p>A directory structure:</p> <pre class="highlight" data-language="ruby"><code>/foo
  /bar
    /baz
</code></pre> <p>The following example shows a way create a file in the <code>/baz</code> directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_directory <span style="color:#4070a0">'/foo/bar/baz'</span> <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>But with this example, the <code>group</code>, <code>mode</code>, and <code>owner</code> attribute values will only be applied to <code>/baz</code>. Which is fine, if that’s what you want. But most of the time, when the entire <code>/foo/bar/baz</code> directory structure is not there, you must be explicit about each directory. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#c65d09">%w( /foo /foo/bar /foo/bar/baz )</span><span style="color:#666">.</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>path<span style="color:#666">|</span>
  remote_directory path <span style="color:#007020;font-weight:700">do</span>
    owner <span style="color:#4070a0">'root'</span>
    group <span style="color:#4070a0">'root'</span>
    mode <span style="color:#4070a0">'0755'</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This approach will create the correct hierarchy—<code>/foo</code>, then <code>/bar</code> in <code>/foo</code>, and then <code>/baz</code> in <code>/bar</code>—and also with the correct attribute values for <code>group</code>, <code>mode</code>, and <code>owner</code>.</p> <h4 id="common-windows-security-directory">Windows File Security</h4> To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes. <strong>Access Control Lists (ACLs)</strong> <p>The <code>rights</code> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <code>rights</code> property can be used as many times as necessary; Chef Infra Client will apply them to the file or directory as required. The syntax for the <code>rights</code> property is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights permission, principal, option_type <span style="color:#666">=&gt;</span> value
</code></pre></div>
<p>where</p> <dl> <dt><code>permission</code></dt> <dd> <p>Use to specify which rights are granted to the <code>principal</code>. The possible values are: <code>:read</code>, <code>:write</code>, <code>read_execute</code>, <code>:modify</code>, <code>:full_control</code>, or an integer.</p> </dd> <dd> <p>Integers used for permissions must match the following list <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.accesscontrol.filesystemrights?view=windowsdesktop-5.0#fields">FileSystemRights Enum</a> fields.</p> </dd> </dl> <pre class="highlight" data-language="ruby"><code>These permissions are cumulative. If `:write` is specified, then it
includes `:read`. If `:full_control` is specified, then it includes
both `:write` and `:read`.

(For those who know the Microsoft Windows API: `:read` corresponds
to `GENERIC_READ`; `:write` corresponds to `GENERIC_WRITE`;
`:read_execute` corresponds to `GENERIC_READ` and `GENERIC_EXECUTE`;
`:modify` corresponds to `GENERIC_WRITE`, `GENERIC_READ`,
`GENERIC_EXECUTE`, and `DELETE`; `:full_control` corresponds to
`GENERIC_ALL`, which allows a user to change the owner and other
metadata about a file.)
</code></pre> <dl> <dt><code>principal</code></dt> <dd> <p>Use to specify a group or user. The principal can be specified by either name or SID. When using name, this is identical to what is entered in the login box for Microsoft Windows, such as <code>user_name</code>, <code>domain\user_name</code>, or <code>user_name@fully_qualified_domain_name</code>. When using a SID, you may use either the standard string representation of a SID (S-R-I-S-S) or one of the <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/sid-strings">SDDL string constants</a>. Chef Infra Client does not need to know if a principal is a user or a group.</p> </dd> <dt><code>option_type</code></dt> <dd> <p>A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <code>rights :write, 'domain\group_name', :one_level_deep =&gt; true</code>. Possible option types:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Option Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>:applies_to_children</code></td> <td>Specify how permissions are applied to children. Possible values: <code>true</code> to inherit both child directories and files; <code>false</code> to not inherit any child directories or files; <code>:containers_only</code> to inherit only child directories (and not files); <code>:objects_only</code> to recursively inherit files (and not child directories).</td> </tr> <tr> <td><code>:applies_to_self</code></td> <td>Indicates whether a permission is applied to the parent directory. Possible values: <code>true</code> to apply to the parent directory or file and its children; <code>false</code> to not apply only to child directories and files.</td> </tr> <tr> <td><code>:one_level_deep</code></td> <td>Indicates the depth to which permissions will be applied. Possible values: <code>true</code> to apply only to the first level of children; <code>false</code> to apply to all children.</td> </tr> </tbody> </table> </dd> </dl> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'S-1-1-0'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Administrators Everyone)</span>
rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'Users'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'Sally'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#517918">:containers_only</span>, <span style="color:#517918">applies_to_self</span>: <span style="color:#007020">false</span>, <span style="color:#517918">one_level_deep</span>: <span style="color:#007020">true</span>
</code></pre></div>
<p>Some other important things to know when using the <code>rights</code> attribute:</p> <ul> <li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li> <li>If rights are not specified, nothing will be changed. Chef Infra Client does not clear out the rights on a file or directory if rights are not specified.</li> <li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li> </ul> <p>Use the <code>deny_rights</code> property to deny specific rights to specific users. The ordering is independent of using the <code>rights</code> property. For example, it doesn’t matter if rights are granted to everyone is placed before or after <code>deny_rights :read, ['Julian', 'Lewis']</code>, both Julian and Lewis will be unable to read the document. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'Everyone'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Julian Lewis)</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">deny_rights <span style="color:#517918">:full_control</span>, <span style="color:#666">[</span><span style="color:#4070a0">'Sally'</span><span style="color:#666">]</span>
</code></pre></div> <strong>Inheritance</strong> <p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <code>inherits</code> property can be used to specifically tell Chef Infra Client to apply (or not apply) inherited rights from its parent directory.</p> <p>For example, the following example specifies the rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  inherits <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># Sauron is the only person who should have any sort of access</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>If the <code>deny_rights</code> permission were to be used instead, something could slip through unless all users and groups were denied.</p> <p>Another example also shows how to specify rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'SHIRE\Frodo'</span> <span style="color:#60a0b0;font-style:italic"># Who put that there I didn't put that there</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>but then not use the <code>inherits</code> property to deny those rights on a child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span> <span style="color:#60a0b0;font-style:italic"># Oops, not specific enough</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Because the <code>inherits</code> property is not specified, Chef Infra Client will default it to <code>true</code>, which will ensure that security settings for existing files remain unchanged.</p> <br> <h3 id="functionality-directory">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-directory">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-directory">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-directory">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-directory">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>directory</strong> resource in recipes:</p> <p>Create a directory</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'/tmp/something'</span> <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create a directory in Microsoft Windows</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">"C:</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">tmp</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">something"</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">"DOMAIN</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">User"</span>
  inherits <span style="color:#007020">false</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\tmp\something'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'DOMAIN\User'</span>
  inherits <span style="color:#007020">false</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The difference between the two previous examples is the single- versus double-quoted strings, where if the double quotes are used, the backslash character (<code>\</code>) must be escaped using the Ruby escape character (which is a backslash).</p> </div> </div> <p>Create a directory recursively</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#c65d09">%w{dir1 dir2 dir3}</span><span style="color:#666">.</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>dir<span style="color:#666">|</span>
  directory <span style="color:#4070a0">"/tmp/mydirs/</span><span style="color:#70a0d0;font-style:italic">#{</span>dir<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#007020;font-weight:700">do</span>
    mode <span style="color:#4070a0">'0755'</span>
    owner <span style="color:#4070a0">'root'</span>
    group <span style="color:#4070a0">'root'</span>
    action <span style="color:#517918">:create</span>
    recursive <span style="color:#007020">true</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Delete a directory</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'/tmp/something'</span> <span style="color:#007020;font-weight:700">do</span>
  recursive <span style="color:#007020">true</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Set directory permissions using a variable</p> <p>The following example shows how read/write/execute permissions can be set using a variable named <code>user_home</code>, and then for owners and groups on any matching node:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">user_home <span style="color:#666">=</span> <span style="color:#4070a0">"/</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#517918">:matching_node</span><span style="color:#666">][</span><span style="color:#517918">:user</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>

directory user_home <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'node[:matching_node][:user]'</span>
  group <span style="color:#4070a0">'node[:matching_node][:group]'</span>
  mode <span style="color:#4070a0">'0755'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where <code>matching_node</code> represents a type of node. For example, if the <code>user_home</code> variable specified <code>{node[:nginx]...}</code>, a recipe might look similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">user_home <span style="color:#666">=</span> <span style="color:#4070a0">"/</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#517918">:nginx</span><span style="color:#666">][</span><span style="color:#517918">:user</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>

directory user_home <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'node[:nginx][:user]'</span>
  group <span style="color:#4070a0">'node[:nginx][:group]'</span>
  mode <span style="color:#4070a0">'0755'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Set directory permissions for a specific type of node</p> <p>The following example shows how permissions can be set for the <code>/certificates</code> directory on any node that is running Nginx. In this example, permissions are being set for the <code>owner</code> and <code>group</code> properties as <code>root</code>, and then read/write permissions are granted to the root.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#517918">:nginx</span><span style="color:#666">][</span><span style="color:#517918">:dir</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/shared/certificates"</span> <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  recursive <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Reload the configuration</p> <p>The following example shows how to reload the configuration of a chef-client using the <strong>remote_file</strong> resource to:</p> <ul> <li>using an if statement to check whether the plugins on a node are the latest versions</li> <li>identify the location from which Ohai plugins are stored</li> <li>using the <code>notifies</code> property and a <strong>ruby_block</strong> resource to trigger an update (if required) and to then reload the client.rb file.</li> </ul> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'node[:ohai][:plugin_path]'</span> <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'chef'</span>
  recursive <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>

ruby_block <span style="color:#4070a0">'reload_config'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">.</span>from_file(<span style="color:#4070a0">'/etc/chef/client.rb'</span>)
  <span style="color:#007020;font-weight:700">end</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#007020;font-weight:700">if</span> node<span style="color:#666">[</span><span style="color:#517918">:ohai</span><span style="color:#666">].</span>key?(<span style="color:#517918">:plugins</span>)
  node<span style="color:#666">[</span><span style="color:#517918">:ohai</span><span style="color:#666">][</span><span style="color:#517918">:plugins</span><span style="color:#666">].</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>plugin<span style="color:#666">|</span>
    remote_file node<span style="color:#666">[</span><span style="color:#517918">:ohai</span><span style="color:#666">][</span><span style="color:#517918">:plugin_path</span><span style="color:#666">]</span> <span style="color:#666">+</span><span style="color:#4070a0">"/</span><span style="color:#70a0d0;font-style:italic">#{</span>plugin<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#007020;font-weight:700">do</span>
      source plugin
      owner <span style="color:#4070a0">'chef'</span>
      notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'ruby_block[reload_config]'</span>, <span style="color:#517918">:immediately</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Manage dotfiles</p> <p>The following example shows using the <strong>directory</strong> and <strong>cookbook_file</strong> resources to manage dotfiles. The dotfiles are defined by a JSON data structure similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript"><span style="color:#4070a0">"files"</span><span style="color:#666">:</span> {
  <span style="color:#4070a0">".zshrc"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"mode"</span><span style="color:#666">:</span> <span style="color:#4070a0">'0755'</span>,
    <span style="color:#4070a0">"source"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dot-zshrc"</span>
    },
  <span style="color:#4070a0">".bashrc"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"mode"</span><span style="color:#666">:</span> <span style="color:#4070a0">'0755'</span>,
    <span style="color:#4070a0">"source"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dot-bashrc"</span>
     },
  <span style="color:#4070a0">".bash_profile"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"mode"</span><span style="color:#666">:</span> <span style="color:#4070a0">'0755'</span>,
    <span style="color:#4070a0">"source"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dot-bash_profile"</span>
    },
  }
</code></pre></div>
<p>and then the following resources manage the dotfiles:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">if</span> u<span style="color:#666">.</span>has_key?(<span style="color:#4070a0">'files'</span>)
  u<span style="color:#666">[</span><span style="color:#4070a0">'files'</span><span style="color:#666">].</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>filename, file_data<span style="color:#666">|</span>

  directory <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>home_dir<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">File</span><span style="color:#666">.</span>dirname(filename)<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#007020;font-weight:700">do</span>
    recursive <span style="color:#007020">true</span>
    mode <span style="color:#4070a0">'0755'</span>
  <span style="color:#007020;font-weight:700">end</span> <span style="color:#007020;font-weight:700">if</span> file_data<span style="color:#666">[</span><span style="color:#4070a0">'subdir'</span><span style="color:#666">]</span>

  cookbook_file <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>home_dir<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span>filename<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>u<span style="color:#666">[</span><span style="color:#4070a0">'id'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span>file_data<span style="color:#666">[</span><span style="color:#4070a0">'source'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
    owner <span style="color:#4070a0">'u['</span><span style="color:#007020">id</span><span style="color:#4070a0">']'</span>
    group <span style="color:#4070a0">'group_id'</span>
    mode <span style="color:#4070a0">'file_data['</span>mode<span style="color:#4070a0">']'</span>
    ignore_failure <span style="color:#007020">true</span>
    backup <span style="color:#40a070">0</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="dmg-package-resource">dmg_package resource</h2> <a href="dmg_package/index.html">dmg_package resource page</a> <hr> <p>Use the <strong>dmg_package</strong> resource to install a package from a .dmg file. The resource will retrieve the dmg file from a remote URL, mount it using macOS' <code>hdidutil</code>, copy the application (.app directory) to the specified destination (<code>/Applications</code>), and detach the image using <code>hdiutil</code>. The dmg file will be stored in the <code>Chef::Config[:file_cache_path]</code>.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-dmg-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>dmg_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dmg_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  accept_eula          <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  allow_untrusted      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  app                  <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  checksum             <span style="color:#007020">String</span>
  destination          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/Applications"</span>
  dmg_name             <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: The value passed for the application name.</span>
  dmg_passphrase       <span style="color:#007020">String</span>
  file                 <span style="color:#007020">String</span>
  headers              <span style="color:#60add5">Hash</span>
  owner                <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  package_id           <span style="color:#007020">String</span>
  source               <span style="color:#007020">String</span>
  type                 <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "app"</span>
  volumes_dir          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: The value passed for the application name.</span>
  action               <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>dmg_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>accept_eula</code>, <code>allow_untrusted</code>, <code>app</code>, <code>checksum</code>, <code>destination</code>, <code>dmg_name</code>, <code>dmg_passphrase</code>, <code>file</code>, <code>headers</code>, <code>owner</code>, <code>package_id</code>, <code>source</code>, <code>type</code>, and <code>volumes_dir</code> are the properties available to this resource.</li> </ul> <h3 id="actions-dmg-package">Actions</h3> <hr> <p>The <strong>dmg_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Installs the application. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-dmg-package">Properties</h3> <hr> <p>The <strong>dmg_package</strong> resource has the following properties:</p> <dl> <dt> <code>accept_eula</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Specify whether to accept the EULA. Certain dmg files require acceptance of EULA before mounting.</p> </dd> </dl> <dl> <dt> <code>allow_untrusted</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Allow installation of packages that do not have trusted certificates.</p> </dd> </dl> <dl> <dt> <code>app</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the application as it appears in the <code>/Volumes</code> directory if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>checksum</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The sha256 checksum of the <code>.dmg</code> file to download.</p> </dd> </dl> <dl> <dt> <code>destination</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/Applications</code> <p>The directory to copy the <code>.app</code> into.</p> </dd> </dl> <dl> <dt> <code>dmg_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The value passed for the application name.</code> <p>The name of the <code>.dmg</code> file if it differs from that of the app, or if the name has spaces.</p> </dd> </dl> <dl> <dt> <code>dmg_passphrase</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specify a passphrase to be used to decrypt the <code>.dmg</code> file during the mount process.</p> </dd> </dl> <dl> <dt> <code>file</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The absolute path to the <code>.dmg</code> file on the local system.</p> </dd> </dl> <dl> <dt> <code>headers</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>Allows custom HTTP headers (like cookies) to be set on the <code>remote_file</code> resource.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The user that should own the package installation.</p> </dd> </dl> <dl> <dt> <code>package_id</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The package ID that is registered with <code>pkgutil</code> when a <code>pkg</code> or <code>mpkg</code> is installed.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The remote URL that is used to download the <code>.dmg</code> file, if specified.</p> </dd> </dl> <dl> <dt> <code>type</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>app</code> <strong>Allowed Values:</strong> <code>"app", "mpkg", "pkg"</code> <p>The type of package.</p> </dd> </dl> <dl> <dt> <code>volumes_dir</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The value passed for the application name.</code> <p>The directory under <code>/Volumes</code> where the <code>dmg</code> is mounted if it differs from the name of the <code>.dmg</code> file.</p> </dd> </dl> <br> <h3 id="functionality-dmg-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-dmg-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-dmg-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-dmg-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-dmg-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>dmg_package</strong> resource in recipes:</p> <p><strong>Install Google Chrome via the DMG package</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dmg_package <span style="color:#4070a0">'Google Chrome'</span> <span style="color:#007020;font-weight:700">do</span>
  dmg_name <span style="color:#4070a0">'googlechrome'</span>
  source   <span style="color:#4070a0">'https://dl-ssl.google.com/chrome/mac/stable/GGRM/googlechrome.dmg'</span>
  checksum <span style="color:#4070a0">'7daa2dc5c46d9bfb14f1d7ff4b33884325e5e63e694810adc58f14795165c91a'</span>
  action   <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install VirtualBox from the .mpkg</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dmg_package <span style="color:#4070a0">'Virtualbox'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'http://dlc.sun.com.edgesuite.net/virtualbox/4.0.8/VirtualBox-4.0.8-71778-OSX.dmg'</span>
  type   <span style="color:#4070a0">'mpkg'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install pgAdmin and automatically accept the EULA</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dmg_package <span style="color:#4070a0">'pgAdmin3'</span> <span style="color:#007020;font-weight:700">do</span>
  source   <span style="color:#4070a0">'http://wwwmaster.postgresql.org/redir/198/h/pgadmin3/release/v1.12.3/osx/pgadmin3-1.12.3.dmg'</span>
  checksum <span style="color:#4070a0">'9435f79d5b52d0febeddfad392adf82db9df159196f496c1ab139a6957242ce9'</span>
  accept_eula <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="dnf-package-resource">dnf_package resource</h2> <a href="dnf_package/index.html">dnf_package resource page</a> <hr> <p>Use the <strong>dnf_package</strong> resource to install, upgrade, and remove packages with DNF for Fedora and RHEL 8+. The dnf_package resource is able to resolve provides data for packages much like DNF can do when it is run from the command line. This allows a variety of options for installing packages, like minimum versions, virtual provides and library names.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <p><strong>New in Chef Infra Client 12.18.</strong></p> <h3 id="syntax-dnf-package">Syntax</h3> <hr> 
<p>A <strong>dnf_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>dnf_package</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'package_name'</span>
</code></pre></div>
<p>which will install the named package using all of the default options and the default action (<code>:install</code>).</p> <p>The full syntax for all of the properties that are available to the <strong>dnf_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  allow_downgrade      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  arch                 <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  flush_cache          <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {"before"=&gt;false, "after"=&gt;false}</span>
  options              <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name         <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  source               <span style="color:#007020">String</span>
  timeout              <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version              <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action               <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>dnf_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>allow_downgrade</code>, <code>arch</code>, <code>flush_cache</code>, <code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-dnf-package">Actions</h3> <hr> <p>The <strong>dnf_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install a package. If a version is specified, install the specified version of the package. (default)</dd> <dt><code>:lock</code></dt> <dd>Locks the DNF package to a specific version.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:unlock</code></dt> <dd>Unlocks the DNF package so that it can be upgraded to a newer version.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-dnf-package">Properties</h3> <hr> <p>The <strong>dnf_package</strong> resource has the following properties:</p> <dl> <dt> <code>allow_downgrade</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Allow downgrading a package to satisfy requested version requirements.</p> </dd> </dl> <dl> <dt> <code>arch</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The architecture of the package to be installed or upgraded. This value can also be passed as part of the package name.</p> </dd> </dl> <dl> <dt> <code>flush_cache</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{"before"=&gt;false, "after"=&gt;false}</code> 
<p>Flush the in-memory cache before or after a DNF operation that installs, upgrades, or removes a package.</p> <p>DNF automatically synchronizes remote metadata to a local cache. Chef Infra Client creates a copy of the local cache, and then stores it in-memory during a Chef Infra Client run. The in-memory cache allows packages to be installed during a Chef Infra Client run without the need to continue synchronizing the remote metadata to the local cache while a Chef Infra Client run is in-progress.</p> <p>As an array:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'some-package'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic">#...</span>
  flush_cache <span style="color:#666">[</span> <span style="color:#517918">:before</span> <span style="color:#666">]</span>
  <span style="color:#60a0b0;font-style:italic">#...</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and as a Hash:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'some-package'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic">#...</span>
  flush_cache( { <span style="color:#517918">:after</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span> } )
  <span style="color:#60a0b0;font-style:italic">#...</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The <code>flush_cache</code> property does not flush the local DNF cache! Use dnf tools—<code>dnf clean metadata</code>, <code>dnf clean packages</code>, <code>dnf clean all</code>—to clean the local DNF cache.</p> </div> </div> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The version of a package to be installed or upgraded. This property is ignored when using the <code>:upgrade</code> action.</p> </dd> </dl> <h4 id="multiple-packages-properties-dnf-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <br> <h3 id="functionality-dnf-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-dnf-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-dnf-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-dnf-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h4 id="multiple-packages-common-dnf-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <h3 id="examples-dnf-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>dnf_package</strong> resource in recipes:</p> <p>Install an exact version</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'netpbm = 10.35.58-8.el5'</span>
</code></pre></div>
<p>Install a minimum version</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'netpbm &gt;= 10.35.58-8.el5'</span>
</code></pre></div>
<p>Install a minimum version using the default action</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'netpbm'</span>
</code></pre></div>
<p>To install a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'netpbm'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>To install a partial minimum version</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'netpbm &gt;= 10'</span>
</code></pre></div>
<p>To install a specific architecture</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'netpbm'</span> <span style="color:#007020;font-weight:700">do</span>
  arch <span style="color:#4070a0">'i386'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'netpbm.x86_64'</span>
</code></pre></div>
<p>To install a specific version-release</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'netpbm'</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#4070a0">'10.35.58-8.el5'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>To install a specific version (even when older than the current)</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dnf_package <span style="color:#4070a0">'tzdata'</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#4070a0">'2011b-1.el5'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Handle cookbook_file and dnf_package resources in the same recipe</p> <p>When a <strong>cookbook_file</strong> resource and a <strong>dnf_package</strong> resource are both called from within the same recipe, use the <code>flush_cache</code> attribute to dump the in-memory DNF cache, and then use the repository immediately to ensure that the correct package is installed:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'/etc/yum.repos.d/custom.repo'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'custom'</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>

dnf_package <span style="color:#4070a0">'only-in-custom-repo'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  flush_cache <span style="color:#666">[</span> <span style="color:#517918">:before</span> <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="dpkg-package-resource">dpkg_package resource</h2> <a href="dpkg_package/index.html">dpkg_package resource page</a> <hr> <p>Use the <strong>dpkg_package</strong> resource to manage packages for the dpkg platform. When a package is installed from a local file, it must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p> <h3 id="syntax-dpkg-package">Syntax</h3> <hr> 
<p>A <strong>dpkg_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>dpkg_package</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dpkg_package <span style="color:#4070a0">'package_name'</span>
</code></pre></div>
<p>which will install the named package using all of the default options and the default action (<code>:install</code>).</p> <p>The full syntax for all of the properties that are available to the <strong>dpkg_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dpkg_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  options                      <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name                 <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  response_file                <span style="color:#007020">String</span>
  response_file_variables      <span style="color:#60add5">Hash</span>
  source                       <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  timeout                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version                      <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action                       <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>dpkg_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>options</code>, <code>package_name</code>, <code>response_file</code>, <code>response_file_variables</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-dpkg-package">Actions</h3> <hr> <p>The <strong>dpkg_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install a package. If a version is specified, install the specified version of the package. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> </dl> <h3 id="properties-dpkg-package">Properties</h3> <hr> <p>The <strong>dpkg_package</strong> resource has the following properties:</p> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>response_file</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The direct path to the file used to pre-seed a package.</p> </dd> </dl> <dl> <dt> <code>response_file_variables</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> <p>A Hash of response file variables in the form of {‘VARIABLE’ =&gt; ‘VALUE’}.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The path to a package in the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <h4 id="multiple-packages-properties-dpkg-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <br> <h3 id="functionality-dpkg-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-dpkg-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-dpkg-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-dpkg-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h4 id="multiple-packages-common-dpkg-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <h3 id="examples-dpkg-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>dpkg_package</strong> resource in recipes:</p> <p>Install a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dpkg_package <span style="color:#4070a0">'wget_1.13.4-2ubuntu1.4_amd64.deb'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'/foo/bar/wget_1.13.4-2ubuntu1.4_amd64.deb'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="dsc-resource-resource">dsc_resource resource</h2> <a href="dsc_resource/index.html">dsc_resource resource page</a> <hr> <p> Windows PowerShell is a task-based command-line shell and scripting language developed by Microsoft. Windows PowerShell uses a document-oriented approach for managing Microsoft Windows-based machines, similar to the approach that is used for managing Unix and Linux-based machines. Windows PowerShell is <a href="https://docs.microsoft.com/en-us/powershell/scripting/powershell-scripting">a tool-agnostic platform</a> that supports using Chef for configuration management. </p> <p> Desired State Configuration (DSC) is a feature of Windows PowerShell that provides <a href="https://docs.microsoft.com/en-us/powershell/dsc/overview">a set of language extensions, cmdlets, and resources</a> that can be used to declaratively configure software. DSC is similar to Chef, in that both tools are idempotent, take similar approaches to the concept of resources, describe the configuration of a system, and then take the steps required to do that configuration. The most important difference between Chef and DSC is that Chef uses Ruby and DSC is exposed as configuration data from within Windows PowerShell. </p> <p>The <strong>dsc_resource</strong> resource allows any DSC resource to be used in a Chef recipe, as well as any custom resources that have been added to your Windows PowerShell environment. Microsoft <a href="https://github.com/powershell/DscResources">frequently adds new resources</a> to the DSC resource collection.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> 
<p>Using the <strong>dsc_resource</strong> has the following requirements:</p> <ul> <li> <p>Windows Management Framework (WMF) 5.0 (or higher)</p> </li> <li> <p>The <strong>dsc_resource</strong> resource can only use binary- or script-based resources. Composite DSC resources may not be used.</p> <p>This is because composite resources aren’t “real” resources from the perspective of the Local Configuration Manager (LCM). Composite resources are used by the “configuration” keyword from the <code>PSDesiredStateConfiguration</code> module, and then evaluated in that context. When using DSC to create the configuration document (the Managed Object Framework (MOF) file) from the configuration command, the composite resource is evaluated. Any individual resources from that composite resource are written into the Managed Object Framework (MOF) document. As far as the Local Configuration Manager (LCM) is concerned, there is no such thing as a composite resource. Unless that changes, the <strong>dsc_resource</strong> resource and/or <code>Invoke-DscResource</code> command cannot directly use them.</p> </li> </ul> </div> </div> <h3 id="syntax-dsc-resource">Syntax</h3> <hr> 
<p>A <strong>dsc_resource</strong> resource block allows DSC resources to be used in a Chef recipe. For example, the DSC <code>Archive</code> resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell">Archive ExampleArchive {
  Ensure = <span style="color:#4070a0">"Present"</span>
  Path = <span style="color:#4070a0">"C:\Users\Public\Documents\example.zip"</span>
  Destination = <span style="color:#4070a0">"C:\Users\Public\Documents\ExtractionPath"</span>
}
</code></pre></div>
<p>and then the same <strong>dsc_resource</strong> with Chef:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_resource <span style="color:#4070a0">'example'</span> <span style="color:#007020;font-weight:700">do</span>
   resource <span style="color:#517918">:archive</span>
   property <span style="color:#517918">:ensure</span>, <span style="color:#4070a0">'Present'</span>
   property <span style="color:#517918">:path</span>, <span style="color:#4070a0">"C:\Users\Public\Documents</span><span style="color:#4070a0;font-weight:700">\e</span><span style="color:#4070a0">xample.zip"</span>
   property <span style="color:#517918">:destination</span>, <span style="color:#4070a0">"C:\Users\Public\Documents\ExtractionPath"</span>
 <span style="color:#007020;font-weight:700">end</span><span style="color:#4070a0">```</span></code></pre></div> <p>The full syntax for all of the properties that are available to the <strong>dsc_resource</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_resource <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  module_name                <span style="color:#007020">String</span>
  module_version             <span style="color:#007020">String</span>
  property                   <span style="color:#60add5">Symbol</span>
  reboot_action              <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :nothing</span>
  resource                   <span style="color:#60add5">Symbol</span>
  timeout                    <span style="color:#007020">Integer</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>dsc_resource</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>property</code> is zero (or more) properties in the DSC resource, where each property is entered on a separate line, <code>:dsc_property_name</code> is the case-insensitive name of that property, and <code>"property_value"</code> is a Ruby value to be applied by Chef Infra Client</li> <li>
<code>module_name</code>, <code>module_version</code>, <code>property</code>, <code>reboot_action</code>, <code>resource</code>, and <code>timeout</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-dsc-resource">Actions</h3> <hr> <p>The <strong>dsc_resource</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:run</code></dt> <dd>Default. Use to run the DSC configuration defined as defined in this resource.</dd> </dl> <h3 id="properties-dsc-resource">Properties</h3> <hr> <p>The <strong>dsc_resource</strong> resource has the following properties:</p> <dl> <dt> <code>module_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of the module from which a DSC resource originates. If this property is not specified, it will be inferred.</p> </dd> </dl> <dl> <dt> <code>module_version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version number of the module to use. PowerShell 5.0.10018.0 (or higher) supports having multiple versions of a module installed. This should be specified along with the <code>module_name</code>.</p> <p> New in Chef Client 12.21 </p> </dd> </dl> <dl> <dt> <code>property</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol 
<p>A property from a Desired State Configuration (DSC) resource. Use this property multiple times, one for each property in the Desired State Configuration (DSC) resource. The format for this property must follow <code>property :dsc_property_name, "property_value"</code> for each DSC property added to the resource block.</p> <p>The <code>:dsc_property_name</code> must be a symbol.</p> <p>Use the following Ruby types to define <code>property_value</code>:</p> <table> <col style="width:50%"> <col style="width:50%"> <thead> <tr class="header"> <th>Ruby</th> <th>Windows PowerShell</th> </tr> </thead> <tbody> <tr> <td><code>Array</code></td> <td><code>Object[]</code></td> </tr> <tr> <td><code>Chef::Util::Powershell:PSCredential</code></td> <td><code>PSCredential</code></td> </tr> <tr> <td><code>False</code></td> <td><code>bool($false)</code></td> </tr> <tr> <td><code>Fixnum</code></td> <td><code>Integer</code></td> </tr> <tr> <td><code>Float</code></td> <td><code>Double</code></td> </tr> <tr> <td><code>Hash</code></td> <td><code>Hashtable</code></td> </tr> <tr> <td><code>True</code></td> <td><code>bool($true)</code></td> </tr> </tbody> </table> <p>These are converted into the corresponding Windows PowerShell type during a Chef Infra Client run.</p> </dd> </dl> <dl> <dt> <code>reboot_action</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:nothing</code> <strong>Allowed Values:</strong> <code>:nothing, :reboot_now, :request_reboot</code> <p>Use to request an immediate reboot or to queue a reboot using the :reboot_now (immediate reboot) or :request_reboot (queued reboot) actions built into the reboot resource.</p> <p> New in Chef Client 12.6 </p> </dd> </dl> <dl> <dt> <code>resource</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol 
<p>The name of the DSC resource. This value is case-insensitive and must be a symbol that matches the name of the DSC resource.</p> <p>For built-in DSC resources, use the following values:</p> <table> <col style="width:50%"> <col style="width:50%"> <thead> <tr class="header"> <th>Value</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>:archive</code></td> <td>Use to <a href="https://docs.microsoft.com/en-us/powershell/dsc/reference/resources/windows/archiveresource">unpack archive (.zip) files</a>.</td> </tr> <tr> <td><code>:environment</code></td> <td>Use to <a href="https://docs.microsoft.com/en-us/powershell/dsc/reference/resources/windows/environmentresource">manage system environment variables</a>.</td> </tr> <tr> <td><code>:file</code></td> <td>Use to <a href="https://docs.microsoft.com/en-us/powershell/dsc/reference/resources/windows/fileresource">manage files and directories</a>.</td> </tr> <tr> <td><code>:group</code></td> <td>Use to <a href="https://docs.microsoft.com/en-us/powershell/dsc/reference/resources/windows/groupresource">manage local groups</a>.</td> </tr> <tr> <td><code>:log</code></td> <td>Use to <a href="https://docs.microsoft.com/en-us/powershell/dsc/reference/resources/windows/logresource">log configuration messages</a>.</td> </tr> <tr> <td><code>:package</code></td> <td>Use to <a href="https://docs.microsoft.com/en-us/powershell/dsc/reference/resources/windows/packageresource">install and manage packages</a>.</td> </tr> <tr> <td><code>:registry</code></td> <td>Use to <a href="https://docs.microsoft.com/en-us/powershell/dsc/reference/resources/windows/registryresource">manage registry keys and registry key values</a>.</td> </tr> <tr> <td><code>:script</code></td> <td>Use to <a href="https://docs.microsoft.com/en-us/powershell/dsc/reference/resources/windows/scriptresource">run PowerShell script blocks</a>.</td> </tr> <tr> <td><code>:service</code></td> <td>Use to <a href="https://docs.microsoft.com/en-us/powershell/dsc/reference/resources/windows/serviceresource">manage services</a>.</td> </tr> <tr> <td><code>:user</code></td> <td>Use to <a href="https://docs.microsoft.com/en-us/powershell/dsc/reference/resources/windows/userresource">manage local user accounts</a>.</td> </tr> <tr> <td><code>:windowsfeature</code></td> <td>Use to <a href="https://docs.microsoft.com/en-us/powershell/dsc/reference/resources/windows/windowsfeatureresource">add or remove Windows features and roles</a>.</td> </tr> <tr> <td><code>:windowsoptionalfeature</code></td> <td>Use to configure Microsoft Windows optional features.</td> </tr> <tr> <td><code>:windowsprocess</code></td> <td>Use to <a href="https://docs.microsoft.com/en-us/powershell/dsc/reference/resources/windows/windowsprocessresource">configure Windows processes</a>.</td> </tr> </tbody> </table> <p>Any DSC resource may be used in a Chef recipe. For example, the DSC Resource Kit contains resources for <a href="http://www.powershellgallery.com/packages/xActiveDirectory/2.8.0.0">configuring Active Directory components</a>, such as <code>xADDomain</code>, <code>xADDomainController</code>, and <code>xADUser</code>. Assuming that these resources are available to Chef Infra Client, the corresponding values for the <code>resource</code> attribute would be: <code>:xADDomain</code>, <code>:xADDomainController</code>, and <code>xADUser</code>.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The amount of time (in seconds) a command is to wait before timing out.</p> </dd> </dl> <br> <h3 id="functionality-dsc-resource">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-dsc-resource">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-dsc-resource">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-dsc-resource">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-dsc-resource">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>dsc_resource</strong> resource in recipes:</p> <p>Open a Zip file</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_resource <span style="color:#4070a0">'example'</span> <span style="color:#007020;font-weight:700">do</span>
   resource <span style="color:#517918">:archive</span>
   property <span style="color:#517918">:ensure</span>, <span style="color:#4070a0">'Present'</span>
   property <span style="color:#517918">:path</span>, <span style="color:#4070a0">'C:\Users\Public\Documents\example.zip'</span>
   property <span style="color:#517918">:destination</span>, <span style="color:#4070a0">'C:\Users\Public\Documents\ExtractionPath'</span>
 <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Manage users and groups</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_resource <span style="color:#4070a0">'demogroupadd'</span> <span style="color:#007020;font-weight:700">do</span>
  resource <span style="color:#517918">:group</span>
  property <span style="color:#517918">:groupname</span>, <span style="color:#4070a0">'demo1'</span>
  property <span style="color:#517918">:ensure</span>, <span style="color:#4070a0">'present'</span>
<span style="color:#007020;font-weight:700">end</span>

dsc_resource <span style="color:#4070a0">'useradd'</span> <span style="color:#007020;font-weight:700">do</span>
  resource <span style="color:#517918">:user</span>
  property <span style="color:#517918">:username</span>, <span style="color:#4070a0">'Foobar1'</span>
  property <span style="color:#517918">:fullname</span>, <span style="color:#4070a0">'Foobar1'</span>
  property <span style="color:#517918">:password</span>, ps_credential(<span style="color:#4070a0">'P@assword!'</span>)
  property <span style="color:#517918">:ensure</span>, <span style="color:#4070a0">'present'</span>
<span style="color:#007020;font-weight:700">end</span>

dsc_resource <span style="color:#4070a0">'AddFoobar1ToUsers'</span> <span style="color:#007020;font-weight:700">do</span>
  resource <span style="color:#517918">:Group</span>
  property <span style="color:#517918">:GroupName</span>, <span style="color:#4070a0">'demo1'</span>
  property <span style="color:#517918">:MembersToInclude</span>, <span style="color:#666">[</span><span style="color:#4070a0">'Foobar1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create and register a windows service</p> <p>The following example creates a windows service, defines it’s execution path, and prevents windows from starting the service in case the executable is not at the defined location:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_resource <span style="color:#4070a0">'NAME'</span> <span style="color:#007020;font-weight:700">do</span>
  resource <span style="color:#517918">:service</span>
  property <span style="color:#517918">:name</span>, <span style="color:#4070a0">'NAME'</span>
  property <span style="color:#517918">:startuptype</span>, <span style="color:#4070a0">'Disabled'</span>
  property <span style="color:#517918">:path</span>, <span style="color:#4070a0">'D:\\Sites\\Site_name\file_to_run.exe'</span>
  property <span style="color:#517918">:ensure</span>, <span style="color:#4070a0">'Present'</span>
  property <span style="color:#517918">:state</span>, <span style="color:#4070a0">'Stopped'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create a test message queue</p> <p>The following example creates a file on a node (based on one that is located in a cookbook), unpacks the <code>MessageQueue.zip</code> Windows PowerShell module, and then uses the <strong>dsc_resource</strong> to ensure that Message Queuing (MSMQ) sub-features are installed, a test queue is created, and that permissions are set on the test queue:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'cMessageQueue.zip'</span> <span style="color:#007020;font-weight:700">do</span>
  path <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">MessageQueue.zip"</span>
  action <span style="color:#517918">:create_if_missing</span>
<span style="color:#007020;font-weight:700">end</span>

windows_zipfile <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">ENV</span><span style="color:#666">[</span><span style="color:#4070a0">'PROGRAMW6432'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">WindowsPowerShell</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Modules"</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">MessageQueue.zip"</span>
  action <span style="color:#517918">:unzip</span>
<span style="color:#007020;font-weight:700">end</span>

dsc_resource <span style="color:#4070a0">'install-sub-features'</span> <span style="color:#007020;font-weight:700">do</span>
  resource <span style="color:#517918">:windowsfeature</span>
  property <span style="color:#517918">:ensure</span>, <span style="color:#4070a0">'Present'</span>
  property <span style="color:#517918">:name</span>, <span style="color:#4070a0">'msmq'</span>
  property <span style="color:#517918">:IncludeAllSubFeature</span>, <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>

dsc_resource <span style="color:#4070a0">'create-test-queue'</span> <span style="color:#007020;font-weight:700">do</span>
  resource <span style="color:#517918">:cPrivateMsmqQueue</span>
  property <span style="color:#517918">:ensure</span>, <span style="color:#4070a0">'Present'</span>
  property <span style="color:#517918">:name</span>, <span style="color:#4070a0">'Test_Queue'</span>
<span style="color:#007020;font-weight:700">end</span>

dsc_resource <span style="color:#4070a0">'set-permissions'</span> <span style="color:#007020;font-weight:700">do</span>
  resource <span style="color:#517918">:cPrivateMsmqQueuePermissions</span>
  property <span style="color:#517918">:ensure</span>, <span style="color:#4070a0">'Present'</span>
  property <span style="color:#517918">:name</span>, <span style="color:#4070a0">'Test_Queue_Permissions'</span>
  property <span style="color:#517918">:QueueNames</span>, <span style="color:#4070a0">'Test_Queue'</span>
  property <span style="color:#517918">:ReadUsers</span>, node<span style="color:#666">[</span><span style="color:#4070a0">'msmq'</span><span style="color:#666">][</span><span style="color:#4070a0">'read_user'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Example to show usage of module properties</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_resource <span style="color:#4070a0">'test-cluster'</span> <span style="color:#007020;font-weight:700">do</span>
  resource <span style="color:#517918">:xCluster</span>
  module_name <span style="color:#4070a0">'xFailOverCluster'</span>
  module_version <span style="color:#4070a0">'1.6.0.0'</span>
  property <span style="color:#517918">:name</span>, <span style="color:#4070a0">'TestCluster'</span>
  property <span style="color:#517918">:staticipaddress</span>, <span style="color:#4070a0">'10.0.0.3'</span>
  property <span style="color:#517918">:domainadministratorcredential</span>, ps_credential(<span style="color:#4070a0">'abcd'</span>)
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="dsc-script-resource">dsc_script resource</h2> <a href="dsc_script/index.html">dsc_script resource page</a> <hr> <p> Windows PowerShell is a task-based command-line shell and scripting language developed by Microsoft. Windows PowerShell uses a document-oriented approach for managing Microsoft Windows-based machines, similar to the approach that is used for managing Unix and Linux-based machines. Windows PowerShell is <a href="https://docs.microsoft.com/en-us/powershell/scripting/powershell-scripting">a tool-agnostic platform</a> that supports using Chef for configuration management. </p> <p> Desired State Configuration (DSC) is a feature of Windows PowerShell that provides <a href="https://docs.microsoft.com/en-us/powershell/dsc/overview">a set of language extensions, cmdlets, and resources</a> that can be used to declaratively configure software. DSC is similar to Chef, in that both tools are idempotent, take similar approaches to the concept of resources, describe the configuration of a system, and then take the steps required to do that configuration. The most important difference between Chef and DSC is that Chef uses Ruby and DSC is exposed as configuration data from within Windows PowerShell. </p> <p>Many DSC resources are comparable to built-in Chef Infra resources. For example, both DSC and Chef have <strong>file</strong>, <strong>package</strong>, and <strong>service</strong> resources. The <strong>dsc_script</strong> resource is most useful for those DSC resources that do not have a direct comparison to a resource in Chef, such as the <code>Archive</code> resource, a custom DSC resource, an existing DSC script that performs an important task, and so on. Use the <strong>dsc_script</strong> resource to embed the code that defines a DSC configuration directly within a Chef Infra recipe.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Windows PowerShell 4.0 is required for using the <strong>dsc_script</strong> resource with Chef Infra.</p> </div> </div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The WinRM service must be enabled. (Use <code>winrm quickconfig</code> to enable the service.)</p> </div> </div> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>The <strong>dsc_script</strong> resource may not be used in the same run-list with the <strong>dsc_resource</strong>. This is because the <strong>dsc_script</strong> resource requires that <code>RefreshMode</code> in the Local Configuration Manager be set to <code>Push</code>, whereas the <strong>dsc_resource</strong> resource requires it to be set to <code>Disabled</code>.</p> </div> </div> <h3 id="syntax-dsc-script">Syntax</h3> <hr> 
<p>A <strong>dsc_script</strong> resource block embeds the code that defines a DSC configuration directly within a Chef recipe:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_script <span style="color:#4070a0">'get-dsc-resource-kit'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span style="color:#60add5">Archive</span> reskit
    {
      <span style="color:#007020;font-weight:700">ensure</span> <span style="color:#666">=</span> <span style="color:#4070a0">'Present'</span>
      path <span style="color:#666">=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">DSCResourceKit620082014.zip"</span>
      destination <span style="color:#666">=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">ENV</span><span style="color:#666">[</span><span style="color:#4070a0">'PROGRAMW6432'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">WindowsPowerShell</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Modules"</span>
    }
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>the <strong>remote_file</strong> resource is first used to download the <code>DSCResourceKit620082014.zip</code> file.</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>dsc_script</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_script <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  code                       <span style="color:#007020">String</span>
  command                    <span style="color:#007020">String</span>
  configuration_data         <span style="color:#007020">String</span>
  configuration_data_script  <span style="color:#007020">String</span>
  configuration_name         <span style="color:#007020">String</span>
  cwd                        <span style="color:#007020">String</span>
  environment                <span style="color:#60add5">Hash</span>
  flags                      <span style="color:#60add5">Hash</span>
  imports                    <span style="color:#007020">Array</span>
  timeout                    <span style="color:#007020">Integer</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>dsc_script</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>code</code>, <code>command</code>, <code>configuration_data</code>, <code>configuration_data_script</code>, <code>configuration_name</code>, <code>cwd</code>, <code>environment</code>, <code>flags</code>, <code>imports</code>, and <code>timeout</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-dsc-script">Actions</h3> <hr> <p>The <strong>dsc_script</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:run</code></dt> <dd>Default. Use to run the DSC configuration defined as defined in this resource.</dd> </dl> <h3 id="properties-dsc-script">Properties</h3> <hr> <p>The <strong>dsc_script</strong> resource has the following properties:</p> <dl> <dt> <code>code</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The code for the DSC configuration script. This property may not be used in conjunction with the <code>command</code> property.</p> </dd> </dl> <dl> <dt> <code>command</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to a valid Windows PowerShell data file that contains the DSC configuration script. This data file must be capable of running independently of Chef and must generate a valid DSC configuration. This property may not be used in conjunction with the <code>code</code> property.</p> </dd> </dl> <dl> <dt> <code>configuration_data</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The configuration data for the DSC script. The configuration data must be <a href="https://docs.microsoft.com/en-us/powershell/">a valid Windows PowerShell data file</a>. This property may not be used in conjunction with the <code>configuration_data_script</code> property.</p> </dd> </dl> <dl> <dt> <code>configuration_data_script</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to a valid Windows PowerShell data file that also contains a node called <code>localhost</code>. This property may not be used in conjunction with the <code>configuration_data</code> property.</p> </dd> </dl> <dl> <dt> <code>configuration_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of a valid Windows PowerShell cmdlet. The name may only contain letter (a-z, A-Z), number (0-9), and underscore (_) characters and should start with a letter. The name may not be null or empty. This property may not be used in conjunction with the <code>code</code> property.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The current working directory.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of environment variables in the form of ({‘ENV_VARIABLE’ =&gt; ‘VALUE’}). (These variables must exist for a command to be run successfully).</p> </dd> </dl> <dl> <dt> <code>flags</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>Pass parameters to the DSC script that is specified by the <code>command</code> property. Parameters are defined as key-value pairs, where the value of each key is the parameter to pass. This property may not be used in the same recipe as the <code>code</code> property. For example: <code>flags ({ :EditorChoice =&gt; 'emacs', :EditorFlags =&gt; '--maximized' })</code>.</p> </dd> </dl> <dl> <dt> <code>imports</code> </dt> <dd> <strong>Ruby Type:</strong> Array <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>This property <strong>MUST</strong> be used with the <code>code</code> attribute.</p> </div> </div> 
<p>Use to import DSC resources from a module.</p> <p>To import all resources from a module, specify only the module name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">imports <span style="color:#4070a0">'module_name'</span>
</code></pre></div>
<p>To import specific resources, specify the module name, and then specify the name for each resource in that module to import:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">imports <span style="color:#4070a0">'module_name'</span>, <span style="color:#4070a0">'resource_name_a'</span>, <span style="color:#4070a0">'resource_name_b'</span>, <span style="color:#666">...</span>
</code></pre></div>
<p>For example, to import all resources from a module named <code>cRDPEnabled</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">imports <span style="color:#4070a0">'cRDPEnabled'</span>
</code></pre></div>
<p>To import only the <code>PSHOrg_cRDPEnabled</code> resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">imports <span style="color:#4070a0">'cRDPEnabled'</span>, <span style="color:#4070a0">'PSHOrg_cRDPEnabled'</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The amount of time (in seconds) a command is to wait before timing out.</p> </dd> </dl> <h4 id="ps-credential-helper-dsc-script">ps_credential Helper</h4> <p>Use the <code>ps_credential</code> helper to embed a <code>PSCredential</code> object— <a href="https://technet.microsoft.com/en-us/magazine/ff714574.aspx">a set of security credentials, such as a user name or password</a> —within a script, which allows that script to be run using security credentials.</p> <p>For example, assuming the <code>CertificateID</code> is configured in the local configuration manager, the <code>SeaPower1@3</code> object is created and embedded within the <code>seapower-user</code> script:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_script <span style="color:#4070a0">'seapower-user'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span style="color:#60add5">User</span> <span style="color:#60add5">AlbertAtom</span>
    {
      <span style="color:#60add5">UserName</span> <span style="color:#666">=</span> <span style="color:#4070a0">'AlbertAtom'</span>
      <span style="color:#60add5">Password</span> <span style="color:#666">=</span> <span style="color:#60a0b0;font-style:italic">#{ps_credential('SeaPower1@3')}</span>
    }
  <span style="color:#60add5">EOH</span>
  configuration_data <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span>@</span>{
      <span style="color:#60add5">AllNodes</span> <span style="color:#666">=</span> <span>@</span>(
        <span>@</span>{
          <span style="color:#60add5">NodeName</span> <span style="color:#666">=</span> <span style="color:#4070a0">"localhost"</span>;
          <span style="color:#60add5">CertificateID</span> <span style="color:#666">=</span> <span style="color:#4070a0">'A8D1234559F349F7EF19104678908F701D4167'</span>
        }
      )
    }
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <br> <h3 id="functionality-dsc-script">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-dsc-script">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-dsc-script">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-dsc-script">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-dsc-script">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>dsc_script</strong> resource in recipes:</p> <p>Specify DSC code directly</p> <p>DSC data can be specified directly in a recipe:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_script <span style="color:#4070a0">'emacs'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>  <span style="color:#60add5">Environment</span> <span style="color:#4070a0">'texteditor'</span>
  {
    <span style="color:#60add5">Name</span> <span style="color:#666">=</span> <span style="color:#4070a0">'EDITOR'</span>
    <span style="color:#60add5">Value</span> <span style="color:#666">=</span> <span style="color:#4070a0">'c:\\emacs\\bin\\emacs.exe'</span>
  }
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Specify DSC code using a Windows PowerShell data file</p> <p>Use the <code>command</code> property to specify the path to a Windows PowerShell data file. For example, the following Windows PowerShell script defines the <code>DefaultEditor</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell">Configuration <span style="color:#4070a0">'DefaultEditor'</span>
{
  Environment <span style="color:#4070a0">'texteditor'</span>
    {
      Name = <span style="color:#4070a0">'EDITOR'</span>
      Value = <span style="color:#4070a0">'c:\emacs\bin\emacs.exe'</span>
    }
}
</code></pre></div>
<p>Use the following recipe to specify the location of that data file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_script <span style="color:#4070a0">'DefaultEditor'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'c:\dsc_scripts\emacs.ps1'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Pass parameters to DSC configurations</p> <p>If a DSC script contains configuration data that takes parameters, those parameters may be passed using the <code>flags</code> property. For example, the following Windows PowerShell script takes parameters for the <code>EditorChoice</code> and <code>EditorFlags</code> settings:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell"><span style="color:#bb60d5">$choices</span> = @{<span style="color:#4070a0">'emacs'</span> = <span style="color:#4070a0">'c:\emacs\bin\emacs'</span>;<span style="color:#4070a0">'vi'</span> = <span style="color:#4070a0">'c:\vim\vim.exe'</span>;<span style="color:#4070a0">'powershell'</span> = <span style="color:#4070a0">'powershell_ise.exe'</span>}
  Configuration <span style="color:#4070a0">'DefaultEditor'</span>
    {
      [<span style="color:#007020;font-weight:700">CmdletBinding</span>()]
      <span style="color:#007020;font-weight:700">param</span>
        (
          <span style="color:#bb60d5">$EditorChoice</span>,
          <span style="color:#bb60d5">$EditorFlags</span> = <span style="color:#4070a0">''</span>
        )
      Environment <span style="color:#4070a0">'TextEditor'</span>
      {
        Name = <span style="color:#4070a0">'EDITOR'</span>
        Value =  <span style="color:#4070a0">"</span>$(<span style="color:#bb60d5">$choices</span>[<span style="color:#bb60d5">$EditorChoice</span>])<span style="color:#4070a0"> $EditorFlags"</span>
      }
    }
</code></pre></div>
<p>Use the following recipe to set those parameters:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_script <span style="color:#4070a0">'DefaultEditor'</span> <span style="color:#007020;font-weight:700">do</span>
  flags ({ <span style="color:#517918">:EditorChoice</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'emacs'</span>, <span style="color:#517918">:EditorFlags</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'--maximized'</span> })
  command <span style="color:#4070a0">'c:\dsc_scripts\editors.ps1'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use custom configuration data</p> <p>Configuration data in DSC scripts may be customized from a recipe. For example, scripts are typically customized to set the behavior for Windows PowerShell credential data types. Configuration data may be specified in one of three ways:</p> <ul> <li>By using the <code>configuration_data</code> attribute</li> <li>By using the <code>configuration_data_script</code> attribute</li> <li>By specifying the path to a valid Windows PowerShell data file</li> </ul> <p>The following example shows how to specify custom configuration data using the <code>configuration_data</code> property:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_script <span style="color:#4070a0">'BackupUser'</span> <span style="color:#007020;font-weight:700">do</span>
  configuration_data <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span>@</span>{
     <span style="color:#60add5">AllNodes</span> <span style="color:#666">=</span> <span>@</span>(
          <span>@</span>{
          <span style="color:#60add5">NodeName</span> <span style="color:#666">=</span> <span style="color:#4070a0">"localhost"</span>;
          <span style="color:#60add5">PSDscAllowPlainTextPassword</span> <span style="color:#666">=</span> $true
          })
     }
  <span style="color:#60add5">EOH</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    $user <span style="color:#666">=</span> <span style="color:#4070a0">'backup'</span>
    $password <span style="color:#666">=</span> <span style="color:#60add5">ConvertTo</span><span style="color:#666">-</span><span style="color:#60add5">SecureString</span> <span style="color:#666">-</span><span style="color:#007020">String</span> <span style="color:#4070a0">"YourPass$(random)"</span> <span style="color:#666">-</span><span style="color:#60add5">AsPlainText</span> <span style="color:#666">-</span><span style="color:#60add5">Force</span>
    $cred <span style="color:#666">=</span> <span style="color:#60add5">New</span><span style="color:#666">-</span><span style="color:#60add5">Object</span> <span style="color:#666">-</span><span style="color:#60add5">TypeName</span> <span style="color:#60add5">System</span><span style="color:#666">.</span>Management<span style="color:#666">.</span>Automation<span style="color:#666">.</span>PSCredential <span style="color:#666">-</span><span style="color:#60add5">ArgumentList</span> $user, $password

   <span style="color:#60add5">User</span> $user
     {
       <span style="color:#60add5">UserName</span> <span style="color:#666">=</span> $user
       <span style="color:#60add5">Password</span> <span style="color:#666">=</span> $cred
       <span style="color:#60add5">Description</span> <span style="color:#666">=</span> <span style="color:#4070a0">'Backup operator'</span>
       <span style="color:#60add5">Ensure</span> <span style="color:#666">=</span> <span style="color:#4070a0">"Present"</span>
       <span style="color:#60add5">Disabled</span> <span style="color:#666">=</span> $false
       <span style="color:#60add5">PasswordNeverExpires</span> <span style="color:#666">=</span> $true
       <span style="color:#60add5">PasswordChangeRequired</span> <span style="color:#666">=</span> $false
     }
   <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The following example shows how to specify custom configuration data using the <code>configuration_name</code> property. For example, the following Windows PowerShell script defines the <code>vi</code> configuration:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell">Configuration <span style="color:#4070a0">'emacs'</span>
  {
    Environment <span style="color:#4070a0">'TextEditor'</span>
    {
      Name = <span style="color:#4070a0">'EDITOR'</span>
      Value = <span style="color:#4070a0">'c:\emacs\bin\emacs.exe'</span>
    }
}

Configuration <span style="color:#4070a0">'vi'</span>
{
    Environment <span style="color:#4070a0">'TextEditor'</span>
    {
      Name = <span style="color:#4070a0">'EDITOR'</span>
      Value = <span style="color:#4070a0">'c:\vim\bin\vim.exe'</span>
    }
}
</code></pre></div>
<p>Use the following recipe to specify that configuration:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">dsc_script <span style="color:#4070a0">'EDITOR'</span> <span style="color:#007020;font-weight:700">do</span>
  configuration_name <span style="color:#4070a0">'vi'</span>
  command <span style="color:#4070a0">'C:\dsc_scripts\editors.ps1'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Using DSC with other Chef resources</p> <p>The <strong>dsc_script</strong> resource can be used with other resources. The following example shows how to download a file using the <strong>remote_file</strong> resource, and then uncompress it using the DSC <code>Archive</code> resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">DSCResourceKit620082014.zip"</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'http://gallery.technet.microsoft.com/DSC-Resource-Kit-All-c449312d/file/124481/1/DSC%20Resource%20Kit%20Wave%206%2008282014.zip'</span>
<span style="color:#007020;font-weight:700">end</span>

dsc_script <span style="color:#4070a0">'get-dsc-resource-kit'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span style="color:#60add5">Archive</span> reskit
    {
      <span style="color:#007020;font-weight:700">ensure</span> <span style="color:#666">=</span> <span style="color:#4070a0">'Present'</span>
      path <span style="color:#666">=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">DSCResourceKit620082014.zip"</span>
      destination <span style="color:#666">=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">ENV</span><span style="color:#666">[</span><span style="color:#4070a0">'PROGRAMW6432'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">WindowsPowerShell</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Modules"</span>
    }
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="execute-resource">execute resource</h2> <a href="execute/index.html">execute resource page</a> <hr> <p>Use the <strong>execute</strong> resource to execute a single command. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <code>not_if</code> and <code>only_if</code> to guard this resource for idempotence.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Use the <strong>script</strong> resource to execute a script using a specific interpreter (Ruby, Python, Perl, csh, or Bash).</p> </div> </div> <h3 id="syntax-execute">Syntax</h3> <hr> 
<p>An <strong>execute</strong> resource block typically executes a single command that is unique to the environment in which a recipe will run. Some <strong>execute</strong> resource commands are run by themselves, but often they are run in combination with other Chef resources. For example, a single command that is run by itself:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'apache_configtest'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'/usr/sbin/apachectl configtest'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>The full syntax for all of the properties that are available to the <strong>execute</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  command          <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  creates          <span style="color:#007020">String</span>
  cwd              <span style="color:#007020">String</span>
  default_env      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  domain           <span style="color:#007020">String</span>
  elevated         <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  environment      <span style="color:#60add5">Hash</span>
  group            <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  input            <span style="color:#007020">String</span>
  live_stream      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  login            <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  password         <span style="color:#007020">String</span>
  returns          <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: 0</span>
  timeout          <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>, <span style="color:#007020">Float</span> <span style="color:#60a0b0;font-style:italic"># default value: 3600</span>
  user             <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>execute</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>command</code>, <code>creates</code>, <code>cwd</code>, <code>default_env</code>, <code>domain</code>, <code>elevated</code>, <code>environment</code>, <code>group</code>, <code>input</code>, <code>live_stream</code>, <code>login</code>, <code>password</code>, <code>returns</code>, <code>timeout</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h3 id="actions-execute">Actions</h3> <hr> <p>The <strong>execute</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:run</code></dt> <dd>Run a command. (default)</dd> </dl> <h3 id="properties-execute">Properties</h3> <hr> <p>The <strong>execute</strong> resource has the following properties:</p> <dl> <dt> <code>command</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the command to be executed if it differs from the resource block’s name.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Use the <strong>execute</strong> resource to run a single command. Use multiple <strong>execute</strong> resource blocks to run multiple commands.</p> </div> </div> </dd> </dl> <dl> <dt> <code>creates</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Prevent a command from creating a file when that file already exists.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The current working directory from which the command will be run.</p> </dd> </dl> <dl> <dt> <code>default_env</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>When true this enables ENV magic to add path_sanity to the PATH and force the locale to English+UTF-8 for parsing output</p> <p> New in Chef Client 14.2 </p> </dd> </dl> <dl> <dt> <code>domain</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Windows only: The domain of the user specified by the user property. If not specified, the username and password specified by the <code>user</code> and <code>password</code> properties will be used to resolve that user against the domain in which the system running Chef Infra Client is joined, or if that system is not joined to a domain it will resolve the user as a local account on that system. An alternative way to specify the domain is to leave this property unspecified and specify the domain as part of the user property.</p> <p> New in Chef Client 12.21 </p> </dd> </dl> <dl> <dt> <code>elevated</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Determines whether the script will run with elevated permissions to circumvent User Access Control (UAC) from interactively blocking the process. This will cause the process to be run under a batch login instead of an interactive login. The user running chef-client needs the ‘Replace a process level token’ and ‘Adjust Memory Quotas for a process’ permissions. The user that is running the command needs the ‘Log on as a batch job’ permission. Because this requires a login, the user and password properties are required.</p> <p> New in Chef Client 13.3 </p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of environment variables in the form of <code>({'ENV_VARIABLE' =&gt; 'VALUE'})</code>. <strong>Note</strong>: These variables must exist for a command to be run successfully.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group name or group ID that must be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>input</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the input sent to the command as STDIN.</p> <p> New in Chef Infra Client 16.2 </p> </dd> </dl> <dl> <dt> <code>live_stream</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Send the output of the command run by this execute resource block to the Chef Infra Client event stream.</p> </dd> </dl> <dl> <dt> <code>login</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Use a login shell to run the commands instead of inheriting the existing execution environment.</p> <p> New in Chef Infra Client 17.0 </p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Windows only: The password of the user specified by the user property. This property is mandatory if user is specified on Windows and may only be specified if user is specified. The sensitive property for this resource will automatically be set to true if password is specified.</p> <p> New in Chef Client 12.21 </p> </dd> </dl> <dl> <dt> <code>returns</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Array | <strong>Default Value:</strong> <code>0</code> <p>The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String, Float | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) a command is to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The user name of the user identity with which to launch the new process. The user name may optionally be specified with a domain, i.e. <code>domain\user</code> or <code>user@my.dns.domain.com</code> via Universal Principal Name (UPN)format. It can also be specified without a domain simply as user if the domain is instead specified using the domain property. On Windows only, if this property is specified, the password property must be specified.</p> </dd> </dl> <br> <h3 id="functionality-execute">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-execute">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-execute">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-execute">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-execute">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>execute</strong> resource in recipes:</p> <p><strong>Run a command upon notification</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'slapadd'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'slapadd &lt; /tmp/something.ldif'</span>
  creates <span style="color:#4070a0">'/var/lib/slapd/uid.bdb'</span>

  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

template <span style="color:#4070a0">'/tmp/something.ldif'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'something.ldif'</span>

  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[slapadd]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run a touch file only once while running a command</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'upgrade script'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'php upgrade-application.php &amp;&amp; touch /var/application/.upgraded'</span>

  creates <span style="color:#4070a0">'/var/application/.upgraded'</span>
  action <span style="color:#517918">:run</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run a command which requires an environment variable</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'slapadd'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'slapadd &lt; /tmp/something.ldif'</span>
  creates <span style="color:#4070a0">'/var/lib/slapd/uid.bdb'</span>

  action <span style="color:#517918">:run</span>
  environment ({<span style="color:#4070a0">'HOME'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/home/my_home'</span>})
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Delete a repository using yum to scrub the cache</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># the following code sample thanks to gaffneyc @ https://gist.github.com/918711</span>
execute <span style="color:#4070a0">'clean-yum-cache'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'yum clean all'</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

file <span style="color:#4070a0">'/etc/yum.repos.d/bad.repo'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[clean-yum-cache]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Prevent restart and reconfigure if configuration is broken</strong>:</p> <p>Use the <code>:nothing</code> action (common to all resources) to prevent the test from starting automatically, and then use the <code>subscribes</code> notification to run a configuration test when a change to the template is detected.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'test-nagios-config'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'nagios3 --verify-config'</span>
  action <span style="color:#517918">:nothing</span>
  subscribes <span style="color:#517918">:run</span>, <span style="color:#4070a0">'template[/etc/nagios3/configures-nagios.conf]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Notify in a specific order</strong>:</p> <p>To notify multiple resources, and then have these resources run in a certain order, do something like the following.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'foo'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'...'</span>
  notifies <span style="color:#517918">:create</span>, <span style="color:#4070a0">'template[baz]'</span>, <span style="color:#517918">:immediately</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[bar]'</span>, <span style="color:#517918">:immediately</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[final]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>

template <span style="color:#4070a0">'baz'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic">#...</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[restart_baz]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>

package <span style="color:#4070a0">'bar'</span>
  execute <span style="color:#4070a0">'restart_baz'</span>
  execute <span style="color:#4070a0">'final'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'...'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the sequencing will be in the same order as the resources are listed in the recipe: <code>execute 'foo'</code>, <code>template 'baz'</code>, <code>execute [restart_baz]</code>, <code>package 'bar'</code>, and <code>execute 'final'</code>.</p> <p><strong>Execute a command using a template</strong>:</p> <p>The following example shows how to set up IPv4 packet forwarding using the <strong>execute</strong> resource to run a command named <code>forward_ipv4</code> that uses a template defined by the <strong>template</strong> resource.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'forward_ipv4'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'echo &gt; /proc/.../ipv4/ip_forward'</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

template <span style="color:#4070a0">'/etc/file_name.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'routing/file_name.conf.erb'</span>

 notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[forward_ipv4]'</span>, <span style="color:#517918">:delayed</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the <code>command</code> property for the <strong>execute</strong> resource contains the command that is to be run and the <code>source</code> property for the <strong>template</strong> resource specifies which template to use. The <code>notifies</code> property for the <strong>template</strong> specifies that the <code>execute[forward_ipv4]</code> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of a Chef Infra Client run.</p> <p><strong>Add a rule to an IP table</strong>:</p> <p>The following example shows how to add a rule named <code>test_rule</code> to an IP table using the <strong>execute</strong> resource to run a command using a template that is defined by the <strong>template</strong> resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'test_rule'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">"command_to_run
</span><span style="color:#4070a0">    --option value
</span><span style="color:#4070a0">    --option value
</span><span style="color:#4070a0">    --source </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#517918">:name_of_node</span><span style="color:#666">][</span><span style="color:#517918">:ipsec</span><span style="color:#666">][</span><span style="color:#517918">:local</span><span style="color:#666">][</span><span style="color:#517918">:subnet</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">    -j test_rule"</span>

  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

template <span style="color:#4070a0">'/etc/file_name.local'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'routing/file_name.local.erb'</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[test_rule]'</span>, <span style="color:#517918">:delayed</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the <code>command</code> property for the <strong>execute</strong> resource contains the command that is to be run and the <code>source</code> property for the <strong>template</strong> resource specifies which template to use. The <code>notifies</code> property for the <strong>template</strong> specifies that the <code>execute[test_rule]</code> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of a Chef Infra Client run.</p> <p><strong>Stop a service, do stuff, and then restart it</strong>:</p> <p>The following example shows how to use the <strong>execute</strong>, <strong>service</strong>, and <strong>mount</strong> resources together to ensure that a node running on Amazon EC2 is running MySQL. This example does the following:</p> <ul> <li>Checks to see if the Amazon EC2 node has MySQL</li> <li>If the node has MySQL, stops MySQL</li> <li>Installs MySQL</li> <li>Mounts the node</li> <li>Restarts MySQL</li> </ul> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># the following code sample comes from the ``server_ec2``</span>
<span style="color:#60a0b0;font-style:italic"># recipe in the following cookbook:</span>
<span style="color:#60a0b0;font-style:italic"># https://github.com/chef-cookbooks/mysql</span>

<span style="color:#007020;font-weight:700">if</span> (node<span style="color:#666">.</span>attribute?(<span style="color:#4070a0">'ec2'</span>) <span style="color:#666">&amp;&amp;</span> <span style="color:#666">!</span><span style="color:#60add5">FileTest</span><span style="color:#666">.</span>directory?(node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span>))
  service <span style="color:#4070a0">'mysql'</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:stop</span>
  <span style="color:#007020;font-weight:700">end</span>

  execute <span style="color:#4070a0">'install-mysql'</span> <span style="color:#007020;font-weight:700">do</span>
    command <span style="color:#4070a0">"mv </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'data_dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
    not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>directory?(node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span>) }
  <span style="color:#007020;font-weight:700">end</span>

  <span style="color:#666">[</span>node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span>, node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'data_dir'</span><span style="color:#666">]].</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>dir<span style="color:#666">|</span>
    directory dir <span style="color:#007020;font-weight:700">do</span>
      owner <span style="color:#4070a0">'mysql'</span>
      group <span style="color:#4070a0">'mysql'</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>

  mount node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'data_dir'</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:700">do</span>
    device node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span>
    fstype <span style="color:#4070a0">'none'</span>
    options <span style="color:#4070a0">'bind,rw'</span>
    action <span style="color:#666">[</span><span style="color:#517918">:mount</span>, <span style="color:#517918">:enable</span><span style="color:#666">]</span>
  <span style="color:#007020;font-weight:700">end</span>

  service <span style="color:#4070a0">'mysql'</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:start</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where</p> <ul> <li>the two <strong>service</strong> resources are used to stop, and then restart the MySQL service</li> <li>the <strong>execute</strong> resource is used to install MySQL</li> <li>the <strong>mount</strong> resource is used to mount the node and enable MySQL</li> </ul> <p><strong>Use the platform_family? method</strong>:</p> <p>The following is an example of using the <code>platform_family?</code> method in the Recipe DSL to create a variable that can be used with other resources in the same recipe. In this example, <code>platform_family?</code> is being used to ensure that a specific binary is used for a specific platform before using the <strong>remote_file</strong> resource to download a file from a remote location, and then using the <strong>execute</strong> resource to install that file by running a command.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">if</span> platform_family?(<span style="color:#4070a0">'rhel'</span>)
  pip_binary <span style="color:#666">=</span> <span style="color:#4070a0">'/usr/bin/pip'</span>
<span style="color:#007020;font-weight:700">else</span>
  pip_binary <span style="color:#666">=</span> <span style="color:#4070a0">'/usr/local/bin/pip'</span>
<span style="color:#007020;font-weight:700">end</span>

remote_file <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/distribute_setup.py"</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'http://python-distribute.org/distribute_setup.py'</span>
  mode <span style="color:#4070a0">'0755'</span>
  not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(pip_binary) }
<span style="color:#007020;font-weight:700">end</span>

execute <span style="color:#4070a0">'install-pip'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
  command <span style="color:#666">&lt;&lt;~</span><span style="color:#60add5">EOF</span>
    <span style="color:#60a0b0;font-style:italic"># command for installing Python goes here</span>
  <span style="color:#60add5">EOF</span>
  not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(pip_binary) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where a command for installing Python might look something like:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic">#{node['python']['binary']} distribute_setup.py #{::File.dirname(pip_binary)}/easy_install pip</span>
</code></pre></div>
<p><strong>Control a service using the execute resource</strong>:</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> This is an example of something that should NOT be done. Use the **service** resource to control a service, not the **execute** resource. </div> </div> <p>Do something like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'tomcat'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:start</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and NOT something like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'start-tomcat'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'/etc/init.d/tomcat start'</span>
  action <span style="color:#517918">:run</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>There is no reason to use the <strong>execute</strong> resource to control a service because the <strong>service</strong> resource exposes the <code>start_command</code> property directly, which gives a recipe full control over the command issued in a much cleaner, more direct manner.</p> <p><strong>Use the search Infra Language helper to find users</strong>:</p> <p>The following example shows how to use the <code>search</code> method in the Chef Infra Language to search for users:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic">#  the following code sample comes from the openvpn cookbook:</span>

search(<span style="color:#4070a0">"users"</span>, <span style="color:#4070a0">"*:*"</span>) <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>u<span style="color:#666">|</span>
  execute <span style="color:#4070a0">"generate-openvpn-</span><span style="color:#70a0d0;font-style:italic">#{</span>u<span style="color:#666">[</span><span style="color:#4070a0">'id'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#007020;font-weight:700">do</span>
    command <span style="color:#4070a0">"./pkitool </span><span style="color:#70a0d0;font-style:italic">#{</span>u<span style="color:#666">[</span><span style="color:#4070a0">'id'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
    cwd <span style="color:#4070a0">'/etc/openvpn/easy-rsa'</span>
  <span style="color:#007020;font-weight:700">end</span>

  <span style="color:#c65d09">%w{ conf ovpn }</span><span style="color:#666">.</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>ext<span style="color:#666">|</span>
    template <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'openvpn'</span><span style="color:#666">][</span><span style="color:#4070a0">'key_dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span>u<span style="color:#666">[</span><span style="color:#4070a0">'id'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.</span><span style="color:#70a0d0;font-style:italic">#{</span>ext<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#007020;font-weight:700">do</span>
      source <span style="color:#4070a0">'client.conf.erb'</span>
      variables <span style="color:#517918">:username</span> <span style="color:#666">=&gt;</span> u<span style="color:#666">[</span><span style="color:#4070a0">'id'</span><span style="color:#666">]</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where</p> <ul> <li>the search data will be used to create <strong>execute</strong> resources</li> <li>the <strong>template</strong> resource tells Chef Infra Client which template to use</li> </ul> <p><strong>Enable remote login for macOS</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'enable ssh'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'/usr/sbin/systemsetup -setremotelogin on'</span>
  not_if <span style="color:#4070a0">'/usr/sbin/systemsetup -getremotelogin | /usr/bin/grep On'</span>
  action <span style="color:#517918">:run</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Execute code immediately, based on the template resource</strong>:</p> <p>By default, notifications are <code>:delayed</code>, that is they are queued up as they are triggered, and then executed at the very end of a Chef Infra Client run. To run an action immediately, use <code>:immediately</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/nagios3/configures-nagios.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic"># other parameters</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[test-nagios-config]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then Chef Infra Client would immediately run the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'test-nagios-config'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'nagios3 --verify-config'</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Sourcing a file</strong>:</p> <p>The <strong>execute</strong> resource cannot be used to source a file (e.g. <code>command 'source filename'</code>). The following example will fail because <code>source</code> is not an executable:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'foo'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'source /tmp/foo.sh'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Instead, use the <strong>script</strong> resource or one of the <strong>script</strong>-based resources (<strong>bash</strong>, <strong>csh</strong>, <strong>perl</strong>, <strong>python</strong>, or <strong>ruby</strong>). For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'foo'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">'source /tmp/foo.sh'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run a Knife command</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'create_user'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#666">&lt;&lt;~</span><span style="color:#60add5">EOM</span>
    knife user create <span style="color:#60a0b0;font-style:italic">#{user}</span>
      <span style="color:#666">--</span>admin
      <span style="color:#666">--</span>password password
      <span style="color:#666">--</span>disable<span style="color:#666">-</span>editing
      <span style="color:#666">--</span>file <span style="color:#235388">/home/</span>vagrant<span style="color:#666">/.</span>chef<span style="color:#666">/</span>user<span style="color:#666">.</span>pem
      <span style="color:#666">--</span>config <span style="color:#235388">/tmp/</span>knife<span style="color:#666">-</span>admin<span style="color:#666">.</span>rb
    <span style="color:#60add5">EOM</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run install command into virtual environment</strong>:</p> <p>The following example shows how to install a lightweight JavaScript framework into Vagrant:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">"install q and zombiejs"</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#4070a0">"/home/vagrant"</span>
  user <span style="color:#4070a0">"vagrant"</span>
  environment ({<span style="color:#4070a0">'HOME'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/home/vagrant'</span>, <span style="color:#4070a0">'USER'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'vagrant'</span>})
  command <span style="color:#4070a0">"npm install -g q zombie should mocha coffee-script"</span>
  action <span style="color:#517918">:run</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run a command as a named user</strong>:</p> <p>The following example shows how to run <code>bundle install</code> from a Chef Infra Client run as a specific user. This will put the gem into the path of the user (<code>vagrant</code>) instead of the root user (under which the Chef Infra Client runs):</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'/opt/chefdk/embedded/bin/bundle install'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd node<span style="color:#666">[</span><span style="color:#4070a0">'chef_workstation'</span><span style="color:#666">][</span><span style="color:#4070a0">'bundler_path'</span><span style="color:#666">]</span>
  user node<span style="color:#666">[</span><span style="color:#4070a0">'chef_workstation'</span><span style="color:#666">][</span><span style="color:#4070a0">'user'</span><span style="color:#666">]</span>

  environment ({
    <span style="color:#4070a0">'HOME'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"/home/</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_workstation'</span><span style="color:#666">][</span><span style="color:#4070a0">'user'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>,
    <span style="color:#4070a0">'USER'</span> <span style="color:#666">=&gt;</span> node<span style="color:#666">[</span><span style="color:#4070a0">'chef_workstation'</span><span style="color:#666">][</span><span style="color:#4070a0">'user'</span><span style="color:#666">]</span>
  })
  not_if <span style="color:#4070a0">'bundle check'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run a command as an alternate user</strong>:</p> <p><em>Note</em>: When Chef is running as a service, this feature requires that the user that Chef runs as has ‘SeAssignPrimaryTokenPrivilege’ (aka ‘SE_ASSIGNPRIMARYTOKEN_NAME’) user right. By default only LocalSystem and NetworkService have this right when running as a service. This is necessary even if the user is an Administrator.</p> <p>This right can be added and checked in a recipe using this example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># Add 'SeAssignPrimaryTokenPrivilege' for the user</span>
<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">ReservedNames</span><span style="color:#666">::</span><span style="color:#60add5">Win32</span><span style="color:#666">::</span><span style="color:#60add5">Security</span><span style="color:#666">.</span>add_account_right(<span style="color:#4070a0">'&lt;user&gt;'</span>, <span style="color:#4070a0">'SeAssignPrimaryTokenPrivilege'</span>)

<span style="color:#60a0b0;font-style:italic"># Check if the user has 'SeAssignPrimaryTokenPrivilege' rights</span>
<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">ReservedNames</span><span style="color:#666">::</span><span style="color:#60add5">Win32</span><span style="color:#666">::</span><span style="color:#60add5">Security</span><span style="color:#666">.</span>get_account_right(<span style="color:#4070a0">'&lt;user&gt;'</span>)<span style="color:#666">.</span>include?(<span style="color:#4070a0">'SeAssignPrimaryTokenPrivilege'</span>)
</code></pre></div>
<p>The following example shows how to run <code>mkdir test_dir</code> from a Chef Infra Client run as an alternate user.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># Passing only username and password</span>
execute <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>

  user <span style="color:#4070a0">"username"</span>
  password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Passing username and domain</span>
execute <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>

  domain <span style="color:#4070a0">"domain-name"</span>
  user <span style="color:#4070a0">"user"</span>
  password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Passing username = 'domain-name\username'. No domain is passed</span>
execute <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>

  user <span style="color:#4070a0">"domain-name\username"</span>
  password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Passing username = 'username@domain-name'.  No domain is passed</span>
execute <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>

  user <span style="color:#4070a0">"username@domain-name"</span>
  password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run a command with an external input file</strong>:</p> <p>execute ‘md5sum’ do input File.read(<strong>FILE</strong>) end</p> <h2 id="file-resource">file resource</h2> <a href="file/index.html">file resource page</a> <hr> <p>Use the <strong>file</strong> resource to manage files directly on a node.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Use the <strong>cookbook_file</strong> resource to copy a file from a cookbook’s <code>/files</code> directory. Use the <strong>template</strong> resource to create a file based on a template in a cookbook’s <code>/templates</code> directory. And use the <strong>remote_file</strong> resource to transfer a file to a node from a remote location.</p> </div> </div> <h3 id="syntax-file">Syntax</h3> <hr> 
<p>A <strong>file</strong> resource block manages files that exist on nodes. For example, to write the home page for an Apache website:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/var/www/customers/public_html/index.php'</span> <span style="color:#007020;font-weight:700">do</span>
  content <span style="color:#4070a0">'&lt;html&gt;This is a placeholder for the home page.&lt;/html&gt;'</span>
  mode <span style="color:#4070a0">'0755'</span>
  owner <span style="color:#4070a0">'web_admin'</span>
  group <span style="color:#4070a0">'web_admin'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>'/var/www/customers/public_html/index.php'</code> is path to the file and also the filename to be managed</li> <li>
<code>content</code> defines the contents of the file</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>file</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  atomic_update              <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  backup                     <span style="color:#007020">false</span>, <span style="color:#007020">Integer</span>
  checksum                   <span style="color:#007020">String</span>
  content                    <span style="color:#007020">String</span>
  force_unlink               <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  inherits                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  manage_symlink_source      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  mode                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  owner                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                       <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># defaults to 'name' if not specified</span>
  rights                     <span style="color:#60add5">Hash</span>
  verify                     <span style="color:#007020">String</span>, <span style="color:#60add5">Block</span>, <span style="color:#60add5">Symbol</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>file</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>atomic_update</code>, <code>backup</code>, <code>checksum</code>, <code>content</code>, <code>force_unlink</code>, <code>group</code>, <code>inherits</code>, <code>manage_symlink_source</code>, <code>mode</code>, <code>owner</code>, <code>path</code>, <code>rights</code>, <code>sensitive</code>, and <code>verify</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-file">Actions</h3> <hr> <p>The <strong>file</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Create a file. If a file already exists (but does not match), update that file to match.</dd> <dt><code>:create_if_missing</code></dt> <dd>Create a file only if the file does not exist. When the file exists, nothing happens.</dd> <dt><code>:delete</code></dt> <dd>Delete a file.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:touch</code></dt> <dd>Touch a file. This updates the access (atime) and file modification (mtime) times for a file.</dd> </dl> <h3 id="properties-file">Properties</h3> <hr> <p>The <strong>file</strong> resource has the following properties:</p> <dl> <dt> <code>atomic_update</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>False if modifying /etc/hosts, /etc/hostname, or /etc/resolv.conf within Docker containers. Otherwise default to the client.rb 'file_atomic_update' config value.</code> <p>Perform atomic file updates on a per-resource basis. Set to true for atomic file updates. Set to false for non-atomic file updates. This setting overrides <code>file_atomic_update</code>, which is a global setting found in the <code>client.rb</code> file.</p> </dd> </dl> <dl> <dt> <code>backup</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, false | <strong>Default Value:</strong> <code>5</code> <p>The number of backups to be kept in <code>/var/chef/backup</code> (for UNIX- and Linux-based platforms) or <code>C:/chef/backup</code> (for the Microsoft Windows platform). Set to <code>false</code> to prevent backups from being kept.</p> </dd> </dl> <dl> <dt> <code>checksum</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The SHA-256 checksum of the file. Use to ensure that a specific file is used. If the checksum does not match, the file is not used.</p> </dd> </dl> <dl> <dt> <code>content</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A string that is written to the file. The contents of this property replace any previous content when this property has something other than the default value. The default behavior will not modify content.</p> </dd> </dl> <dl> <dt> <code>force_unlink</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>How Chef Infra Client handles certain situations when the target file turns out not to be a file. For example, when a target file is actually a symlink. Set to <code>true</code> for Chef Infra Client to delete the non-file target and replace it with the specified file. Set to <code>false</code> for Chef Infra Client to raise an error.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>A string or ID that identifies the group owner by group name or SID, including fully qualified group names such as <code>domain\group</code> or <code>group@domain</code>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <code>POSIX</code> group (if available).</p> </dd> </dl> <dl> <dt> <code>inherits</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Microsoft Windows only. Whether a file inherits rights from its parent directory.</p> </dd> </dl> <dl> <dt> <code>manage_symlink_source</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> 
<p>(with warning)</p> <p>Change the behavior of the file resource if it is pointed at a symlink. When this value is set to <code>false</code>, Chef Infra Client will manage the symlink’s permissions or will replace the symlink with a normal file if the resource has content. When this value is set to <code>true</code>, Chef will follow the symlink and will manage the permissions and content of symlink’s target file.</p> <p>The default behavior is <code>true</code> but emits a warning that the default value will be changed to <code>false</code> in a future version; setting this explicitly to <code>true</code> or <code>false</code> suppresses this warning.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String 
<p>A quoted 3-5 character string that defines the octal mode. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If <code>mode</code> is not specified and if the file already exists, the existing mode on the file is used. If <code>mode</code> is not specified, the file does not exist, and the <code>:create</code> action is specified, Chef Infra Client assumes a mask value of <code>'0777'</code> and then applies the umask for the system on which the file is to be created to the <code>mask</code> value. For example, if the umask on a system is <code>'022'</code>, Chef Infra Client uses the default value of <code>'0755'</code>.</p> <p>The behavior is different depending on the platform.</p> <p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If the value is specified as a quoted string, it works exactly as if the <code>chmod</code> command was passed. If the value is specified as an integer, prepend a zero (<code>0</code>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <code>'0777'</code> or <code>'777'</code>; for the same rights, plus the sticky bit, use <code>01777</code> or <code>'1777'</code>.</p> <p>Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. Values up to <code>'0777'</code> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <code>4</code> equals <code>GENERIC_READ</code>, <code>2</code> equals <code>GENERIC_WRITE</code>, and <code>1</code> equals <code>GENERIC_EXECUTE</code>. This property cannot be used to set <code>:full_control</code>. This property has no effect if not specified, but when it and <code>rights</code> are both specified, the effects are cumulative.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>A string or ID that identifies the group owner by user name or SID, including fully qualified user names such as <code>domain\user</code> or <code>user@domain</code>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String 
<p>The full path to the file, including the file name and its extension. For example: <code>/files/file.txt</code>. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> <p>Microsoft Windows: A path that begins with a forward slash (<code>/</code>) will point to the root of the current working directory of Chef Infra Client process. This path can vary from system to system. Therefore, using a path that begins with a forward slash (<code>/</code>) is not recommended.</p> </dd> </dl> <dl> <dt> <code>rights</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <code>rights &lt;permissions&gt;, &lt;principal&gt;, &lt;options&gt;</code> where <code>&lt;permissions&gt;</code> specifies the rights granted to the principal, <code>&lt;principal&gt;</code> is the group or user name, and <code>&lt;options&gt;</code> is a Hash with one (or more) advanced rights options.</p> </dd> </dl> <dl> <dt> <code>verify</code> </dt> <dd> <strong>Ruby Type:</strong> String, Block, Symbol 
<p>Allows verification of a file'’s contents before it is created. Creates a temporary file and then allows execution of commands or Ruby code. If this code evaluates to true, the file is created. If the code evaluates to false, an error is raised.</p> <p>The types for this property are a block, string, or a symbol. When specified as a block, it returns <code>true</code> or <code>false</code>. When specified as a string, it is executed as a system command. It returns <code>true</code> if the command returns 0 as its exit status code and <code>false</code> if the command returns a non-zero exit status code. When using a built-in verifier symbol it returns <code>true</code> if the verifier succeeds else it returns <code>false</code>. Currently suppported verifiers are <code>:yaml</code>, <code>:json</code> and <code>:systemd_unit</code>.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>A block is arbitrary Ruby defined within the resource block by using the <code>verify</code> property. When a block returns <code>true</code>, Chef Infra Client will continue to update the file as appropriate.'</p> </div> </div> 
<p>For example, this should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/tmp/baz'</span>  <span style="color:#007020;font-weight:700">do</span>
  verify { <span style="color:#40a070">1</span> <span style="color:#666">==</span> <span style="color:#40a070">1</span> }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This should also return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  verify <span style="color:#4070a0">'nginx -t -c %{path}'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this example, the <code>%{path}</code> portion of this command is expanded to the temporary location where a copy of the file to be created exists. This will use Nginx’s syntax checking feature to ensure the file is a valid Nginx configuration file before writing the file. An error will be raised if the executed command returns a non-zero exit status code.</p> <p>This should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/tmp/foo'</span> <span style="color:#007020;font-weight:700">do</span>
  content <span style="color:#4070a0">"hello"</span>
  verify <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>path<span style="color:#666">|</span>
    <span style="color:#007020">open</span>(path)<span style="color:#666">.</span>read<span style="color:#666">.</span>include?       <span style="color:#4070a0">"hello"</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Whereas, this should return <code>false</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/tmp/foo'</span> <span style="color:#007020;font-weight:700">do</span>
  content <span style="color:#4070a0">"goodbye"</span>
  verify <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>path<span style="color:#666">|</span>
    <span style="color:#007020">open</span>(path)<span style="color:#666">.</span>read<span style="color:#666">.</span>include?       <span style="color:#4070a0">"hello"</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>When using one of the built-in symbols(<code>:json</code>, <code>:yaml</code>, <code>:systemd_unit</code>) This should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'foo.json'</span> <span style="color:#007020;font-weight:700">do</span>
  content <span style="color:#4070a0">'{"foo": "bar"}'</span>
  verify <span style="color:#517918">:json</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Whereas, this should return <code>false</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'foo.yaml'</span> <span style="color:#007020;font-weight:700">do</span>
    content <span style="color:#4070a0">"--- foo: 'foo-"</span>
    verify <span style="color:#517918">:yaml</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>If a string, block or symbol returns <code>false</code>, the Chef Infra Client run will stop and an error is raised.</p> </dd> </dl> <h4 id="common-atomic-update-file">Atomic File Updates</h4> <p>Atomic updates are used with <strong>file</strong>-based resources to help ensure that file updates can be made when updating a binary or if disk space runs out.</p> <p>Atomic updates are enabled by default. They can be managed globally using the <code>file_atomic_update</code> setting in the client.rb file. They can be managed on a per-resource basis using the <code>atomic_update</code> property that is available with the <strong>cookbook_file</strong>, <strong>file</strong>, <strong>remote_file</strong>, and <strong>template</strong> resources.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>On certain platforms, and after a file has been moved into place, Chef Infra Client may modify file permissions to support features specific to those platforms. On platforms with SELinux enabled, Chef Infra Client will fix up the security contexts after a file has been moved into the correct location by running the <code>restorecon</code> command. On the Microsoft Windows platform, Chef Infra Client will create files so that ACL inheritance works as expected.</p> </div> </div> <h4 id="common-windows-security-file">Windows File Security</h4> To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes. <strong>Access Control Lists (ACLs)</strong> <p>The <code>rights</code> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <code>rights</code> property can be used as many times as necessary; Chef Infra Client will apply them to the file or directory as required. The syntax for the <code>rights</code> property is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights permission, principal, option_type <span style="color:#666">=&gt;</span> value
</code></pre></div>
<p>where</p> <dl> <dt><code>permission</code></dt> <dd> <p>Use to specify which rights are granted to the <code>principal</code>. The possible values are: <code>:read</code>, <code>:write</code>, <code>read_execute</code>, <code>:modify</code>, <code>:full_control</code>, or an integer.</p> </dd> <dd> <p>Integers used for permissions must match the following list <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.accesscontrol.filesystemrights?view=windowsdesktop-5.0#fields">FileSystemRights Enum</a> fields.</p> </dd> </dl> <pre class="highlight" data-language="ruby"><code>These permissions are cumulative. If `:write` is specified, then it
includes `:read`. If `:full_control` is specified, then it includes
both `:write` and `:read`.

(For those who know the Microsoft Windows API: `:read` corresponds
to `GENERIC_READ`; `:write` corresponds to `GENERIC_WRITE`;
`:read_execute` corresponds to `GENERIC_READ` and `GENERIC_EXECUTE`;
`:modify` corresponds to `GENERIC_WRITE`, `GENERIC_READ`,
`GENERIC_EXECUTE`, and `DELETE`; `:full_control` corresponds to
`GENERIC_ALL`, which allows a user to change the owner and other
metadata about a file.)
</code></pre> <dl> <dt><code>principal</code></dt> <dd> <p>Use to specify a group or user. The principal can be specified by either name or SID. When using name, this is identical to what is entered in the login box for Microsoft Windows, such as <code>user_name</code>, <code>domain\user_name</code>, or <code>user_name@fully_qualified_domain_name</code>. When using a SID, you may use either the standard string representation of a SID (S-R-I-S-S) or one of the <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/sid-strings">SDDL string constants</a>. Chef Infra Client does not need to know if a principal is a user or a group.</p> </dd> <dt><code>option_type</code></dt> <dd> <p>A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <code>rights :write, 'domain\group_name', :one_level_deep =&gt; true</code>. Possible option types:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Option Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>:applies_to_children</code></td> <td>Specify how permissions are applied to children. Possible values: <code>true</code> to inherit both child directories and files; <code>false</code> to not inherit any child directories or files; <code>:containers_only</code> to inherit only child directories (and not files); <code>:objects_only</code> to recursively inherit files (and not child directories).</td> </tr> <tr> <td><code>:applies_to_self</code></td> <td>Indicates whether a permission is applied to the parent directory. Possible values: <code>true</code> to apply to the parent directory or file and its children; <code>false</code> to not apply only to child directories and files.</td> </tr> <tr> <td><code>:one_level_deep</code></td> <td>Indicates the depth to which permissions will be applied. Possible values: <code>true</code> to apply only to the first level of children; <code>false</code> to apply to all children.</td> </tr> </tbody> </table> </dd> </dl> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'S-1-1-0'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Administrators Everyone)</span>
rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'Users'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'Sally'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#517918">:containers_only</span>, <span style="color:#517918">applies_to_self</span>: <span style="color:#007020">false</span>, <span style="color:#517918">one_level_deep</span>: <span style="color:#007020">true</span>
</code></pre></div>
<p>Some other important things to know when using the <code>rights</code> attribute:</p> <ul> <li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li> <li>If rights are not specified, nothing will be changed. Chef Infra Client does not clear out the rights on a file or directory if rights are not specified.</li> <li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li> </ul> <p>Use the <code>deny_rights</code> property to deny specific rights to specific users. The ordering is independent of using the <code>rights</code> property. For example, it doesn’t matter if rights are granted to everyone is placed before or after <code>deny_rights :read, ['Julian', 'Lewis']</code>, both Julian and Lewis will be unable to read the document. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'Everyone'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Julian Lewis)</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">deny_rights <span style="color:#517918">:full_control</span>, <span style="color:#666">[</span><span style="color:#4070a0">'Sally'</span><span style="color:#666">]</span>
</code></pre></div> <strong>Inheritance</strong> <p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <code>inherits</code> property can be used to specifically tell Chef Infra Client to apply (or not apply) inherited rights from its parent directory.</p> <p>For example, the following example specifies the rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  inherits <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># Sauron is the only person who should have any sort of access</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>If the <code>deny_rights</code> permission were to be used instead, something could slip through unless all users and groups were denied.</p> <p>Another example also shows how to specify rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'SHIRE\Frodo'</span> <span style="color:#60a0b0;font-style:italic"># Who put that there I didn't put that there</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>but then not use the <code>inherits</code> property to deny those rights on a child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span> <span style="color:#60a0b0;font-style:italic"># Oops, not specific enough</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Because the <code>inherits</code> property is not specified, Chef Infra Client will default it to <code>true</code>, which will ensure that security settings for existing files remain unchanged.</p> <br> <h3 id="functionality-file">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-file">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-file">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-file">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-file">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>file</strong> resource in recipes:</p> <p>Create a file</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/tmp/something'</span> <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create a file in Microsoft Windows</p> <p>To create a file in Microsoft Windows, be sure to add an escape character—<code>\</code>—before the backslashes in the paths:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'C:\\tmp\\something.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'Everyone'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'DOMAIN\\User'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Remove a file</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/tmp/something'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Set file modes</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/tmp/something'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Delete a repository using yum to scrub the cache</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># the following code sample thanks to gaffneyc @ https://gist.github.com/918711</span>

execute <span style="color:#4070a0">'clean-yum-cache'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'yum clean all'</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

file <span style="color:#4070a0">'/etc/yum.repos.d/bad.repo'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[clean-yum-cache]'</span>, <span style="color:#517918">:immediately</span>
  notifies <span style="color:#517918">:create</span>, <span style="color:#4070a0">'ruby_block[reload-internal-yum-cache]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Add the value of a data bag item to a file</p> <p>The following example shows how to get the contents of a data bag item named <code>impossible_things</code>, create a .pem file located at <code>some/directory/path/</code>, and then use the <code>content</code> attribute to update the contents of that file with the value of the <code>impossible_things</code> data bag item:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">private_key <span style="color:#666">=</span> data_bag_item(<span style="color:#4070a0">'impossible_things'</span>, private_key_name)<span style="color:#666">[</span><span style="color:#4070a0">'private_key'</span><span style="color:#666">]</span>

file <span style="color:#4070a0">"some/directory/path/</span><span style="color:#70a0d0;font-style:italic">#{</span>private_key_name<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.pem"</span> <span style="color:#007020;font-weight:700">do</span>
  content private_key
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'group'</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Write a YAML file</p> <p>The following example shows how to use the <code>content</code> property to write a YAML file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>app<span style="color:#666">[</span><span style="color:#4070a0">'deploy_to'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/shared/config/settings.yml"</span> <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">"app['owner']"</span>
  group <span style="color:#4070a0">"app['group']"</span>
  mode <span style="color:#4070a0">'0755'</span>
  content app<span style="color:#666">.</span>to_yaml
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Write a string to a file</p> <p>The following example specifies a directory, and then uses the <code>content</code> property to add a string to the file created in that directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">status_file <span style="color:#666">=</span> <span style="color:#4070a0">'/path/to/file/status_file'</span>

file status_file <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  content <span style="color:#4070a0">'My favourite foremost coastal Antarctic shelf, oh Larsen B!'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create a file from a copy</p> <p>The following example shows how to copy a file from one directory to another, locally on a node:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/root/1.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  content <span style="color:#60add5">IO</span><span style="color:#666">.</span>read(<span style="color:#4070a0">'/tmp/1.txt'</span>)
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the <code>content</code> attribute uses the Ruby <code>IO.read</code> method to get the contents of the <code>/tmp/1.txt</code> file.</p> <h2 id="freebsd-package-resource">freebsd_package resource</h2> <a href="freebsd_package/index.html">freebsd_package resource page</a> <hr> <p>Use the <strong>freebsd_package</strong> resource to manage packages for the FreeBSD platform.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <h3 id="syntax-freebsd-package">Syntax</h3> <hr> 
<p>A <strong>freebsd_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>freebsd_package</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">freebsd_package <span style="color:#4070a0">'package_name'</span>
</code></pre></div>
<p>which will install the named package using all of the default options and the default action (<code>:install</code>).</p> <p>The full syntax for all of the properties that are available to the <strong>freebsd_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">freebsd_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  options           <span style="color:#007020">String</span>
  package_name      <span style="color:#007020">String</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version           <span style="color:#007020">String</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>freebsd_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-freebsd-package">Actions</h3> <hr> <p>The <strong>freebsd_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> </dl> <h3 id="properties-freebsd-package">Properties</h3> <hr> <p>The <strong>freebsd_package</strong> resource has the following properties:</p> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-freebsd-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-freebsd-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-freebsd-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-freebsd-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-freebsd-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>freebsd_package</strong> resource in recipes:</p> <p>Install a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">freebsd_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="gem-package-resource">gem_package resource</h2> <a href="gem_package/index.html">gem_package resource page</a> <hr> <p>Use the <strong>gem_package</strong> resource to manage gem packages that are only included in recipes. When a gem is installed from a local file, it must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The <strong>gem_package</strong> resource must be specified as <code>gem_package</code> and cannot be shortened to <code>package</code> in a recipe.</p> </div> </div> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>The <strong>chef_gem</strong> and <strong>gem_package</strong> resources are both used to install Ruby gems. For any machine on which Chef Infra Client is installed, there are two instances of Ruby. One is the standard, system-wide instance of Ruby and the other is a dedicated instance that is available only to Chef Infra Client. Use the <strong>chef_gem</strong> resource to install gems into the instance of Ruby that is dedicated to Chef Infra Client. Use the <strong>gem_package</strong> resource to install all other gems (i.e. install gems system-wide).</p> </div> </div> <h3 id="syntax-gem-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>gem_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">gem_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  clear_sources               <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  gem_binary                  <span style="color:#007020">String</span>
  include_default_source      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  options                     <span style="color:#007020">String</span>, <span style="color:#60add5">Hash</span>, <span style="color:#007020">Array</span>
  package_name                <span style="color:#007020">String</span>
  source                      <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  timeout                     <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version                     <span style="color:#007020">String</span>
  action                      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>gem_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>clear_sources</code>, <code>gem_binary</code>, <code>include_default_source</code>, <code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-gem-package">Actions</h3> <hr> <p>The <strong>gem_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install a package. If a version is specified, install the specified version of the package. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:reconfig</code></dt> <dd>Reconfigure a package. This action requires a response file.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-gem-package">Properties</h3> <hr> <p>The <strong>gem_package</strong> resource has the following properties:</p> <dl> <dt> <code>clear_sources</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false unless `clear_gem_sources` set to true in the `client.rb` config.</code> <p>Set to <code>true</code> to download a gem from the path specified by the <code>source</code> property (and not from RubyGems).</p> </dd> </dl> <dl> <dt> <code>gem_binary</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path of a gem binary to use for the installation. By default, the same version of Ruby that is used by Chef Infra Client will be used.</p> </dd> </dl> <dl> <dt> <code>include_default_source</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Set to <code>false</code> to not include <code>Chef::Config[:rubygems_url]</code> in the sources.</p> <p> New in Chef Client 13.0 </p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Hash, Array <p>Options for the gem install, either a Hash or a String. When a hash is given, the options are passed to <code>Gem::DependencyInstaller.new</code>, and the gem will be installed via the gems API. When a String is given, the gem will be installed by shelling out to the gem command. Using a Hash of options with an explicit gem_binary will result in undefined behavior.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>Optional. The URL, or list of URLs, at which the gem package is located. This list is added to the source configured in <code>Chef::Config[:rubygems_url]</code> (see also include_default_source) to construct the complete list of rubygems sources. Users in an ‘airgapped’ environment should set Chef::Config[:rubygems_url] to their local RubyGems mirror.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-gem-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-gem-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-gem-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-gem-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-gem-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>gem_package</strong> resource in recipes:</p> <p>The following examples demonstrate various approaches for using the <strong>gem_package</strong> resource in recipes:</p> <p><strong>Install a gem file from the local file system</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">gem_package <span style="color:#4070a0">'loofah'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'/tmp/loofah-2.7.0.gem'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Use the <code>ignore_failure</code> common attribute</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">gem_package <span style="color:#4070a0">'syntax'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  ignore_failure <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="git-resource">git resource</h2> <a href="git/index.html">git resource page</a> <hr> <p>Use the <strong>git</strong> resource to manage source control resources that exist in a git repository. git version 1.6.5 (or higher) is required to use all of the functionality in the git resource.</p> <h3 id="syntax-git">Syntax</h3> <hr> 
<p>A <strong>git</strong> resource block manages source control resources that exist in a git repository:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">git <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/app_name"</span> <span style="color:#007020;font-weight:700">do</span>
  repository node<span style="color:#666">[</span><span style="color:#517918">:app_name</span><span style="color:#666">][</span><span style="color:#517918">:git_repository</span><span style="color:#666">]</span>
  revision node<span style="color:#666">[</span><span style="color:#517918">:app_name</span><span style="color:#666">][</span><span style="color:#517918">:git_revision</span><span style="color:#666">]</span>
  action <span style="color:#517918">:sync</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>The full syntax for all of the properties that are available to the <strong>git</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">git <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  additional_remotes      <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {}</span>
  checkout_branch         <span style="color:#007020">String</span>
  depth                   <span style="color:#007020">Integer</span>
  destination             <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  enable_checkout         <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  enable_submodules       <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  environment             <span style="color:#60add5">Hash</span>
  group                   <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  remote                  <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "origin"</span>
  repository              <span style="color:#007020">String</span>
  revision                <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "HEAD"</span>
  ssh_wrapper             <span style="color:#007020">String</span>
  timeout                 <span style="color:#007020">Integer</span>
  user                    <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action                  <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :sync if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>git</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>additional_remotes</code>, <code>checkout_branch</code>, <code>depth</code>, <code>destination</code>, <code>enable_checkout</code>, <code>enable_submodules</code>, <code>environment</code>, <code>group</code>, <code>remote</code>, <code>repository</code>, <code>revision</code>, <code>ssh_wrapper</code>, <code>timeout</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h3 id="actions-git">Actions</h3> <hr> <p>The <strong>git</strong> resource has the following actions:</p> <dl> <dt><code>:checkout</code></dt> <dd>Clone or check out the source. When a checkout is available, this provider does nothing.</dd> <dt><code>:export</code></dt> <dd>Export the source, excluding or removing any version control artifacts.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:sync</code></dt> <dd>Default. Update the source to the specified version, or get a new clone or checkout. This action causes a hard reset of the index and working tree, discarding any uncommitted changes.</dd> </dl> <h3 id="properties-git">Properties</h3> <hr> <p>The <strong>git</strong> resource has the following properties:</p> <dl> <dt> <code>additional_remotes</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> <p>A Hash of additional remotes that are added to the git repository configuration.</p> </dd> </dl> <dl> <dt> <code>checkout_branch</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Do a one-time checkout from git <strong>or</strong> use when a branch in the upstream repository is named <code>deploy</code>. To prevent the <strong>git</strong> resource from attempting to check out master from master, set <code>enable_checkout</code> to <code>false</code> when using the <code>checkout_branch</code> property. See <code>revision</code>.</p> </dd> </dl> <dl> <dt> <code>depth</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The number of past revisions to be included in the git shallow clone. Unless specified the default behavior will do a full clone.</p> </dd> </dl> <dl> <dt> <code>destination</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The location path to which the source is to be cloned, checked out, or exported. Default value: the name of the resource block.</p> </dd> </dl> <dl> <dt> <code>enable_checkout</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Check out a repo from master. Set to <code>false</code> when using the <code>checkout_branch</code> attribute to prevent the git resource from attempting to check out <code>master</code> from <code>master</code>.</p> </dd> </dl> <dl> <dt> <code>enable_submodules</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Perform a sub-module initialization and update.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of environment variables in the form of <code>({"ENV_VARIABLE" =&gt; "VALUE"})</code>. (These variables must exist for a command to be run successfully.)</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The <strong>git</strong> provider automatically sets the <code>ENV['HOME']</code> and <code>ENV['GIT_SSH']</code> environment variables. To override this behavior and provide different values, add <code>ENV['HOME']</code> and/or <code>ENV['GIT_SSH']</code> to the <code>environment</code> Hash.</p> </div> </div> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The system group that will own the checked-out code.</p> </dd> </dl> <dl> <dt> <code>remote</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>origin</code> <p>The remote repository to use when synchronizing an existing clone.</p> </dd> </dl> <dl> <dt> <code>repository</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The URI of the code repository.</p> </dd> </dl> <dl> <dt> <code>revision</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>HEAD</code> 
<p>A branch, tag, or commit to be synchronized with git. This can be symbolic, like <code>HEAD</code> or it can be a source control management-specific revision identifier. See <code>checkout_branch</code>.</p> <p>The value of the <code>revision</code> attribute may change over time. From one branch to another, to a tag, to a specific SHA for a commit, and then back to a branch. The <code>revision</code> attribute may even be changed in a way where history gets rewritten.</p> <p>Instead of tracking a specific branch or doing a headless checkout, Chef Infra Client maintains its own branch (via the <strong>git</strong> resource) that does not exist in the upstream repository. Chef Infra Client is then free to forcibly check out this branch to any commit without destroying the local history of an existing branch.</p> <p>For example, to explicitly track an upstream repository’s master branch:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">revision <span style="color:#4070a0">'master'</span>
</code></pre></div>
<p>Use the <code>git rev-parse</code> and <code>git ls-remote</code> commands to verify that Chef Infra Client is synchronizing commits correctly. (Chef Infra Client always runs <code>git ls-remote</code> on the upstream repository to verify the commit is made to the correct repository.)</p> </dd> </dl> <dl> <dt> <code>ssh_wrapper</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to the wrapper script used when running SSH with git. The <code>GIT_SSH</code> environment variable is set to this.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The amount of time (in seconds) to wait for a command to execute before timing out. When this property is specified using the <strong>deploy</strong> resource, the value of the <code>timeout</code> property is passed from the <strong>deploy</strong> resource to the <strong>git</strong> resource.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>`HOME` environment variable of the user running chef-client</code> <p>The system user that will own the checked-out code.</p> </dd> </dl> <br> <h3 id="functionality-git">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-git">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-git">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-git">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-git">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>git</strong> resource in recipes:</p> <p><strong>Use the git mirror</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">git <span style="color:#4070a0">'/opt/my_sources/couch'</span> <span style="color:#007020;font-weight:700">do</span>
  repository <span style="color:#4070a0">'git://git.apache.org/couchdb.git'</span>
  revision <span style="color:#4070a0">'master'</span>
  action <span style="color:#517918">:sync</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Use different branches</strong></p> <p>To use different branches, depending on the environment of the node:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">branch_name <span style="color:#666">=</span> <span style="color:#007020;font-weight:700">if</span> node<span style="color:#666">.</span>chef_environment <span style="color:#666">==</span> <span style="color:#4070a0">'QA'</span>
                <span style="color:#4070a0">'staging'</span>
              <span style="color:#007020;font-weight:700">else</span>
                <span style="color:#4070a0">'master'</span>
              <span style="color:#007020;font-weight:700">end</span>

git <span style="color:#4070a0">'/home/user/deployment'</span> <span style="color:#007020;font-weight:700">do</span>
   repository <span style="color:#4070a0">'git@github.com:git_site/deployment.git'</span>
   revision branch_name
   action <span style="color:#517918">:sync</span>
   user <span style="color:#4070a0">'user'</span>
   group <span style="color:#4070a0">'test'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Where the <code>branch_name</code> variable is set to staging or master, depending on the environment of the node. Once this is determined, the <code>branch_name</code> variable is used to set the revision for the repository. If the git status command is used after running the example above, it will return the branch name as <code>deploy</code>, as this is the default value. Run Chef Infra Client in debug mode to verify that the correct branches are being checked out:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code>sudo chef-client -l debug
</code></pre>
<p><strong>Install an application from git using bash</strong></p> <p>The following example shows how Bash can be used to install a plug-in for rbenv named ruby-build, which is located in git version source control. First, the application is synchronized, and then Bash changes its working directory to the location in which ruby-build is located, and then runs a command.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">git <span style="color:#4070a0">"/Users/tsmith/.chef/cache/ruby-build"</span> <span style="color:#007020;font-weight:700">do</span>
  repository <span style="color:#4070a0">'git://github.com/rbenv/ruby-build.git'</span>
  revision <span style="color:#4070a0">'master'</span>
  action <span style="color:#517918">:sync</span>
<span style="color:#007020;font-weight:700">end</span>

bash <span style="color:#4070a0">'install_ruby_build'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#4070a0">"/Users/tsmith/.chef/cache/ruby-build"</span>
  user <span style="color:#4070a0">'rbenv'</span>
  group <span style="color:#4070a0">'rbenv'</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span style="color:#666">.</span>/install<span style="color:#666">.</span>sh
    <span style="color:#60add5">EOH</span>
  environment <span style="color:#4070a0">'PREFIX'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/usr/local'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Notify a resource post-checkout</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">git <span style="color:#4070a0">"/Users/tsmith/.chef/cache/my_app"</span> <span style="color:#007020;font-weight:700">do</span>
  repository node<span style="color:#666">[</span><span style="color:#4070a0">'my_app'</span><span style="color:#666">][</span><span style="color:#4070a0">'git_repository'</span><span style="color:#666">]</span>
  revision node<span style="color:#666">[</span><span style="color:#4070a0">'my_app'</span><span style="color:#666">][</span><span style="color:#4070a0">'git_revision'</span><span style="color:#666">]</span>
  action <span style="color:#517918">:sync</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'bash[compile_my_app]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Pass in environment variables</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">git <span style="color:#4070a0">'/opt/my_sources/couch'</span> <span style="color:#007020;font-weight:700">do</span>
  repository <span style="color:#4070a0">'git://git.apache.org/couchdb.git'</span>
  revision <span style="color:#4070a0">'master'</span>
  environment <span style="color:#4070a0">'VAR'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'whatever'</span>
  action <span style="color:#517918">:sync</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="group-resource">group resource</h2> <a href="group/index.html">group resource page</a> <hr> <p>Use the <strong>group</strong> resource to manage a local group.</p> <h3 id="syntax-group">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>group</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">group <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  append                <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  comment               <span style="color:#007020">String</span>
  excluded_members      <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  gid                   <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  group_name            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  members               <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  non_unique            <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  <span style="color:#007020">system</span>                <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  action                <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>group</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>append</code>, <code>comment</code>, <code>excluded_members</code>, <code>gid</code>, <code>group_name</code>, <code>members</code>, <code>non_unique</code>, and <code>system</code> are the properties available to this resource.</li> </ul> <h3 id="actions-group">Actions</h3> <hr> <p>The <strong>group</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Create a group. If a group already exists (but does not match), update that group to match.</dd> <dt><code>:manage</code></dt> <dd>Manage an existing group. This action does nothing if the group does not exist.</dd> <dt><code>:modify</code></dt> <dd>Modify an existing group. This action raises an exception if the group does not exist.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a group.</dd> </dl> <h3 id="properties-group">Properties</h3> <hr> <p>The <strong>group</strong> resource has the following properties:</p> <dl> <dt> <code>append</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>How members should be appended and/or removed from a group. When true, <code>members</code> are appended and <code>excluded_members</code> are removed. When <code>false</code>, group members are reset to the value of the <code>members</code> property.</p> </dd> </dl> <dl> <dt> <code>comment</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specifies a comment to associate with the local group.</p> <p> New in Chef Client 14.9 </p> </dd> </dl> <dl> <dt> <code>excluded_members</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>[]</code> <p>Remove users from a group. May only be used when <code>append</code> is set to <code>true</code>.</p> </dd> </dl> <dl> <dt> <code>gid</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The identifier for the group.</p> </dd> </dl> <dl> <dt> <code>group_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the group. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <dl> <dt> <code>members</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>[]</code> <p>Which users should be set or appended to a group. When more than one group member is identified, the list of members should be an array: <code>members ['user1', 'user2']</code>.</p> </dd> </dl> <dl> <dt> <code>non_unique</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Allow gid duplication. May only be used with the <code>Groupadd</code> user resource provider.</p> </dd> </dl> <dl> <dt> <code>system</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Set to <code>true</code> if the group belongs to a system group.</p> </dd> </dl> <br> <h3 id="functionality-group">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-group">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-group">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-group">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-group">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>group</strong> resource in recipes:</p> Append users to groups\n\n <code>ruby\n group 'www-data' do\n \ \ action :modify\n members 'maintenance'\n append true\n end\n </code>\n\n \ \ Add a user to group on the Windows platform\n\n <code>ruby\n group 'Administrators'\ \ do\n members ['domain\\foo']\n append true\n action :modify\n end\n\ \ </code>\n" <h2 id="habitat-config-resource">habitat_config resource</h2> <a href="habitat_config/index.html">habitat_config resource page</a> <hr> <p>Use the <strong>habitat_config</strong> resource to apply a configuration to a Chef Habitat service.</p> <p><strong>New in Chef Infra Client 17.3.</strong></p> <h3 id="syntax-habitat-config">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>habitat_config</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_config <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  config                  <span style="color:#60add5">Mash</span> (<span style="color:#60add5">Hash</span><span style="color:#666">-</span>like)
  gateway_auth_token      <span style="color:#007020">String</span>
  remote_sup              <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "127.0.0.1:9632"</span>
  remote_sup_http         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "127.0.0.1:9631"</span>
  service_group           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  user                    <span style="color:#007020">String</span>
  action                  <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :apply if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>habitat_config</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>config</code>, <code>gateway_auth_token</code>, <code>remote_sup</code>, <code>remote_sup_http</code>, <code>service_group</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h3 id="actions-habitat-config">Actions</h3> <hr> <p>The <strong>habitat_config</strong> resource has the following actions:</p> <dl> <dt><code>:apply</code></dt> <dd>applies the given configuration (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-habitat-config">Properties</h3> <hr> <p>The <strong>habitat_config</strong> resource has the following properties:</p> <dl> <dt> <code>config</code> </dt> <dd> <strong>Ruby Type:</strong> Mash (Hash-like) | <code>REQUIRED</code> <p>The configuration to apply as a ruby hash, for example, <code>{ worker_count: 2, http: { keepalive_timeout: 120 } }</code>.</p> </dd> </dl> <dl> <dt> <code>gateway_auth_token</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Auth token for accessing the remote supervisor’s http port.</p> </dd> </dl> <dl> <dt> <code>remote_sup</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>127.0.0.1:9632</code> <p>Address to a remote supervisor’s control gateway.</p> </dd> </dl> <dl> <dt> <code>remote_sup_http</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>127.0.0.1:9631</code> <p>Address for remote supervisor http port. Used to pull existing.</p> </dd> </dl> <dl> <dt> <code>service_group</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The service group to apply the configuration to. For example, <code>nginx.default</code></p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Name of user key to use for encryption. Passes <code>--user</code> to <code>hab config apply</code>.</p> </dd> </dl> <br> <h3 id="functionality-habitat-config">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-habitat-config">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-habitat-config">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-habitat-config">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-habitat-config">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>habitat_config</strong> resource in recipes:</p> <p><strong>Configure your nginx defaults</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_config <span style="color:#4070a0">'nginx.default'</span> <span style="color:#007020;font-weight:700">do</span>
  config({
    <span style="color:#517918">worker_count</span>: <span style="color:#40a070">2</span>,
    <span style="color:#517918">http</span>: {
      <span style="color:#517918">keepalive_timeout</span>: <span style="color:#40a070">120</span>
    }
    })
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="habitat-install-resource">habitat_install resource</h2> <a href="habitat_install/index.html">habitat_install resource page</a> <hr> <p>Use the <strong>habitat_install</strong> resource to install Chef Habitat.</p> <p><strong>New in Chef Infra Client 17.3.</strong></p> <h3 id="syntax-habitat-install">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>habitat_install</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_install <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  bldr_url         <span style="color:#007020">String</span>
  create_user      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  hab_version      <span style="color:#007020">String</span>
  install_url      <span style="color:#007020">String</span>
  license          <span style="color:#007020">String</span>
  tmp_dir          <span style="color:#007020">String</span>
  action           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>habitat_install</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>bldr_url</code>, <code>create_user</code>, <code>hab_version</code>, <code>install_url</code>, <code>license</code>, and <code>tmp_dir</code> are the properties available to this resource.</li> </ul> <h3 id="actions-habitat-install">Actions</h3> <hr> <p>The <strong>habitat_install</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Installs Habitat. Does nothing if the <code>hab</code> binary is found in the default location for the system (<code>/bin/hab</code> on Linux, <code>/usr/local/bin/hab</code> on macOS, <code>C:/habitat/hab.exe</code> on Windows) (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-habitat-install">Properties</h3> <hr> <p>The <strong>habitat_install</strong> resource has the following properties:</p> <dl> <dt> <code>bldr_url</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Optional URL to an alternate Habitat Builder.</p> </dd> </dl> <dl> <dt> <code>create_user</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Creates the <code>hab</code> system user.</p> </dd> </dl> <dl> <dt> <code>hab_version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specify the version of <code>Habitat</code> you would like to install.</p> </dd> </dl> <dl> <dt> <code>install_url</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>https://raw.githubusercontent.com/habitat-sh/habitat/main/components/hab/install.sh</code> <p>URL to the install script, default is from the <a href="https://raw.githubusercontent.com/habitat-sh/habitat/main/components/hab/install.sh">habitat repo</a> .</p> </dd> </dl> <dl> <dt> <code>license</code> </dt> <dd> <strong>Ruby Type:</strong> String <strong>Allowed Values:</strong> <code>"accept"</code> <p>Specifies acceptance of habitat license when set to <code>accept</code>.</p> </dd> </dl> <dl> <dt> <code>tmp_dir</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Sets TMPDIR environment variable for location to place temp files.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>This is required if <code>/tmp</code> and <code>/var/tmp</code> are mounted <code>noexec</code>.</p> </div> </div> </dd> </dl> <br> <h3 id="functionality-habitat-install">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-habitat-install">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-habitat-install">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-habitat-install">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-habitat-install">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>habitat_install</strong> resource in recipes:</p> <p><strong>Installation Without a Resource Name</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_install
</code></pre></div>
<p><strong>Installation specifying a habitat builder URL</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_install <span style="color:#4070a0">'install habitat'</span> <span style="color:#007020;font-weight:700">do</span>
  bldr_url <span style="color:#4070a0">'http://localhost'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Installation specifying version and habitat builder URL</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_install <span style="color:#4070a0">'install habitat'</span> <span style="color:#007020;font-weight:700">do</span>
  bldr_url <span style="color:#4070a0">'http://localhost'</span>
  hab_version <span style="color:#4070a0">'1.5.50'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="habitat-package-resource">habitat_package resource</h2> <a href="habitat_package/index.html">habitat_package resource page</a> <hr> <p>Use the <strong>habitat_package</strong> to install or remove Chef Habitat packages from Habitat Builder.</p> <p><strong>New in Chef Infra Client 17.3.</strong></p> <h3 id="syntax-habitat-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>habitat_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  auth_token        <span style="color:#007020">String</span>
  binlink           <span style="color:#007020">true</span>, <span style="color:#007020">false</span>, force <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  bldr_url          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "https://bldr.habitat.sh"</span>
  channel           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "stable"</span>
  exclude           <span style="color:#007020">String</span>
  keep_latest       <span style="color:#007020">String</span>
  no_deps           <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  options           <span style="color:#007020">String</span>
  package_name      <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version           <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>habitat_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>auth_token</code>, <code>binlink</code>, <code>bldr_url</code>, <code>channel</code>, <code>exclude</code>, <code>keep_latest</code>, <code>no_deps</code>, <code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-habitat-package">Actions</h3> <hr> <p>The <strong>habitat_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install a package. If a version is specified, install the specified version of the package. (default)</dd> <dt><code>:lock</code></dt>  <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:reconfig</code></dt>  <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:unlock</code></dt>  <dt><code>:upgrade</code></dt> <dd>Install a package and ensure that a package is the latest version.</dd> </dl> <h3 id="properties-habitat-package">Properties</h3> <hr> <p>The <strong>habitat_package</strong> resource has the following properties:</p> <dl> <dt> <code>auth_token</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Auth token for installing a package from a private organization on Habitat builder.</p> </dd> </dl> <dl> <dt> <code>binlink</code> </dt> <dd> <strong>Ruby Type:</strong> true, false, force | <strong>Default Value:</strong> <code>false</code> <p>If habitat should attempt to binlink the package. Acceptable values: <code>true</code>, <code>false</code>, <code>:force</code>. Will fail on binlinking if set to <code>true</code> and binary or binlink exists.</p> </dd> </dl> <dl> <dt> <code>bldr_url</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>https://bldr.habitat.sh</code> <p>The habitat builder url where packages will be downloaded from. <strong>Defaults to public Habitat Builder</strong></p> </dd> </dl> <dl> <dt> <code>channel</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>stable</code> <p>The release channel to install your package from.</p> </dd> </dl> <dl> <dt> <code>exclude</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Identifier of one or more packages that should not be uninstalled. (ex: core/redis, core/busybox-static/1.42.2/21120102031201)</p> </dd> </dl> <dl> <dt> <code>keep_latest</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Ability to uninstall while retaining a specified version <strong>This feature only works in Habitat 1.5.86+.</strong></p> </dd> </dl> <dl> <dt> <code>no_deps</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Remove package but retain dependencies.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Pass any additional parameters to the habitat package command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-habitat-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-habitat-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-habitat-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-habitat-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-habitat-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>habitat_package</strong> resource in recipes:</p> <p><strong>Install core/redis</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_package <span style="color:#4070a0">'core/redis'</span>
</code></pre></div>
<p><strong>Install specific version of a package from the unstable channel</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_package <span style="color:#4070a0">'core/redis'</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#4070a0">'3.2.3'</span>
  channel <span style="color:#4070a0">'unstable'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install a package with specific version and revision</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_package <span style="color:#4070a0">'core/redis'</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#4070a0">'3.2.3/20160920131015'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install a package and force linking it’s binary files to the system path</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_package <span style="color:#4070a0">'core/nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  binlink <span style="color:#517918">:force</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install a package and link it’s binary files to the system path</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_package <span style="color:#4070a0">'core/nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  options <span style="color:#4070a0">'--binlink'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove package and all of it’s versions</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_package <span style="color:#4070a0">'core/nginx'</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove specified version of a package</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_package <span style="color:#4070a0">'core/nginx/3.2.3'</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove package but retain some versions Note: Only available as of Habitat 1.5.86</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_package <span style="color:#4070a0">'core/nginx'</span>
  keep_latest <span style="color:#4070a0">'2'</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">**</span><span style="color:#60add5">Remove</span> package but keep dependencies<span style="color:#666">**</span>
habitat_package <span style="color:#4070a0">'core/nginx'</span>
  no_deps <span style="color:#007020">false</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="habitat-service-resource">habitat_service resource</h2> <a href="habitat_service/index.html">habitat_service resource page</a> <hr> <p>Use the <strong>habitat_service</strong> resource to manage Chef Habitat services. This requires that <code>core/hab-sup</code> be running as a service. See the <code>habitat_sup</code> resource documentation for more information.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Applications may run as a specific user. Often with Habitat, the default is <code>hab</code>, or <code>root</code>. If the application requires another user, then it should be created with Chef’s <code>user</code> resource.</p> </div> </div> <p><strong>New in Chef Infra Client 17.3.</strong></p> <h3 id="syntax-habitat-service">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>habitat_service</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_service <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  bind                       <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  binding_mode               <span style="color:#60add5">Symbol</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: :strict</span>
  bldr_url                   <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "https://bldr.habitat.sh/"</span>
  channel                    <span style="color:#60add5">Symbol</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: :stable</span>
  gateway_auth_token         <span style="color:#007020">String</span>
  health_check_interval      <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 30</span>
  remote_sup                 <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "127.0.0.1:9632"</span>
  remote_sup_http            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "127.0.0.1:9631"</span>
  service_group              <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "default"</span>
  service_name               <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  shutdown_timeout           <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 8</span>
  strategy                   <span style="color:#60add5">Symbol</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: :none</span>
  topology                   <span style="color:#60add5">Symbol</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: :standalone</span>
  update_condition           <span style="color:#60add5">Symbol</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: :latest</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :load if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>habitat_service</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>bind</code>, <code>binding_mode</code>, <code>bldr_url</code>, <code>channel</code>, <code>gateway_auth_token</code>, <code>health_check_interval</code>, <code>remote_sup</code>, <code>remote_sup_http</code>, <code>service_group</code>, <code>service_name</code>, <code>shutdown_timeout</code>, <code>strategy</code>, <code>topology</code>, and <code>update_condition</code> are the properties available to this resource.</li> </ul> <h3 id="actions-habitat-service">Actions</h3> <hr> <p>The <strong>habitat_service</strong> resource has the following actions:</p> <dl> <dt><code>:load</code></dt> <dd>(default action) runs <code>hab service load</code> to load and start the specified application service (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:reload</code></dt> <dd>runs the <code>:unload</code> and then <code>:load</code> actions</dd> <dt><code>:restart</code></dt> <dd>runs the <code>:stop</code> and then <code>:start</code> actions</dd> <dt><code>:start</code></dt> <dd>runs <code>hab service start</code> to start the specified application service</dd> <dt><code>:stop</code></dt> <dd>runs <code>hab service stop</code> to stop the specified application service</dd> <dt><code>:unload</code></dt> <dd>runs <code>hab service unload</code> to unload and stop the specified application service</dd> </dl> <h3 id="properties-habitat-service">Properties</h3> <hr> <p>The <strong>habitat_service</strong> resource has the following properties:</p> <dl> <dt> <code>bind</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>[]</code> <p>Passes <code>--bind</code> with the specified services to bind to the hab command. If an array of multiple service binds are specified then a <code>--bind</code> flag is added for each.</p> </dd> </dl> <dl> <dt> <code>binding_mode</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, String | <strong>Default Value:</strong> <code>:strict</code> <strong>Allowed Values:</strong> <code>:strict, "strict", :relaxed, "relaxed"</code> <p>Passes <code>--binding-mode</code> with the specified binding mode. Defaults to <code>:strict</code>. Options are <code>:strict</code> or <code>:relaxed</code></p> </dd> </dl> <dl> <dt> <code>bldr_url</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>https://bldr.habitat.sh/</code> <p>Passes <code>--url</code> with the specified Habitat Builder URL to the hab command. Depending on the type of Habitat Builder you are connecting to, this URL will look different, here are the <strong>3</strong> current types: - Public Habitat Builder (default) - <code>https://bldr.habitat.sh</code> - On-Prem Habitat Builder installed using the <a href="https://github.com/habitat-sh/on-prem-builder">Source Install Method</a> - <code>https://your.bldr.url</code> - On-Prem Habitat Builder installed using the <a href="https://automate.chef.io/docs/on-prem-builder/">Automate Installer</a> - <code>https://your.bldr.url/bldr/v1</code></p> </dd> </dl> <dl> <dt> <code>channel</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, String | <strong>Default Value:</strong> <code>:stable</code> <p>Passes <code>--channel</code> with the specified channel to the hab command</p> </dd> </dl> <dl> <dt> <code>gateway_auth_token</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Auth token for accessing the remote supervisor’s http port.</p> </dd> </dl> <dl> <dt> <code>health_check_interval</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>30</code> <p>The interval (seconds) on which to run health checks.</p> </dd> </dl> <dl> <dt> <code>remote_sup</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>127.0.0.1:9632</code> <p>Address to a remote Supervisor’s Control Gateway</p> </dd> </dl> <dl> <dt> <code>remote_sup_http</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>127.0.0.1:9631</code> <p>IP address and port used to communicate with the remote supervisor. If this value is invalid, the resource will update the supervisor configuration each time Chef Infra Server runs.</p> </dd> </dl> <dl> <dt> <code>service_group</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>default</code> <p>Passes <code>--group</code> with the specified service group to the hab command</p> </dd> </dl> <dl> <dt> <code>service_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the service, must be in the form of <code>origin/name</code></p> </dd> </dl> <dl> <dt> <code>shutdown_timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>8</code> <p>The timeout in seconds allowed during shutdown.</p> </dd> </dl> <dl> <dt> <code>strategy</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, String | <strong>Default Value:</strong> <code>:none</code> <strong>Allowed Values:</strong> <code>:none, "none", :"at-once", "at-once", :rolling, "rolling"</code> <p>Passes <code>--strategy</code> with the specified update strategy to the hab command. Defaults to <code>:none</code>. Other options are <code>:'at-once'</code> and <code>:rolling</code></p> </dd> </dl> <dl> <dt> <code>topology</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, String | <strong>Default Value:</strong> <code>:standalone</code> <strong>Allowed Values:</strong> <code>:standalone, "standalone", :leader, "leader"</code> <p>Passes <code>--topology</code> with the specified service topology to the hab command</p> </dd> </dl> <dl> <dt> <code>update_condition</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, String | <strong>Default Value:</strong> <code>:latest</code> <strong>Allowed Values:</strong> <code>:latest, "latest", :"track-channel", "track-channel"</code> <p>Passes <code>--update-condition</code> dictating when this service should updated. Defaults to <code>latest</code>. Options are <code>latest</code> or <code>track-channel</code> **_</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>This requires a minimum habitat version of 1.5.71_** - <code>latest</code>: Runs the latest package that can be found in the configured channel and local packages. - <code>track-channel</code>: Always run the package at the head of a given channel. This enables service rollback, where demoting a package from a channel will cause the package to rollback to an older version of the package. A ramification of enabling this condition is that packages that are newer than the package at the head of the channel are also uninstalled during a service rollback.</p> </div> </div> </dd> </dl> <br> <h3 id="functionality-habitat-service">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-habitat-service">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-habitat-service">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-habitat-service">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-habitat-service">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>habitat_service</strong> resource in recipes:</p> <p><strong>Install and load nginx</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_package <span style="color:#4070a0">'core/nginx'</span>
habitat_service <span style="color:#4070a0">'core/nginx'</span>

habitat_service <span style="color:#4070a0">'core/nginx unload'</span> <span style="color:#007020;font-weight:700">do</span>
  service_name <span style="color:#4070a0">'core/nginx'</span>
  action <span style="color:#517918">:unload</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Pass the <code>strategy</code> and <code>topology</code> options to hab service commands</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_service <span style="color:#4070a0">'core/redis'</span> <span style="color:#007020;font-weight:700">do</span>
  strategy <span style="color:#4070a0">'rolling'</span>
  topology <span style="color:#4070a0">'standalone'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Using update_condition</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_service <span style="color:#4070a0">'core/redis'</span> <span style="color:#007020;font-weight:700">do</span>
  strategy <span style="color:#4070a0">'rolling'</span>
  update_condition <span style="color:#4070a0">'track-channel'</span>
  topology <span style="color:#4070a0">'standalone'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>If the service has it’s own user specified that is not the <code>hab</code> user, don’t create the <code>hab</code> user on install, and instead create the application user with Chef’s <code>user</code> resource</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_install <span style="color:#4070a0">'install habitat'</span> <span style="color:#007020;font-weight:700">do</span>
  create_user <span style="color:#007020">false</span>
<span style="color:#007020;font-weight:700">end</span>

user <span style="color:#4070a0">'acme-apps'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#007020">system</span> <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>

habitat_service <span style="color:#4070a0">'acme/apps'</span>
</code></pre></div> <h2 id="habitat-sup-resource">habitat_sup resource</h2> <a href="habitat_sup/index.html">habitat_sup resource page</a> <hr> <p>Use the <strong>habitat_sup</strong> resource to runs a Chef Habitat supervisor for one or more Chef Habitat services. The resource is commonly used in conjunction with <code>habitat_service</code> which will manage the services loaded and started within the supervisor.</p> <p><strong>New in Chef Infra Client 17.3.</strong></p> <h3 id="syntax-habitat-sup">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>habitat_sup</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_sup <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  auth_token                    <span style="color:#007020">String</span>
  auto_update                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  bldr_url                      <span style="color:#007020">String</span>
  event_stream_application      <span style="color:#007020">String</span>
  event_stream_cert             <span style="color:#007020">String</span>
  event_stream_environment      <span style="color:#007020">String</span>
  event_stream_site             <span style="color:#007020">String</span>
  event_stream_token            <span style="color:#007020">String</span>
  event_stream_url              <span style="color:#007020">String</span>
  gateway_auth_token            <span style="color:#007020">String</span>
  hab_channel                   <span style="color:#007020">String</span>
  health_check_interval         <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  keep_latest                   <span style="color:#007020">String</span>
  launcher_version              <span style="color:#007020">String</span>
  license                       <span style="color:#007020">String</span>
  limit_no_files                <span style="color:#007020">String</span>
  listen_ctl                    <span style="color:#007020">String</span>
  listen_gossip                 <span style="color:#007020">String</span>
  listen_http                   <span style="color:#007020">String</span>
  org                           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "default"</span>
  peer                          <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  permanent_peer                <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  ring                          <span style="color:#007020">String</span>
  service_version               <span style="color:#007020">String</span>
  sup_version                   <span style="color:#007020">String</span>
  toml_config                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  update_condition              <span style="color:#007020">String</span>
  action                        <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>habitat_sup</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>auth_token</code>, <code>auto_update</code>, <code>bldr_url</code>, <code>event_stream_application</code>, <code>event_stream_cert</code>, <code>event_stream_environment</code>, <code>event_stream_site</code>, <code>event_stream_token</code>, <code>event_stream_url</code>, <code>gateway_auth_token</code>, <code>hab_channel</code>, <code>health_check_interval</code>, <code>keep_latest</code>, <code>launcher_version</code>, <code>license</code>, <code>limit_no_files</code>, <code>listen_ctl</code>, <code>listen_gossip</code>, <code>listen_http</code>, <code>org</code>, <code>peer</code>, <code>permanent_peer</code>, <code>ring</code>, <code>service_version</code>, <code>sup_version</code>, <code>toml_config</code>, and <code>update_condition</code> are the properties available to this resource.</li> </ul> <h3 id="actions-habitat-sup">Actions</h3> <hr> <p>The <strong>habitat_sup</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:run</code></dt> <dd>The <code>run</code> action handles installing Habitat using the <code>habitat_install</code> resource, ensures that the appropriate versions of the <code>core/hab-sup</code> and <code>core/hab-launcher</code> packages are installed using <code>habitat_package</code>, and then drops off the appropriate init system definitions and manages the service. (default)</dd> <dt><code>:stop</code></dt>  </dl> <h3 id="properties-habitat-sup">Properties</h3> <hr> <p>The <strong>habitat_sup</strong> resource has the following properties:</p> <dl> <dt> <code>auth_token</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Auth token for accessing a private organization on bldr. This value is templated into the appropriate service file.</p> </dd> </dl> <dl> <dt> <code>auto_update</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Passes <code>--auto-update</code>. This will set the Habitat supervisor to automatically update itself any time a stable version has been released.</p> </dd> </dl> <dl> <dt> <code>bldr_url</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The Habitat Builder URL for the <code>habitat_package</code> resource, if needed.</p> </dd> </dl> <dl> <dt> <code>event_stream_application</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of your application that will be displayed in the Chef Automate Applications Dashboard.</p> </dd> </dl> <dl> <dt> <code>event_stream_cert</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>With <code>Intermediary Certificates</code> or, Automate 2 being set to use TLS with a valid cert, you will need to provide <code>Habitat</code> with your certificate for communication with Automate to work. <a href="https://automate.chef.io/docs/applications-setup/#share-the-tls-certificate-with-chef-habitat">Follow these steps!</a>.</p> </dd> </dl> <dl> <dt> <code>event_stream_environment</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The application environment for the supervisor, this is for grouping in the Applications Dashboard.</p> </dd> </dl> <dl> <dt> <code>event_stream_site</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Application Dashboard label for the ‘site’ of the application - can be filtered in the dashboard.</p> </dd> </dl> <dl> <dt> <code>event_stream_token</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Chef Automate token for sending application event stream data.</p> </dd> </dl> <dl> <dt> <code>event_stream_url</code> </dt> <dd> <strong>Ruby Type:</strong> String <p><code>AUTOMATE_HOSTNAME:4222</code> - the Chef Automate URL with port 4222 specified</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The port can be changed if needed.</p> </div> </div> </dd> </dl> <dl> <dt> <code>gateway_auth_token</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Auth token for accessing the supervisor’s HTTP gateway. This value is templated into the appropriate service file.</p> </dd> </dl> <dl> <dt> <code>hab_channel</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The channel to install Habitat from. Defaults to stable</p> </dd> </dl> <dl> <dt> <code>health_check_interval</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The interval (seconds) on which to run health checks.</p> </dd> </dl> <dl> <dt> <code>keep_latest</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Automatically cleans up old packages. If this flag is enabled, service startup will initiate an uninstall of all previous versions of the associated package. This also applies when a service is restarted due to an update. If a number is passed to this argument, that number of latest versions will be kept. The same logic applies to the Supervisor package <code>env:HAB_KEEP_LATEST_PACKAGES=1</code></p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>This requires Habitat version <code>1.5.86+</code></p> </div> </div> </dd> </dl> <dl> <dt> <code>launcher_version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Allows you to choose which version of launcher to install.</p> </dd> </dl> <dl> <dt> <code>license</code> </dt> <dd> <strong>Ruby Type:</strong> String <strong>Allowed Values:</strong> <code>"accept"</code> <p>Specifies acceptance of habitat license when set to <code>accept</code>.</p> </dd> </dl> <dl> <dt> <code>limit_no_files</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>allows you to set LimitNOFILE in the systemd service when used</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Linux Only.</p> </div> </div> </dd> </dl> <dl> <dt> <code>listen_ctl</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Only valid for <code>:run</code> action, passes <code>--listen-ctl</code> with the specified address and port, e.g., <code>0.0.0.0:9632</code>, to the hab command.</p> </dd> </dl> <dl> <dt> <code>listen_gossip</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Only valid for <code>:run</code> action, passes <code>--listen-gossip</code> with the specified address and port, e.g., <code>0.0.0.0:9638</code>, to the hab command.</p> </dd> </dl> <dl> <dt> <code>listen_http</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Only valid for <code>:run</code> action, passes <code>--listen-http</code> with the specified address and port, e.g., <code>0.0.0.0:9631</code>, to the hab command.</p> </dd> </dl> <dl> <dt> <code>org</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>default</code> <p>Only valid for <code>:run</code> action, passes <code>--org</code> with the specified org name to the hab command.</p> </dd> </dl> <dl> <dt> <code>peer</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>Only valid for <code>:run</code> action, passes <code>--peer</code> with the specified initial peer to the hab command.</p> </dd> </dl> <dl> <dt> <code>permanent_peer</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Only valid for <code>:run</code> action, passes <code>--permanent-peer</code> to the hab command.</p> </dd> </dl> <dl> <dt> <code>ring</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Only valid for <code>:run</code> action, passes <code>--ring</code> with the specified ring key name to the hab command.</p> </dd> </dl> <dl> <dt> <code>service_version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Allows you to choose which version of the <strong><em>Windows Service</em></strong> to install.</p> </dd> </dl> <dl> <dt> <code>sup_version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Allows you to choose which version of supervisor you would like to install.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If a version is provided, it will also install that version of habitat if not previously installed.</p> </div> </div> </dd> </dl> <dl> <dt> <code>toml_config</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Supports using the Supervisor toml configuration instead of passing exec parameters to the service, <a href="https://www.habitat.sh/docs/reference/#supervisor-config">reference</a>.</p> </dd> </dl> <dl> <dt> <code>update_condition</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Passes <code>--update-condition</code> dictating when this service should updated. Defaults to <code>latest</code>. Options are <code>latest</code> or <code>track-channel</code> **_</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>This requires a minimum habitat version of 1.5.71_** - <code>latest</code>: Runs the latest package that can be found in the configured channel and local packages. - <code>track-channel</code>: Always run what is at the head of a given channel. This enables service rollback where demoting a package from a channel will cause the package to rollback to an older version of the package. A ramification of enabling this condition is packages newer than the package at the head of the channel will be automatically uninstalled during a service rollback.</p> </div> </div> </dd> </dl> <br> <h3 id="functionality-habitat-sup">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-habitat-sup">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-habitat-sup">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-habitat-sup">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-habitat-sup">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>habitat_sup</strong> resource in recipes:</p> <p><strong>Set up with just the defaults</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_sup <span style="color:#4070a0">'default'</span>
</code></pre></div>
<p><strong>Update listen ports and use Supervisor toml config</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_sup <span style="color:#4070a0">'test-options'</span> <span style="color:#007020;font-weight:700">do</span>
  listen_http <span style="color:#4070a0">'0.0.0.0:9999'</span>
  listen_gossip <span style="color:#4070a0">'0.0.0.0:9998'</span>
  toml_config <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Use with an on-prem Habitat Builder. Note: Access to public builder may not be available due to your company policies</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_sup <span style="color:#4070a0">'default'</span> <span style="color:#007020;font-weight:700">do</span>
  bldr_url <span style="color:#4070a0">'https://bldr.example.com'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Using update_condition</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_sup <span style="color:#4070a0">'default'</span> <span style="color:#007020;font-weight:700">do</span>
  bldr_url <span style="color:#4070a0">'https://bldr.example.com'</span>
  habitat_channel <span style="color:#4070a0">'dev'</span>
  update_condition <span style="color:#4070a0">'track-channel'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><em><em>Provide event_stream_</em> information</em>*</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_sup <span style="color:#4070a0">'default'</span> <span style="color:#007020;font-weight:700">do</span>
  license <span style="color:#4070a0">'accept'</span>
  event_stream_application <span style="color:#4070a0">'myapp'</span>
  event_stream_environment <span style="color:#4070a0">'production'</span>
  event_stream_site <span style="color:#4070a0">'MySite'</span>
  event_stream_url <span style="color:#4070a0">'automate.example.com:4222'</span>
  event_stream_token <span style="color:#4070a0">'myawesomea2clitoken='</span>
  event_stream_cert <span style="color:#4070a0">'/hab/cache/ssl/mycert.crt'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Provide specific versions</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_sup <span style="color:#4070a0">'default'</span> <span style="color:#007020;font-weight:700">do</span>
  bldr_url <span style="color:#4070a0">'https://bldr.example.com'</span>
  sup_version <span style="color:#4070a0">'1.5.50'</span>
  launcher_version <span style="color:#4070a0">'13458'</span>
  service_version <span style="color:#4070a0">'0.6.0'</span> <span style="color:#60a0b0;font-style:italic"># WINDOWS ONLY</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Set latest version of packages to retain</strong></p> <p>habitat_sup ‘default’ do bldr_url ‘<a href="https://bldr.example.com">https://bldr.example.com</a>’ sup_version ‘1.5.86’ launcher_version ‘13458’ service_version ‘0.6.0’ # WINDOWS ONLY keep_latest ‘2’ end</p>  <h2 id="habitat-user-toml-resource">habitat_user_toml resource</h2> <a href="habitat_user_toml/index.html">habitat_user_toml resource page</a> <hr> <p>Use the <strong>habitat_user_toml</strong> to template a <code>user.toml</code> for Chef Habitat services. Configurations set in the <code>user.toml</code> override the <code>default.toml</code> for a given package, which makes it an alternative to applying service group level configuration.</p> <p><strong>New in Chef Infra Client 17.3.</strong></p> <h3 id="syntax-habitat-user-toml">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>habitat_user_toml</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_user_toml <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  config            <span style="color:#60add5">Mash</span> (<span style="color:#60add5">Hash</span><span style="color:#666">-</span>like)
  service_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>habitat_user_toml</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>config</code> and <code>service_name</code> are the properties available to this resource.</li> </ul> <h3 id="actions-habitat-user-toml">Actions</h3> <hr> <p>The <strong>habitat_user_toml</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>(default action) Create the user.toml from the specified config. (default)</dd> <dt><code>:delete</code></dt> <dd>Delete the user.toml</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-habitat-user-toml">Properties</h3> <hr> <p>The <strong>habitat_user_toml</strong> resource has the following properties:</p> <dl> <dt> <code>config</code> </dt> <dd> <strong>Ruby Type:</strong> Mash (Hash-like) | <code>REQUIRED</code> <p>Only valid for <code>:create</code> action. The configuration to apply as a ruby hash, for example, <code>{ worker_count: 2, http: { keepalive_timeout: 120 } }</code>.</p> </dd> </dl> <dl> <dt> <code>service_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The service group to apply the configuration to, for example, <code>nginx.default</code>.</p> </dd> </dl> <br> <h3 id="functionality-habitat-user-toml">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-habitat-user-toml">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-habitat-user-toml">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-habitat-user-toml">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-habitat-user-toml">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>habitat_user_toml</strong> resource in recipes:</p> <p><strong>Configure user specific settings to nginx</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">habitat_user_toml <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  config({
    <span style="color:#517918">worker_count</span>: <span style="color:#40a070">2</span>,
    <span style="color:#517918">http</span>: {
      <span style="color:#517918">keepalive_timeout</span>: <span style="color:#40a070">120</span>
    }
    })
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="homebrew-cask-resource">homebrew_cask resource</h2> <a href="homebrew_cask/index.html">homebrew_cask resource page</a> <hr> <p>Use the <strong>homebrew_cask</strong> resource to install binaries distributed via the Homebrew package manager.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-homebrew-cask">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>homebrew_cask</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">homebrew_cask <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  cask_name          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  homebrew_path      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/usr/local/bin/brew"</span>
  install_cask       <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  options            <span style="color:#007020">String</span>
  owner              <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: "Calculated default username"</span>
  action             <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>homebrew_cask</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>cask_name</code>, <code>homebrew_path</code>, <code>install_cask</code>, <code>options</code>, and <code>owner</code> are the properties available to this resource.</li> </ul> <h3 id="actions-homebrew-cask">Actions</h3> <hr> <p>The <strong>homebrew_cask</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install an application that is packaged as a Homebrew cask. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove an application that is packaged as a Homebrew cask.</dd> </dl> <h3 id="properties-homebrew-cask">Properties</h3> <hr> <p>The <strong>homebrew_cask</strong> resource has the following properties:</p> <dl> <dt> <code>cask_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the cask name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>homebrew_path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/usr/local/bin/brew</code> <p>The path to the homebrew binary.</p> </dd> </dl> <dl> <dt> <code>install_cask</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Automatically install the Homebrew cask tap, if necessary.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Options to pass to the brew command during installation.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>Calculated default username</code> <p>The owner of the Homebrew installation.</p> </dd> </dl> <br> <h3 id="functionality-homebrew-cask">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-homebrew-cask">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-homebrew-cask">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-homebrew-cask">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-homebrew-cask">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="homebrew-package-resource">homebrew_package resource</h2> <a href="homebrew_package/index.html">homebrew_package resource page</a> <hr> <p>Use the <strong>homebrew_package</strong> resource to manage packages for the macOS platform.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Starting with Chef Infra Client 16 the homebrew resource now accepts an array of packages for installing multiple packages at once.</p> </div> </div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <p><strong>New in Chef Infra Client 12.0.</strong></p> <h3 id="syntax-homebrew-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>homebrew_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">homebrew_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  homebrew_user      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  options            <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name       <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  source             <span style="color:#007020">String</span>
  timeout            <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version            <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action             <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>homebrew_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>homebrew_user</code>, <code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-homebrew-package">Actions</h3> <hr> <p>The <strong>homebrew_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install a package. If a version is specified, install the specified version of the package. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and ensure that a package is the latest version.</dd> </dl> <h3 id="properties-homebrew-package">Properties</h3> <hr> <p>The <strong>homebrew_package</strong> resource has the following properties:</p> <dl> <dt> <code>homebrew_user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer 
<p>The name or uid of the Homebrew owner to be used by Chef Infra Client when executing a command.</p> <p>Chef Infra Client, by default, will attempt to execute a Homebrew command as the owner of the <code>/usr/local/bin/brew</code> executable. If that executable does not exist, Chef Infra Client will attempt to find the user by executing <code>which brew</code>. If that executable cannot be found, Chef Infra Client will print an error message: <code>Could not find the 'brew' executable in /usr/local/bin or anywhere on the path.</code>.</p> <p>Set this property to specify the Homebrew owner for situations where Chef Infra Client cannot automatically detect the correct owner.'</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <h4 id="multiple-packages-properties-homebrew-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <br> <h3 id="functionality-homebrew-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-homebrew-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-homebrew-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-homebrew-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h4 id="multiple-packages-common-homebrew-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <h3 id="examples-homebrew-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>homebrew_package</strong> resource in recipes:</p> <p><strong>Install a package</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">homebrew_package <span style="color:#4070a0">'git'</span>
</code></pre></div>
<p><strong>Install multiple packages at once</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">homebrew_package <span style="color:#c65d09">%w(git fish ruby)</span>
</code></pre></div>
<p><strong>Specify the Homebrew user with a UUID</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">homebrew_package <span style="color:#4070a0">'git'</span> <span style="color:#007020;font-weight:700">do</span>
  homebrew_user <span style="color:#40a070">1001</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Specify the Homebrew user with a string</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">homebrew_package <span style="color:#4070a0">'vim'</span> <span style="color:#007020;font-weight:700">do</span>
  homebrew_user <span style="color:#4070a0">'user1'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="homebrew-tap-resource">homebrew_tap resource</h2> <a href="homebrew_tap/index.html">homebrew_tap resource page</a> <hr> <p>Use the <strong>homebrew_tap</strong> resource to add additional formula repositories to the Homebrew package manager.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-homebrew-tap">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>homebrew_tap</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">homebrew_tap <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  homebrew_path      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/usr/local/bin/brew"</span>
  owner              <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "Calculated default username"</span>
  tap_name           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  url                <span style="color:#007020">String</span>
  action             <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :tap if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>homebrew_tap</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>homebrew_path</code>, <code>owner</code>, <code>tap_name</code>, and <code>url</code> are the properties available to this resource.</li> </ul> <h3 id="actions-homebrew-tap">Actions</h3> <hr> <p>The <strong>homebrew_tap</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:tap</code></dt> <dd>Add a Homebrew tap. (default)</dd> <dt><code>:untap</code></dt> <dd>Remove a Homebrew tap.</dd> </dl> <h3 id="properties-homebrew-tap">Properties</h3> <hr> <p>The <strong>homebrew_tap</strong> resource has the following properties:</p> <dl> <dt> <code>homebrew_path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/usr/local/bin/brew</code> <p>The path to the Homebrew binary.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>Calculated default username</code> <p>The owner of the Homebrew installation.</p> </dd> </dl> <dl> <dt> <code>tap_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the tap name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>url</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The URL of the tap.</p> </dd> </dl> <br> <h3 id="functionality-homebrew-tap">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-homebrew-tap">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-homebrew-tap">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-homebrew-tap">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-homebrew-tap">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="homebrew-update-resource">homebrew_update resource</h2> <a href="homebrew_update/index.html">homebrew_update resource page</a> <hr> <p>Use the <strong>homebrew_update</strong> resource to manage Homebrew repository updates on macOS.</p> <p><strong>New in Chef Infra Client 16.2.</strong></p> <h3 id="syntax-homebrew-update">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>homebrew_update</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">homebrew_update <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  frequency      <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 86400</span>
  action         <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :periodic if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>homebrew_update</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>frequency</code> is the property available to this resource.</li> </ul> <h3 id="actions-homebrew-update">Actions</h3> <hr> <p>The <strong>homebrew_update</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:periodic</code></dt> <dd>Run a periodic update based on the frequency property. (default)</dd> <dt><code>:update</code></dt> <dd>Run an immediate update.</dd> </dl> <h3 id="properties-homebrew-update">Properties</h3> <hr> <p>The <strong>homebrew_update</strong> resource has the following properties:</p> <dl> <dt> <code>frequency</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>86400</code> <p>Determines how frequently (in seconds) Homebrew updates are made. Use this property when the <code>:periodic</code> action is specified.</p> </dd> </dl> <br> <h3 id="functionality-homebrew-update">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-homebrew-update">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-homebrew-update">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-homebrew-update">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-homebrew-update">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>homebrew_update</strong> resource in recipes:</p> <p><strong>Update the homebrew repository data at a specified interval</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">homebrew_update <span style="color:#4070a0">'all platforms'</span> <span style="color:#007020;font-weight:700">do</span>
  frequency <span style="color:#40a070">86400</span>
  action <span style="color:#517918">:periodic</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Update the Homebrew repository at the start of a Chef Infra Client run</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">homebrew_update <span style="color:#4070a0">'update'</span>
</code></pre></div> <h2 id="hostname-resource">hostname resource</h2> <a href="hostname/index.html">hostname resource page</a> <hr> <p>Use the <strong>hostname</strong> resource to set the system’s hostname, configure hostname and hosts config file, and re-run the Ohai hostname plugin so the hostname will be available in subsequent cookbooks.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-hostname">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>hostname</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">hostname <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  aliases              <span style="color:#007020">Array</span>
  compile_time         <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  domain_password      <span style="color:#007020">String</span>
  domain_user          <span style="color:#007020">String</span>
  fqdn                 <span style="color:#007020">String</span>
  hostname             <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  ipaddress            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: The node's IP address as determined by Ohai.</span>
  windows_reboot       <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  action               <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :set if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>hostname</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>aliases</code>, <code>compile_time</code>, <code>domain_password</code>, <code>domain_user</code>, <code>fqdn</code>, <code>hostname</code>, <code>ipaddress</code>, and <code>windows_reboot</code> are the properties available to this resource.</li> </ul> <h3 id="actions-hostname">Actions</h3> <hr> <p>The <strong>hostname</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:set</code></dt> <dd>Sets the node’s hostname. (default)</dd> </dl> <h3 id="properties-hostname">Properties</h3> <hr> <p>The <strong>hostname</strong> resource has the following properties:</p> <dl> <dt> <code>aliases</code> </dt> <dd> <strong>Ruby Type:</strong> Array <p>An array of hostname aliases to use when configuring the hosts file.</p> </dd> </dl> <dl> <dt> <code>compile_time</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Determines whether or not the resource should be run at compile time.</p> </dd> </dl> <dl> <dt> <code>domain_password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The password to accompany the domain_user parameter</p> <p> New in Chef Infra Client 17.2 </p> </dd> </dl> <dl> <dt> <code>domain_user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A domain account specified in the form of DOMAIN\user used when renaming a domain-joined device</p> <p> New in Chef Infra Client 17.2 </p> </dd> </dl> <dl> <dt> <code>fqdn</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the fqdn if it differs from the resource block’s hostname.</p> <p> New in Chef Infra Client 17.0 </p> </dd> </dl> <dl> <dt> <code>hostname</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the hostname if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>ipaddress</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The node's IP address as determined by Ohai.</code> <p>The IP address to use when configuring the hosts file.</p> </dd> </dl> <dl> <dt> <code>windows_reboot</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Determines whether or not Windows should be reboot after changing the hostname, as this is required for the change to take effect.</p> </dd> </dl> <br> <h3 id="functionality-hostname">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-hostname">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-hostname">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-hostname">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-hostname">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>hostname</strong> resource in recipes:</p> <p><strong>Set the hostname using the IP address, as detected by Ohai</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">hostname <span style="color:#4070a0">'example'</span>
</code></pre></div>
<p><strong>Manually specify the hostname and IP address</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">hostname <span style="color:#4070a0">'statically_configured_host'</span> <span style="color:#007020;font-weight:700">do</span>
  hostname <span style="color:#4070a0">'example'</span>
  ipaddress <span style="color:#4070a0">'198.51.100.2'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Change the hostname of a Windows, Non-Domain joined node</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">hostname <span style="color:#4070a0">'renaming a workgroup computer'</span> <span style="color:#007020;font-weight:700">do</span>
  hostname <span style="color:#4070a0">'Foo'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Change the hostname of a Windows, Domain-joined node (new in 17.2)</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">hostname <span style="color:#4070a0">'renaming a domain-joined computer'</span> <span style="color:#007020;font-weight:700">do</span>
  hostname <span style="color:#4070a0">'Foo'</span>
  domain_user <span style="color:#4070a0">"Domain\Someone"</span>
  domain_password <span style="color:#4070a0">'SomePassword'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="http-request-resource">http_request resource</h2> <a href="http_request/index">http_request resource page</a> <hr> <p>Use the <strong>http_request</strong> resource to send an HTTP request (<code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>DELETE</code>, <code>HEAD</code>, or <code>OPTIONS</code>) with an arbitrary message. This resource is often useful when custom callbacks are necessary.</p> <h3 id="syntax-http-request">Syntax</h3> <hr> 
<p>A <strong>http_request</strong> resource block sends HTTP requests with an arbitrary message. For example, send a <code>DELETE</code> request to <code>'http://www.chef.io/some_page?message=please_delete_me'</code>.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">http_request <span style="color:#4070a0">'please_delete_me'</span> <span style="color:#007020;font-weight:700">do</span>
  url <span style="color:#4070a0">'http://www.chef.io/some_page'</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>The full syntax for all of the properties that are available to the <strong>http_request</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">http_request <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  headers                    <span style="color:#60add5">Hash</span>
  message                    <span style="color:#60add5">Object</span> <span style="color:#60a0b0;font-style:italic"># defaults to 'name' if not specified</span>
  url                        <span style="color:#007020">String</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :get if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>http_request</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>headers</code>, <code>message</code>, and <code>url</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-http-request">Actions</h3> <hr> <p>The <strong>http_request</strong> resource has the following actions:</p> <dl> <dt><code>:delete</code></dt> <dd>Send a <code>DELETE</code> request.</dd> <dt><code>:get</code></dt> <dd>Default. Send a <code>GET</code> request. Changed in Chef Client 12.0 to deprecate the hard-coded query string from earlier versions. Cookbooks that rely on this string need to be updated to manually add it to the URL as it is passed to the resource.</dd> <dt><code>:head</code></dt> <dd>Send a <code>HEAD</code> request.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:options</code></dt> <dd>Send an <code>OPTIONS</code> request.</dd> <dt><code>:post</code></dt> <dd>Send a <code>POST</code> request.</dd> <dt><code>:put</code></dt> <dd>Send a <code>PUT</code> request.</dd> </dl> <h3 id="properties-http-request">Properties</h3> <hr> <p>The <strong>http_request</strong> resource has the following properties:</p> <dl> <dt> <code>headers</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of custom headers.</p> </dd> </dl> <dl> <dt> <code>message</code> </dt> <dd> <strong>Ruby Type:</strong> Object <p>The message that is sent by the HTTP request. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <dl> <dt> <code>url</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The URL to which an HTTP request is sent.</p> </dd> </dl> <br> <h3 id="functionality-http-request">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-http-request">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-http-request">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-http-request">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-http-request">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>http_request</strong> resource in recipes:</p> <p>Send a GET request</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">http_request <span style="color:#4070a0">'some_message'</span> <span style="color:#007020;font-weight:700">do</span>
  url <span style="color:#4070a0">'http://example.com/check_in'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The message is sent as <code>http://example.com/check_in?message=some_message</code>.</p> <p>Send a POST request</p> <p>To send a <code>POST</code> request as JSON data, convert the message to JSON and include the correct content-type header. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">http_request <span style="color:#4070a0">'posting data'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:post</span>
  url <span style="color:#4070a0">'http://example.com/check_in'</span>
  message ({<span style="color:#517918">:some</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'data'</span>}<span style="color:#666">.</span>to_json)
  headers({<span style="color:#4070a0">'AUTHORIZATION'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"Basic </span><span style="color:#70a0d0;font-style:italic">#{</span>
    <span style="color:#60add5">Base64</span><span style="color:#666">.</span>encode64(<span style="color:#4070a0">'username:password'</span>)<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>,
    <span style="color:#4070a0">'Content-Type'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'application/data'</span>
  })
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Transfer a file only when the remote source changes</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'/tmp/couch.png'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'http://couchdb.apache.org/img/sketch.png'</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

http_request <span style="color:#4070a0">'HEAD http://couchdb.apache.org/img/sketch.png'</span> <span style="color:#007020;font-weight:700">do</span>
  message <span style="color:#4070a0">''</span>
  url <span style="color:#4070a0">'http://couchdb.apache.org/img/sketch.png'</span>
  action <span style="color:#517918">:head</span>
  <span style="color:#007020;font-weight:700">if</span> <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(<span style="color:#4070a0">'/tmp/couch.png'</span>)
    headers <span style="color:#4070a0">'If-Modified-Since'</span> <span style="color:#666">=&gt;</span> <span style="color:#60add5">File</span><span style="color:#666">.</span>mtime(<span style="color:#4070a0">'/tmp/couch.png'</span>)<span style="color:#666">.</span>httpdate
  <span style="color:#007020;font-weight:700">end</span>
  notifies <span style="color:#517918">:create</span>, <span style="color:#4070a0">'remote_file[/tmp/couch.png]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="ifconfig-resource">ifconfig resource</h2> <a href="ifconfig/index.html">ifconfig resource page</a> <hr> <p>Use the <strong>ifconfig</strong> resource to manage interfaces on Unix and Linux systems.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>This resource requires the ifconfig binary to be present on the system and may require additional packages to be installed first. On Ubuntu 18.04 or later you will need to install the <code>ifupdown</code> package, which disables the built in Netplan functionality.</p> </div> </div> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>This resource will not work with Fedora release 33 or later.</p> </div> </div> <h3 id="syntax-ifconfig">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>ifconfig</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ifconfig <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  bcast             <span style="color:#007020">String</span>
  bonding_opts      <span style="color:#007020">String</span>
  bootproto         <span style="color:#007020">String</span>
  bridge            <span style="color:#007020">String</span>
  device            <span style="color:#007020">String</span>
  ethtool_opts      <span style="color:#007020">String</span>
  family            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "inet"</span>
  gateway           <span style="color:#007020">String</span>
  hwaddr            <span style="color:#007020">String</span>
  inet_addr         <span style="color:#007020">String</span>
  mask              <span style="color:#007020">String</span>
  master            <span style="color:#007020">String</span>
  metric            <span style="color:#007020">String</span>
  mtu               <span style="color:#007020">String</span>
  network           <span style="color:#007020">String</span>
  onboot            <span style="color:#007020">String</span>
  onparent          <span style="color:#007020">String</span>
  slave             <span style="color:#007020">String</span>
  target            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  vlan              <span style="color:#007020">String</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>ifconfig</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>bcast</code>, <code>bonding_opts</code>, <code>bootproto</code>, <code>bridge</code>, <code>device</code>, <code>ethtool_opts</code>, <code>family</code>, <code>gateway</code>, <code>hwaddr</code>, <code>inet_addr</code>, <code>mask</code>, <code>master</code>, <code>metric</code>, <code>mtu</code>, <code>network</code>, <code>onboot</code>, <code>onparent</code>, <code>slave</code>, <code>target</code>, and <code>vlan</code> are the properties available to this resource.</li> </ul> <h3 id="actions-ifconfig">Actions</h3> <hr> <p>The <strong>ifconfig</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Run ifconfig to configure a network interface and (on some platforms) write a configuration file for that network interface. (default)</dd> <dt><code>:delete</code></dt> <dd>Run ifconfig to disable a network interface and (on some platforms) delete that network interface’s configuration file.</dd> <dt><code>:disable</code></dt> <dd>Run ifconfig to disable a network interface.</dd> <dt><code>:enable</code></dt> <dd>Run ifconfig to enable a network interface.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-ifconfig">Properties</h3> <hr> <p>The <strong>ifconfig</strong> resource has the following properties:</p> <dl> <dt> <code>bcast</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The broadcast address for a network interface. On some platforms this property is not set using ifconfig, but instead is added to the startup configuration file for the network interface.</p> </dd> </dl> <dl> <dt> <code>bonding_opts</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Bonding options to pass via <code>BONDING_OPTS</code> on RHEL and CentOS. For example: <code>mode=active-backup miimon=100</code>.</p> <p> New in Chef Client 13.4 </p> </dd> </dl> <dl> <dt> <code>bootproto</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The boot protocol used by a network interface.</p> </dd> </dl> <dl> <dt> <code>bridge</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The bridge interface this interface is a member of on Red Hat based systems.</p> <p> New in Chef Infra Client 16.7 </p> </dd> </dl> <dl> <dt> <code>device</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The network interface to be configured.</p> </dd> </dl> <dl> <dt> <code>ethtool_opts</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Options to be passed to ethtool(8). For example: <code>-A eth0 autoneg off rx off tx off</code>.</p> <p> New in Chef Client 13.4 </p> </dd> </dl> <dl> <dt> <code>family</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>inet</code> <p>Networking family option for Debian-based systems; for example: <code>inet</code> or <code>inet6</code>.</p> <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>gateway</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The gateway to use for the interface.</p> <p> New in Chef Client 14.4 </p> </dd> </dl> <dl> <dt> <code>hwaddr</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The hardware address for the network interface.</p> </dd> </dl> <dl> <dt> <code>inet_addr</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The Internet host address for the network interface.</p> </dd> </dl> <dl> <dt> <code>mask</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The decimal representation of the network mask. For example: <code>255.255.255.0</code>.</p> </dd> </dl> <dl> <dt> <code>master</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specifies the channel bonding interface to which the Ethernet interface is linked.</p> <p> New in Chef Client 13.4 </p> </dd> </dl> <dl> <dt> <code>metric</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The routing metric for the interface.</p> </dd> </dl> <dl> <dt> <code>mtu</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The maximum transmission unit (MTU) for the network interface.</p> </dd> </dl> <dl> <dt> <code>network</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The address for the network interface.</p> </dd> </dl> <dl> <dt> <code>onboot</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Bring up the network interface on boot.</p> </dd> </dl> <dl> <dt> <code>onparent</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Bring up the network interface when its parent interface is brought up.</p> </dd> </dl> <dl> <dt> <code>slave</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>When set to <code>yes</code>, this device is controlled by the channel bonding interface that is specified via the <code>master</code> property.</p> <p> New in Chef Client 13.4 </p> </dd> </dl> <dl> <dt> <code>target</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The IP address that is to be assigned to the network interface. If not specified we’ll use the resource’s name.</p> </dd> </dl> <dl> <dt> <code>vlan</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The VLAN to assign the interface to.</p> <p> New in Chef Client 14.4 </p> </dd> </dl> <br> <h3 id="functionality-ifconfig">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-ifconfig">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-ifconfig">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-ifconfig">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-ifconfig">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>ifconfig</strong> resource in recipes:</p> <p><strong>Configure a network interface with a static IP</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ifconfig <span style="color:#4070a0">'33.33.33.80'</span> <span style="color:#007020;font-weight:700">do</span>
  device <span style="color:#4070a0">'eth1'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>will create the following interface configuration:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code>iface eth1 inet static
  address 33.33.33.80
</code></pre>
<p><strong>Configure an interface to use DHCP</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ifconfig <span style="color:#4070a0">'Set eth1 to DHCP'</span> <span style="color:#007020;font-weight:700">do</span>
  device <span style="color:#4070a0">'eth1'</span>
  bootproto <span style="color:#4070a0">'dhcp'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>will create the following interface configuration:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code>iface eth1 inet dhcp
</code></pre>
<p><strong>Update a static IP address with a boot protocol</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ifconfig <span style="color:#4070a0">"33.33.33.80"</span> <span style="color:#007020;font-weight:700">do</span>
  bootproto <span style="color:#4070a0">"dhcp"</span>
  device <span style="color:#4070a0">"eth1"</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>will update the interface configuration from static to dhcp:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code>iface eth1 inet dhcp
  address 33.33.33.80
</code></pre> <h2 id="inspec-input-resource">inspec_input resource</h2> <a href="inspec_input/index.html">inspec_input resource page</a> <hr> <p>Use the <strong>inspec_input</strong> resource to add an input to the Compliance Phase.</p> <p><strong>New in Chef Infra Client 17.5.</strong></p> <h3 id="syntax-inspec-input">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>inspec_input</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">inspec_input <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  input       <span style="color:#60add5">Hash</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  source      <span style="color:#60add5">Hash</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>inspec_input</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>input</code> and <code>source</code> are the properties available to this resource.</li> </ul> <h3 id="actions-inspec-input">Actions</h3> <hr> <p>The <strong>inspec_input</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Add an input to the compliance phase (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-inspec-input">Properties</h3> <hr> <p>The <strong>inspec_input</strong> resource has the following properties:</p> <dl> <dt> <code>input</code> </dt> <dd> <strong>Ruby Type:</strong> Hash, String | <strong>Default Value:</strong> <code>The resource block's name</code>  </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> Hash, String | <strong>Default Value:</strong> <code>The resource block's name</code>  </dd> </dl> <br> <h3 id="functionality-inspec-input">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-inspec-input">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-inspec-input">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-inspec-input">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-inspec-input">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>inspec_input</strong> resource in recipes:</p> <p><strong>Activate the default input in the openssh cookbook’s compliance segment</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_input <span style="color:#4070a0">'openssh'</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:add</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Activate all inputs in the openssh cookbook’s compliance segment</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_input <span style="color:#4070a0">'openssh::.*'</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:add</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add an InSpec input to the Compliance Phase from a hash</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_input { <span style="color:#517918">ssh_custom_path</span>: <span style="color:#4070a0">'/whatever2'</span> }
</code></pre></div>
<p><strong>Add an InSpec input to the Compliance Phase using the ‘name’ property to identify the input</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_input <span style="color:#4070a0">"setting my input"</span> <span style="color:#007020;font-weight:700">do</span>
    source( { <span style="color:#517918">ssh_custom_path</span>: <span style="color:#4070a0">'/whatever2'</span> })
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add an InSpec input to the Compliance Phase using a TOML, JSON, or YAML file</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_input <span style="color:#4070a0">"/path/to/my/input.yml"</span>
</code></pre></div>
<p><strong>Add an InSpec input to the Compliance Phase using a TOML, JSON, or YAML file, using the ‘name’ property</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_input <span style="color:#4070a0">"setting my input"</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">"/path/to/my/input.yml"</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Note that the <strong>inspec_input</strong> resource does not update and will not fire notifications (similar to the log resource). This is done to preserve the ability to use the resource while not causing the updated resource count to be larger than zero. Since the resource does not update the state of the managed node, this behavior is still consistent with the configuration management model. Instead, you should use events to observe configuration changes for the compliance phase. It is possible to use the <code>notify_group</code> resource to chain notifications of the two resources, but notifications are the wrong model to use, and you should use pure ruby conditionals instead. Compliance configuration should be independent of other resources and should only be conditional based on state/attributes, not other resources.</p> <h2 id="inspec-waiver-resource">inspec_waiver resource</h2> <a href="inspec_waiver/index.html">inspec_waiver resource page</a> <hr> <p>Use the <strong>inspec_waiver</strong> resource to add a waiver to the Compliance Phase.</p> <p><strong>New in Chef Infra Client 17.5.</strong></p> <h3 id="syntax-inspec-waiver">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>inspec_waiver</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">inspec_waiver <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  control            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  expiration         <span style="color:#007020">String</span>
  justification      <span style="color:#007020">String</span>
  run_test           <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  source             <span style="color:#60add5">Hash</span>, <span style="color:#007020">String</span>
  action             <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>inspec_waiver</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>control</code>, <code>expiration</code>, <code>justification</code>, <code>run_test</code>, and <code>source</code> are the properties available to this resource.</li> </ul> <h3 id="actions-inspec-waiver">Actions</h3> <hr> <p>The <strong>inspec_waiver</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Add a waiver to the compliance phase (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-inspec-waiver">Properties</h3> <hr> <p>The <strong>inspec_waiver</strong> resource has the following properties:</p> <dl> <dt> <code>control</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the control being waived</p> </dd> </dl> <dl> <dt> <code>expiration</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The expiration date of the waiver - provided in YYYY-MM-DD format</p> </dd> </dl> <dl> <dt> <code>justification</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Can be any text you want and might include a reason for the waiver as well as who signed off on the waiver.</p> </dd> </dl> <dl> <dt> <code>run_test</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>If present and true, the control will run and be reported, but failures in it won’t make the overall run fail. If absent or false, the control will not be run.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> Hash, String  </dd> </dl> <br> <h3 id="functionality-inspec-waiver">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-inspec-waiver">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-inspec-waiver">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-inspec-waiver">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-inspec-waiver">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>inspec_waiver</strong> resource in recipes:</p> <p><strong>Activate the default waiver in the openssh cookbook’s compliance segment</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_waiver <span style="color:#4070a0">'openssh'</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:add</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Activate all waivers in the openssh cookbook’s compliance segment</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_waiver <span style="color:#4070a0">'openssh::.*'</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:add</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add an InSpec waiver to the Compliance Phase</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_waiver <span style="color:#4070a0">'Add waiver entry for control'</span> <span style="color:#007020;font-weight:700">do</span>
    control <span style="color:#4070a0">'my_inspec_control_01'</span>
    run_test <span style="color:#007020">false</span>
    justification <span style="color:#4070a0">"The subject of this control is not managed by Chef Infra Client on the systems in policy group </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'policy_group'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
    expiration <span style="color:#4070a0">'2022-01-01'</span>
    action <span style="color:#517918">:add</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add an InSpec waiver to the Compliance Phase using the ‘name’ property to identify the control</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_waiver <span style="color:#4070a0">'my_inspec_control_01'</span> <span style="color:#007020;font-weight:700">do</span>
    justification <span style="color:#4070a0">"The subject of this control is not managed by Chef Infra Client on the systems in policy group </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'policy_group'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
    action <span style="color:#517918">:add</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add an InSpec waiver to the Compliance Phase using an arbitrary YAML, JSON, or TOML file</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  <span style="color:#60a0b0;font-style:italic"># files ending in .yml or .yaml that exist are parsed as YAML</span>
  inspec_waiver <span style="color:#4070a0">"/path/to/my/waiver.yml"</span>

  inspec_waiver <span style="color:#4070a0">"my-waiver-name"</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">"/path/to/my/waiver.yml"</span>
  <span style="color:#007020;font-weight:700">end</span>

  <span style="color:#60a0b0;font-style:italic"># files ending in .json that exist are parsed as JSON</span>
  inspec_waiver <span style="color:#4070a0">"/path/to/my/waiver.json"</span>

  inspec_waiver <span style="color:#4070a0">"my-waiver-name"</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">"/path/to/my/waiver.json"</span>
  <span style="color:#007020;font-weight:700">end</span>

  <span style="color:#60a0b0;font-style:italic"># files ending in .toml that exist are parsed as TOML</span>
  inspec_waiver <span style="color:#4070a0">"/path/to/my/waiver.toml"</span>

  inspec_waiver <span style="color:#4070a0">"my-waiver-name"</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">"/path/to/my/waiver.toml"</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add an InSpec waiver to the Compliance Phase using a hash</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  my_hash <span style="color:#666">=</span> { <span style="color:#4070a0">"ssh-01"</span> <span style="color:#666">=&gt;</span> {
    <span style="color:#4070a0">"expiration_date"</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"2033-07-31"</span>,
    <span style="color:#4070a0">"run"</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">false</span>,
    <span style="color:#4070a0">"justification"</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"because"</span>
  } }

  inspec_waiver <span style="color:#4070a0">"my-waiver-name"</span> <span style="color:#007020;font-weight:700">do</span>
    source my_hash
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Note that the <strong>inspec_waiver</strong> resource does not update and will not fire notifications (similar to the log resource). This is done to preserve the ability to use the resource while not causing the updated resource count to be larger than zero. Since the resource does not update the state of the managed node, this behavior is still consistent with the configuration management model. Instead, you should use events to observe configuration changes for the compliance phase. It is possible to use the <code>notify_group</code> resource to chain notifications of the two resources, but notifications are the wrong model to use, and you should use pure ruby conditionals instead. Compliance configuration should be independent of other resources and should only be conditional based on state/attributes, not other resources.</p> <h2 id="inspec-waiver-file-entry-resource">inspec_waiver_file_entry resource</h2> <a href="inspec_waiver_file_entry/index.html">inspec_waiver_file_entry resource page</a> <hr> <p>Use the <strong>inspec_waiver_file_entry</strong> resource to add or remove entries from an InSpec waiver file. This can be used in conjunction with the Compliance Phase.</p> <p><strong>New in Chef Infra Client 17.1.</strong></p> <h3 id="syntax-inspec-waiver-file-entry">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>inspec_waiver_file_entry</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">inspec_waiver_file_entry <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  backup             <span style="color:#007020">false</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  control            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  expiration         <span style="color:#007020">String</span>
  file_path          <span style="color:#007020">String</span>
  justification      <span style="color:#007020">String</span>
  run_test           <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  action             <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>inspec_waiver_file_entry</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>backup</code>, <code>control</code>, <code>expiration</code>, <code>file_path</code>, <code>justification</code>, and <code>run_test</code> are the properties available to this resource.</li> </ul> <h3 id="actions-inspec-waiver-file-entry">Actions</h3> <hr> <p>The <strong>inspec_waiver_file_entry</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>(default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt>  </dl> <h3 id="properties-inspec-waiver-file-entry">Properties</h3> <hr> <p>The <strong>inspec_waiver_file_entry</strong> resource has the following properties:</p> <dl> <dt> <code>backup</code> </dt> <dd> <strong>Ruby Type:</strong> false, Integer | <strong>Default Value:</strong> <code>false</code> <p>The number of backups to be kept in <code>/var/chef/backup</code> (for UNIX- and Linux-based platforms) or <code>C:/chef/backup</code> (for the Microsoft Windows platform). Set to <code>false</code> to prevent backups from being kept.</p> </dd> </dl> <dl> <dt> <code>control</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the control being added or removed to the waiver file</p> </dd> </dl> <dl> <dt> <code>expiration</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The expiration date of the given waiver - provided in YYYY-MM-DD format</p> </dd> </dl> <dl> <dt> <code>file_path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>`/etc/chef/inspec_waivers.yml` on Linux/Unix and `C:\chef\inspec_waivers.yml` on Windows</code> | <code>REQUIRED</code> <p>The path to the waiver file being modified</p> </dd> </dl> <dl> <dt> <code>justification</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Can be any text you want and might include a reason for the waiver as well as who signed off on the waiver.</p> </dd> </dl> <dl> <dt> <code>run_test</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>If present and <code>true</code>, the control will run and be reported, but failures in it won’t make the overall run fail. If absent or <code>false</code>, the control will not be run.</p> </dd> </dl> <br> <h3 id="functionality-inspec-waiver-file-entry">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-inspec-waiver-file-entry">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-inspec-waiver-file-entry">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-inspec-waiver-file-entry">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-inspec-waiver-file-entry">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>inspec_waiver_file_entry</strong> resource in recipes:</p> <p><strong>Add an InSpec waiver entry to a given waiver file</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_waiver_file_entry <span style="color:#4070a0">'Add waiver entry for control'</span> <span style="color:#007020;font-weight:700">do</span>
    file_path <span style="color:#4070a0">'C:\chef\inspec_waiver_file.yml'</span>
    control <span style="color:#4070a0">'my_inspec_control_01'</span>
    run_test <span style="color:#007020">false</span>
    justification <span style="color:#4070a0">"The subject of this control is not managed by Chef Infra Client on the systems in policy group </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'policy_group'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
    expiration <span style="color:#4070a0">'2022-01-01'</span>
    action <span style="color:#517918">:add</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add an InSpec waiver entry to a given waiver file using the ‘name’ property to identify the control</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_waiver_file_entry <span style="color:#4070a0">'my_inspec_control_01'</span> <span style="color:#007020;font-weight:700">do</span>
    justification <span style="color:#4070a0">"The subject of this control is not managed by Chef Infra Client on the systems in policy group </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'policy_group'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
    action <span style="color:#517918">:add</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove an InSpec waiver entry to a given waiver file</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  inspec_waiver_file_entry <span style="color:#4070a0">"my_inspec_control_01"</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:remove</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="ips-package-resource">ips_package resource</h2> <a href="ips_package/index.html">ips_package resource page</a> <hr> <p>Use the <strong>ips_package</strong> resource to manage packages (using Image Packaging System (IPS)) on the Solaris 11 platform.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <h3 id="syntax-ips-package">Syntax</h3> <hr> 
<p>A <strong>ips_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>ips_package</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ips_package <span style="color:#4070a0">'package_name'</span>
</code></pre></div>
<p>which will install the named package using all of the default options and the default action (<code>:install</code>).</p> <p>The full syntax for all of the properties that are available to the <strong>ips_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ips_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  accept_license             <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  options                    <span style="color:#007020">String</span>
  package_name               <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  source                     <span style="color:#007020">String</span>
  timeout                    <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version                    <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>ips_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>accept_license</code>, <code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-ips-package">Actions</h3> <hr> <p>The <strong>ips_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install a package. If a version is specified, install the specified version of the package. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-ips-package">Properties</h3> <hr> <p>The <strong>ips_package</strong> resource has the following properties:</p> <dl> <dt> <code>accept_license</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Accept an end-user license agreement, automatically.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-ips-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-ips-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-ips-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-ips-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-ips-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>ips_package</strong> resource in recipes:</p> <p>Install a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ips_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="kernel-module-resource">kernel_module resource</h2> <a href="kernel_module/index.html">kernel_module resource page</a> <hr> <p>Use the <strong>kernel_module</strong> resource to manage kernel modules on Linux systems. This resource can load, unload, blacklist, disable, enable, install, and uninstall modules.</p> <p><strong>New in Chef Infra Client 14.3.</strong></p> <h3 id="syntax-kernel-module">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>kernel_module</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">kernel_module <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  load_dir        <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/etc/modules-load.d"</span>
  modname         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  options         <span style="color:#007020">Array</span>
  unload_dir      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/etc/modprobe.d"</span>
  action          <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>kernel_module</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>load_dir</code>, <code>modname</code>, <code>options</code>, and <code>unload_dir</code> are the properties available to this resource.</li> </ul> <h3 id="actions-kernel-module">Actions</h3> <hr> <p>The <strong>kernel_module</strong> resource has the following actions:</p> <dl> <dt><code>:blacklist</code></dt> <dd>Blacklist a kernel module.</dd> <dt><code>:disable</code></dt> <dd>Disable a kernel module. <strong>New in Chef Infra Client 15.2.</strong>
</dd> <dt><code>:enable</code></dt> <dd>Enable a kernel module. Reverse :disable actions</dd> <dt><code>:install</code></dt> <dd>Load kernel module, and ensure it loads on reboot. (default)</dd> <dt><code>:load</code></dt> <dd>Load a kernel module.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:uninstall</code></dt> <dd>Unload a kernel module and remove module config, so it doesn’t load on reboot.</dd> <dt><code>:unload</code></dt> <dd>Unload kernel module.</dd> </dl> <h3 id="properties-kernel-module">Properties</h3> <hr> <p>The <strong>kernel_module</strong> resource has the following properties:</p> <dl> <dt> <code>load_dir</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/etc/modules-load.d</code> <p>The directory to load modules from.</p> </dd> </dl> <dl> <dt> <code>modname</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the kernel module name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> Array <p>An optional property to set options for the kernel module.</p> <p> New in Chef Infra Client 15.4 </p> </dd> </dl> <dl> <dt> <code>unload_dir</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/etc/modprobe.d</code> <p>The modprobe.d directory.</p> </dd> </dl> <br> <h3 id="functionality-kernel-module">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-kernel-module">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-kernel-module">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-kernel-module">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-kernel-module">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>kernel_module</strong> resource in recipes:</p> <p>Install and load a kernel module, and ensure it loads on reboot.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">kernel_module <span style="color:#4070a0">'loop'</span>
</code></pre></div>
<p>Install and load a kernel with a specific set of options, and ensure it loads on reboot. Consult kernel module documentation for specific options that are supported.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">kernel_module <span style="color:#4070a0">'loop'</span> <span style="color:#007020;font-weight:700">do</span>
  options <span style="color:#666">[</span>
    <span style="color:#4070a0">'max_loop=4'</span>,
    <span style="color:#4070a0">'max_part=8'</span>,
  <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Load a kernel module.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">kernel_module <span style="color:#4070a0">'loop'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:load</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Unload a kernel module and remove module config, so it doesn’t load on reboot.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">kernel_module <span style="color:#4070a0">'loop'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:uninstall</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Unload kernel module.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">kernel_module <span style="color:#4070a0">'loop'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:unload</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Blacklist a module from loading.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">kernel_module <span style="color:#4070a0">'loop'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:blacklist</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Disable a kernel module so that it is not installable.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">kernel_module <span style="color:#4070a0">'loop'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:disable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Enable a kernel module so that it is can be installed. Does not load or install.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">kernel_module <span style="color:#4070a0">'loop'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="ksh-resource">ksh resource</h2> <a href="ksh/index.html">ksh resource page</a> <hr> <p>Use the <strong>ksh</strong> resource to execute scripts using the Korn shell (ksh) interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <code>not_if</code> and <code>only_if</code> to guard this resource for idempotence.</p> <h3 id="syntax-ksh">Syntax</h3> <hr> 
<p>A <strong>ksh</strong> resource block executes scripts using ksh:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ksh <span style="color:#4070a0">'hello world'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    echo <span style="color:#4070a0">"Hello world!"</span>
    echo <span style="color:#4070a0">"Current directory: "</span> $cwd
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>code</code> specifies the command to run</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>ksh</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ksh <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  code                       <span style="color:#007020">String</span>
  creates                    <span style="color:#007020">String</span>
  cwd                        <span style="color:#007020">String</span>
  environment                <span style="color:#60add5">Hash</span>
  flags                      <span style="color:#007020">String</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                       <span style="color:#007020">Array</span>
  returns                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span>
  timeout                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Float</span>
  user                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  umask                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>ksh</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>code</code>, <code>creates</code>, <code>cwd</code>, <code>environment</code>, <code>flags</code>, <code>group</code>, <code>path</code>, <code>returns</code>, <code>timeout</code>, <code>user</code>, and <code>umask</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-ksh">Actions</h3> <hr> <p>The <strong>ksh</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>Prevent a command from running. This action is used to specify that a command is run only when another resource notifies it.</dd> <dt><code>:run</code></dt> <dd>Default. Run a script.</dd> </dl> <h3 id="properties-ksh">Properties</h3> <hr> <p>The <strong>ksh</strong> resource has the following properties:</p> <dl> <dt> <code>code</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A quoted (" “) string of code to be executed.</p> </dd> </dl> <dl> <dt> <code>creates</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Prevent a command from creating a file when that file already exists.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The current working directory from which the command will be run.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of environment variables in the form of <code>({'ENV_VARIABLE' =&gt; 'VALUE'})</code>. <strong>Note</strong>: These variables must exist for a command to be run successfully.</p> </dd> </dl> <dl> <dt> <code>flags</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One or more command line flags that are passed to the interpreter when a command is invoked.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group name or group ID that must be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>returns</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Array | <strong>Default Value:</strong> <code>0</code> <p>The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String, Float | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) a command is to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The user name or user ID that should be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>umask</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The file mode creation mask, or umask.</p> </dd> </dl> <br> <h3 id="functionality-ksh">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-ksh">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-ksh">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-ksh">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-ksh">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="launchd-resource">launchd resource</h2> <a href="launchd/index.html">launchd resource page</a> <hr> <p>Use the <strong>launchd</strong> resource to manage system-wide services (daemons) and per-user services (agents) on the macOS platform.</p> <p><strong>New in Chef Infra Client 12.8.</strong></p> <h3 id="syntax-launchd">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>launchd</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">launchd <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  abandon_process_group           <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  backup                          <span style="color:#007020">Integer</span>, <span style="color:#007020">false</span>
  cookbook                        <span style="color:#007020">String</span>
  debug                           <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  disabled                        <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  enable_globbing                 <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  enable_transactions             <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  environment_variables           <span style="color:#60add5">Hash</span>
  exit_timeout                    <span style="color:#007020">Integer</span>
  group                           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  hard_resource_limits            <span style="color:#60add5">Hash</span>
  inetd_compatibility             <span style="color:#60add5">Hash</span>
  init_groups                     <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  keep_alive                      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>, <span style="color:#60add5">Hash</span>
  label                           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  launch_events                   <span style="color:#60add5">Hash</span>
  launch_only_once                <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  ld_group                        <span style="color:#007020">String</span>
  limit_load_from_hosts           <span style="color:#007020">Array</span>
  limit_load_to_hosts             <span style="color:#007020">Array</span>
  limit_load_to_session_type      <span style="color:#007020">Array</span>, <span style="color:#007020">String</span>
  low_priority_io                 <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  mach_services                   <span style="color:#60add5">Hash</span>
  mode                            <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  nice                            <span style="color:#007020">Integer</span>
  on_demand                       <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  owner                           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                            <span style="color:#007020">String</span>
  plist_hash                      <span style="color:#60add5">Hash</span>
  process_type                    <span style="color:#007020">String</span>
  program                         <span style="color:#007020">String</span>
  program_arguments               <span style="color:#007020">Array</span>
  queue_directories               <span style="color:#007020">Array</span>
  root_directory                  <span style="color:#007020">String</span>
  run_at_load                     <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  session_type                    <span style="color:#007020">String</span>
  sockets                         <span style="color:#60add5">Hash</span>
  soft_resource_limits            <span style="color:#007020">Array</span>
  source                          <span style="color:#007020">String</span>
  standard_error_path             <span style="color:#007020">String</span>
  standard_in_path                <span style="color:#007020">String</span>
  standard_out_path               <span style="color:#007020">String</span>
  start_calendar_interval         <span style="color:#60add5">Hash</span>, <span style="color:#007020">Array</span>
  start_interval                  <span style="color:#007020">Integer</span>
  start_on_mount                  <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  throttle_interval               <span style="color:#007020">Integer</span>
  time_out                        <span style="color:#007020">Integer</span>
  type                            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "daemon"</span>
  username                        <span style="color:#007020">String</span>
  wait_for_debugger               <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  watch_paths                     <span style="color:#007020">Array</span>
  working_directory               <span style="color:#007020">String</span>
  action                          <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>launchd</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>abandon_process_group</code>, <code>backup</code>, <code>cookbook</code>, <code>debug</code>, <code>disabled</code>, <code>enable_globbing</code>, <code>enable_transactions</code>, <code>environment_variables</code>, <code>exit_timeout</code>, <code>group</code>, <code>hard_resource_limits</code>, <code>inetd_compatibility</code>, <code>init_groups</code>, <code>keep_alive</code>, <code>label</code>, <code>launch_events</code>, <code>launch_only_once</code>, <code>ld_group</code>, <code>limit_load_from_hosts</code>, <code>limit_load_to_hosts</code>, <code>limit_load_to_session_type</code>, <code>low_priority_io</code>, <code>mach_services</code>, <code>mode</code>, <code>nice</code>, <code>on_demand</code>, <code>owner</code>, <code>path</code>, <code>plist_hash</code>, <code>process_type</code>, <code>program</code>, <code>program_arguments</code>, <code>queue_directories</code>, <code>root_directory</code>, <code>run_at_load</code>, <code>session_type</code>, <code>sockets</code>, <code>soft_resource_limits</code>, <code>source</code>, <code>standard_error_path</code>, <code>standard_in_path</code>, <code>standard_out_path</code>, <code>start_calendar_interval</code>, <code>start_interval</code>, <code>start_on_mount</code>, <code>throttle_interval</code>, <code>time_out</code>, <code>type</code>, <code>username</code>, <code>wait_for_debugger</code>, <code>watch_paths</code>, and <code>working_directory</code> are the properties available to this resource.</li> </ul> <h3 id="actions-launchd">Actions</h3> <hr> <p>The <strong>launchd</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create a launchd property list. (default)</dd> <dt><code>:create_if_missing</code></dt> <dd>Create a launchd property list, if it does not already exist.</dd> <dt><code>:delete</code></dt> <dd>Delete a launchd property list. This will unload a daemon or agent, if loaded.</dd> <dt><code>:disable</code></dt> <dd>Disable a launchd property list.</dd> <dt><code>:enable</code></dt> <dd>Create a launchd property list, and then ensure that it is enabled. If a launchd property list already exists, but does not match, updates the property list to match, and then restarts the daemon or agent.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:restart</code></dt> <dd>Restart a launchd managed daemon or agent.</dd> </dl> <h3 id="properties-launchd">Properties</h3> <hr> <p>The <strong>launchd</strong> resource has the following properties:</p> <dl> <dt> <code>abandon_process_group</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>If a job dies, all remaining processes with the same process ID may be kept running. Set to true to kill all remaining processes.</p> </dd> </dl> <dl> <dt> <code>backup</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, false <p>The number of backups to be kept in <code>/var/chef/backup</code>. Set to <code>false</code> to prevent backups from being kept.</p> </dd> </dl> <dl> <dt> <code>cookbook</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of the cookbook in which the source files are located.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>When launchd is run as the root user, the group to run the job as. If the <code>username</code> property is specified and this property is not, this value is set to the default group for the user.</p> </dd> </dl> <dl> <dt> <code>label</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The unique identifier for the job.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>'0755'</code> <p>A quoted 3-5 character string that defines the octal mode. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>A string or ID that identifies the group owner by user name, including fully qualified user names such as <code>domain\user</code> or <code>user@domain</code>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to the directory. Using a fully qualified path is recommended, but is not always required. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <dl> <dt> <code>plist_hash</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of key value pairs used to create the launchd property list.</p> </dd> </dl> <dl> <dt> <code>session_type</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The type of launchd plist to be created. Possible values: <code>system</code> (default) or <code>user</code>.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to the launchd property list.</p> </dd> </dl> <dl> <dt> <code>type</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The type of resource. Possible values: <code>daemon</code> (default), <code>agent</code>.</p> </dd> </dl> <dl> <dt> <code>abandon_process_group</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>If a job dies, all remaining processes with the same process ID may be kept running. Set to true to kill all remaining processes.</p> </dd> </dl> <dl> <dt> <code>debug</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Sets the log mask to <code>LOG_DEBUG</code> for this job.</p> </dd> </dl> <dl> <dt> <code>disabled</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Hints to <code>launchctl</code> to not submit this job to launchd.</p> </dd> </dl> <dl> <dt> <code>enable_globbing</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Update program arguments before invocation.</p> </dd> </dl> <dl> <dt> <code>enable_transactions</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Track in-progress transactions; if none, then send the <code>SIGKILL</code> signal.</p> </dd> </dl> <dl> <dt> <code>environment_variables</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>Additional environment variables to set before running a job.</p> </dd> </dl> <dl> <dt> <code>exit_timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The amount of time (in seconds) launchd waits before sending a <code>SIGKILL</code> signal.</p> </dd> </dl> <dl> <dt> <code>hard_resource_limits</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of resource limits to be imposed on a job.</p> </dd> </dl> <dl> <dt> <code>inetd_compatibility</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>Specifies if a daemon expects to be run as if it were launched from inetd. Set to <code>wait =&gt; true</code> to pass standard input, output, and error file descriptors. Set to <code>wait =&gt; false</code> to call the accept system call on behalf of the job, and then pass standard input, output, and error file descriptors.</p> </dd> </dl> <dl> <dt> <code>init_groups</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Specify if <code>initgroups</code> is called before running a job.</p> </dd> </dl> <dl> <dt> <code>keep_alive</code> </dt> <dd> <strong>Ruby Type:</strong> true, false, Hash <p>Keep a job running continuously (true) or allow demand and conditions on the node to determine if the job keeps running (<code>false</code>).</p> <p> New in Chef Client 12.14 </p> </dd> </dl> <dl> <dt> <code>launch_events</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>Specify higher-level event types to be used as launch-on-demand event sources.</p> <p> New in Chef Infra Client 15.1 </p> </dd> </dl> <dl> <dt> <code>launch_only_once</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Specify if a job can be run only one time. Set this value to true if a job cannot be restarted without a full machine reboot.</p> </dd> </dl> <dl> <dt> <code>limit_load_from_hosts</code> </dt> <dd> <strong>Ruby Type:</strong> Array <p>An array of hosts to which this configuration file does not apply, i.e. ‘apply this configuration file to all hosts not specified in this array’.</p> </dd> </dl> <dl> <dt> <code>limit_load_to_hosts</code> </dt> <dd> <strong>Ruby Type:</strong> Array <p>An array of hosts to which this configuration file applies.</p> </dd> </dl> <dl> <dt> <code>limit_load_to_session_type</code> </dt> <dd> <strong>Ruby Type:</strong> Array, String <p>The session type(s) to which this configuration file applies.</p> </dd> </dl> <dl> <dt> <code>low_priority_io</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Specify if the kernel on the node should consider this daemon to be low priority during file system I/O.</p> </dd> </dl> <dl> <dt> <code>mach_services</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>Specify services to be registered with the bootstrap subsystem.</p> </dd> </dl> <dl> <dt> <code>nice</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The program scheduling priority value in the range -20 to 19.</p> </dd> </dl> <dl> <dt> <code>on_demand</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Keep a job alive. Only applies to macOS version 10.4 (and earlier); use <code>keep_alive</code> instead for newer versions.</p> </dd> </dl> <dl> <dt> <code>process_type</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The intended purpose of the job: <code>Adaptive</code>, <code>Background</code>, <code>Interactive</code>, or <code>Standard</code>.</p> </dd> </dl> <dl> <dt> <code>program</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The first argument of <code>execvp</code>, typically the file name associated with the file to be executed. This value must be specified if <code>program_arguments</code> is not specified, and vice-versa.</p> </dd> </dl> <dl> <dt> <code>program_arguments</code> </dt> <dd> <strong>Ruby Type:</strong> Array <p>The second argument of <code>execvp</code>. If program is not specified, this property must be specified and will be handled as if it were the first argument.</p> </dd> </dl> <dl> <dt> <code>queue_directories</code> </dt> <dd> <strong>Ruby Type:</strong> Array <p>An array of non-empty directories which, if any are modified, will cause a job to be started.</p> </dd> </dl> <dl> <dt> <code>root_directory</code> </dt> <dd> <strong>Ruby Type:</strong> String <p><code>chroot</code> to this directory, and then run the job.</p> </dd> </dl> <dl> <dt> <code>run_at_load</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Launch a job once (at the time it is loaded).</p> </dd> </dl> <dl> <dt> <code>sockets</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of on-demand sockets that notify launchd when a job should be run.</p> </dd> </dl> <dl> <dt> <code>soft_resource_limits</code> </dt> <dd> <strong>Ruby Type:</strong> Array <p>A Hash of resource limits to be imposed on a job.</p> </dd> </dl> <dl> <dt> <code>standard_error_path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The file to which standard error (<code>stderr</code>) is sent.</p> </dd> </dl> <dl> <dt> <code>standard_in_path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The file to which standard input (<code>stdin</code>) is sent.</p> </dd> </dl> <dl> <dt> <code>standard_out_path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The file to which standard output (<code>stdout</code>) is sent.</p> </dd> </dl> <dl> <dt> <code>start_calendar_interval</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash (similar to <code>crontab</code>) that defines the calendar frequency at which a job is started. For example: <code>{ Minute =&gt; "0", Hour =&gt; "20", Day =&gt; "*", Weekday =&gt; "1-5", Month =&gt; "*" }</code> will run a job at 8:00 PM every day, Monday through Friday, every month of the year.</p> </dd> </dl> <dl> <dt> <code>start_interval</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The frequency (in seconds) at which a job is started.</p> </dd> </dl> <dl> <dt> <code>start_on_mount</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Start a job every time a file system is mounted.</p> </dd> </dl> <dl> <dt> <code>throttle_interval</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>10</code> <p>The frequency (in seconds) at which jobs are allowed to spawn.</p> </dd> </dl> <dl> <dt> <code>time_out</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The amount of time (in seconds) a job may be idle before it times out. If no value is specified, the default timeout value for launchd will be used.</p> </dd> </dl> <dl> <dt> <code>username</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>When launchd is run as the root user, the user to run the job as.</p> </dd> </dl> <dl> <dt> <code>wait_for_debugger</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Specify if launchd has a job wait for a debugger to attach before executing code.</p> </dd> </dl> <dl> <dt> <code>watch_paths</code> </dt> <dd> <strong>Ruby Type:</strong> Array <p>An array of paths which, if any are modified, will cause a job to be started.</p> </dd> </dl> <dl> <dt> <code>working_directory</code> </dt> <dd> <strong>Ruby Type:</strong> String <p><code>chdir</code> to this directory, and then run the job.</p> </dd> </dl> <br> <h3 id="functionality-launchd">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-launchd">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-launchd">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-launchd">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-launchd">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>launchd</strong> resource in recipes:</p> <p>Create a Launch Daemon from a cookbook file</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">launchd <span style="color:#4070a0">'com.chef.every15'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'com.chef.every15.plist'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create a Launch Daemon using keys</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">launchd <span style="color:#4070a0">'call.mom.weekly'</span> <span style="color:#007020;font-weight:700">do</span>
  program <span style="color:#4070a0">'/Library/scripts/call_mom.sh'</span>
  start_calendar_interval <span style="color:#4070a0">'Weekday'</span> <span style="color:#666">=&gt;</span> <span style="color:#40a070">7</span>, <span style="color:#4070a0">'Hourly'</span> <span style="color:#666">=&gt;</span> <span style="color:#40a070">10</span>
  time_out <span style="color:#40a070">300</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Remove a Launch Daemon</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">launchd <span style="color:#4070a0">'com.chef.every15'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="link-resource">link resource</h2> <a href="link/index.html">link resource page</a> <hr> 
<p>Use the <strong>link</strong> resource to create symbolic or hard links.</p> <p>A symbolic link—sometimes referred to as a soft link—is a directory entry that associates a file name with a string that contains an absolute or relative path to a file on any file system. In other words, “a file that contains a path that points to another file.” A symbolic link creates a new file with a new inode that points to the inode location of the original file.</p> <p>A hard link is a directory entry that associates a file with another file in the same file system. In other words, “multiple directory entries to the same file.” A hard link creates a new file that points to the same inode as the original file. On Windows, this resource can be used to create directory junction/reparse points.</p> <h3 id="syntax-link">Syntax</h3> <hr> 
<p>A <strong>link</strong> resource block creates symbolic or hard links. For example, to create a hard link from <code>/tmp/file</code> to <code>/etc/file</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">link <span style="color:#4070a0">'/tmp/file'</span> <span style="color:#007020;font-weight:700">do</span>
  to <span style="color:#4070a0">'/etc/file'</span>
  link_type <span style="color:#517918">:hard</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Because the default value for <code>link_type</code> is symbolic, and because properties that are not specified in the resource block will be assigned their default values, the following example creates a symbolic link:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">link <span style="color:#4070a0">'/tmp/file'</span> <span style="color:#007020;font-weight:700">do</span>
  to <span style="color:#4070a0">'/etc/file'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>The full syntax for all of the properties that are available to the <strong>link</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">link <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  group            <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  link_type        <span style="color:#007020">String</span>, <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :symbolic</span>
  mode             <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>
  owner            <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  target_file      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  to               <span style="color:#007020">String</span>
  action           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>link</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>group</code>, <code>link_type</code>, <code>mode</code>, <code>owner</code>, <code>target_file</code>, and <code>to</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-link">Actions</h3> <hr> <p>The <strong>link</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Create a link. If a link already exists (but does not match), update that link to match.</dd> <dt><code>:delete</code></dt> <dd>Delete a link.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-link">Properties</h3> <hr> <p>The <strong>link</strong> resource has the following properties:</p> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>A group name or ID number that identifies the group associated with a symbolic link.</p> </dd> </dl> <dl> <dt> <code>link_type</code> </dt> <dd> <strong>Ruby Type:</strong> String, Symbol | <strong>Default Value:</strong> <code>:symbolic</code> <strong>Allowed Values:</strong> <code>:hard, :symbolic</code> <p>The type of link: <code>:symbolic</code> or <code>:hard</code>. On Windows, <code>:symbolic</code> will create a junction point if the target is a directory.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>777</code> 
<p>If <code>mode</code> is not specified and if the file already exists, the existing mode on the file is used. If <code>mode</code> is not specified, the file does not exist, and the <code>:create</code> action is specified, Chef Infra Client assumes a mask value of <code>'0777'</code> and then applies the umask for the system on which the file is to be created to the <code>mask</code> value. For example, if the umask on a system is <code>'022'</code>, Chef Infra Client uses the default value of <code>'0755'</code>.</p> <p>The behavior is different depending on the platform.</p> <p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If the value is specified as a quoted string, it works exactly as if the <code>chmod</code> command was passed. If the value is specified as an integer, prepend a zero (<code>0</code>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <code>'0777'</code> or <code>'777'</code>; for the same rights, plus the sticky bit, use <code>01777</code> or <code>'1777'</code>.</p> <p>Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. Values up to <code>'0777'</code> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <code>4</code> equals <code>GENERIC_READ</code>, <code>2</code> equals <code>GENERIC_WRITE</code>, and <code>1</code> equals <code>GENERIC_EXECUTE</code>. This property cannot be used to set <code>:full_control</code>. This property has no effect if not specified, but when it and <code>rights</code> are both specified, the effects are cumulative.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The owner associated with a symbolic link.</p> </dd> </dl> <dl> <dt> <code>target_file</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the target file if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>to</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The actual file to which the link is to be created.</p> </dd> </dl> <br> <h3 id="functionality-link">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-link">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-link">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-link">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-link">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>link</strong> resource in recipes:</p> <p>Create symbolic links</p> <p>The following example will create a symbolic link from <code>/tmp/file</code> to <code>/etc/file</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">link <span style="color:#4070a0">'/tmp/file'</span> <span style="color:#007020;font-weight:700">do</span>
  to <span style="color:#4070a0">'/etc/file'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create hard links</p> <p>The following example will create a hard link from <code>/tmp/file</code> to <code>/etc/file</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">link <span style="color:#4070a0">'/tmp/file'</span> <span style="color:#007020;font-weight:700">do</span>
  to <span style="color:#4070a0">'/etc/file'</span>
  link_type <span style="color:#517918">:hard</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Delete links</p> <p>The following example will delete the <code>/tmp/file</code> symbolic link and uses the <code>only_if</code> guard to run the <code>test -L</code> command, which verifies that <code>/tmp/file</code> is a symbolic link, and then only deletes <code>/tmp/file</code> if the test passes:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">link <span style="color:#4070a0">'/tmp/file'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
  only_if <span style="color:#4070a0">'test -L /tmp/file'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create multiple symbolic links</p> <p>The following example creates symbolic links from two files in the <code>/vol/webserver/cert/</code> directory to files located in the <code>/etc/ssl/certs/</code> directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">link <span style="color:#4070a0">'/vol/webserver/cert/server.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  to <span style="color:#4070a0">'/etc/ssl/certs/ssl-cert-name.pem'</span>
<span style="color:#007020;font-weight:700">end</span>

link <span style="color:#4070a0">'/vol/webserver/cert/server.key'</span> <span style="color:#007020;font-weight:700">do</span>
  to <span style="color:#4070a0">'/etc/ssl/certs/ssl-cert-name.key'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create platform-specific symbolic links</p> <p>The following example shows installing a filter module on Apache. The package name is different for different platforms, and for the Red Hat Enterprise Linux family, a symbolic link is required:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">include_recipe <span style="color:#4070a0">'apache2::default'</span>

<span style="color:#007020;font-weight:700">case</span> node<span style="color:#666">[</span><span style="color:#4070a0">'platform_family'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'debian'</span>
  <span style="color:#666">...</span>
<span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'suse'</span>
  <span style="color:#666">...</span>
<span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'rhel'</span>, <span style="color:#4070a0">'fedora'</span>
  <span style="color:#666">...</span>

  link <span style="color:#4070a0">'/usr/lib64/httpd/modules/mod_apreq.so'</span> <span style="color:#007020;font-weight:700">do</span>
    to      <span style="color:#4070a0">'/usr/lib64/httpd/modules/mod_apreq2.so'</span>
    only_if <span style="color:#4070a0">'test -f /usr/lib64/httpd/modules/mod_apreq2.so'</span>
  <span style="color:#007020;font-weight:700">end</span>

  link <span style="color:#4070a0">'/usr/lib/httpd/modules/mod_apreq.so'</span> <span style="color:#007020;font-weight:700">do</span>
    to      <span style="color:#4070a0">'/usr/lib/httpd/modules/mod_apreq2.so'</span>
    only_if <span style="color:#4070a0">'test -f /usr/lib/httpd/modules/mod_apreq2.so'</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#666">...</span>
</code></pre></div>
<p>For the complete recipe, see <a href="https://github.com/onehealth-cookbooks/apache2/blob/68bdfba4680e70b3e90f77e40223dd535bf22c17/recipes/mod_apreq2.rb">https://github.com/onehealth-cookbooks/apache2/blob/68bdfba4680e70b3e90f77e40223dd535bf22c17/recipes/mod_apreq2.rb</a>.</p> <p><strong>Create Windows junction/reparse points</strong></p> <p>This example demonstrates how to create a directory junction/reparse point. In this example, <code>C:\destination</code> will be a junction/reparse point to the <code>C:\source</code> directory.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:/source'</span>

link <span style="color:#4070a0">'C:/destination'</span> <span style="color:#007020;font-weight:700">do</span>
    link_type <span style="color:#517918">:symbolic</span>
    to <span style="color:#4070a0">'C:/source'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="locale-resource">locale resource</h2> <a href="locale/index.html">locale resource page</a> <hr> <p>Use the <strong>locale</strong> resource to set the system’s locale on Debian and Windows systems. Windows support was added in Chef Infra Client 16.0</p> <p><strong>New in Chef Infra Client 14.5.</strong></p> <h3 id="syntax-locale">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>locale</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">locale <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  lang        <span style="color:#007020">String</span>
  lc_env      <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {}</span>
  action      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :update if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>locale</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>lang</code> and <code>lc_env</code> are the properties available to this resource.</li> </ul> <h3 id="actions-locale">Actions</h3> <hr> <p>The <strong>locale</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:update</code></dt> <dd>Update the system’s locale. (default)</dd> </dl> <h3 id="properties-locale">Properties</h3> <hr> <p>The <strong>locale</strong> resource has the following properties:</p> <dl> <dt> <code>lang</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Sets the default system language.</p> </dd> </dl> <dl> <dt> <code>lc_env</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> <p>A Hash of LC_* env variables in the form of <code>({ 'LC_ENV_VARIABLE' =&gt; 'VALUE' })</code>.</p> </dd> </dl> <br> <h3 id="functionality-locale">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-locale">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-locale">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-locale">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-locale">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>locale</strong> resource in recipes:</p> <p>Set the lang to ‘en_US.UTF-8’</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  locale <span style="color:#4070a0">'set system locale'</span> <span style="color:#007020;font-weight:700">do</span>
    lang <span style="color:#4070a0">'en_US.UTF-8'</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="log-resource">log resource</h2> <a href="log/index.html">log resource page</a> <hr> <h3 id="syntax-log">Syntax</h3> <hr>  <p>A <strong>log</strong> resource block adds messages to the log file based on events that occur during a Chef Infra Client run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">log <span style="color:#4070a0">'message'</span> <span style="color:#007020;font-weight:700">do</span>
  message <span style="color:#4070a0">'A message add to the log.'</span>
  level <span style="color:#517918">:info</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The full syntax for all of the properties that are available to the <strong>log</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">log <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  level        <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :info</span>
  message      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action       <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :write if not specified</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where:</p> <ul> <li>
<code>log</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>level</code> and <code>message</code> are the properties available to this resource.</li> </ul> <h3 id="properties-log">Properties</h3> <hr> <p>The log resource has the following properties:</p> <dl> <dt><code>level</code></dt> <dd> <p><strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:info</code></p> <p>The logging level for displaying this message. Options (in order of priority): <code>:debug</code>, <code>:info</code>, <code>:warn</code>, <code>:error</code>, and <code>:fatal</code>.</p> </dd> <dt><code>message</code></dt> <dd> <p><strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code></p> <p>The message to be added to a log file. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <h3 id="ruby-style-basics-chef-log">Log Entries</h3> <p><code>Chef::Log</code> will print log entries to the default logger that is configured for the machine on which Chef Infra Client is running. (To create a log entry that is built into the resource collection, use the <a href="log/index.html">log resource</a> instead of <code>Chef::Log</code>.)</p> <h3 id="supported-log-levels">Supported Log Levels</h3> <table> <col style="width:25%"> <col style="width:75%"> <thead> <tr class="header"> <th>Log Level</th> <th>Syntax</th> </tr> </thead> <tbody> <tr> <td>Fatal</td> <td><code>Chef::Log.fatal('string')</code></td> </tr> <tr> <td>Error</td> <td><code>Chef::Log.error('string')</code></td> </tr> <tr> <td>Warn</td> <td><code>Chef::Log.warn('string')</code></td> </tr> <tr> <td>Info</td> <td><code>Chef::Log.info('string')</code></td> </tr> <tr> <td>Debug</td> <td><code>Chef::Log.debug('string')</code></td> </tr> </tbody> </table> <p>The following example shows a series of fatal <code>Chef::Log</code> entries:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">unless</span> node<span style="color:#666">[</span><span style="color:#4070a0">'splunk'</span><span style="color:#666">][</span><span style="color:#4070a0">'upgrade_enabled'</span><span style="color:#666">]</span>
  <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>fatal(<span style="color:#4070a0">'The chef-splunk::upgrade recipe was added to the node,'</span>)
  <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>fatal(<span style="color:#4070a0">'but the attribute `node["splunk"]["upgrade_enabled"]` was not set.'</span>)
  <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>fatal(<span style="color:#4070a0">'I am bailing here so this node does not upgrade.'</span>)
  <span style="color:#007020;font-weight:700">raise</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'splunk_stop'</span> <span style="color:#007020;font-weight:700">do</span>
  service_name <span style="color:#4070a0">'splunk'</span>
  supports <span style="color:#517918">status</span>: <span style="color:#007020">true</span>
  action <span style="color:#517918">:stop</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#007020;font-weight:700">if</span> node<span style="color:#666">[</span><span style="color:#4070a0">'splunk'</span><span style="color:#666">][</span><span style="color:#4070a0">'is_server'</span><span style="color:#666">]</span>
  splunk_package <span style="color:#666">=</span> <span style="color:#4070a0">'splunk'</span>
  url_type <span style="color:#666">=</span> <span style="color:#4070a0">'server'</span>
<span style="color:#007020;font-weight:700">else</span>
  splunk_package <span style="color:#666">=</span> <span style="color:#4070a0">'splunkforwarder'</span>
  url_type <span style="color:#666">=</span> <span style="color:#4070a0">'forwarder'</span>
<span style="color:#007020;font-weight:700">end</span>

splunk_installer splunk_package <span style="color:#007020;font-weight:700">do</span>
  url node<span style="color:#666">[</span><span style="color:#4070a0">'splunk'</span><span style="color:#666">][</span><span style="color:#4070a0">'upgrade'</span><span style="color:#666">][</span><span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>url_type<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">_url"</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#007020;font-weight:700">if</span> node<span style="color:#666">[</span><span style="color:#4070a0">'splunk'</span><span style="color:#666">][</span><span style="color:#4070a0">'accept_license'</span><span style="color:#666">]</span>
  execute <span style="color:#4070a0">'splunk-unattended-upgrade'</span> <span style="color:#007020;font-weight:700">do</span>
    command <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>splunk_cmd<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0"> start --accept-license --answer-yes"</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">else</span>
  <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>fatal(<span style="color:#4070a0">'You did not accept the license (set node["splunk"]["accept_license"] to true)'</span>)
  <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>fatal(<span style="color:#4070a0">'Splunk is stopped and cannot be restarted until the license is accepted!'</span>)
  <span style="color:#007020;font-weight:700">raise</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>The following example shows using multiple <code>Chef::Log</code> entry types:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">...</span>

<span style="color:#007020;font-weight:700">begin</span>
  aws <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">DataBagItem</span><span style="color:#666">.</span>load(<span style="color:#517918">:aws</span>, <span style="color:#517918">:main</span>)
  <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>info(<span style="color:#4070a0">"Loaded AWS information from DataBagItem aws[</span><span style="color:#70a0d0;font-style:italic">#{</span>aws<span style="color:#666">[</span><span style="color:#4070a0">'id'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">]"</span>)
<span style="color:#007020;font-weight:700">rescue</span>
  <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>fatal(<span style="color:#4070a0">"Could not find the 'main' item in the 'aws' data bag"</span>)
  <span style="color:#007020;font-weight:700">raise</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#666">...</span>
</code></pre></div> <br> <h3 id="functionality-log">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-log">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-log">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-log">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-log">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>log</strong> resource in recipes:</p> <p>Set default logging level</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">log <span style="color:#4070a0">'a string to log'</span>
</code></pre></div>
<p>Set debug logging level</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">log <span style="color:#4070a0">'a debug string'</span> <span style="color:#007020;font-weight:700">do</span>
  level <span style="color:#517918">:debug</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Add a message to a log file</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">log <span style="color:#4070a0">'message'</span> <span style="color:#007020;font-weight:700">do</span>
  message <span style="color:#4070a0">'This is the message that will be added to the log.'</span>
  level <span style="color:#517918">:info</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="macos-userdefaults-resource">macos_userdefaults resource</h2> <a href="macos_userdefaults/index.html">macos_userdefaults resource page</a> <hr> <p>Use the <strong>macos_userdefaults</strong> resource to manage the macOS user defaults system. The properties of this resource are passed to the defaults command, and the parameters follow the convention of that command. See the defaults(1) man page for details on how the tool works.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-macos-userdefaults">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>macos_userdefaults</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">macos_userdefaults <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  domain      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: NSGlobalDomain: the global domain.</span>
  host        <span style="color:#007020">String</span>, <span style="color:#60add5">Symbol</span>
  key         <span style="color:#007020">String</span>
  user        <span style="color:#007020">String</span>, <span style="color:#60add5">Symbol</span>
  value       <span style="color:#007020">Integer</span>, <span style="color:#007020">Float</span>, <span style="color:#007020">String</span>, <span style="color:#007020">true</span>, <span style="color:#007020">false</span>, <span style="color:#60add5">Hash</span>, <span style="color:#007020">Array</span>
  action      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :write if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>macos_userdefaults</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>domain</code>, <code>host</code>, <code>key</code>, <code>user</code>, and <code>value</code> are the properties available to this resource.</li> </ul> <h3 id="actions-macos-userdefaults">Actions</h3> <hr> <p>The <strong>macos_userdefaults</strong> resource has the following actions:</p> <dl> <dt><code>:delete</code></dt> <dd>Delete a key from a domain.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:write</code></dt> <dd>Write the value to the specified domain/key. (default)</dd> </dl> <h3 id="properties-macos-userdefaults">Properties</h3> <hr> <p>The <strong>macos_userdefaults</strong> resource has the following properties:</p> <dl> <dt> <code>domain</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>NSGlobalDomain: the global domain.</code> <p>The domain that the user defaults belong to.</p> </dd> </dl> <dl> <dt> <code>host</code> </dt> <dd> <strong>Ruby Type:</strong> String, Symbol <p>Set either :current, :all or a hostname to set the user default at the host level.</p> <p> New in Chef Infra Client 16.3 </p> </dd> </dl> <dl> <dt> <code>key</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The preference key.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Symbol <p>The system user that the default will be applied to. Set :current for current user, :all for all users or pass a valid username</p> </dd> </dl> <dl> <dt> <code>value</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Float, String, true, false, Hash, Array | <code>REQUIRED</code> <p>The value of the key.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>With the <code>type</code> property set to <code>bool</code>, <code>String</code> forms of Boolean true/false values that Apple accepts in the defaults command will be coerced: 0/1, ‘TRUE’/‘FALSE,’ ‘true’/false', ‘YES’/‘NO’, or ‘yes’/‘no’.</p> </div> </div> </dd> </dl> <br> <h3 id="functionality-macos-userdefaults">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-macos-userdefaults">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-macos-userdefaults">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-macos-userdefaults">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-macos-userdefaults">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>macos_userdefaults</strong> resource in recipes:</p> <p><strong>Specify a global domain value</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">macos_userdefaults <span style="color:#4070a0">'Full keyboard access to all controls'</span> <span style="color:#007020;font-weight:700">do</span>
  key <span style="color:#4070a0">'AppleKeyboardUIMode'</span>
  value <span style="color:#40a070">2</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Setting a value on a specific domain</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">macos_userdefaults <span style="color:#4070a0">'Enable macOS firewall'</span> <span style="color:#007020;font-weight:700">do</span>
  domain <span style="color:#4070a0">'/Library/Preferences/com.apple.alf'</span>
  key <span style="color:#4070a0">'globalstate'</span>
  value <span style="color:#40a070">1</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Specifying the type of a key to skip automatic type detection</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">macos_userdefaults <span style="color:#4070a0">'Finder expanded save dialogs'</span> <span style="color:#007020;font-weight:700">do</span>
  key <span style="color:#4070a0">'NSNavPanelExpandedStateForSaveMode'</span>
  value <span style="color:#4070a0">'TRUE'</span>
  type <span style="color:#4070a0">'bool'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="macports-package-resource">macports_package resource</h2> <a href="macports_package/index.html">macports_package resource page</a> <hr> <p>Use the <strong>macports_package</strong> resource to manage packages for the macOS platform using the MacPorts package management system.</p> <h3 id="syntax-macports-package">Syntax</h3> <hr> 
<p>A <strong>macports_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>macports_package</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">macports_package <span style="color:#4070a0">'package_name'</span>
</code></pre></div>
<p>which will install the named package using all of the default options and the default action (<code>:install</code>).</p> <p>The full syntax for all of the properties that are available to the <strong>macports_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">macports_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  options           <span style="color:#007020">String</span>
  package_name      <span style="color:#007020">String</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version           <span style="color:#007020">String</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>macports_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-macports-package">Actions</h3> <hr> <p>The <strong>macports_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-macports-package">Properties</h3> <hr> <p>The <strong>macports_package</strong> resource has the following properties:</p> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-macports-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-macports-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-macports-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-macports-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-macports-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>macports_package</strong> resource in recipes:</p> <p>Install a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">macports_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="mdadm-resource">mdadm resource</h2> <a href="mdadm/index.html">mdadm resource page</a> <hr> <p>Use the <strong>mdadm</strong> resource to manage RAID devices in a Linux environment using the mdadm utility. The mdadm resource will create and assemble an array, but it will not create the config file that is used to persist the array upon reboot. If the config file is required, it must be done by specifying a template with the correct array layout, and then by using the mount provider to create a file systems table (fstab) entry.</p> <h3 id="syntax-mdadm">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>mdadm</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">mdadm <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  bitmap           <span style="color:#007020">String</span>
  chunk            <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 16</span>
  devices          <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  layout           <span style="color:#007020">String</span>
  level            <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 1</span>
  metadata         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "0.90"</span>
  raid_device      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>mdadm</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>bitmap</code>, <code>chunk</code>, <code>devices</code>, <code>layout</code>, <code>level</code>, <code>metadata</code>, and <code>raid_device</code> are the properties available to this resource.</li> </ul> <h3 id="actions-mdadm">Actions</h3> <hr> <p>The <strong>mdadm</strong> resource has the following actions:</p> <dl> <dt><code>:assemble</code></dt> <dd>Assemble a previously created array into an active array.</dd> <dt><code>:create</code></dt> <dd>Create an array with per-device superblocks. If an array already exists (but does not match), update that array to match. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:stop</code></dt> <dd>Stop an active array.</dd> </dl> <h3 id="properties-mdadm">Properties</h3> <hr> <p>The <strong>mdadm</strong> resource has the following properties:</p> <dl> <dt> <code>bitmap</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to a file in which a write-intent bitmap is stored.</p> </dd> </dl> <dl> <dt> <code>chunk</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>16</code> <p>The chunk size. This property should not be used for a RAID 1 mirrored pair (i.e. when the <code>level</code> property is set to <code>1</code>).</p> </dd> </dl> <dl> <dt> <code>devices</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>The devices to be part of a RAID array.</p> </dd> </dl> <dl> <dt> <code>layout</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The RAID5 parity algorithm. Possible values: <code>left-asymmetric</code> (or <code>la</code>), <code>left-symmetric</code> (or ls), <code>right-asymmetric</code> (or <code>ra</code>), or <code>right-symmetric</code> (or <code>rs</code>).</p> </dd> </dl> <dl> <dt> <code>level</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>1</code> <p>The RAID level.</p> </dd> </dl> <dl> <dt> <code>metadata</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>0.90</code> <p>The superblock type for RAID metadata.</p> </dd> </dl> <dl> <dt> <code>raid_device</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to specify the name of the RAID device if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-mdadm">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-mdadm">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-mdadm">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-mdadm">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-mdadm">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>mdadm</strong> resource in recipes:</p> <p><strong>Create and assemble a RAID 0 array</strong></p> <p>The mdadm command can be used to create RAID arrays. For example, a RAID 0 array named /dev/md0 with 10 devices would have a command similar to the following:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code>mdadm --create /dev/md0 --level=0 --raid-devices=10 /dev/s01.../dev/s10
</code></pre>
<p>where /dev/s01 .. /dev/s10 represents 10 devices (01, 02, 03, and so on). This same command, when expressed as a recipe using the mdadm resource, would be similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">mdadm <span style="color:#4070a0">'/dev/md0'</span> <span style="color:#007020;font-weight:700">do</span>
  devices <span style="color:#666">[</span> <span style="color:#4070a0">'/dev/s01'</span>, <span style="color:#666">...</span> <span style="color:#4070a0">'/dev/s10'</span> <span style="color:#666">]</span>
  level <span style="color:#40a070">0</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>(again, where /dev/s01 .. /dev/s10 represents devices /dev/s01, /dev/s02, /dev/s03, and so on).</p> <p><strong>Create and assemble a RAID 1 array</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">mdadm <span style="color:#4070a0">'/dev/md0'</span> <span style="color:#007020;font-weight:700">do</span>
  devices <span style="color:#666">[</span> <span style="color:#4070a0">'/dev/sda'</span>, <span style="color:#4070a0">'/dev/sdb'</span> <span style="color:#666">]</span>
  level <span style="color:#40a070">1</span>
  action <span style="color:#666">[</span> <span style="color:#517918">:create</span>, <span style="color:#517918">:assemble</span> <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create and assemble a RAID 5 array</strong></p> <p>The mdadm command can be used to create RAID arrays. For example, a RAID 5 array named /dev/sd0 with 4, and a superblock type of 0.90 would be similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">mdadm <span style="color:#4070a0">'/dev/sd0'</span> <span style="color:#007020;font-weight:700">do</span>
  devices <span style="color:#666">[</span> <span style="color:#4070a0">'/dev/s1'</span>, <span style="color:#4070a0">'/dev/s2'</span>, <span style="color:#4070a0">'/dev/s3'</span>, <span style="color:#4070a0">'/dev/s4'</span> <span style="color:#666">]</span>
  level <span style="color:#40a070">5</span>
  metadata <span style="color:#4070a0">'0.90'</span>
  chunk <span style="color:#40a070">32</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="mount-resource">mount resource</h2> <a href="mount/index.html">mount resource page</a> <hr> <p>Use the <strong>mount</strong> resource to manage a mounted file system.</p> <h3 id="syntax-mount">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>mount</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">mount <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  device           <span style="color:#007020">String</span>
  device_type      <span style="color:#007020">String</span>, <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :device</span>
  domain           <span style="color:#007020">String</span>
  dump             <span style="color:#007020">Integer</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: 0</span>
  enabled          <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  fsck_device      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "-"</span>
  fstype           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "auto"</span>
  mount_point      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  options          <span style="color:#007020">Array</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: ["defaults"]</span>
  pass             <span style="color:#007020">Integer</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: 2</span>
  password         <span style="color:#007020">String</span>
  supports         <span style="color:#007020">Array</span>, <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: { remount: false }</span>
  username         <span style="color:#007020">String</span>
  action           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :mount if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>mount</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>device</code>, <code>device_type</code>, <code>domain</code>, <code>dump</code>, <code>enabled</code>, <code>fsck_device</code>, <code>fstype</code>, <code>mount_point</code>, <code>options</code>, <code>pass</code>, <code>password</code>, <code>supports</code>, and <code>username</code> are the properties available to this resource.</li> </ul> <h3 id="actions-mount">Actions</h3> <hr> <p>The <strong>mount</strong> resource has the following actions:</p> <dl> <dt><code>:disable</code></dt> <dd>Remove an entry from the file systems table (<code>fstab</code>).</dd> <dt><code>:enable</code></dt> <dd>Add an entry to the file systems table (<code>fstab</code>).</dd> <dt><code>:mount</code></dt> <dd>Default. Mount a device.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remount</code></dt> <dd>Remount a device.</dd> <dt><code>:umount</code></dt> <dd>Unmount a device.</dd> <dt><code>:unmount</code></dt> <dd>Alias for <code>:umount</code> action.</dd> </dl> <h3 id="properties-mount">Properties</h3> <hr> <p>The <strong>mount</strong> resource has the following properties:</p> <dl> <dt> <code>device</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Required for <code>:umount</code> and <code>:remount</code> actions (for the purpose of checking the mount command output for presence). The special block device or remote node, a label, or a uuid to be mounted.</p> </dd> </dl> <dl> <dt> <code>device_type</code> </dt> <dd> <strong>Ruby Type:</strong> String, Symbol | <strong>Default Value:</strong> <code>:device</code> <strong>Allowed Values:</strong> <code>:device, :label, :uuid</code> <p>The type of device: :device, :label, or :uuid</p> </dd> </dl> <dl> <dt> <code>domain</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Windows only: Use to specify the domain in which the <code>username</code> and <code>password</code> are located.</p> </dd> </dl> <dl> <dt> <code>dump</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, false | <strong>Default Value:</strong> <code>0</code> <p>The dump frequency (in days) used while creating a file systems table (fstab) entry.</p> </dd> </dl> <dl> <dt> <code>enabled</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Use to specify if a mounted file system is enabled.</p> </dd> </dl> <dl> <dt> <code>fsck_device</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>-</code> <p>Solaris only: The fsck device.</p> </dd> </dl> <dl> <dt> <code>fstype</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>auto</code> <p>The file system type (fstype) of the device.</p> </dd> </dl> <dl> <dt> <code>mount_point</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The directory (or path) in which the device is to be mounted. Defaults to the name of the resource block if not provided.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> Array, String | <strong>Default Value:</strong> <code>["defaults"]</code> <p>An array or comma separated list of options for the mount.</p> </dd> </dl> <dl> <dt> <code>pass</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, false | <strong>Default Value:</strong> <code>2</code> <p>The pass number used by the file system check (fsck) command while creating a file systems table (fstab) entry.</p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Windows only:. Use to specify the password for username.</p> </dd> </dl> <dl> <dt> <code>supports</code> </dt> <dd> <strong>Ruby Type:</strong> Array, Hash | <strong>Default Value:</strong> <code>{ remount: false }</code> <p>Specify a Hash of supported mount features.</p> </dd> </dl> <dl> <dt> <code>username</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Windows only: Use to specify the user name.</p> </dd> </dl> <br> <h3 id="functionality-mount">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-mount">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-mount">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-mount">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-mount">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>mount</strong> resource in recipes:</p> <p>Mount a labeled file system</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">mount <span style="color:#4070a0">'/mnt/volume1'</span> <span style="color:#007020;font-weight:700">do</span>
  device <span style="color:#4070a0">'volume1'</span>
  device_type <span style="color:#517918">:label</span>
  fstype <span style="color:#4070a0">'xfs'</span>
  options <span style="color:#4070a0">'rw'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Mount a local block drive</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">mount <span style="color:#4070a0">'/mnt/local'</span> <span style="color:#007020;font-weight:700">do</span>
  device <span style="color:#4070a0">'/dev/sdb1'</span>
  fstype <span style="color:#4070a0">'ext3'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Mount a non-block file system</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">mount <span style="color:#4070a0">'/mount/tmp'</span> <span style="color:#007020;font-weight:700">do</span>
  pass     <span style="color:#40a070">0</span>
  fstype   <span style="color:#4070a0">'tmpfs'</span>
  device   <span style="color:#4070a0">'/dev/null'</span>
  options  <span style="color:#4070a0">'nr_inodes=999k,mode=755,size=500m'</span>
  action   <span style="color:#666">[</span><span style="color:#517918">:mount</span>, <span style="color:#517918">:enable</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Mount and add to the file systems table</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">mount <span style="color:#4070a0">'/export/www'</span> <span style="color:#007020;font-weight:700">do</span>
  device <span style="color:#4070a0">'nas1prod:/export/web_sites'</span>
  fstype <span style="color:#4070a0">'nfs'</span>
  options <span style="color:#4070a0">'rw'</span>
  action <span style="color:#666">[</span><span style="color:#517918">:mount</span>, <span style="color:#517918">:enable</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Mount a remote file system</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">mount <span style="color:#4070a0">'/export/www'</span> <span style="color:#007020;font-weight:700">do</span>
  device <span style="color:#4070a0">'nas1prod:/export/web_sites'</span>
  fstype <span style="color:#4070a0">'nfs'</span>
  options <span style="color:#4070a0">'rw'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Mount a remote folder in Microsoft Windows</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">mount <span style="color:#4070a0">'T:'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:mount</span>
  device <span style="color:#4070a0">'\\\\hostname.example.com\\folder'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Unmount a remote folder in Microsoft Windows</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">mount <span style="color:#4070a0">'T:'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:umount</span>
  device <span style="color:#4070a0">'\\\\hostname.example.com\\D$'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Stop a service, do stuff, and then restart it</p> <p>The following example shows how to use the <strong>execute</strong>, <strong>service</strong>, and <strong>mount</strong> resources together to ensure that a node running on Amazon EC2 is running MySQL. This example does the following:</p> <ul> <li>Checks to see if the Amazon EC2 node has MySQL</li> <li>If the node has MySQL, stops MySQL</li> <li>Installs MySQL</li> <li>Mounts the node</li> <li>Restarts MySQL</li> </ul> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># the following code sample comes from the ``server_ec2``</span>
<span style="color:#60a0b0;font-style:italic"># recipe in the following cookbook:</span>
<span style="color:#60a0b0;font-style:italic"># https://github.com/chef-cookbooks/mysql</span>

<span style="color:#007020;font-weight:700">if</span> (node<span style="color:#666">.</span>attribute?(<span style="color:#4070a0">'ec2'</span>) <span style="color:#666">&amp;&amp;</span> <span style="color:#666">!</span> <span style="color:#60add5">FileTest</span><span style="color:#666">.</span>directory?(node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span>))

  service <span style="color:#4070a0">'mysql'</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:stop</span>
  <span style="color:#007020;font-weight:700">end</span>

  execute <span style="color:#4070a0">'install-mysql'</span> <span style="color:#007020;font-weight:700">do</span>
    command <span style="color:#4070a0">"mv </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'data_dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
    not_if <span style="color:#007020;font-weight:700">do</span> <span style="color:#60add5">FileTest</span><span style="color:#666">.</span>directory?(node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span>) <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>

  <span style="color:#666">[</span>node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span>, node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'data_dir'</span><span style="color:#666">]].</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>dir<span style="color:#666">|</span>
    directory dir <span style="color:#007020;font-weight:700">do</span>
      owner <span style="color:#4070a0">'mysql'</span>
      group <span style="color:#4070a0">'mysql'</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>

  mount node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'data_dir'</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:700">do</span>
    device node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span>
    fstype <span style="color:#4070a0">'none'</span>
    options <span style="color:#4070a0">'bind,rw'</span>
    action <span style="color:#666">[</span><span style="color:#517918">:mount</span>, <span style="color:#517918">:enable</span><span style="color:#666">]</span>
  <span style="color:#007020;font-weight:700">end</span>

  service <span style="color:#4070a0">'mysql'</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:start</span>
  <span style="color:#007020;font-weight:700">end</span>

<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where</p> <ul> <li>the two <strong>service</strong> resources are used to stop, and then restart the MySQL service</li> <li>the <strong>execute</strong> resource is used to install MySQL</li> <li>the <strong>mount</strong> resource is used to mount the node and enable MySQL</li> </ul> <h2 id="msu-package-resource">msu_package resource</h2> <a href="msu_package/index.html">msu_package resource page</a> <hr> <p>Use the <strong>msu_package</strong> resource to install Microsoft Update(MSU) packages on Microsoft Windows machines.</p> <p><strong>New in Chef Infra Client 12.17.</strong></p> <h3 id="syntax-msu-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>msu_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">msu_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  checksum          <span style="color:#007020">String</span>
  options           <span style="color:#007020">String</span>
  package_name      <span style="color:#007020">String</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 3600</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>msu_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>checksum</code>, <code>options</code>, <code>package_name</code>, <code>source</code>, and <code>timeout</code> are the properties available to this resource.</li> </ul> <h3 id="actions-msu-package">Actions</h3> <hr> <p>The <strong>msu_package</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-msu-package">Properties</h3> <hr> <p>The <strong>msu_package</strong> resource has the following properties:</p> <dl> <dt> <code>checksum</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>SHA-256 digest used to verify the checksum of the downloaded MSU package.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The local file path or URL for the MSU package.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <br> <h3 id="functionality-msu-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-msu-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-msu-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-msu-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-msu-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>msu_package</strong> resource in recipes:</p> <p>Using local path in source</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">msu_package <span style="color:#4070a0">'Install Windows 2012R2 Update KB2959977'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'C:\Users\xyz\AppData\Local\Temp\Windows8.1-KB2959977-x64.msu'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">msu_package <span style="color:#4070a0">'Remove Windows 2012R2 Update KB2959977'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'C:\Users\xyz\AppData\Local\Temp\Windows8.1-KB2959977-x64.msu'</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Using URL in source</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">msu_package <span style="color:#4070a0">'Install Windows 2012R2 Update KB2959977'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'https://s3.amazonaws.com/my_bucket/Windows8.1-KB2959977-x64.msu'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">msu_package <span style="color:#4070a0">'Remove Windows 2012R2 Update KB2959977'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'https://s3.amazonaws.com/my_bucket/Windows8.1-KB2959977-x64.msu'</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="notify-group-resource">notify_group resource</h2> <a href="notify_group/index.html">notify_group resource page</a> <hr> <p>The notify_group resource does nothing, and always fires notifications which are set on it. Use it to DRY blocks of notifications that are common to multiple resources, and provide a single target for other resources to notify. Unlike most resources, its default action is :nothing.</p> <p><strong>New in Chef Infra Client 15.8.</strong></p> <h3 id="syntax-notify-group">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>notify_group</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notify_group <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  action      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :nothing if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>notify_group</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> </ul> <h3 id="actions-notify-group">Actions</h3> <hr> <p>The <strong>notify_group</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:run</code></dt>  </dl> <h3 id="properties-notify-group">Properties</h3> <hr> <p>This resource does not have any properties.</p> <br> <h3 id="functionality-notify-group">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-notify-group">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-notify-group">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-notify-group">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-notify-group">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>notify_group</strong> resource in recipes:</p> <p>Wire up a notification from a service resource to stop and start the service with a 60 second delay.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">"crude"</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#666">[</span> <span style="color:#517918">:enable</span>, <span style="color:#517918">:start</span> <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>

chef_sleep <span style="color:#4070a0">"60"</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Example code for a hypothetical badly behaved service that requires</span>
<span style="color:#60a0b0;font-style:italic"># 60 seconds between a stop and start in order to restart the service</span>
<span style="color:#60a0b0;font-style:italic"># (due to race conditions, bleeding connections down, resources that only</span>
<span style="color:#60a0b0;font-style:italic"># slowly unlock in the background, or other poor software behaviors that</span>
<span style="color:#60a0b0;font-style:italic"># are sometimes encountered).</span>
<span style="color:#60a0b0;font-style:italic">#</span>
notify_group <span style="color:#4070a0">"crude_stop_and_start"</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:stop</span>, <span style="color:#4070a0">"service[crude]"</span>, <span style="color:#517918">:immediately</span>
  notifies <span style="color:#517918">:sleep</span>, <span style="color:#4070a0">"chef_sleep[60]"</span>, <span style="color:#517918">:immediately</span>
  notifies <span style="color:#517918">:start</span>, <span style="color:#4070a0">"service[crude]"</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>

template <span style="color:#4070a0">"/etc/crude/crude.conf"</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">"crude.conf.erb"</span>
  variables node<span style="color:#666">[</span><span style="color:#4070a0">"crude"</span><span style="color:#666">]</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">"notify_group[crude_stop_and_start]"</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="ohai-resource">ohai resource</h2> <a href="ohai/index.html">ohai resource page</a> <hr> <p>Use the <strong>ohai</strong> resource to reload the Ohai configuration on a node. This allows recipes that change system attributes (like a recipe that adds a user) to refer to those attributes later on during the Chef Infra Client run.</p> <h3 id="syntax-ohai">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>ohai</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ohai <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  plugin      <span style="color:#007020">String</span>
  action      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :reload if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>ohai</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>plugin</code> is the property available to this resource.</li> </ul> <h3 id="actions-ohai">Actions</h3> <hr> <p>The <strong>ohai</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:reload</code></dt> <dd>Reloads the Ohai data. (default)</dd> </dl> <h3 id="properties-ohai">Properties</h3> <hr> <p>The <strong>ohai</strong> resource has the following properties:</p> <dl> <dt> <code>plugin</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specific Ohai attribute data to reload. This property behaves similar to specifying attributes when running Ohai on the command line and takes the attribute that you wish to reload instead of the actual plugin name. For instance, you can pass <code>ipaddress</code> to reload <code>node['ipaddress']</code> even though that data comes from the <code>Network</code> plugin. If this property is not specified, Chef Infra Client will reload all plugins.</p> </dd> </dl> <br> <h3 id="functionality-ohai">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-ohai">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-ohai">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-ohai">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-ohai">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>ohai</strong> resource in recipes:</p> <p>Reload All Ohai Plugins</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ohai <span style="color:#4070a0">'reload'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:reload</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Reload A Single Ohai Plugin</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ohai <span style="color:#4070a0">'reload'</span> <span style="color:#007020;font-weight:700">do</span>
  plugin <span style="color:#4070a0">'ipaddress'</span>
  action <span style="color:#517918">:reload</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Reload Ohai after a new user is created</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ohai <span style="color:#4070a0">'reload_passwd'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
  plugin <span style="color:#4070a0">'etc'</span>
<span style="color:#007020;font-weight:700">end</span>

user <span style="color:#4070a0">'daemon_user'</span> <span style="color:#007020;font-weight:700">do</span>
  home <span style="color:#4070a0">'/dev/null'</span>
  shell <span style="color:#4070a0">'/sbin/nologin'</span>
  <span style="color:#007020">system</span> <span style="color:#007020">true</span>
  notifies <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'ohai[reload_passwd]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>

ruby_block <span style="color:#4070a0">'just an example'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#60a0b0;font-style:italic"># These variables will now have the new values</span>
    <span style="color:#007020">puts</span> node<span style="color:#666">[</span><span style="color:#4070a0">'etc'</span><span style="color:#666">][</span><span style="color:#4070a0">'passwd'</span><span style="color:#666">][</span><span style="color:#4070a0">'daemon_user'</span><span style="color:#666">][</span><span style="color:#4070a0">'uid'</span><span style="color:#666">]</span>
    <span style="color:#007020">puts</span> node<span style="color:#666">[</span><span style="color:#4070a0">'etc'</span><span style="color:#666">][</span><span style="color:#4070a0">'passwd'</span><span style="color:#666">][</span><span style="color:#4070a0">'daemon_user'</span><span style="color:#666">][</span><span style="color:#4070a0">'gid'</span><span style="color:#666">]</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="ohai-hint-resource">ohai_hint resource</h2> <a href="ohai_hint/index.html">ohai_hint resource page</a> <hr> <p>Use the <strong>ohai_hint</strong> resource to aid in configuration detection by passing hint data to Ohai.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-ohai-hint">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>ohai_hint</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ohai_hint <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  compile_time      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  content           <span style="color:#60add5">Hash</span>
  hint_name         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>ohai_hint</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>compile_time</code>, <code>content</code>, and <code>hint_name</code> are the properties available to this resource.</li> </ul> <h3 id="actions-ohai-hint">Actions</h3> <hr> <p>The <strong>ohai_hint</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create an Ohai hint file. (default)</dd> <dt><code>:delete</code></dt> <dd>Delete an Ohai hint file.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-ohai-hint">Properties</h3> <hr> <p>The <strong>ohai_hint</strong> resource has the following properties:</p> <dl> <dt> <code>compile_time</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Determines whether or not the resource is executed during the compile time phase.</p> </dd> </dl> <dl> <dt> <code>content</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>Values to include in the hint file.</p> </dd> </dl> <dl> <dt> <code>hint_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the hint name if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-ohai-hint">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-ohai-hint">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-ohai-hint">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-ohai-hint">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-ohai-hint">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>ohai_hint</strong> resource in recipes:</p> <p><strong>Create a hint file</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ohai_hint <span style="color:#4070a0">'example'</span> <span style="color:#007020;font-weight:700">do</span>
  content <span style="color:#517918">a</span>: <span style="color:#4070a0">'test_content'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a hint file with a name that does not match the resource name</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ohai_hint <span style="color:#4070a0">'example'</span> <span style="color:#007020;font-weight:700">do</span>
  hint_name <span style="color:#4070a0">'custom'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a hint file that is not loaded at compile time</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ohai_hint <span style="color:#4070a0">'example'</span> <span style="color:#007020;font-weight:700">do</span>
  compile_time <span style="color:#007020">false</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Delete a hint file</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ohai_hint <span style="color:#4070a0">'example'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="openbsd-package-resource">openbsd_package resource</h2> <a href="openbsd_package/index.html">openbsd_package resource page</a> <hr> <p>Use the <strong>openbsd_package</strong> resource to manage packages for the OpenBSD platform.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <h3 id="syntax-openbsd-package">Syntax</h3> <hr> 
<p>A <strong>openbsd_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>openbsd_package</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openbsd_package <span style="color:#4070a0">'package_name'</span>
</code></pre></div>
<p>which will install the named package using all of the default options and the default action (<code>:install</code>).</p> <p>The full syntax for all of the properties that are available to the <strong>openbsd_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openbsd_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  options           <span style="color:#007020">String</span>
  package_name      <span style="color:#007020">String</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version           <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>openbsd_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-openbsd-package">Actions</h3> <hr> <p>The <strong>openbsd_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> </dl> <h3 id="properties-openbsd-package">Properties</h3> <hr> <p>The <strong>openbsd_package</strong> resource has the following properties:</p> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-openbsd-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-openbsd-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-openbsd-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-openbsd-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-openbsd-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>openbsd_package</strong> resource in recipes:</p> <p><strong>Install a package</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openbsd_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove a package</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openbsd_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="openssl-dhparam-resource">openssl_dhparam resource</h2> <a href="openssl_dhparam/index.html">openssl_dhparam resource page</a> <hr> <p>Use the <strong>openssl_dhparam</strong> resource to generate <code>dhparam.pem</code> files. If a valid <code>dhparam.pem</code> file is found at the specified location, no new file will be created. If a file is found at the specified location but it is not a valid <code>dhparam.pem</code> file, it will be overwritten.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-openssl-dhparam">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>openssl_dhparam</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_dhparam <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  generator       <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 2</span>
  group           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  key_length      <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 2048</span>
  mode            <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "0640"</span>
  owner           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action          <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>openssl_dhparam</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>generator</code>, <code>group</code>, <code>key_length</code>, <code>mode</code>, <code>owner</code>, and <code>path</code> are the properties available to this resource.</li> </ul> <h3 id="actions-openssl-dhparam">Actions</h3> <hr> <p>The <strong>openssl_dhparam</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create the <code>dhparam.pem</code> file. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-openssl-dhparam">Properties</h3> <hr> <p>The <strong>openssl_dhparam</strong> resource has the following properties:</p> <dl> <dt> <code>generator</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code> <strong>Allowed Values:</strong> <code>2, 5</code> <p>The desired Diffie-Hellmann generator.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group ownership applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>key_length</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2048</code> <strong>Allowed Values:</strong> <code>1024, 2048, 4096, 8192</code> <p>The desired bit length of the generated key.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>0640</code> <p>The permission mode applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The owner applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property for specifying the path to write the file to if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-openssl-dhparam">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-openssl-dhparam">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-openssl-dhparam">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-openssl-dhparam">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-openssl-dhparam">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>openssl_dhparam</strong> resource in recipes:</p> <p><strong>Create a dhparam file</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_dhparam <span style="color:#4070a0">'/etc/httpd/ssl/dhparam.pem'</span>
</code></pre></div>
<p><strong>Create a dhparam file with a specific key length</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_dhparam <span style="color:#4070a0">'/etc/httpd/ssl/dhparam.pem'</span> <span style="color:#007020;font-weight:700">do</span>
  key_length <span style="color:#40a070">4096</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a dhparam file with specific user/group ownership</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_dhparam <span style="color:#4070a0">'/etc/httpd/ssl/dhparam.pem'</span> <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'www-data'</span>
  group <span style="color:#4070a0">'www-data'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Manually specify the dhparam file path</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_dhparam <span style="color:#4070a0">'httpd_dhparam'</span> <span style="color:#007020;font-weight:700">do</span>
  path <span style="color:#4070a0">'/etc/httpd/ssl/dhparam.pem'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="openssl-ec-private-key-resource">openssl_ec_private_key resource</h2> <a href="openssl_ec_private_key/index.html">openssl_ec_private_key resource page</a> <hr> <p>Use the <strong>openssl_ec_private_key</strong> resource to generate an elliptic curve (EC) private key file. If a valid EC key file can be opened at the specified location, no new file will be created. If the EC key file cannot be opened, either because it does not exist or because the password to the EC key file does not match the password in the recipe, then it will be overwritten.</p> <p><strong>New in Chef Infra Client 14.4.</strong></p> <h3 id="syntax-openssl-ec-private-key">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>openssl_ec_private_key</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_ec_private_key <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  force           <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  group           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  key_cipher      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "des3"</span>
  key_curve       <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "prime256v1"</span>
  key_pass        <span style="color:#007020">String</span>
  mode            <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "0600"</span>
  owner           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action          <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>openssl_ec_private_key</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>force</code>, <code>group</code>, <code>key_cipher</code>, <code>key_curve</code>, <code>key_pass</code>, <code>mode</code>, <code>owner</code>, and <code>path</code> are the properties available to this resource.</li> </ul> <h3 id="actions-openssl-ec-private-key">Actions</h3> <hr> <p>The <strong>openssl_ec_private_key</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Generate the EC private key file. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-openssl-ec-private-key">Properties</h3> <hr> <p>The <strong>openssl_ec_private_key</strong> resource has the following properties:</p> <dl> <dt> <code>force</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Force creation of the key even if the same key already exists on the node.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group ownership applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>key_cipher</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>des3</code> <p>The designed cipher to use when generating your key. Run <code>openssl list-cipher-algorithms</code> to see available options.</p> </dd> </dl> <dl> <dt> <code>key_curve</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>prime256v1</code> <strong>Allowed Values:</strong> <code>"prime256v1", "secp224r1", "secp256k1", "secp384r1", "secp521r1"</code> <p>The desired curve of the generated key (if key_type is equal to ‘ec’). Run openssl ecparam -list_curves to see available options.</p> </dd> </dl> <dl> <dt> <code>key_pass</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The desired passphrase for the key.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>0600</code> <p>The permission mode applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The owner applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property for specifying the path to write the file to if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-openssl-ec-private-key">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-openssl-ec-private-key">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-openssl-ec-private-key">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-openssl-ec-private-key">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-openssl-ec-private-key">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>openssl_ec_private_key</strong> resource in recipes:</p> <p><strong>Generate a new ec privatekey with prime256v1 key curve and default des3 cipher</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_ec_private_key <span style="color:#4070a0">'/etc/ssl_files/eckey_prime256v1_des3.pem'</span> <span style="color:#007020;font-weight:700">do</span>
  key_curve <span style="color:#4070a0">'prime256v1'</span>
  key_pass <span style="color:#4070a0">'something'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Generate a new ec private key with prime256v1 key curve and aes-128-cbc cipher</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_ec_private_key <span style="color:#4070a0">'/etc/ssl_files/eckey_prime256v1_des3.pem'</span> <span style="color:#007020;font-weight:700">do</span>
  key_curve <span style="color:#4070a0">'prime256v1'</span>
  key_cipher <span style="color:#4070a0">'aes-128-cbc'</span>
  key_pass <span style="color:#4070a0">'something'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="openssl-ec-public-key-resource">openssl_ec_public_key resource</h2> <a href="openssl_ec_public_key/index.html">openssl_ec_public_key resource page</a> <hr> <p>Use the <strong>openssl_ec_public_key</strong> resource to generate elliptic curve (EC) public key files from a given EC private key.</p> <p><strong>New in Chef Infra Client 14.4.</strong></p> <h3 id="syntax-openssl-ec-public-key">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>openssl_ec_public_key</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_ec_public_key <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  group                    <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  mode                     <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "0640"</span>
  owner                    <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                     <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  private_key_content      <span style="color:#007020">String</span>
  private_key_pass         <span style="color:#007020">String</span>
  private_key_path         <span style="color:#007020">String</span>
  action                   <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>openssl_ec_public_key</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>group</code>, <code>mode</code>, <code>owner</code>, <code>path</code>, <code>private_key_content</code>, <code>private_key_pass</code>, and <code>private_key_path</code> are the properties available to this resource.</li> </ul> <h3 id="actions-openssl-ec-public-key">Actions</h3> <hr> <p>The <strong>openssl_ec_public_key</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Generate the EC public key file from a private key. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-openssl-ec-public-key">Properties</h3> <hr> <p>The <strong>openssl_ec_public_key</strong> resource has the following properties:</p> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group ownership applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>0640</code> <p>The permission mode applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The owner applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property for specifying the path to write the file to if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>private_key_content</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The content of the private key including new lines. This property is used in place of private_key_path in instances where you want to avoid having to first write the private key to disk</p> </dd> </dl> <dl> <dt> <code>private_key_pass</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The passphrase of the provided private key.</p> </dd> </dl> <dl> <dt> <code>private_key_path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to the private key file.</p> </dd> </dl> <br> <h3 id="functionality-openssl-ec-public-key">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-openssl-ec-public-key">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-openssl-ec-public-key">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-openssl-ec-public-key">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-openssl-ec-public-key">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>openssl_ec_public_key</strong> resource in recipes:</p> <p><strong>Generate new EC public key from a private key on disk</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_ec_public_key <span style="color:#4070a0">'/etc/ssl_files/eckey_prime256v1_des3.pub'</span> <span style="color:#007020;font-weight:700">do</span>
  private_key_path <span style="color:#4070a0">'/etc/ssl_files/eckey_prime256v1_des3.pem'</span>
  private_key_pass <span style="color:#4070a0">'something'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Generate new EC public key by passing in a private key</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_ec_public_key <span style="color:#4070a0">'/etc/ssl_files/eckey_prime256v1_des3_2.pub'</span> <span style="color:#007020;font-weight:700">do</span>
  private_key_content <span style="color:#4070a0">"-----BEGIN EC PRIVATE KEY-----
</span><span style="color:#4070a0">MHcCAQEEII2VAU9re44mAUzYPWCg+qqwdmP8CplsEg0b/DYPXLg2oAoGCCqGSM49
</span><span style="color:#4070a0">AwEHoUQDQgAEKkpMCbIQ2C6Qlp/B+Odp1a9Y06Sm8yqPvCVIkWYP7M8PX5+RmoIv
</span><span style="color:#4070a0">jGBVf/+mVBx77ji3NpTilMUt2KPZ87lZ3w==
</span><span style="color:#4070a0">-----END EC PRIVATE KEY-----
</span><span style="color:#4070a0">"</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="openssl-rsa-private-key-resource">openssl_rsa_private_key resource</h2> <a href="openssl_rsa_private_key/index.html">openssl_rsa_private_key resource page</a> <hr> <p>Use the <strong>openssl_rsa_private_key</strong> resource to generate RSA private key files. If a valid RSA key file can be opened at the specified location, no new file will be created. If the RSA key file cannot be opened, either because it does not exist or because the password to the RSA key file does not match the password in the recipe, it will be overwritten.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-openssl-rsa-private-key">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>openssl_rsa_private_key</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_rsa_private_key <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  force           <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  group           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  key_cipher      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "des3"</span>
  key_length      <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 2048</span>
  key_pass        <span style="color:#007020">String</span>
  mode            <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "0600"</span>
  owner           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action          <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>openssl_rsa_private_key</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>force</code>, <code>group</code>, <code>key_cipher</code>, <code>key_length</code>, <code>key_pass</code>, <code>mode</code>, <code>owner</code>, and <code>path</code> are the properties available to this resource.</li> </ul> <h3 id="actions-openssl-rsa-private-key">Actions</h3> <hr> <p>The <strong>openssl_rsa_private_key</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create the RSA private key file. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-openssl-rsa-private-key">Properties</h3> <hr> <p>The <strong>openssl_rsa_private_key</strong> resource has the following properties:</p> <dl> <dt> <code>force</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Force creation of the key even if the same key already exists on the node.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group ownership applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>key_cipher</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>des3</code> <p>The designed cipher to use when generating your key. Run <code>openssl list-cipher-algorithms</code> to see available options.</p> </dd> </dl> <dl> <dt> <code>key_length</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2048</code> <strong>Allowed Values:</strong> <code>1024, 2048, 4096, 8192</code> <p>The desired bit length of the generated key.</p> </dd> </dl> <dl> <dt> <code>key_pass</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The desired passphrase for the key.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>0600</code> <p>The permission mode applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The owner applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property for specifying the path to write the file to if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-openssl-rsa-private-key">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-openssl-rsa-private-key">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-openssl-rsa-private-key">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-openssl-rsa-private-key">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-openssl-rsa-private-key">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>openssl_rsa_private_key</strong> resource in recipes:</p> <p>Generate new 2048bit key with the default des3 cipher</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_rsa_private_key <span style="color:#4070a0">'/etc/ssl_files/rsakey_des3.pem'</span> <span style="color:#007020;font-weight:700">do</span>
  key_length <span style="color:#40a070">2048</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Generate new 1024bit key with the aes-128-cbc cipher</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_rsa_private_key <span style="color:#4070a0">'/etc/ssl_files/rsakey_aes128cbc.pem'</span> <span style="color:#007020;font-weight:700">do</span>
  key_length <span style="color:#40a070">1024</span>
  key_cipher <span style="color:#4070a0">'aes-128-cbc'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="openssl-rsa-public-key-resource">openssl_rsa_public_key resource</h2> <a href="openssl_rsa_public_key/index.html">openssl_rsa_public_key resource page</a> <hr> <p>Use the <strong>openssl_rsa_public_key</strong> resource to generate RSA public key files for a given RSA private key.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-openssl-rsa-public-key">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>openssl_rsa_public_key</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_rsa_public_key <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  group                    <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  mode                     <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "0640"</span>
  owner                    <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                     <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  private_key_content      <span style="color:#007020">String</span>
  private_key_pass         <span style="color:#007020">String</span>
  private_key_path         <span style="color:#007020">String</span>
  action                   <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>openssl_rsa_public_key</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>group</code>, <code>mode</code>, <code>owner</code>, <code>path</code>, <code>private_key_content</code>, <code>private_key_pass</code>, and <code>private_key_path</code> are the properties available to this resource.</li> </ul> <h3 id="actions-openssl-rsa-public-key">Actions</h3> <hr> <p>The <strong>openssl_rsa_public_key</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create the RSA public key file. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-openssl-rsa-public-key">Properties</h3> <hr> <p>The <strong>openssl_rsa_public_key</strong> resource has the following properties:</p> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group ownership applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>0640</code> <p>The permission mode applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The owner applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property for specifying the path to the public key if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>private_key_content</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The content of the private key, including new lines. This property is used in place of private_key_path in instances where you want to avoid having to first write the private key to disk.</p> </dd> </dl> <dl> <dt> <code>private_key_pass</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The passphrase of the provided private key.</p> </dd> </dl> <dl> <dt> <code>private_key_path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to the private key file.</p> </dd> </dl> <br> <h3 id="functionality-openssl-rsa-public-key">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-openssl-rsa-public-key">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-openssl-rsa-public-key">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-openssl-rsa-public-key">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-openssl-rsa-public-key">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>openssl_rsa_public_key</strong> resource in recipes:</p> <p>Generate new public key from a private key on disk</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_rsa_public_key <span style="color:#4070a0">'/etc/ssl_files/rsakey_des3.pub'</span> <span style="color:#007020;font-weight:700">do</span>
  private_key_path <span style="color:#4070a0">'/etc/ssl_files/rsakey_des3.pem'</span>
  private_key_pass <span style="color:#4070a0">'something'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Generate new public key by passing in a private key</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_rsa_public_key <span style="color:#4070a0">'/etc/ssl_files/rsakey_2.pub'</span> <span style="color:#007020;font-weight:700">do</span>
  private_key_pass <span style="color:#4070a0">'something'</span>
  private_key_content <span style="color:#4070a0">"-----BEGIN RSA PRIVATE KEY-----
</span><span style="color:#4070a0">Proc-Type: 4,ENCRYPTED
</span><span style="color:#4070a0">DEK-Info: DES-EDE3-CBC,5EE0AE9A5FE3342E
</span><span style="color:#4070a0">yb930kj5/4/nd738dPx6XdbDrMCvqkldaz0rHNw8xsWvwARrl/QSPwROG3WY7ROl
</span><span style="color:#4070a0">EUttVlLaeVaqRPfQbmTUfzGI8kTMmDWKjw52gJUx2YJTYRgMHAB0dzYIRjeZAaeS
</span><span style="color:#4070a0">ypXnEfouVav+jKTmmehr1WuVKbzRhQDBSalzeUwsPi2+fb3Bfuo1dRW6xt8yFuc4
</span><span style="color:#4070a0">Akv1hCglymPzPHE2L0nSGjcgA2DZu+/S8/wZ4E63442NHPzO4VlLvpNvJrYpEWq9
</span><span style="color:#4070a0">B5mJzcdXPeOTjqd13olNTlOZMaKxu9QShu50GreCTVsl8VRkK8NtwbWuPGBZlIFa
</span><span style="color:#4070a0">jzlS/RaLuzNzfajaKMkcIYco9t7gN2DwnsACHKqEYT8248Ii3NQ+9/M5YcmpywQj
</span><span style="color:#4070a0">WGr0UFCSAdCky1lRjwT+zGQKohr+dVR1GaLem+rSZH94df4YBxDYw4rjsKoEhvXB
</span><span style="color:#4070a0">v2Vlx+G7Vl2NFiZzxUKh3MvQLr/NDElpG1pYWDiE0DIG13UqEG++cS870mcEyfFh
</span><span style="color:#4070a0">SF2SXYHLWyAhDK0viRDChJyFMduC4E7a2P9DJhL3ZvM0KZ1SLMwROc1XuZ704GwO
</span><span style="color:#4070a0">YUqtCX5OOIsTti1Z74jQm9uWFikhgWByhVtu6sYL1YTqtiPJDMFhA560zp/k/qLO
</span><span style="color:#4070a0">FKiM4eUWV8AI8AVwT6A4o45N2Ru8S48NQyvh/ADFNrgJbVSeDoYE23+DYKpzbaW9
</span><span style="color:#4070a0">00BD/EmUQqaQMc670vmI+CIdcdE7L1zqD6MZN7wtPaRIjx4FJBGsFoeDShr+LoTD
</span><span style="color:#4070a0">rwbadwrbc2Rf4DWlvFwLJ4pvNvdtY3wtBu79UCOol0+t8DVVSPVASsh+tp8XncDE
</span><span style="color:#4070a0">KRljj88WwBjX7/YlRWvQpe5y2UrsHI0pNy8TA1Xkf6GPr6aS2TvQD5gOrAVReSse
</span><span style="color:#4070a0">/kktCzZQotjmY1odvo90Zi6A9NCzkI4ZLgAuhiKDPhxZg61IeLppnfFw0v3H4331
</span><span style="color:#4070a0">V9SMYgr1Ftov0++x7q9hFPIHwZp6NHHOhdHNI80XkHqtY/hEvsh7MhFMYCgSY1pa
</span><span style="color:#4070a0">K/gMcZ/5Wdg9LwOK6nYRmtPtg6fuqj+jB3Rue5/p9dt4kfom4etCSeJPdvP1Mx2I
</span><span style="color:#4070a0">eNmyQ/7JN9N87FsfZsIj5OK9OB0fPdj0N0m1mlHM/mFt5UM5x39u13QkCt7skEF+
</span><span style="color:#4070a0">yOptXcL629/xwm8eg4EXnKFk330WcYSw+sYmAQ9ZTsBxpCMkz0K4PBTPWWXx63XS
</span><span style="color:#4070a0">c4J0r88kbCkMCNv41of8ceeGzFrC74dG7i3IUqZzMzRP8cFeps8auhweUHD2hULs
</span><span style="color:#4070a0">XwwtII0YQ6/Fw4hgGQ5//0ASdvAicvH0l1jOQScHzXC2QWNg3GttueB/kmhMeGGm
</span><span style="color:#4070a0">sHOJ1rXQ4oEckFvBHOvzjP3kuRHSWFYDx35RjWLAwLCG9odQUApHjLBgFNg9yOR0
</span><span style="color:#4070a0">jW9a2SGxRvBAfdjTa9ZBBrbjlaF57hq7mXws90P88RpAL+xxCAZUElqeW2Rb2rQ6
</span><span style="color:#4070a0">Cbz4/AtPekV1CYVodGkPutOsew2zjNqlNH+M8XzfonA60UAH20TEqAgLKwgfgr+a
</span><span style="color:#4070a0">c+rXp1AupBxat4EHYJiwXBB9XcVwyp5Z+/dXsYmLXzoMOnp8OFyQ9H8R7y9Y0PEu
</span><span style="color:#4070a0">-----END RSA PRIVATE KEY-----
</span><span style="color:#4070a0">"</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="openssl-x509-certificate-resource">openssl_x509_certificate resource</h2> <a href="openssl_x509_certificate/index.html">openssl_x509_certificate resource page</a> <hr> <p>Use the <strong>openssl_x509_certificate</strong> resource to generate signed or self-signed, PEM-formatted x509 certificates. If no existing key is specified, the resource will automatically generate a passwordless key with the certificate. If a CA private key and certificate are provided, the certificate will be signed with them.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>This resource was renamed from openssl_x509 to openssl_x509_certificate. The legacy name will continue to function, but cookbook code should be updated for the new resource name.</p> </div> </div> <p><strong>New in Chef Infra Client 14.4.</strong></p> <h3 id="syntax-openssl-x509-certificate">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>openssl_x509_certificate</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_x509_certificate <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  ca_cert_file             <span style="color:#007020">String</span>
  ca_key_file              <span style="color:#007020">String</span>
  ca_key_pass              <span style="color:#007020">String</span>
  city                     <span style="color:#007020">String</span>
  common_name              <span style="color:#007020">String</span>
  country                  <span style="color:#007020">String</span>
  csr_file                 <span style="color:#007020">String</span>
  email                    <span style="color:#007020">String</span>
  expire                   <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 365</span>
  extensions               <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {}</span>
  group                    <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  key_curve                <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "prime256v1"</span>
  key_file                 <span style="color:#007020">String</span>
  key_length               <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 2048</span>
  key_pass                 <span style="color:#007020">String</span>
  key_type                 <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "rsa"</span>
  mode                     <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>
  org                      <span style="color:#007020">String</span>
  org_unit                 <span style="color:#007020">String</span>
  owner                    <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                     <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  renew_before_expiry      <span style="color:#007020">Integer</span>
  state                    <span style="color:#007020">String</span>
  subject_alt_name         <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  action                   <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>openssl_x509_certificate</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>ca_cert_file</code>, <code>ca_key_file</code>, <code>ca_key_pass</code>, <code>city</code>, <code>common_name</code>, <code>country</code>, <code>csr_file</code>, <code>email</code>, <code>expire</code>, <code>extensions</code>, <code>group</code>, <code>key_curve</code>, <code>key_file</code>, <code>key_length</code>, <code>key_pass</code>, <code>key_type</code>, <code>mode</code>, <code>org</code>, <code>org_unit</code>, <code>owner</code>, <code>path</code>, <code>renew_before_expiry</code>, <code>state</code>, and <code>subject_alt_name</code> are the properties available to this resource.</li> </ul> <h3 id="actions-openssl-x509-certificate">Actions</h3> <hr> <p>The <strong>openssl_x509_certificate</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Generate a certificate file. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-openssl-x509-certificate">Properties</h3> <hr> <p>The <strong>openssl_x509_certificate</strong> resource has the following properties:</p> <dl> <dt> <code>ca_cert_file</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to the CA X509 Certificate on the filesystem. If the <code>ca_cert_file</code> property is specified, the <code>ca_key_file</code> property must also be specified, the certificate will be signed with them.</p> </dd> </dl> <dl> <dt> <code>ca_key_file</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to the CA private key on the filesystem. If the <code>ca_key_file</code> property is specified, the <code>ca_cert_file</code> property must also be specified, the certificate will be signed with them.</p> </dd> </dl> <dl> <dt> <code>ca_key_pass</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The passphrase for CA private key’s passphrase.</p> </dd> </dl> <dl> <dt> <code>city</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>L</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>common_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>CN</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>country</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>C</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>csr_file</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to a X509 Certificate Request (CSR) on the filesystem. If the <code>csr_file</code> property is specified, the resource will attempt to source a CSR from this location. If no CSR file is found, the resource will generate a Self-Signed Certificate and the certificate fields must be specified (common_name at last).</p> </dd> </dl> <dl> <dt> <code>email</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>email</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>expire</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>365</code> <p>Value representing the number of days from now through which the issued certificate cert will remain valid. The certificate will expire after this period.</p> </dd> </dl> <dl> <dt> <code>extensions</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> <p>Hash of X509 Extensions entries, in format <code>{ 'keyUsage' =&gt; { 'values' =&gt; %w( keyEncipherment digitalSignature), 'critical' =&gt; true } }</code>.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group ownership applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>key_curve</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>prime256v1</code> <strong>Allowed Values:</strong> <code>"prime256v1", "secp384r1", "secp521r1"</code> <p>The desired curve of the generated key (if key_type is equal to ‘ec’). Run <code>openssl ecparam -list_curves</code> to see available options.</p> </dd> </dl> <dl> <dt> <code>key_file</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to a certificate key file on the filesystem. If the key_file property is specified, the resource will attempt to source a key from this location. If no key file is found, the resource will generate a new key file at this location. If the key_file property is not specified, the resource will generate a key file in the same directory as the generated certificate, with the same name as the generated certificate.</p> </dd> </dl> <dl> <dt> <code>key_length</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2048</code> <strong>Allowed Values:</strong> <code>1024, 2048, 4096, 8192</code> <p>The desired bit length of the generated key (if key_type is equal to ‘rsa’).</p> </dd> </dl> <dl> <dt> <code>key_pass</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The passphrase for an existing key’s passphrase.</p> </dd> </dl> <dl> <dt> <code>key_type</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>rsa</code> <strong>Allowed Values:</strong> <code>"ec", "rsa"</code> <p>The desired type of the generated key.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>The permission mode applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>org</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>O</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>org_unit</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>OU</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The owner applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property for specifying the path to write the file to if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>renew_before_expiry</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The number of days before the expiry. The certificate will be automatically renewed when the value is reached.</p> <p> New in Chef Infra Client 15.7 </p> </dd> </dl> <dl> <dt> <code>state</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>ST</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>subject_alt_name</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>Array of Subject Alternative Name entries, in format <code>DNS:example.com</code> or <code>IP:1.2.3.4</code>.</p> </dd> </dl> <br> <h3 id="functionality-openssl-x509-certificate">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-openssl-x509-certificate">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-openssl-x509-certificate">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-openssl-x509-certificate">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-openssl-x509-certificate">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>openssl_x509_certificate</strong> resource in recipes:</p> <p>Create a simple self-signed certificate file</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_x509_certificate <span style="color:#4070a0">'/etc/httpd/ssl/mycert.pem'</span> <span style="color:#007020;font-weight:700">do</span>
  common_name <span style="color:#4070a0">'www.f00bar.com'</span>
  org <span style="color:#4070a0">'Foo Bar'</span>
  org_unit <span style="color:#4070a0">'Lab'</span>
  country <span style="color:#4070a0">'US'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create a certificate using additional options</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_x509_certificate <span style="color:#4070a0">'/etc/ssl_files/my_signed_cert.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  common_name <span style="color:#4070a0">'www.f00bar.com'</span>
  ca_key_file <span style="color:#4070a0">'/etc/ssl_files/my_ca.key'</span>
  ca_cert_file <span style="color:#4070a0">'/etc/ssl_files/my_ca.crt'</span>
  expire <span style="color:#40a070">365</span>
  extensions(
    <span style="color:#4070a0">'keyUsage'</span> <span style="color:#666">=&gt;</span> {
      <span style="color:#4070a0">'values'</span> <span style="color:#666">=&gt;</span> <span style="color:#c65d09">%w(
</span><span style="color:#c65d09">        keyEncipherment
</span><span style="color:#c65d09">        digitalSignature)</span>,
      <span style="color:#4070a0">'critical'</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>,
    },
    <span style="color:#4070a0">'extendedKeyUsage'</span> <span style="color:#666">=&gt;</span> {
      <span style="color:#4070a0">'values'</span> <span style="color:#666">=&gt;</span> <span style="color:#c65d09">%w(serverAuth)</span>,
      <span style="color:#4070a0">'critical'</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">false</span>,
    }
  )
  subject_alt_name <span style="color:#666">[</span><span style="color:#4070a0">'IP:127.0.0.1'</span>, <span style="color:#4070a0">'DNS:localhost.localdomain'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="openssl-x509-crl-resource">openssl_x509_crl resource</h2> <a href="openssl_x509_crl/index.html">openssl_x509_crl resource page</a> <hr> <p>Use the <strong>openssl_x509_crl</strong> resource to generate PEM-formatted x509 certificate revocation list (CRL) files.</p> <p><strong>New in Chef Infra Client 14.4.</strong></p> <h3 id="syntax-openssl-x509-crl">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>openssl_x509_crl</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_x509_crl <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  ca_cert_file           <span style="color:#007020">String</span>
  ca_key_file            <span style="color:#007020">String</span>
  ca_key_pass            <span style="color:#007020">String</span>
  expire                 <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 8</span>
  group                  <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  mode                   <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>
  owner                  <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                   <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  renewal_threshold      <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 1</span>
  revocation_reason      <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 0</span>
  serial_to_revoke       <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>
  action                 <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>openssl_x509_crl</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>ca_cert_file</code>, <code>ca_key_file</code>, <code>ca_key_pass</code>, <code>expire</code>, <code>group</code>, <code>mode</code>, <code>owner</code>, <code>path</code>, <code>renewal_threshold</code>, <code>revocation_reason</code>, and <code>serial_to_revoke</code> are the properties available to this resource.</li> </ul> <h3 id="actions-openssl-x509-crl">Actions</h3> <hr> <p>The <strong>openssl_x509_crl</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create the certificate revocation list (CRL) file. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-openssl-x509-crl">Properties</h3> <hr> <p>The <strong>openssl_x509_crl</strong> resource has the following properties:</p> <dl> <dt> <code>ca_cert_file</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The path to the CA X509 Certificate on the filesystem. If the <code>ca_cert_file</code> property is specified, the <code>ca_key_file</code> property must also be specified, the CRL will be signed with them.</p> </dd> </dl> <dl> <dt> <code>ca_key_file</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The path to the CA private key on the filesystem. If the <code>ca_key_file</code> property is specified, the <code>ca_cert_file</code> property must also be specified, the CRL will be signed with them.</p> </dd> </dl> <dl> <dt> <code>ca_key_pass</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The passphrase for CA private key’s passphrase.</p> </dd> </dl> <dl> <dt> <code>expire</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>8</code> <p>Value representing the number of days from now through which the issued CRL will remain valid. The CRL will expire after this period.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group permission for the CRL file.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>The permission mode of the CRL file.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The owner permission for the CRL file.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property for specifying the path to write the file to if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>renewal_threshold</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>1</code> <p>Number of days before the expiration. It this threshold is reached, the CRL will be renewed.</p> </dd> </dl> <dl> <dt> <code>revocation_reason</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code> <p>Reason for the revocation.</p> </dd> </dl> <dl> <dt> <code>serial_to_revoke</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>Serial of the X509 Certificate to revoke.</p> </dd> </dl> <br> <h3 id="functionality-openssl-x509-crl">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-openssl-x509-crl">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-openssl-x509-crl">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-openssl-x509-crl">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-openssl-x509-crl">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>openssl_x509_crl</strong> resource in recipes:</p> <p><strong>Create a certificate revocation file</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_x509_crl <span style="color:#4070a0">'/etc/ssl_test/my_ca.crl'</span> <span style="color:#007020;font-weight:700">do</span>
  ca_cert_file <span style="color:#4070a0">'/etc/ssl_test/my_ca.crt'</span>
  ca_key_file <span style="color:#4070a0">'/etc/ssl_test/my_ca.key'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a certificate revocation file for a particular serial</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_x509_crl <span style="color:#4070a0">'/etc/ssl_test/my_ca.crl'</span> <span style="color:#007020;font-weight:700">do</span>
  ca_cert_file <span style="color:#4070a0">'/etc/ssl_test/my_ca.crt'</span>
  ca_key_file <span style="color:#4070a0">'/etc/ssl_test/my_ca.key'</span>
  serial_to_revoke <span style="color:#60add5">C7BCB6602A2E4251EF4E2827A228CB52BC0CEA2F</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="openssl-x509-request-resource">openssl_x509_request resource</h2> <a href="openssl_x509_request/index.html">openssl_x509_request resource page</a> <hr> <p>Use the <strong>openssl_x509_request</strong> resource to generate PEM-formatted x509 certificates requests. If no existing key is specified, the resource will automatically generate a passwordless key with the certificate.</p> <p><strong>New in Chef Infra Client 14.4.</strong></p> <h3 id="syntax-openssl-x509-request">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>openssl_x509_request</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_x509_request <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  city             <span style="color:#007020">String</span>
  common_name      <span style="color:#007020">String</span>
  country          <span style="color:#007020">String</span>
  email            <span style="color:#007020">String</span>
  group            <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  key_curve        <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "prime256v1"</span>
  key_file         <span style="color:#007020">String</span>
  key_length       <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 2048</span>
  key_pass         <span style="color:#007020">String</span>
  key_type         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "ec"</span>
  mode             <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>
  org              <span style="color:#007020">String</span>
  org_unit         <span style="color:#007020">String</span>
  owner            <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path             <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  state            <span style="color:#007020">String</span>
  action           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>openssl_x509_request</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>city</code>, <code>common_name</code>, <code>country</code>, <code>email</code>, <code>group</code>, <code>key_curve</code>, <code>key_file</code>, <code>key_length</code>, <code>key_pass</code>, <code>key_type</code>, <code>mode</code>, <code>org</code>, <code>org_unit</code>, <code>owner</code>, <code>path</code>, and <code>state</code> are the properties available to this resource.</li> </ul> <h3 id="actions-openssl-x509-request">Actions</h3> <hr> <p>The <strong>openssl_x509_request</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Generate a certificate request file. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-openssl-x509-request">Properties</h3> <hr> <p>The <strong>openssl_x509_request</strong> resource has the following properties:</p> <dl> <dt> <code>city</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>L</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>common_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>Value for the <code>CN</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>country</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>C</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>email</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>email</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group ownership applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>key_curve</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>prime256v1</code> <strong>Allowed Values:</strong> <code>"prime256v1", "secp384r1", "secp521r1"</code> <p>The desired curve of the generated key (if key_type is equal to <code>ec</code>). Run <code>openssl ecparam -list_curves</code> to see available options.</p> </dd> </dl> <dl> <dt> <code>key_file</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to a certificate key file on the filesystem. If the <code>key_file</code> property is specified, the resource will attempt to source a key from this location. If no key file is found, the resource will generate a new key file at this location. If the <code>key_file</code> property is not specified, the resource will generate a key file in the same directory as the generated certificate, with the same name as the generated certificate.</p> </dd> </dl> <dl> <dt> <code>key_length</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2048</code> <strong>Allowed Values:</strong> <code>1024, 2048, 4096, 8192</code> <p>The desired bit length of the generated key (if key_type is equal to <code>rsa</code>).</p> </dd> </dl> <dl> <dt> <code>key_pass</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The passphrase for an existing key’s passphrase.</p> </dd> </dl> <dl> <dt> <code>key_type</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>ec</code> <strong>Allowed Values:</strong> <code>"ec", "rsa"</code> <p>The desired type of the generated key.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>The permission mode applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>org</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>O</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>org_unit</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>OU</code> certificate field.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The owner applied to all files created by the resource.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property for specifying the path to write the file to if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>state</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Value for the <code>ST</code> certificate field.</p> </dd> </dl> <br> <h3 id="functionality-openssl-x509-request">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-openssl-x509-request">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-openssl-x509-request">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-openssl-x509-request">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-openssl-x509-request">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>openssl_x509_request</strong> resource in recipes:</p> <p><strong>Generate new EC key and CSR file</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_x509_request <span style="color:#4070a0">'/etc/ssl_files/my_ec_request.csr'</span> <span style="color:#007020;font-weight:700">do</span>
  common_name <span style="color:#4070a0">'myecrequest.example.com'</span>
  org <span style="color:#4070a0">'Test Kitchen Example'</span>
  org_unit <span style="color:#4070a0">'Kitchens'</span>
  country <span style="color:#4070a0">'UK'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Generate a new CSR file from an existing EC key</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_x509_request <span style="color:#4070a0">'/etc/ssl_files/my_ec_request2.csr'</span> <span style="color:#007020;font-weight:700">do</span>
  common_name <span style="color:#4070a0">'myecrequest2.example.com'</span>
  org <span style="color:#4070a0">'Test Kitchen Example'</span>
  org_unit <span style="color:#4070a0">'Kitchens'</span>
  country <span style="color:#4070a0">'UK'</span>
  key_file <span style="color:#4070a0">'/etc/ssl_files/my_ec_request.key'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Generate new RSA key and CSR file</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">openssl_x509_request <span style="color:#4070a0">'/etc/ssl_files/my_rsa_request.csr'</span> <span style="color:#007020;font-weight:700">do</span>
  common_name <span style="color:#4070a0">'myrsarequest.example.com'</span>
  org <span style="color:#4070a0">'Test Kitchen Example'</span>
  org_unit <span style="color:#4070a0">'Kitchens'</span>
  country <span style="color:#4070a0">'UK'</span>
  key_type <span style="color:#4070a0">'rsa'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="osx-profile-resource">osx_profile resource</h2> <a href="osx_profile/index.html">osx_profile resource page</a> <hr> <p>Use the <strong>osx_profile</strong> resource to manage configuration profiles (<code>.mobileconfig</code> files) on the macOS platform. The <strong>osx_profile</strong> resource installs profiles by using the uuidgen library to generate a unique <code>ProfileUUID</code>, and then using the <code>profiles</code> command to install the profile on the system.</p> <p><strong>New in Chef Infra Client 12.7.</strong></p> <h3 id="syntax-osx-profile">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>osx_profile</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">osx_profile <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  identifier        <span style="color:#007020">String</span>
  profile           <span style="color:#007020">String</span>, <span style="color:#60add5">Hash</span>
  profile_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>osx_profile</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>identifier</code>, <code>profile</code>, and <code>profile_name</code> are the properties available to this resource.</li> </ul> <h3 id="actions-osx-profile">Actions</h3> <hr> <p>The <strong>osx_profile</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install the specified configuration profile. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove the specified configuration profile.</dd> </dl> <h3 id="properties-osx-profile">Properties</h3> <hr> <p>The <strong>osx_profile</strong> resource has the following properties:</p> <dl> <dt> <code>identifier</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Use to specify the identifier for the profile, such as <code>com.company.screensaver</code>.</p> </dd> </dl> <dl> <dt> <code>profile</code> </dt> <dd> <strong>Ruby Type:</strong> String, Hash <p>Use to specify a profile. This may be the name of a profile contained in a cookbook or a Hash that contains the contents of the profile.</p> </dd> </dl> <dl> <dt> <code>profile_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>Use to specify the name of the profile, if different from the name of the resource block.</p> </dd> </dl> <br> <h3 id="functionality-osx-profile">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-osx-profile">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-osx-profile">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-osx-profile">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-osx-profile">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>osx_profile</strong> resource in recipes:</p> <p><strong>Install a profile from a cookbook file</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">osx_profile <span style="color:#4070a0">'com.company.screensaver.mobileconfig'</span>
</code></pre></div>
<p><strong>Install profile from a hash</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">profile_hash <span style="color:#666">=</span> {
  <span style="color:#4070a0">'PayloadIdentifier'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'com.company.screensaver'</span>,
  <span style="color:#4070a0">'PayloadRemovalDisallowed'</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">false</span>,
  <span style="color:#4070a0">'PayloadScope'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'System'</span>,
  <span style="color:#4070a0">'PayloadType'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'Configuration'</span>,
  <span style="color:#4070a0">'PayloadUUID'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'1781fbec-3325-565f-9022-8aa28135c3cc'</span>,
  <span style="color:#4070a0">'PayloadOrganization'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'Chef'</span>,
  <span style="color:#4070a0">'PayloadVersion'</span> <span style="color:#666">=&gt;</span> <span style="color:#40a070">1</span>,
  <span style="color:#4070a0">'PayloadDisplayName'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'Screensaver Settings'</span>,
  <span style="color:#4070a0">'PayloadContent'</span> <span style="color:#666">=&gt;</span> <span style="color:#666">[</span>
    {
      <span style="color:#4070a0">'PayloadType'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'com.apple.ManagedClient.preferences'</span>,
      <span style="color:#4070a0">'PayloadVersion'</span> <span style="color:#666">=&gt;</span> <span style="color:#40a070">1</span>,
      <span style="color:#4070a0">'PayloadIdentifier'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'com.company.screensaver'</span>,
      <span style="color:#4070a0">'PayloadUUID'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'73fc30e0-1e57-0131-c32d-000c2944c108'</span>,
      <span style="color:#4070a0">'PayloadEnabled'</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>,
      <span style="color:#4070a0">'PayloadDisplayName'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'com.apple.screensaver'</span>,
      <span style="color:#4070a0">'PayloadContent'</span> <span style="color:#666">=&gt;</span> {
        <span style="color:#4070a0">'com.apple.screensaver'</span> <span style="color:#666">=&gt;</span> {
          <span style="color:#4070a0">'Forced'</span> <span style="color:#666">=&gt;</span> <span style="color:#666">[</span>
            {
              <span style="color:#4070a0">'mcx_preference_settings'</span> <span style="color:#666">=&gt;</span> {
                <span style="color:#4070a0">'idleTime'</span> <span style="color:#666">=&gt;</span> <span style="color:#40a070">0</span>,
              },
            },
          <span style="color:#666">]</span>,
        },
      },
    },
  <span style="color:#666">]</span>,
}

osx_profile <span style="color:#4070a0">'Install screensaver profile'</span> <span style="color:#007020;font-weight:700">do</span>
  profile profile_hash
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove profile using identifier in resource name</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">osx_profile <span style="color:#4070a0">'com.company.screensaver'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove profile by identifier and user friendly resource name</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">osx_profile <span style="color:#4070a0">'Remove screensaver profile'</span> <span style="color:#007020;font-weight:700">do</span>
  identifier <span style="color:#4070a0">'com.company.screensaver'</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="package-resource">package resource</h2> <a href="package/index.html">package resource page</a> <hr> 
<p>Use the <strong>package</strong> resource to manage packages. When the package is installed from a local file (such as with RubyGems, dpkg, or RPM Package Manager), the file must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p> <p>This resource is the base resource for several other resources used for package management on specific platforms. While it is possible to use each of these specific resources, it is recommended to use the <strong>package</strong> resource as often as possible.</p> <p>For more information about specific resources for specific platforms, see the following topics:</p> <ul> <li><a href="apt_package/index.html">apt_package</a></li> <li><a href="bff_package/index.html">bff_package</a></li> <li><a href="cab_package/index.html">cab_package</a></li> <li><a href="chef_gem/index.html">chef_gem</a></li> <li><a href="chocolatey_package/index.html">chocolatey_package</a></li> <li><a href="dmg_package/index.html">dmg_package</a></li> <li><a href="dnf_package/index.html">dnf_package</a></li> <li><a href="dpkg_package/index.html">dpkg_package</a></li> <li><a href="freebsd_package/index.html">freebsd_package</a></li> <li><a href="gem_package/index.html">gem_package</a></li> <li><a href="homebrew_package/index.html">homebrew_package</a></li> <li><a href="ips_package/index.html">ips_package</a></li> <li><a href="macports_package/index.html">macports_package</a></li> <li><a href="msu_package/index.html">msu_package</a></li> <li><a href="openbsd_package/index.html">openbsd_package</a></li> <li><a href="pacman_package/index.html">pacman_package</a></li> <li><a href="paludis_package/index.html">paludis_package</a></li> <li><a href="portage_package/index.html">portage_package</a></li> <li><a href="rpm_package/index.html">rpm_package</a></li> <li><a href="smartos_package/index.html">smartos_package</a></li> <li><a href="snap_package/index.html">snap_package</a></li> <li><a href="solaris_package/index.html">solaris_package</a></li> <li><a href="windows_package/index.html">windows_package</a></li> <li><a href="yum_package/index.html">yum_package</a></li> <li><a href="zypper_package/index.html">zypper_package</a></li> </ul> <h3 id="syntax-package">Syntax</h3> <hr> 
<p>A <strong>package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>package</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'httpd'</span>
</code></pre></div>
<p>which will install Apache using all of the default options and the default action (<code>:install</code>).</p> <p>For a package that has different package names, depending on the platform, use a <code>case</code> statement within the <strong>package</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'Install Apache'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#007020;font-weight:700">case</span> node<span style="color:#666">[</span><span style="color:#517918">:platform</span><span style="color:#666">]</span>
  <span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'redhat'</span>, <span style="color:#4070a0">'centos'</span>
    package_name <span style="color:#4070a0">'httpd'</span>
  <span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'ubuntu'</span>, <span style="color:#4070a0">'debian'</span>
    package_name <span style="color:#4070a0">'apache2'</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>'redhat', 'centos'</code> will install Apache using the <code>httpd</code> package and <code>'ubuntu', 'debian'</code> will install it using the <code>apache2</code> package</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  allow_downgrade            <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># Yum, RPM packages only</span>
  arch                       <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># Yum packages only</span>
  default_release            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># Apt packages only</span>
  flush_cache                <span style="color:#007020">Array</span>
  gem_binary                 <span style="color:#007020">String</span>
  homebrew_user              <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># Homebrew packages only</span>
  notifies                   <span style="color:#60a0b0;font-style:italic"># see description</span>
  options                    <span style="color:#007020">String</span>
  package_name               <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># defaults to 'name' if not specified</span>
  response_file              <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># Apt packages only</span>
  response_file_variables    <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># Apt packages only</span>
  source                     <span style="color:#007020">String</span>
  subscribes                 <span style="color:#60a0b0;font-style:italic"># see description</span>
  timeout                    <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version                    <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>package</code> tells Chef Infra Client to manage a package; Chef Infra Client will determine the correct package provider to use based on the platform running on the node</li> <li>
<code>'name'</code> is the name of the package</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state</li> <li>
<code>allow_downgrade</code>, <code>arch</code>, <code>default_release</code>, <code>flush_cache</code>, <code>gem_binary</code>, <code>homebrew_user</code>, <code>options</code>, <code>package_name</code>, <code>response_file</code>, <code>response_file_variables</code>, <code>source</code>, <code>recursive</code>, <code>timeout</code>, and <code>version</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="package-options">Gem Package Options</h3> <p>The RubyGems package provider attempts to use the RubyGems API to install gems without spawning a new process, whenever possible. A gems command to install will be spawned under the following conditions:</p> <ul> <li>When a <code>gem_binary</code> property is specified (as a hash, a string, or by a .gemrc file), Chef Infra Client will run that command to examine its environment settings and then again to install the gem.</li> <li>When install options are specified as a string, Chef Infra Client will span a gems command with those options when installing the gem.</li> <li>The Chef installer will search the <code>PATH</code> for a gem command rather than defaulting to the current gem environment. As part of <code>enforce_default_paths</code>, the <code>bin</code> directories area added to the <code>PATH</code>, which means when there are no other proceeding RubyGems, the installation will still be operated against it.</li> </ul> <h4 id="package-options-hash">Specify with Hash</h4> <p>You should provide the install options as a hash if you are not using an explicit <code>gem_binary</code> parameter with the <code>gem_package</code> resource. This approach allows the provider to install the gem without needing to spawn an external gem process.</p> <p>The following RubyGems options are available for inclusion within a hash and are passed to the RubyGems DependencyInstaller:</p> <ul> <li><code>:env_shebang</code></li> <li><code>:force</code></li> <li><code>:format_executable</code></li> <li><code>:ignore_dependencies</code></li> <li><code>:prerelease</code></li> <li><code>:security_policy</code></li> <li><code>:wrappers</code></li> </ul> <p>For more information about these options, see the RubyGems documentation: <a href="https://docs.ruby-lang.org/en/2.2.0/Gem/DependencyInstaller.html">https://docs.ruby-lang.org/en/2.2.0/Gem/DependencyInstaller.html</a>.</p> <strong>Example</strong> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">gem_package <span style="color:#4070a0">'bundler'</span> <span style="color:#007020;font-weight:700">do</span>
  options(<span style="color:#517918">prerelease</span>: <span style="color:#007020">true</span>, <span style="color:#517918">format_executable</span>: <span style="color:#007020">false</span>)
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h4 id="package-options-string">Specify with String</h4> When using an explicit <code>gem_binary</code>, options must be passed as a string. When not using an explicit <code>gem_binary</code>, Chef Infra Client is forced to spawn a gems process to install the gems (which uses more system resources) when options are passed as a string. String options are passed verbatim to the gems command and should be specified just as if they were passed on a command line. For example, <code>--prerelease</code> for a pre-release gem. <strong>Example</strong> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">gem_package <span style="color:#4070a0">'nokogiri'</span> <span style="color:#007020;font-weight:700">do</span>
  gem_binary(<span style="color:#4070a0">'/opt/ree/bin/gem'</span>)
  options(<span style="color:#4070a0">'--prerelease --no-format-executable'</span>)
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h4 id="package-options-gemrc">Specify with .gemrc File</h4> Options can be specified in a .gemrc file. By default the <code>gem_package</code> resource will use the Ruby interface to install gems which will ignore the .gemrc file. The <code>gem_package</code> resource can be forced to use the gems command instead (and to read the .gemrc file) by adding the <code>gem_binary</code> attribute to a code block. <p>A template named <code>gemrc.erb</code> is located in a cookbook’s <code>/templates</code> directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#517918">:sources</span>:
<span style="color:#666">-</span> <span style="color:#517918">http</span>:<span style="color:#235388">//</span><span style="color:#666">&lt;</span><span style="color:#4070a0">%= node['gem_file']['host'] %&gt;:&lt;%=</span> node<span style="color:#666">[</span><span style="color:#4070a0">'gem_file'</span><span style="color:#666">][</span><span style="color:#4070a0">'port'</span><span style="color:#666">]</span> <span style="color:#666">%&gt;</span><span style="color:#235388">/
</span></code></pre></div>
<p>A recipe can be built that does the following:</p> <ul> <li>Builds a <code>.gemrc</code> file based on a <code>gemrc.erb</code> template</li> <li>Runs a <code>Gem.configuration</code> command</li> <li>Installs a package using the <code>.gemrc</code> file</li> </ul> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/root/.gemrc'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'gemrc.erb'</span>
  action <span style="color:#517918">:create</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'ruby_block[refresh_gemrc]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>

ruby_block <span style="color:#4070a0">'refresh_gemrc'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#60add5">Gem</span><span style="color:#666">.</span>configuration <span style="color:#666">=</span> <span style="color:#60add5">Gem</span><span style="color:#666">::</span><span style="color:#60add5">ConfigFile</span><span style="color:#666">.</span>new <span style="color:#666">[]</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>

gem_package <span style="color:#4070a0">'di-ruby-lvm'</span> <span style="color:#007020;font-weight:700">do</span>
  gem_binary <span style="color:#4070a0">'/opt/chef/embedded/bin/gem'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h3 id="actions-package">Actions</h3> <hr> <p>The <strong>package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package. (Debian platform only; for other platforms, use the <code>:remove</code> action.)</dd> <dt><code>:reconfig</code></dt> <dd>Reconfigure a package. This action requires a response file.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-package">Properties</h3> <hr> <p>The <strong>package</strong> resource has the following properties:</p> <dl> <dt> <code>allow_downgrade</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p><strong>yum_package</strong> resource only. Downgrade a package to satisfy requested version requirements.</p> </dd> </dl> <dl> <dt> <code>arch</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p><strong>yum_package</strong> resource only. The architecture of the package to be installed or upgraded. This value can also be passed as part of the package name.</p> </dd> </dl> <dl> <dt> <code>default_release</code> </dt> <dd> <strong>Ruby Type:</strong> String <p><strong>apt_package</strong> resource only. The default release. For example: <code>stable</code>.</p> </dd> </dl> <dl> <dt> <code>flush_cache</code> </dt> <dd> <strong>Ruby Type:</strong> Array <p>Flush the in-memory cache before or after a Yum operation that installs, upgrades, or removes a package. Default value: <code>[ :before, :after ]</code>. The value may also be a Hash: <code>( { :before =&gt; true/false, :after =&gt; true/false } )</code>.</p> <p> Yum automatically synchronizes remote metadata to a local cache. Chef Infra Client creates a copy of the local cache, and then stores it in-memory during a Chef Infra Client run. The in-memory cache allows packages to be installed during a Chef Infra Client run without the need to continue synchronizing the remote metadata to the local cache while the Chef Infra Client run is in-progress. </p> 
<p>As an array:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'some-package'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic">#...</span>
  flush_cache <span style="color:#666">[</span> <span style="color:#517918">:before</span> <span style="color:#666">]</span>
  <span style="color:#60a0b0;font-style:italic">#...</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and as a Hash:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'some-package'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic">#...</span>
  flush_cache( { <span style="color:#517918">:after</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span> } )
  <span style="color:#60a0b0;font-style:italic">#...</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The <code>flush_cache</code> property does not flush the local Yum cache! Use Yum tools—<code>yum clean headers</code>, <code>yum clean packages</code>, <code>yum clean all</code>—to clean the local Yum cache.</p> </div> </div> </dd> </dl> <dl> <dt> <code>gem_binary</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A property for the <code>gem_package</code> provider that is used to specify a gems binary.</p> </dd> </dl> <dl> <dt> <code>homebrew_user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p><strong>homebrew_package</strong> resource only. The name of the Homebrew owner to be used by Chef Infra Client when executing a command.</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One (or more) additional options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The name of the package. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <dl> <dt> <code>response_file</code> </dt> <dd> <strong>Ruby Type:</strong> String <p><strong>apt_package</strong> and <strong>dpkg_package</strong> resources only. The direct path to the file used to pre-seed a package.</p> </dd> </dl> <dl> <dt> <code>response_file_variables</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p><strong>apt_package</strong> and <strong>dpkg_package</strong> resources only. A Hash of response file variables in the form of <code>{"VARIABLE" =&gt; "VALUE"}</code>.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Optional. The path to a package in the local file system.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The AIX platform requires <code>source</code> to be a local file system path because <code>installp</code> does not retrieve packages using HTTP or FTP.</p> </div> </div> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <h4 id="multiple-packages-properties-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <br> <h3 id="functionality-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="multiple-packages-common-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <h3 id="examples-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>package</strong> resource in recipes:</p> <p>Install a gems file for use in recipes</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_gem <span style="color:#4070a0">'right_aws'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#007020">require</span> <span style="color:#4070a0">'right_aws'</span>
</code></pre></div>
<p>Install a gems file from the local file system</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">gem_package <span style="color:#4070a0">'right_aws'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'/tmp/right_aws-1.11.0.gem'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'tar'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install a package version</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'tar'</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#4070a0">'1.16.1-1'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install a package with options</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'debian-archive-keyring'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  options <span style="color:#4070a0">'--force-yes'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install a package with a response_file</p> <p>Use of a <code>response_file</code> is only supported on Debian and Ubuntu at this time. Custom resources must be written to support the use of a <code>response_file</code>, which contains debconf answers to questions normally asked by the package manager on installation. Put the file in <code>/files/default</code> of the cookbook where the package is specified and Chef Infra Client will use the <strong>cookbook_file</strong> resource to retrieve it.</p> <p>To install a package with a <code>response_file</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'sun-java6-jdk'</span> <span style="color:#007020;font-weight:700">do</span>
  response_file <span style="color:#4070a0">'java.seed'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install a specified architecture using a named provider</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'glibc-devel'</span> <span style="color:#007020;font-weight:700">do</span>
  arch <span style="color:#4070a0">'i386'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purge a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'tar'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Remove a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'tar'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrade a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'tar'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use the ignore_failure common attribute</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">gem_package <span style="color:#4070a0">'syntax'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  ignore_failure <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Avoid unnecessary string interpolation</p> <p>Do this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'mysql-server'</span> <span style="color:#007020;font-weight:700">do</span>
  version node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'version'</span><span style="color:#666">]</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and not this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'mysql-server'</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'version'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install a package in a platform</p> <p>The following example shows how to use the <strong>package</strong> resource to install an application named <code>app</code> and ensure that the correct packages are installed for the correct platform:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'app_name'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#007020;font-weight:700">case</span> node<span style="color:#666">[</span><span style="color:#517918">:platform</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'ubuntu'</span>,<span style="color:#4070a0">'debian'</span>
  package <span style="color:#4070a0">'app_name-doc'</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:install</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'centos'</span>
  package <span style="color:#4070a0">'app_name-html'</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:install</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install sudo, then configure /etc/sudoers/ file</strong></p> <p>The following example shows how to install sudo and then configure the <code>/etc/sudoers</code> file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic">#  the following code sample comes from the ``default`` recipe in the ``sudo`` cookbook: https://github.com/chef-cookbooks/sudo</span>

package <span style="color:#4070a0">'sudo'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#007020;font-weight:700">if</span> node<span style="color:#666">[</span><span style="color:#4070a0">'authorization'</span><span style="color:#666">][</span><span style="color:#4070a0">'sudo'</span><span style="color:#666">][</span><span style="color:#4070a0">'include_sudoers_d'</span><span style="color:#666">]</span>
  directory <span style="color:#4070a0">'/etc/sudoers.d'</span> <span style="color:#007020;font-weight:700">do</span>
    mode        <span style="color:#4070a0">'0755'</span>
    owner       <span style="color:#4070a0">'root'</span>
    group       <span style="color:#4070a0">'root'</span>
    action      <span style="color:#517918">:create</span>
  <span style="color:#007020;font-weight:700">end</span>

  cookbook_file <span style="color:#4070a0">'/etc/sudoers.d/README'</span> <span style="color:#007020;font-weight:700">do</span>
    source      <span style="color:#4070a0">'README'</span>
    mode        <span style="color:#4070a0">'0440'</span>
    owner       <span style="color:#4070a0">'root'</span>
    group       <span style="color:#4070a0">'root'</span>
    action      <span style="color:#517918">:create</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>

template <span style="color:#4070a0">'/etc/sudoers'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'sudoers.erb'</span>
  mode <span style="color:#4070a0">'0440'</span>
  owner <span style="color:#4070a0">'root'</span>
  group platform?(<span style="color:#4070a0">'freebsd'</span>) ? <span style="color:#4070a0">'wheel'</span> : <span style="color:#4070a0">'root'</span>
  variables(
    <span style="color:#517918">:sudoers_groups</span> <span style="color:#666">=&gt;</span> node<span style="color:#666">[</span><span style="color:#4070a0">'authorization'</span><span style="color:#666">][</span><span style="color:#4070a0">'sudo'</span><span style="color:#666">][</span><span style="color:#4070a0">'groups'</span><span style="color:#666">]</span>,
    <span style="color:#517918">:sudoers_users</span> <span style="color:#666">=&gt;</span> node<span style="color:#666">[</span><span style="color:#4070a0">'authorization'</span><span style="color:#666">][</span><span style="color:#4070a0">'sudo'</span><span style="color:#666">][</span><span style="color:#4070a0">'users'</span><span style="color:#666">]</span>,
    <span style="color:#517918">:passwordless</span> <span style="color:#666">=&gt;</span> node<span style="color:#666">[</span><span style="color:#4070a0">'authorization'</span><span style="color:#666">][</span><span style="color:#4070a0">'sudo'</span><span style="color:#666">][</span><span style="color:#4070a0">'passwordless'</span><span style="color:#666">]</span>
  )
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where</p> <ul> <li>the <strong>package</strong> resource is used to install sudo</li> <li>the <code>if</code> statement is used to ensure availability of the <code>/etc/sudoers.d</code> directory</li> <li>the <strong>template</strong> resource tells Chef Infra Client where to find the <code>sudoers</code> template</li> <li>the <code>variables</code> property is a hash that passes values to template files (that are located in the <code>templates/</code> directory for the cookbook</li> </ul> <p>Use a case statement to specify the platform</p> <p>The following example shows how to use a case statement to tell Chef Infra Client which platforms and packages to install using cURL.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'curl'</span>
  <span style="color:#007020;font-weight:700">case</span> node<span style="color:#666">[</span><span style="color:#517918">:platform</span><span style="color:#666">]</span>
  <span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'redhat'</span>, <span style="color:#4070a0">'centos'</span>
    package <span style="color:#4070a0">'package_1'</span>
    package <span style="color:#4070a0">'package_2'</span>
    package <span style="color:#4070a0">'package_3'</span>
  <span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'ubuntu'</span>, <span style="color:#4070a0">'debian'</span>
    package <span style="color:#4070a0">'package_a'</span>
    package <span style="color:#4070a0">'package_b'</span>
    package <span style="color:#4070a0">'package_c'</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where <code>node[:platform]</code> for each node is identified by Ohai during every Chef Infra Client run. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'curl'</span>
  <span style="color:#007020;font-weight:700">case</span> node<span style="color:#666">[</span><span style="color:#517918">:platform</span><span style="color:#666">]</span>
  <span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'redhat'</span>, <span style="color:#4070a0">'centos'</span>
    package <span style="color:#4070a0">'zlib-devel'</span>
    package <span style="color:#4070a0">'openssl-devel'</span>
    package <span style="color:#4070a0">'libc6-dev'</span>
  <span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'ubuntu'</span>, <span style="color:#4070a0">'debian'</span>
    package <span style="color:#4070a0">'openssl'</span>
    package <span style="color:#4070a0">'pkg-config'</span>
    package <span style="color:#4070a0">'subversion'</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use symbols to reference attributes</p> <p>Symbols may be used to reference attributes:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'mysql-server'</span> <span style="color:#007020;font-weight:700">do</span>
  version node<span style="color:#666">[</span><span style="color:#517918">:mysql</span><span style="color:#666">][</span><span style="color:#517918">:version</span><span style="color:#666">]</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>instead of strings:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'mysql-server'</span> <span style="color:#007020;font-weight:700">do</span>
  version node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'version'</span><span style="color:#666">]</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use a whitespace array to simplify a recipe</p> <p>The following examples show different ways of doing the same thing. The first shows a series of packages that will be upgraded:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'package-a'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>

package <span style="color:#4070a0">'package-b'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>

package <span style="color:#4070a0">'package-c'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>

package <span style="color:#4070a0">'package-d'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and the next uses a single <strong>package</strong> resource and a whitespace array (<code>%w</code>):</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w{package-a package-b package-c package-d}</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Specify the Homebrew user with a UUID</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">homebrew_package <span style="color:#4070a0">'emacs'</span> <span style="color:#007020;font-weight:700">do</span>
  homebrew_user <span style="color:#40a070">1001</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Specify the Homebrew user with a string</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">homebrew_package <span style="color:#4070a0">'vim'</span> <span style="color:#007020;font-weight:700">do</span>
  homebrew_user <span style="color:#4070a0">'user1'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="pacman-package-resource">pacman_package resource</h2> <a href="pacman_package/index.html">pacman_package resource page</a> <hr> <p>Use the <strong>pacman_package</strong> resource to manage packages (using pacman) on the Arch Linux platform.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <h3 id="syntax-pacman-package">Syntax</h3> <hr> 
<p>A <strong>pacman_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>pacman_package</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">pacman_package <span style="color:#4070a0">'package_name'</span>
</code></pre></div>
<p>which will install the named package using all of the default options and the default action (<code>:install</code>).</p> <p>The full syntax for all of the properties that are available to the <strong>pacman_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">pacman_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  options           <span style="color:#007020">String</span>
  package_name      <span style="color:#007020">String</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version           <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>pacman_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-pacman-package">Actions</h3> <hr> <p>The <strong>pacman_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-pacman-package">Properties</h3> <hr> <p>The <strong>pacman_package</strong> resource has the following properties:</p> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <h4 id="multiple-packages-properties-pacman-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <br> <h3 id="functionality-pacman-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-pacman-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-pacman-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-pacman-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h4 id="multiple-packages-common-pacman-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <h3 id="examples-pacman-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>pacman_package</strong> resource in recipes:</p> <p>Install a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">pacman_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="paludis-package-resource">paludis_package resource</h2> <a href="paludis_package/index.html">paludis_package resource page</a> <hr> <p>Use the <strong>paludis_package</strong> resource to manage packages for the Paludis platform.</p> <h3 id="syntax-paludis-package">Syntax</h3> <hr> 
<p>A <strong>paludis_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>paludis_package</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">paludis_package <span style="color:#4070a0">'package_name'</span>
</code></pre></div>
<p>which will install the named package using all of the default options and the default action (<code>:install</code>).</p> <p>The full syntax for all of the properties that are available to the <strong>paludis_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">paludis_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  options           <span style="color:#007020">String</span>
  package_name      <span style="color:#007020">String</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 3600</span>
  version           <span style="color:#007020">String</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>paludis_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-paludis-package">Actions</h3> <hr> <p>The <strong>paludis_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-paludis-package">Properties</h3> <hr> <p>The <strong>paludis_package</strong> resource has the following properties:</p> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-paludis-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-paludis-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-paludis-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-paludis-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-paludis-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>paludis_package</strong> resource in recipes:</p> <p>Install a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">paludis_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="perl-resource">perl resource</h2> <a href="perl/index.html">perl resource page</a> <hr> <p>Use the <strong>perl</strong> resource to execute scripts using the Perl interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <code>not_if</code> and <code>only_if</code> to guard this resource for idempotence.</p> <h3 id="syntax-perl">Syntax</h3> <hr> 
<p>A <strong>perl</strong> resource block executes scripts Perl:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-perl" data-lang="perl">perl <span style="color:#4070a0">'hello world'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#666">&lt;&lt;-</span>EOH
    <span style="color:#007020;font-weight:700">print</span> <span style="color:#4070a0">"Hello world! From Chef and Perl."</span>;
  EOH
end
</code></pre></div> <p>where:</p> <ul> <li>
<code>code</code> specifies the command to run</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>perl</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">perl <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  code                       <span style="color:#007020">String</span>
  creates                    <span style="color:#007020">String</span>
  cwd                        <span style="color:#007020">String</span>
  environment                <span style="color:#60add5">Hash</span>
  flags                      <span style="color:#007020">String</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  notifies                   <span style="color:#60a0b0;font-style:italic"># see description</span>
  path                       <span style="color:#007020">Array</span>
  returns                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span>
  subscribes                 <span style="color:#60a0b0;font-style:italic"># see description</span>
  timeout                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Float</span>
  user                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  umask                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>perl</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>code</code>, <code>creates</code>, <code>cwd</code>, <code>environment</code>, <code>flags</code>, <code>group</code>, <code>path</code>, <code>returns</code>, <code>timeout</code>, <code>user</code>, and <code>umask</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-perl">Actions</h3> <hr> <p>The <strong>perl</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>Prevent a command from running. This action is used to specify that a command is run only when another resource notifies it.</dd> <dt><code>:run</code></dt> <dd>Default. Run a script.</dd> </dl> <h3 id="properties-perl">Properties</h3> <hr> <p>The <strong>perl</strong> resource has the following properties:</p> <dl> <dt> <code>code</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A quoted (" “) string of code to be executed.</p> </dd> </dl> <dl> <dt> <code>creates</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Prevent a command from creating a file when that file already exists.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The current working directory.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of environment variables in the form of <code>({"ENV_VARIABLE" =&gt; "VALUE"})</code>. (These variables must exist for a command to be run successfully.)</p> </dd> </dl> <dl> <dt> <code>flags</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One or more command line flags that are passed to the interpreter when a command is invoked.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group name or group ID that must be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>returns</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Array | <strong>Default Value:</strong> <code>0</code> <p>The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match.</p> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Float | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) a command is to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The user name or user ID that should be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>umask</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The file mode creation mask, or umask.</p> </dd> </dl> <br> <h3 id="functionality-perl">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="guards-perl">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-perl">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="plist-resource">plist resource</h2> <a href="plist/index.html">plist resource page</a> <hr> <p>Use the <strong>plist</strong> resource to set config values in plist files on macOS systems.</p> <p><strong>New in Chef Infra Client 16.0.</strong></p> <h3 id="syntax-plist">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>plist</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">plist <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  encoding      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "binary"</span>
  entry         <span style="color:#007020">String</span>
  group         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "wheel"</span>
  mode          <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  owner         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "root"</span>
  path          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  value         <span style="color:#007020">true</span>, <span style="color:#007020">false</span>, <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>, <span style="color:#007020">Float</span>, <span style="color:#60add5">Hash</span>
  action        <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :set if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>plist</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>encoding</code>, <code>entry</code>, <code>group</code>, <code>mode</code>, <code>owner</code>, <code>path</code>, and <code>value</code> are the properties available to this resource.</li> </ul> <h3 id="actions-plist">Actions</h3> <hr> <p>The <strong>plist</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:set</code></dt> <dd>Set a value in a plist file. (default)</dd> </dl> <h3 id="properties-plist">Properties</h3> <hr> <p>The <strong>plist</strong> resource has the following properties:</p> <dl> <dt> <code>encoding</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>binary</code>  </dd> </dl> <dl> <dt> <code>entry</code> </dt> <dd> <strong>Ruby Type:</strong> String  </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>wheel</code> <p>The group of the plist file.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The file mode of the plist file. Ex: ‘644’</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>root</code> <p>The owner of the plist file.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The path on disk to the plist file.</p> </dd> </dl> <dl> <dt> <code>value</code> </dt> <dd> <strong>Ruby Type:</strong> true, false, String, Integer, Float, Hash  </dd> </dl> <br> <h3 id="functionality-plist">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-plist">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-plist">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-plist">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-plist">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>plist</strong> resource in recipes:</p> <p><strong>Show hidden files in finder</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">plist <span style="color:#4070a0">'show hidden files'</span> <span style="color:#007020;font-weight:700">do</span>
  path <span style="color:#4070a0">'/Users/vagrant/Library/Preferences/com.apple.finder.plist'</span>
  entry <span style="color:#4070a0">'AppleShowAllFiles'</span>
  value <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="portage-package-resource">portage_package resource</h2> <a href="portage_package/index.html">portage_package resource page</a> <hr> <p>Use the <strong>portage_package</strong> resource to manage packages for the Gentoo platform.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <h3 id="syntax-portage-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>portage_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">portage_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  options           <span style="color:#007020">String</span>
  package_name      <span style="color:#007020">String</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 3600</span>
  version           <span style="color:#007020">String</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>portage_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-portage-package">Actions</h3> <hr> <p>The <strong>portage_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-portage-package">Properties</h3> <hr> <p>The <strong>portage_package</strong> resource has the following properties:</p> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-portage-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-portage-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-portage-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-portage-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-portage-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>portage_package</strong> resource in recipes:</p> <p>Install a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">portage_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="powershell-package-resource">powershell_package resource</h2> <a href="powershell_package/index.html">powershell_package resource page</a> <hr> <p>Use the <strong>powershell_package</strong> resource to install and manage packages via the PowerShell Package Manager for the Microsoft Windows platform. The <strong>powershell_package</strong> resource requires administrative access, and a source must be configured in the PowerShell Package Manager via the <a href="https://docs.microsoft.com/en-us/powershell/module/packagemanagement/register-packagesource?view=powershell-5.1">Register-PackageSource</a> command or the <a href="powershell_package_source/index.html">powershell_package_source</a> resource.</p> <p><strong>New in Chef Infra Client 12.16.</strong></p> <h3 id="syntax-powershell-package">Syntax</h3> <hr> 
<p>A <strong>powershell_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>powershell_package</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package <span style="color:#4070a0">'package_name'</span>
</code></pre></div>
<p>which will install the named package using all of the default options and the default action (<code>:install</code>).</p> <p>The powershell_package resource has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  options                   <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name              <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  skip_publisher_check      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  source                    <span style="color:#007020">String</span>
  timeout                   <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version                   <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action                    <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>powershell_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>options</code>, <code>package_name</code>, <code>skip_publisher_check</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-powershell-package">Actions</h3> <hr> <p>The <strong>powershell_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> </dl> <h3 id="properties-powershell-package">Properties</h3> <hr> <p>The <strong>powershell_package</strong> resource has the following properties:</p> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The name of the package. Default value: the name of the resource block.</p> </dd> </dl> <dl> <dt> <code>skip_publisher_check</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Skip validating module author.</p> <p> New in Chef Client 14.3 </p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specify the source of the package.</p> <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-powershell-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-powershell-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-powershell-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-powershell-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-powershell-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>powershell_package</strong> resource in recipes:</p> <p>Install a specific version of a package:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package <span style="color:#4070a0">'xCertificate'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  version <span style="color:#4070a0">'1.1.0.0'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package <span style="color:#4070a0">'Install Multiple Packages'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  package_name <span style="color:#c65d09">%w(xCertificate xNetworking)</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install a package from a custom source:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package <span style="color:#4070a0">'xCertificate'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  source <span style="color:#4070a0">'MyGallery'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install multiple packages, and specify package versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package <span style="color:#4070a0">'Install Multiple Packages'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  package_name <span style="color:#c65d09">%w(xCertificate xNetworking)</span>
  version <span style="color:#666">[</span><span style="color:#4070a0">'2.0.0.0'</span>, <span style="color:#4070a0">'2.12.0.0'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install multiple packages, specifying the package version for one package but not the other:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package <span style="color:#4070a0">'Install Multiple Packages'</span> <span style="color:#007020;font-weight:700">do</span>
   action <span style="color:#517918">:install</span>
   package_name <span style="color:#c65d09">%w(xCertificate xNetworking)</span>
   version <span style="color:#666">[</span><span style="color:#007020">nil</span>, <span style="color:#4070a0">'2.12.0.0'</span><span style="color:#666">]</span>
 <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this example, the <code>nil</code> tells <code>powershell_package</code> to install the most up to date version of <code>xCertificate</code> that is available, while pinning <code>xNetworking</code> to version 2.12.0.0.</p> <p>Remove a package:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package <span style="color:#4070a0">'xCertificate'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="powershell-package-source-resource">powershell_package_source resource</h2> <a href="powershell_package_source/index.html">powershell_package_source resource page</a> <hr> <p>Use the <strong>powershell_package_source</strong> resource to register a PowerShell package source and a Powershell package provider. There are two distinct objects we care about here. The first is a package source like a PowerShell repository or a NuGet Source. The second object is a provider that PowerShell uses to get to that source with, like PowerShellGet, NuGet, Chocolatey, etc.</p> <p><strong>New in Chef Infra Client 14.3.</strong></p> <h3 id="syntax-powershell-package-source">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>powershell_package_source</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package_source <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  new_name                     <span style="color:#007020">String</span>
  password                     <span style="color:#007020">String</span>
  provider_name                <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "NuGet"</span>
  publish_location             <span style="color:#007020">String</span>
  script_publish_location      <span style="color:#007020">String</span>
  script_source_location       <span style="color:#007020">String</span>
  source_location              <span style="color:#007020">String</span>
  source_name                  <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  trusted                      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  user                         <span style="color:#007020">String</span>
  action                       <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :register if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>powershell_package_source</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>new_name</code>, <code>password</code>, <code>provider_name</code>, <code>publish_location</code>, <code>script_publish_location</code>, <code>script_source_location</code>, <code>source_location</code>, <code>source_name</code>, <code>trusted</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h3 id="actions-powershell-package-source">Actions</h3> <hr> <p>The <strong>powershell_package_source</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:register</code></dt> <dd>Registers a PowerShell package source. (default)</dd> <dt><code>:set</code></dt> <dd>Updates an existing PowerShell repository or package source.</dd> <dt><code>:unregister</code></dt> <dd>Unregisters the PowerShell package source.</dd> </dl> <h3 id="properties-powershell-package-source">Properties</h3> <hr> <p>The <strong>powershell_package_source</strong> resource has the following properties:</p> <dl> <dt> <code>new_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Used to change the name of a standard package source.</p> <p> New in Chef Infra Client 17.6 </p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A password that, as part of a credential object, is used to register a repository or other package source with.</p> <p> New in Chef Infra Client 17.6 </p> </dd> </dl> <dl> <dt> <code>provider_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>NuGet</code> <strong>Allowed Values:</strong> <code>"NuGet", "PowerShellGet", "Programs", "chocolatey", "msi", "msu", "psl", "winget"</code> <p>The package management provider for the package source. The default is <code>PowerShellGet</code>. Only change this option in specific use cases.</p> </dd> </dl> <dl> <dt> <code>publish_location</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The URL where modules will be published to. Only valid if the provider is <code>PowerShellGet</code>.</p> </dd> </dl> <dl> <dt> <code>script_publish_location</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The location where scripts will be published to for this source. Only valid if the provider is <code>PowerShellGet</code>.</p> </dd> </dl> <dl> <dt> <code>script_source_location</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The URL where scripts are located for this source. Only valid if the provider is <code>PowerShellGet</code>.</p> </dd> </dl> <dl> <dt> <code>source_location</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The URL to the location to retrieve modules from.</p> <p> New in Chef Infra Client 17.6 </p> </dd> </dl> <dl> <dt> <code>source_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>A label that names your package source.</p> </dd> </dl> <dl> <dt> <code>trusted</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Whether or not to trust packages from this source. Used when creating a non-PowerShell repository package source.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A username that, as part of a credential object, is used to register a repository or other package source with.</p> <p> New in Chef Infra Client 17.6 </p> </dd> </dl> <br> <h3 id="functionality-powershell-package-source">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-powershell-package-source">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-powershell-package-source">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-powershell-package-source">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-powershell-package-source">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>powershell_package_source</strong> resource in recipes:</p> <p><strong>Add a new PowerShell repository that is not trusted and which requires credentials to connect to</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package_source <span style="color:#4070a0">'PowerShellModules'</span> <span style="color:#007020;font-weight:700">do</span>
  source_name                  <span style="color:#4070a0">"PowerShellModules"</span>
  source_location              <span style="color:#4070a0">"https://pkgs.dev.azure.com/some-org/some-project/_packaging/some_feed/nuget/v2"</span>
  publish_location             <span style="color:#4070a0">"https://pkgs.dev.azure.com/some-org/some-project/_packaging/some_feed/nuget/v2"</span>
  trusted                      <span style="color:#007020">false</span>
  user                         <span style="color:#4070a0">"someuser@somelocation.io"</span>
  password                     <span style="color:#4070a0">"my_password"</span>
  provider_name                <span style="color:#4070a0">"PSRepository"</span>
  action                       <span style="color:#517918">:register</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add a new package source that uses Chocolatey as the package provider</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package_source <span style="color:#4070a0">'PowerShellModules'</span> <span style="color:#007020;font-weight:700">do</span>
  source_name                  <span style="color:#4070a0">"PowerShellModules"</span>
  source_location              <span style="color:#4070a0">"https://pkgs.dev.azure.com/some-org/some-project/_packaging/some_feed/nuget/v2"</span>
  publish_location             <span style="color:#4070a0">"https://pkgs.dev.azure.com/some-org/some-project/_packaging/some_feed/nuget/v2"</span>
  trusted                      <span style="color:#007020">true</span>
  provider_name                <span style="color:#4070a0">"chocolatey"</span>
  action                       <span style="color:#517918">:register</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add a new PowerShell script source that is trusted</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package_source <span style="color:#4070a0">'MyDodgyScript'</span> <span style="color:#007020;font-weight:700">do</span>
  source_name                  <span style="color:#4070a0">"MyDodgyScript"</span>
  script_source_location       <span style="color:#4070a0">"https://pkgs.dev.azure.com/some-org/some-project/_packaging/some_feed/nuget/v2"</span>
  script_publish_location      <span style="color:#4070a0">"https://pkgs.dev.azure.com/some-org/some-project/_packaging/some_feed/nuget/v2"</span>
  trusted                      <span style="color:#007020">true</span>
  action                       <span style="color:#517918">:register</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Update an existing PowerShell repository to make it trusted</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package_source <span style="color:#4070a0">'MyPSModule'</span> <span style="color:#007020;font-weight:700">do</span>
  source_name                  <span style="color:#4070a0">"MyPSModule"</span>
  trusted                      <span style="color:#007020">true</span>
  action                       <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Update a Nuget package source with a new name and make it trusted</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package_source <span style="color:#4070a0">'PowerShellModules -&gt; GoldFishBowl'</span> <span style="color:#007020;font-weight:700">do</span>
  source_name                  <span style="color:#4070a0">"PowerShellModules"</span>
  new_name                     <span style="color:#4070a0">"GoldFishBowl"</span>
  provider_name                <span style="color:#4070a0">"Nuget"</span>
  trusted                      <span style="color:#007020">true</span>
  action                       <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Update a Nuget package source with a new name when the source is secured with a username and password</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package_source <span style="color:#4070a0">'PowerShellModules -&gt; GoldFishBowl'</span> <span style="color:#007020;font-weight:700">do</span>
  source_name                  <span style="color:#4070a0">"PowerShellModules"</span>
  new_name                     <span style="color:#4070a0">"GoldFishBowl"</span>
  trusted                      <span style="color:#007020">true</span>
  user                         <span style="color:#4070a0">"user@domain.io"</span>
  password                     <span style="color:#4070a0">"some_secret_password"</span>
  action                       <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Unregister a package source</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_package_source <span style="color:#4070a0">'PowerShellModules'</span> <span style="color:#007020;font-weight:700">do</span>
  source_name                  <span style="color:#4070a0">"PowerShellModules"</span>
  action                       <span style="color:#517918">:unregister</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="powershell-script-resource">powershell_script resource</h2> <a href="powershell_script/index.html">powershell_script resource page</a> <hr> 
<p>Use the <strong>powershell_script</strong> resource to execute a script using the Windows PowerShell interpreter, much like how the script and script-based resources <strong>bash</strong>, <strong>csh</strong>, <strong>perl</strong>, <strong>python</strong>, and <strong>ruby</strong> are used. The powershell_script is specific to the Microsoft Windows platform, but may use both the the Windows PowerShell interpreter or the PowerShell Core (pwsh) interpreter as of Chef Infra Client 16.6 and later.</p> <p>The powershell_script resource creates and executes a temporary file rather than running the command inline. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <code>not_if</code> and <code>only_if</code> conditionals to guard this resource for idempotence.</p> <h3 id="syntax-powershell-script">Syntax</h3> <hr> 
<p>A <strong>powershell_script</strong> resource block executes a batch script using the Windows PowerShell interpreter. For example, writing to an interpolated path:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_script <span style="color:#4070a0">'write-to-interpolated-path'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>  $stream <span style="color:#666">=</span> <span style="color:#666">[</span><span style="color:#60add5">System</span><span style="color:#666">.</span>IO<span style="color:#666">.</span>StreamWriter<span style="color:#666">]</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/powershell-test.txt"</span>
  $stream<span style="color:#666">.</span>WriteLine(<span style="color:#4070a0">"In </span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">...word."</span>)
  $stream<span style="color:#666">.</span>close()
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>The full syntax for all of the properties that are available to the <strong>powershell_script</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_script <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  code                        <span style="color:#007020">String</span>
  command                     <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  convert_boolean_return      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  creates                     <span style="color:#007020">String</span>
  cwd                         <span style="color:#007020">String</span>
  domain                      <span style="color:#007020">String</span>
  elevated                    <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  environment                 <span style="color:#60add5">Hash</span>
  flags                       <span style="color:#007020">String</span>
  group                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  input                       <span style="color:#007020">String</span>
  interpreter                 <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "powershell"</span>
  live_stream                 <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  password                    <span style="color:#007020">String</span>
  returns                     <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: 0</span>
  timeout                     <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>, <span style="color:#007020">Float</span> <span style="color:#60a0b0;font-style:italic"># default value: 3600</span>
  user                        <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action                      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>powershell_script</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>code</code>, <code>command</code>, <code>convert_boolean_return</code>, <code>creates</code>, <code>cwd</code>, <code>domain</code>, <code>elevated</code>, <code>environment</code>, <code>flags</code>, <code>group</code>, <code>input</code>, <code>interpreter</code>, <code>live_stream</code>, <code>password</code>, <code>returns</code>, <code>timeout</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h3 id="actions-powershell-script">Actions</h3> <hr> <p>The <strong>powershell_script</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:run</code></dt> <dd>Default. Run the script.</dd> </dl> <h3 id="properties-powershell-script">Properties</h3> <hr> <p>The <strong>powershell_script</strong> resource has the following properties:</p> <dl> <dt> <code>architecture</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol <p>The architecture of the process under which a script is executed. If a value is not provided, Chef Infra Client defaults to the correct value for the architecture, as determined by Ohai. An exception is raised when anything other than <code>:i386</code> is specified for a 32-bit process. Possible values: <code>:i386</code> (for 32-bit processes) and <code>:x86_64</code> (for 64-bit processes).</p> </dd> </dl> <dl> <dt> <code>code</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>A quoted string of code to be executed.</p> </dd> </dl> <dl> <dt> <code>command</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the command to be executed if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>convert_boolean_return</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> 
<p>Return <code>0</code> if the last line of a command is evaluated to be true or to return <code>1</code> if the last line is evaluated to be false.</p> <p>When the <code>guard_interpreter</code> common attribute is set to <code>:powershell_script</code>, a string command will be evaluated as if this value were set to <code>true</code>. This is because the behavior of this attribute is similar to the value of the <code>"$?"</code> expression common in UNIX interpreters. For example, this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_script <span style="color:#4070a0">'make_safe_backup'</span> <span style="color:#007020;font-weight:700">do</span>
  guard_interpreter <span style="color:#517918">:powershell_script</span>
  code <span style="color:#4070a0">'cp ~/data/nodes.json ~/data/nodes.bak'</span>
  not_if <span style="color:#4070a0">'test-path ~/data/nodes.bak'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>is similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'make_safe_backup'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">'cp ~/data/nodes.json ~/data/nodes.bak'</span>
  not_if <span style="color:#4070a0">'test -e ~/data/nodes.bak'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>creates</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Prevent a command from creating a file when that file already exists.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The current working directory from which the command will be run.</p> </dd> </dl> <dl> <dt> <code>domain</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The domain of the username specified by the user property. If not specified, the username and password specified by the <code>user</code> and <code>password</code> properties will be used to resolve that user against the domain in which the system running Chef Infra Client is joined, or if that system is not joined to a domain it will resolve the user as a local account on that system. An alternative way to specify the domain is to leave this property unspecified and specify the domain as part of the user property.</p> <p> New in Chef Client 12.21 </p> </dd> </dl> <dl> <dt> <code>elevated</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Determines whether the script will run with elevated permissions to circumvent User Access Control (UAC) from interactively blocking the process. This will cause the process to be run under a batch login instead of an interactive login. The user running chef-client needs the ‘Replace a process level token’ and ‘Adjust Memory Quotas for a process’ permissions. The user that is running the command needs the ‘Log on as a batch job’ permission. Because this requires a login, the user and password properties are required.</p> <p> New in Chef Client 13.3 </p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of environment variables in the form of <code>({'ENV_VARIABLE' =&gt; 'VALUE'})</code>. <strong>Note</strong>: These variables must exist for a command to be run successfully.</p> </dd> </dl> <dl> <dt> <code>flags</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A string that is passed to the Windows PowerShell command. Default value (Windows PowerShell 3.0+): <code>-NoLogo, -NonInteractive, -NoProfile, -ExecutionPolicy Bypass, -InputFormat None</code>.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group name or group ID that must be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>guard_interpreter</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:powershell_script</code> <p>When this property is set to <code>:powershell_script</code>, the 64-bit version of the Windows PowerShell shell will be used to evaluate strings values for the <code>not_if</code> and <code>only_if</code> properties. Set this value to <code>:default</code> to use the 32-bit version of the cmd.exe shell.</p> </dd> </dl> <dl> <dt> <code>input</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the input sent to the command as STDIN.</p> <p> New in Chef Infra Client 16.2 </p> </dd> </dl> <dl> <dt> <code>interpreter</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>powershell</code> <strong>Allowed Values:</strong> <code>"powershell", "pwsh"</code> <p>The interpreter type, <code>powershell</code> or <code>pwsh</code> (PowerShell Core)</p> </dd> </dl> <dl> <dt> <code>live_stream</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Send the output of the command run by this execute resource block to the Chef Infra Client event stream.</p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The password of the user specified by the user property. This property is mandatory if user is specified on Windows and may only be specified if user is specified. The sensitive property for this resource will automatically be set to true if password is specified.</p> <p> New in Chef Client 12.21 </p> </dd> </dl> <dl> <dt> <code>returns</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Array | <strong>Default Value:</strong> <code>0</code> <p>The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String, Float | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) a command is to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The user name of the user identity with which to launch the new process. The user name may optionally be specified with a domain, i.e. <code>domain\user</code> or <code>user@my.dns.domain.com</code> via Universal Principal Name (UPN)format. It can also be specified without a domain simply as user if the domain is instead specified using the domain property. On Windows only, if this property is specified, the password property must be specified.</p> </dd> </dl> <br> <h3 id="functionality-powershell-script">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-powershell-script">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-powershell-script">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-powershell-script">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-powershell-script">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>powershell_script</strong> resource in recipes:</p> <p>Write to an interpolated path</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_script <span style="color:#4070a0">'write-to-interpolated-path'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>  $stream <span style="color:#666">=</span> <span style="color:#666">[</span><span style="color:#60add5">System</span><span style="color:#666">.</span>IO<span style="color:#666">.</span>StreamWriter<span style="color:#666">]</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/powershell-test.txt"</span>
  $stream<span style="color:#666">.</span>WriteLine(<span style="color:#4070a0">"In </span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">...word."</span>)
  $stream<span style="color:#666">.</span>close()
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Change the working directory</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_script <span style="color:#4070a0">'cwd-then-write'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>  $stream <span style="color:#666">=</span> <span style="color:#666">[</span><span style="color:#60add5">System</span><span style="color:#666">.</span>IO<span style="color:#666">.</span>StreamWriter<span style="color:#666">]</span> <span style="color:#4070a0">"C:/powershell-test2.txt"</span>
  $pwd <span style="color:#666">=</span> pwd
  $stream<span style="color:#666">.</span>WriteLine(<span style="color:#4070a0">"This is the contents of: $pwd"</span>)
  $dirs <span style="color:#666">=</span> dir
  foreach ($dir <span style="color:#007020;font-weight:700">in</span> $dirs) {
    $stream<span style="color:#666">.</span>WriteLine($dir<span style="color:#666">.</span>fullname)
  }
  $stream<span style="color:#666">.</span>close()
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Change the working directory in Microsoft Windows</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_script <span style="color:#4070a0">'cwd-to-win-env-var'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#4070a0">'%TEMP%'</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>  $stream <span style="color:#666">=</span> <span style="color:#666">[</span><span style="color:#60add5">System</span><span style="color:#666">.</span>IO<span style="color:#666">.</span>StreamWriter<span style="color:#666">]</span> <span style="color:#4070a0">"./temp-write-from-chef.txt"</span>
  $stream<span style="color:#666">.</span>WriteLine(<span style="color:#4070a0">"chef on windows rox yo!"</span>)
  $stream<span style="color:#666">.</span>close()
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Pass an environment variable to a script</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_script <span style="color:#4070a0">'read-env-var'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
  environment ({<span style="color:#4070a0">'foo'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'BAZ'</span>})
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>  $stream <span style="color:#666">=</span> <span style="color:#666">[</span><span style="color:#60add5">System</span><span style="color:#666">.</span>IO<span style="color:#666">.</span>StreamWriter<span style="color:#666">]</span> <span style="color:#4070a0">"./test-read-env-var.txt"</span>
  $stream<span style="color:#666">.</span>WriteLine(<span style="color:#4070a0">"FOO is $env:foo"</span>)
  $stream<span style="color:#666">.</span>close()
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Evaluate for true and/or false</strong></p> <p>Use the <code>convert_boolean_return</code> attribute to raise an exception when certain conditions are met. For example, the following fragments will run successfully without error:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_script <span style="color:#4070a0">'false'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">'$false'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_script <span style="color:#4070a0">'true'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">'$true'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>whereas the following will raise an exception:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_script <span style="color:#4070a0">'false'</span> <span style="color:#007020;font-weight:700">do</span>
  convert_boolean_return <span style="color:#007020">true</span>
  code <span style="color:#4070a0">'$false'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use the flags attribute</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_script <span style="color:#4070a0">'Install IIS'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>  <span style="color:#60add5">Import</span><span style="color:#666">-</span><span style="color:#60add5">Module</span> <span style="color:#60add5">ServerManager</span>
  <span style="color:#60add5">Add</span><span style="color:#666">-</span><span style="color:#60add5">WindowsFeature</span> <span style="color:#60add5">Web</span><span style="color:#666">-</span><span style="color:#60add5">Server</span>
  <span style="color:#60add5">EOH</span>
  flags <span style="color:#4070a0">'-NoLogo, -NonInteractive, -NoProfile, -ExecutionPolicy Unrestricted, -InputFormat None, -File'</span>
  guard_interpreter <span style="color:#517918">:powershell_script</span>
  not_if <span style="color:#4070a0">'(Get-WindowsFeature -Name Web-Server).Installed'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Rename computer, join domain, reboot</p> <p>The following example shows how to rename a computer, join a domain, and then reboot the computer:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">reboot <span style="color:#4070a0">'Restart Computer'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

powershell_script <span style="color:#4070a0">'Rename and Join Domain'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span style="color:#666">...</span>your rename <span style="color:#007020;font-weight:700">and</span> domain join logic here<span style="color:#666">...</span>
  <span style="color:#60add5">EOH</span>
  not_if <span style="color:#4070a0">&lt;&lt;-EOH
</span>    $ComputerSystem <span style="color:#666">=</span> gwmi win32_computersystem
    ($ComputerSystem<span style="color:#666">.</span>Name <span style="color:#666">-</span>like <span style="color:#4070a0">'#{node['</span>some_attribute_that_has_the_new_name<span style="color:#4070a0">']}'</span>) <span style="color:#666">-</span><span style="color:#007020;font-weight:700">and</span>
      $ComputerSystem<span style="color:#666">.</span>partofdomain)
  <span style="color:#60add5">EOH</span>
  notifies <span style="color:#517918">:reboot_now</span>, <span style="color:#4070a0">'reboot[Restart Computer]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where:</p> <ul> <li>The <strong>powershell_script</strong> resource block renames a computer, and then joins a domain</li> <li>The <strong>reboot</strong> resource restarts the computer</li> <li>The <code>not_if</code> guard prevents the Windows PowerShell script from running when the settings in the <code>not_if</code> guard match the desired state</li> <li>The <code>notifies</code> statement tells the <strong>reboot</strong> resource block to run if the <strong>powershell_script</strong> block was executed during a Chef Infra Client run</li> </ul> <p>Run a command as an alternate user</p> <p><em>Note</em>: When Chef is running as a service, this feature requires that the user that Chef runs as has ‘SeAssignPrimaryTokenPrivilege’ (aka ‘SE_ASSIGNPRIMARYTOKEN_NAME’) user right. By default only LocalSystem and NetworkService have this right when running as a service. This is necessary even if the user is an Administrator.</p> <p>This right can be added and checked in a recipe using this example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># Add 'SeAssignPrimaryTokenPrivilege' for the user</span>
<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">ReservedNames</span><span style="color:#666">::</span><span style="color:#60add5">Win32</span><span style="color:#666">::</span><span style="color:#60add5">Security</span><span style="color:#666">.</span>add_account_right(<span style="color:#4070a0">'&lt;user&gt;'</span>, <span style="color:#4070a0">'SeAssignPrimaryTokenPrivilege'</span>)

<span style="color:#60a0b0;font-style:italic"># Check if the user has 'SeAssignPrimaryTokenPrivilege' rights</span>
<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">ReservedNames</span><span style="color:#666">::</span><span style="color:#60add5">Win32</span><span style="color:#666">::</span><span style="color:#60add5">Security</span><span style="color:#666">.</span>get_account_right(<span style="color:#4070a0">'&lt;user&gt;'</span>)<span style="color:#666">.</span>include?(<span style="color:#4070a0">'SeAssignPrimaryTokenPrivilege'</span>)
</code></pre></div>
<p>The following example shows how to run <code>mkdir test_dir</code> from a Chef Infra Client run as an alternate user.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># Passing only username and password</span>
powershell_script <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 code <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 user <span style="color:#4070a0">"username"</span>
 password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Passing username and domain</span>
powershell_script <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 code <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 domain <span style="color:#4070a0">"domain"</span>
 user <span style="color:#4070a0">"username"</span>
 password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Passing username = 'domain-name\\username'. No domain is passed</span>
powershell_script <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 code <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 user <span style="color:#4070a0">"domain-name</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">username"</span>
 password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Passing username = 'username@domain-name'. No domain is passed</span>
powershell_script <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 code <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 user <span style="color:#4070a0">"username@domain-name"</span>
 password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Work around User Access Control (UAC)</span>
powershell_script <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 code <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 user <span style="color:#4070a0">"username"</span>
 password <span style="color:#4070a0">"password"</span>
 elevated <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="python-resource">python resource</h2> <a href="python/index.html">python resource page</a> <hr> <p>Use the <strong>python</strong> resource to execute scripts using the Python interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <code>not_if</code> and <code>only_if</code> to guard this resource for idempotence.</p> <h3 id="syntax-python">Syntax</h3> <hr> 
<p>The python resource has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">python <span style="color:#4070a0">'hello world'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span style="color:#007020">print</span> <span style="color:#4070a0">"Hello world! From Chef and Python."</span>
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>code</code> specifies the command to run</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>python</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">python <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  code             <span style="color:#007020">String</span>
  command          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  creates          <span style="color:#007020">String</span>
  cwd              <span style="color:#007020">String</span>
  default_env      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  domain           <span style="color:#007020">String</span>
  elevated         <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  environment      <span style="color:#60add5">Hash</span>
  flags            <span style="color:#007020">String</span>
  group            <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  interpreter      <span style="color:#007020">String</span>
  live_stream      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  password         <span style="color:#007020">String</span>
  returns          <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: 0</span>
  sensitive        <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: "True if the password property is set. False otherwise."</span>
  timeout          <span style="color:#007020">Integer</span>, <span style="color:#007020">Float</span>
  umask            <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  user             <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>python</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>code</code>, <code>command</code>, <code>creates</code>, <code>cwd</code>, <code>default_env</code>, <code>domain</code>, <code>elevated</code>, <code>environment</code>, <code>flags</code>, <code>group</code>, <code>interpreter</code>, <code>live_stream</code>, <code>password</code>, <code>returns</code>, <code>timeout</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h3 id="actions-python">Actions</h3> <hr> <p>The <strong>python</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:run</code></dt> <dd>Default. Run a script.</dd> </dl> <h3 id="properties-python">Properties</h3> <hr> <p>The <strong>python</strong> resource has the following properties:</p> <dl> <dt> <code>code</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>A quoted (" “) string of code to be executed.</p> </dd> </dl> <dl> <dt> <code>creates</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Prevent a command from creating a file when that file already exists.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The current working directory from which the command will be run.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of environment variables in the form of <code>({'ENV_VARIABLE' =&gt; 'VALUE'})</code>. <strong>Note</strong>: These variables must exist for a command to be run successfully.</p> </dd> </dl> <dl> <dt> <code>flags</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One or more command line flags that are passed to the interpreter when a command is invoked.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group name or group ID that must be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>returns</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Array | <strong>Default Value:</strong> <code>0</code> <p>The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match.</p> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String, Float | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) a command is to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>umask</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The file mode creation mask, or umask.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The user name of the user identity with which to launch the new process. The user name may optionally be specified with a domain, i.e. <code>domain\user</code> or <code>user@my.dns.domain.com</code> via Universal Principal Name (UPN)format. It can also be specified without a domain simply as user if the domain is instead specified using the domain property. On Windows only, if this property is specified, the password property must be specified.</p> </dd> </dl> <br> <h3 id="functionality-python">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="guards-python">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-python">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="reboot-resource">reboot resource</h2> <a href="reboot/index.html">reboot resource page</a> <hr> <p>Use the <strong>reboot</strong> resource to reboot a node, a necessary step with some installations on certain platforms. This resource is supported for use on the Microsoft Windows, macOS, and Linux platforms. In using this resource via notifications, it’s important to <em>only</em> use immediate notifications. Delayed notifications produce unintuitive and probably undesired results.</p> <p><strong>New in Chef Infra Client 12.0.</strong></p> <h3 id="syntax-reboot">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>reboot</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">reboot <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  delay_mins      <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 0</span>
  reason          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "Reboot by Chef Infra Client"</span>
  action          <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :nothing if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>reboot</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>delay_mins</code> and <code>reason</code> are the properties available to this resource.</li> </ul> <h3 id="actions-reboot">Actions</h3> <hr> <p>The <strong>reboot</strong> resource has the following actions:</p> <dl> <dt><code>:cancel</code></dt> <dd>Cancel a pending reboot request.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:reboot_now</code></dt> <dd>Reboot a node so that the Chef Infra Client may continue the installation process.</dd> <dt><code>:request_reboot</code></dt> <dd>Reboot a node at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-reboot">Properties</h3> <hr> <p>The <strong>reboot</strong> resource has the following properties:</p> <dl> <dt> <code>delay_mins</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code> <p>The amount of time (in minutes) to delay a reboot request.</p> </dd> </dl> <dl> <dt> <code>reason</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>Reboot by Chef Infra Client</code> <p>A string that describes the reboot action.</p> </dd> </dl> <br> <h3 id="functionality-reboot">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-reboot">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-reboot">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-reboot">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-reboot">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>reboot</strong> resource in recipes:</p> <p><strong>Reboot a node immediately</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">reboot <span style="color:#4070a0">'now'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
  reason <span style="color:#4070a0">'Cannot continue Chef run without a reboot.'</span>
  delay_mins <span style="color:#40a070">2</span>
<span style="color:#007020;font-weight:700">end</span>

execute <span style="color:#4070a0">'foo'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'...'</span>
  notifies <span style="color:#517918">:reboot_now</span>, <span style="color:#4070a0">'reboot[now]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Reboot a node at the end of a Chef Infra Client run</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">reboot <span style="color:#4070a0">'app_requires_reboot'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:request_reboot</span>
  reason <span style="color:#4070a0">'Need to reboot when the run completes successfully.'</span>
  delay_mins <span style="color:#40a070">5</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Cancel a reboot</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">reboot <span style="color:#4070a0">'cancel_reboot_request'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:cancel</span>
  reason <span style="color:#4070a0">'Cancel a previous end-of-run reboot request.'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="registry-key-resource">registry_key resource</h2> <a href="registry_key/index.html">registry_key resource page</a> <hr> <p>Use the <strong>registry_key</strong> resource to create and delete registry keys in Microsoft Windows.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> 
<p>64-bit versions of Microsoft Windows have a 32-bit compatibility layer in the registry that reflects and redirects certain keys (and their values) into specific locations (or logical views) of the registry hive.</p> <p>Chef Infra Client can access any reflected or redirected registry key. The machine architecture of the system on which Chef Infra Client is running is used as the default (non-redirected) location. Access to the SysWow64 location is redirected must be specified. Typically, this is only necessary to ensure compatibility with 32-bit applications that are running on a 64-bit operating system.</p> <p>For more information, see: <a href="https://docs.microsoft.com/en-us/windows/win32/winprog64/registry-reflection">Registry Reflection</a>.</p> </div> </div> <h3 id="syntax-registry-key">Syntax</h3> <hr> 
<p>A <strong>registry_key</strong> resource block creates and deletes registry keys in Microsoft Windows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'HKEY_LOCAL_MACHINE\\...\\System'</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{
    <span style="color:#007020">name</span>: <span style="color:#4070a0">'NewRegistryKeyValue'</span>,
    <span style="color:#517918">type</span>: <span style="color:#517918">:multi_string</span>,
    <span style="color:#517918">data</span>: <span style="color:#c65d09">%w(foo bar baz)</span>,
  }<span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use multiple registry key entries with key values that are based on node attributes:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\name_of_registry_key'</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{<span style="color:#007020">name</span>: <span style="color:#4070a0">'key_name'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:string</span>, <span style="color:#517918">data</span>: <span style="color:#4070a0">'C:\Windows\System32\file_name.bmp'</span>},
          {<span style="color:#007020">name</span>: <span style="color:#4070a0">'key_name'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:string</span>, <span style="color:#517918">data</span>: node<span style="color:#666">[</span><span style="color:#4070a0">'node_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'attribute'</span><span style="color:#666">][</span><span style="color:#4070a0">'value'</span><span style="color:#666">]</span>},
          {<span style="color:#007020">name</span>: <span style="color:#4070a0">'key_name'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:string</span>, <span style="color:#517918">data</span>: node<span style="color:#666">[</span><span style="color:#4070a0">'node_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'attribute'</span><span style="color:#666">][</span><span style="color:#4070a0">'value'</span><span style="color:#666">]</span>}
         <span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The registry_key resource has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  architecture      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :machine</span>
  key               <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  recursive         <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  values
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>registry_key</code> is the resource</li> <li>
<code>name</code> is the name of the resource block</li> <li>
<code>values</code> is a hash that contains at least one registry key to be created or deleted. Each registry key in the hash is grouped by brackets in which the <code>name:</code>, <code>type:</code>, and <code>data:</code> values for that registry key are specified.</li> <li>
<p><code>type:</code> represents the values available for registry keys in Microsoft Windows. Use <code>:binary</code> for REG_BINARY, <code>:string</code> for REG_SZ, <code>:multi_string</code> for REG_MULTI_SZ, <code>:expand_string</code> for REG_EXPAND_SZ, <code>:dword</code> for REG_DWORD, <code>:dword_big_endian</code> for REG_DWORD_BIG_ENDIAN, or <code>:qword</code> for REG_QWORD. </p>
<div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <code>:multi_string</code> must be an array, even if there is only a single string.</div>
</div> </li> <li>
<code>action</code> identifies the steps Chef Infra Client will take to bring the node into the desired state</li> <li>
<code>architecture</code>, <code>key</code>, <code>recursive</code> and <code>values</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h4 id="windows-registry-key-backslashes">Registry Key Path Separators</h4> <p>A Microsoft Windows registry key can be used as a string in Ruby code, such as when a registry key is used as the name of a recipe. In Ruby, when a registry key is enclosed in a double-quoted string (<code>" "</code>), the same backslash character (<code>\</code>) that is used to define the registry key path separator is also used in Ruby to define an escape character. Therefore, the registry key path separators must be escaped when they are enclosed in a double-quoted string. For example, the following registry key:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60add5">HKCU</span>\<span style="color:#60add5">SOFTWARE</span>\<span style="color:#60add5">Policies</span>\<span style="color:#60add5">Microsoft</span>\<span style="color:#60add5">Windows</span>\<span style="color:#60add5">CurrentVersion</span>\<span style="color:#60add5">Themes</span>
</code></pre></div>
<p>may be enclosed in a single-quoted string with a single backslash:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#4070a0">'HKCU\SOFTWARE\path\to\key\Themes'</span>
</code></pre></div>
<p>or may be enclosed in a double-quoted string with an extra backslash as an escape character:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#4070a0">"HKCU</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">path</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">to</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">key</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Themes"</span>
</code></pre></div> <h4 id="dsl-recipe-method-windows-methods">Chef Infra Language Methods</h4> Six methods are present in the Chef Infra Language to help verify the registry during a Chef Infra Client run on the Microsoft Windows platform—<code>registry_data_exists?</code>, <code>registry_get_subkeys</code>, <code>registry_get_values</code>, <code>registry_has_subkeys?</code>, <code>registry_key_exists?</code>, and <code>registry_value_exists?</code>—these helpers ensure the <strong>powershell_script</strong> resource is idempotent. <h5 id="dsl-recipe-method-registry-data-exists">registry_data_exists?</h5> <p>Use the <code>registry_data_exists?</code> method to find out if a Microsoft Windows registry key contains the specified data of the specified type under the value.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p> This method can be used in recipes and from within the <code>not_if</code> and <code>only_if</code> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource. </p> </div> </div> <p>The syntax for the <code>registry_data_exists?</code> method is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_data_exists?(
  <span style="color:#60add5">KEY_PATH</span>,
  { <span style="color:#007020">name</span>: <span style="color:#4070a0">'NAME'</span>, <span style="color:#517918">type</span>: <span style="color:#60add5">TYPE</span>, <span style="color:#517918">data</span>: <span style="color:#60add5">DATA</span> },
  <span style="color:#60add5">ARCHITECTURE</span>
)
</code></pre></div>
<p>where:</p> <ul> <li>
<code>KEY_PATH</code> is the path to the registry key value. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</li> <li>
<code>{ name: 'NAME', type: TYPE, data: DATA }</code> is a hash that contains the expected name, type, and data of the registry key value</li> <li>
<code>type:</code> represents the values available for registry keys in Microsoft Windows. Use <code>:binary</code> for REG_BINARY, <code>:string</code> for REG_SZ, <code>:multi_string</code> for REG_MULTI_SZ, <code>:expand_string</code> for REG_EXPAND_SZ, <code>:dword</code> for REG_DWORD, <code>:dword_big_endian</code> for REG_DWORD_BIG_ENDIAN, or <code>:qword</code> for REG_QWORD.</li> <li>
<code>ARCHITECTURE</code> is one of the following values: <code>:x86_64</code>, <code>:i386</code>, or <code>:machine</code>. Set to <code>:i386</code> to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows. Set to<code>:x86_64</code> to force write to a 64-bit registry location, however Chef Infra Client returns an exception if <code>:x86_64</code> is used on a 32-bit machine. Set to <code>:machine</code> to allow Chef Infra Client to allow Chef Infra Client to use the appropriate key location based on your node’s architecture. Default value: <code>:machine</code>.</li> </ul> <p>This method will return <code>true</code> or <code>false</code>.</p> <h5 id="dsl-recipe-method-registry-get-subkeys">registry_get_subkeys</h5> <p>Use the <code>registry_get_subkeys</code> method to get a list of registry key values that are present for a Microsoft Windows registry key.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p> This method can be used in recipes and from within the <code>not_if</code> and <code>only_if</code> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource. </p> </div> </div> <p>The syntax for the <code>registry_get_subkeys</code> method is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subkey_array <span style="color:#666">=</span> registry_get_subkeys(<span style="color:#60add5">KEY_PATH</span>, <span style="color:#60add5">ARCHITECTURE</span>)
</code></pre></div>
<p>where:</p> <ul> <li>
<code>KEY_PATH</code> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</li> <li>
<code>ARCHITECTURE</code> is one of the following values: <code>:x86_64</code>, <code>:i386</code>, or <code>:machine</code>. Set to <code>:i386</code> to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows. Set to<code>:x86_64</code> to force write to a 64-bit registry location, however Chef Infra Client returns an exception if <code>:x86_64</code> is used on a 32-bit machine. Set to <code>:machine</code> to allow Chef Infra Client to allow Chef Infra Client to use the appropriate key location based on your node’s architecture. Default value: <code>:machine</code>.</li> </ul> <p>This returns an array of registry key values.</p> <h5 id="dsl-recipe-method-registry-get-values">registry_get_values</h5> <p>Use the <code>registry_get_values</code> method to get the registry key values (name, type, and data) for a Microsoft Windows registry key.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p> This method can be used in recipes and from within the <code>not_if</code> and <code>only_if</code> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource. </p> </div> </div> <p>The syntax for the <code>registry_get_values</code> method is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subkey_array <span style="color:#666">=</span> registry_get_values(<span style="color:#60add5">KEY_PATH</span>, <span style="color:#60add5">ARCHITECTURE</span>)
</code></pre></div>
<p>where:</p> <ul> <li>
<code>KEY_PATH</code> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</li> <li>
<code>ARCHITECTURE</code> is one of the following values: <code>:x86_64</code>, <code>:i386</code>, or <code>:machine</code>. Set to <code>:i386</code> to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows. Set to<code>:x86_64</code> to force write to a 64-bit registry location, however Chef Infra Client returns an exception if <code>:x86_64</code> is used on a 32-bit machine. Set to <code>:machine</code> to allow Chef Infra Client to allow Chef Infra Client to use the appropriate key location based on your node’s architecture. Default value: <code>:machine</code>.</li> </ul> <p>This returns an array of registry key values.</p> <h5 id="dsl-recipe-method-registry-has-subkeys">registry_has_subkeys?</h5> <p>Use the <code>registry_has_subkeys?</code> method to find out if a Microsoft Windows registry key has one (or more) values.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p> This method can be used in recipes and from within the <code>not_if</code> and <code>only_if</code> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource. </p> </div> </div> <p>The syntax for the <code>registry_has_subkeys?</code> method is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_has_subkeys?(<span style="color:#60add5">KEY_PATH</span>, <span style="color:#60add5">ARCHITECTURE</span>)
</code></pre></div>
<p>where:</p> <ul> <li>
<code>KEY_PATH</code> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</li> <li>
<code>ARCHITECTURE</code> is one of the following values: <code>:x86_64</code>, <code>:i386</code>, or <code>:machine</code>. Set to <code>:i386</code> to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows. Set to<code>:x86_64</code> to force write to a 64-bit registry location, however Chef Infra Client returns an exception if <code>:x86_64</code> is used on a 32-bit machine. Set to <code>:machine</code> to allow Chef Infra Client to allow Chef Infra Client to use the appropriate key location based on your node’s architecture. Default value: <code>:machine</code>.</li> </ul> <p>This method will return <code>true</code> or <code>false</code>.</p> <h5 id="dsl-recipe-method-registry-key-exists">registry_key_exists?</h5> <p>Use the <code>registry_key_exists?</code> method to find out if a Microsoft Windows registry key exists at the specified path.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p> This method can be used in recipes and from within the <code>not_if</code> and <code>only_if</code> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource. </p> </div> </div> <p>The syntax for the <code>registry_key_exists?</code> method is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key_exists?(<span style="color:#60add5">KEY_PATH</span>, <span style="color:#60add5">ARCHITECTURE</span>)
</code></pre></div>
<p>where:</p> <ul> <li>
<code>KEY_PATH</code> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</li> <li>
<code>ARCHITECTURE</code> is one of the following values: <code>:x86_64</code>, <code>:i386</code>, or <code>:machine</code>. Set to <code>:i386</code> to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows. Set to<code>:x86_64</code> to force write to a 64-bit registry location, however Chef Infra Client returns an exception if <code>:x86_64</code> is used on a 32-bit machine. Set to <code>:machine</code> to allow Chef Infra Client to allow Chef Infra Client to use the appropriate key location based on your node’s architecture. Default value: <code>:machine</code>.</li> </ul> <p>This method will return <code>true</code> or <code>false</code>. (Any registry key values that are associated with this registry key are ignored.)</p> <h5 id="dsl-recipe-method-registry-value-exists">registry_value_exists?</h5> <p>Use the <code>registry_value_exists?</code> method to find out if a registry key value exists. Use <code>registry_data_exists?</code> to test for the type and data of a registry key value.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p> This method can be used in recipes and from within the <code>not_if</code> and <code>only_if</code> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource. </p> </div> </div> <p>The syntax for the <code>registry_dvalue_exists?</code> method is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_value_exists?(
  <span style="color:#60add5">KEY_PATH</span>,
  { <span style="color:#007020">name</span>: <span style="color:#4070a0">'NAME'</span> },
  <span style="color:#60add5">ARCHITECTURE</span>
)
</code></pre></div>
<p>where:</p> <ul> <li>
<code>KEY_PATH</code> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</li> <li>
<code>{ name: 'NAME' }</code> is a hash that contains the name of the registry key value; if either <code>type:</code> or <code>:value</code> are specified in the hash, they are ignored</li> <li>
<code>type:</code> represents the values available for registry keys in Microsoft Windows. Use <code>:binary</code> for REG_BINARY, <code>:string</code> for REG_SZ, <code>:multi_string</code> for REG_MULTI_SZ, <code>:expand_string</code> for REG_EXPAND_SZ, <code>:dword</code> for REG_DWORD, <code>:dword_big_endian</code> for REG_DWORD_BIG_ENDIAN, or <code>:qword</code> for REG_QWORD.</li> <li>
<code>ARCHITECTURE</code> is one of the following values: <code>:x86_64</code>, <code>:i386</code>, or <code>:machine</code>. Set to <code>:i386</code> to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows. Set to<code>:x86_64</code> to force write to a 64-bit registry location, however Chef Infra Client returns an exception if <code>:x86_64</code> is used on a 32-bit machine. Set to <code>:machine</code> to allow Chef Infra Client to allow Chef Infra Client to use the appropriate key location based on your node’s architecture. Default value: <code>:machine</code>.</li> </ul> <p>This method will return <code>true</code> or <code>false</code>.</p> <h3 id="actions-registry-key">Actions</h3> <hr> <p>The <strong>registry_key</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Create a registry key. If a registry key already exists (but does not match), update that registry key to match.</dd> <dt><code>:create_if_missing</code></dt> <dd>Create a registry key if it does not exist. Also, create a registry key value if it does not exist.</dd> <dt><code>:delete</code></dt> <dd>Delete the specified values for a registry key.</dd> <dt><code>:delete_key</code></dt> <dd>Delete the specified registry key and all of its subkeys. The <code>:delete_key</code> action with the <code>recursive</code> attribute will delete the registry key, all of its values and all of the names, types, and data associated with them. This cannot be undone by Chef Infra Client.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-registry-key">Properties</h3> <hr> <p>The <strong>registry_key</strong> resource has the following properties:</p> <dl> <dt> <code>architecture</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:machine</code> <strong>Allowed Values:</strong> <code>:i386, :machine, :x86_64</code> 
<p>The architecture of the node for which keys are to be created or deleted. Possible values: <code>:i386</code> (for nodes with a 32-bit registry), <code>:x86_64</code> (for nodes with a 64-bit registry), and <code>:machine</code> (to have Chef Infra Client determine the architecture during a Chef Infra Client run).</p> <p>In order to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows, the <code>architecture</code> property must be set to <code>:i386</code>. The <code>:x86_64</code> value can be used to force writing to a 64-bit registry location, but this value is less useful than the default (<code>:machine</code>) because Chef Infra Client returns an exception if <code>:x86_64</code> is used and the machine turns out to be a 32-bit machine (whereas with <code>:machine</code>, Chef Infra Client is able to access the registry key on the 32-bit machine).</p> </dd> </dl> <dl> <dt> <code>key</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The path to the location in which a registry key is to be created or from which a registry key is to be deleted. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</p> </dd> </dl> <dl> <dt> <code>recursive</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>When creating a key, this value specifies that the required keys for the specified path are to be created. When using the <code>:delete_key</code> action in a recipe, and if the registry key has subkeys, then set the value for this property to <code>true</code>. The <code>:delete_key</code> action with the <code>recursive</code> attribute will delete the registry key, all of its values and all of the names, types, and data associated with them. This cannot be undone by Chef Infra Client.</p> </dd> </dl> <dl> <dt> <code>values</code> </dt> <dd> <strong>Ruby Type:</strong> Hash, Array 
<p>An array of hashes, where each Hash contains the values that are to be set under a registry key. Each Hash must contain <code>name:</code>, <code>type:</code>, and <code>data:</code> (and must contain no other key values).</p> <p><code>type:</code> represents the values available for registry keys in Microsoft Windows. Use <code>:binary</code> for REG_BINARY, <code>:string</code> for REG_SZ, <code>:multi_string</code> for REG_MULTI_SZ, <code>:expand_string</code> for REG_EXPAND_SZ, <code>:dword</code> for REG_DWORD, <code>:dword_big_endian</code> for REG_DWORD_BIG_ENDIAN, or <code>:qword</code> for REG_QWORD.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p><code>:multi_string</code> must be an array, even if there is only a single string.</p> </div> </div> </dd> </dl> <h3 id="examples-registry-key">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>registry_key</strong> resource in recipes:</p> <p>Create a registry key</p> <p>Use a double-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">"HKEY_LOCAL_MACHINE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">path-to-key</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Policies</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">System"</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{
    <span style="color:#007020">name</span>: <span style="color:#4070a0">'EnableLUA'</span>,
    <span style="color:#517918">type</span>: <span style="color:#517918">:dword</span>,
    <span style="color:#517918">data</span>: <span style="color:#40a070">0</span>
  }<span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or a single-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'HKEY_LOCAL_MACHINE\path-to-key\Policies\System'</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{
    <span style="color:#007020">name</span>: <span style="color:#4070a0">'EnableLUA'</span>,
    <span style="color:#517918">type</span>: <span style="color:#517918">:dword</span>,
    <span style="color:#517918">data</span>: <span style="color:#40a070">0</span>
  }<span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Delete a registry key value</p> <p>Use a double-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">"HKEY_LOCAL_MACHINE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">path</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">to</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">key</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">AU"</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{
    <span style="color:#007020">name</span>: <span style="color:#4070a0">'NoAutoRebootWithLoggedOnUsers'</span>,
    <span style="color:#517918">type</span>: <span style="color:#517918">:dword</span>,
    <span style="color:#517918">data</span>: <span style="color:#4070a0">''</span>
    }<span style="color:#666">]</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or a single-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'HKEY_LOCAL_MACHINE\SOFTWARE\path\to\key\AU'</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{
    <span style="color:#007020">name</span>: <span style="color:#4070a0">'NoAutoRebootWithLoggedOnUsers'</span>,
    <span style="color:#517918">type</span>: <span style="color:#517918">:dword</span>,
    <span style="color:#517918">data</span>: <span style="color:#4070a0">''</span>
    }<span style="color:#666">]</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If <code>data:</code> is not specified, you get an error: <code>Missing data key in RegistryKey values hash</code></p> </div> </div> <p>Delete a registry key and its subkeys, recursively</p> <p>Use a double-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">"HKCU</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Policies</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">path</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">to</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">key</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Themes"</span> <span style="color:#007020;font-weight:700">do</span>
  recursive <span style="color:#007020">true</span>
  action <span style="color:#517918">:delete_key</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or a single-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'HKCU\SOFTWARE\Policies\path\to\key\Themes'</span> <span style="color:#007020;font-weight:700">do</span>
  recursive <span style="color:#007020">true</span>
  action <span style="color:#517918">:delete_key</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Be careful when using the <code>:delete_key</code> action with the <code>recursive</code> attribute. This will delete the registry key, all of its values and all of the names, types, and data associated with them. This cannot be undone by Chef Infra Client.</p> </div> </div> <p>Use re-directed keys</p> <p>In 64-bit versions of Microsoft Windows, <code>HKEY_LOCAL_MACHINE\SOFTWARE\Example</code> is a re-directed key. In the following examples, because <code>HKEY_LOCAL_MACHINE\SOFTWARE\Example</code> is a 32-bit key, the output will be “Found 32-bit key” if they are run on a version of Microsoft Windows that is 64-bit:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">"HKEY_LOCAL_MACHINE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Example"</span> <span style="color:#007020;font-weight:700">do</span>
  architecture <span style="color:#517918">:i386</span>
  recursive <span style="color:#007020">true</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">"HKEY_LOCAL_MACHINE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Example"</span> <span style="color:#007020;font-weight:700">do</span>
  architecture <span style="color:#517918">:x86_64</span>
  recursive <span style="color:#007020">true</span>
  action <span style="color:#517918">:delete_key</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ruby_block <span style="color:#4070a0">'check 32-bit'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#007020">puts</span> <span style="color:#4070a0">'Found 32-bit key'</span>
  <span style="color:#007020;font-weight:700">end</span>
  only_if {
    registry_key_exists?(<span style="color:#4070a0">"HKEY_LOCAL_MACHINE\SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Example"</span>,
    <span style="color:#517918">:i386</span>)
  }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ruby_block <span style="color:#4070a0">'check 64-bit'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#007020">puts</span> <span style="color:#4070a0">'Found 64-bit key'</span>
  <span style="color:#007020;font-weight:700">end</span>
  only_if {
    registry_key_exists?(<span style="color:#4070a0">"HKEY_LOCAL_MACHINE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Example"</span>,
    <span style="color:#517918">:x86_64</span>)
  }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Set proxy settings to be the same as those used by Chef Infra Client</p> <p>Use a double-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">proxy <span style="color:#666">=</span> <span style="color:#60add5">URI</span><span style="color:#666">.</span>parse(<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:http_proxy</span><span style="color:#666">]</span>)
registry_key <span style="color:#4070a0">'HKCU\Software\Microsoft\path\to\key\Internet Settings'</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{<span style="color:#007020">name</span>: <span style="color:#4070a0">'ProxyEnable'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:reg_dword</span>, <span style="color:#517918">data</span>: <span style="color:#40a070">1</span>},
          {<span style="color:#007020">name</span>: <span style="color:#4070a0">'ProxyServer'</span>, <span style="color:#517918">data</span>: <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>proxy<span style="color:#666">.</span>host<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">:</span><span style="color:#70a0d0;font-style:italic">#{</span>proxy<span style="color:#666">.</span>port<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>},
          {<span style="color:#007020">name</span>: <span style="color:#4070a0">'ProxyOverride'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:reg_string</span>, <span style="color:#517918">data</span>: <span style="color:#666">&lt;</span>local<span style="color:#666">&gt;</span>},
         <span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or a single-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">proxy <span style="color:#666">=</span> <span style="color:#60add5">URI</span><span style="color:#666">.</span>parse(<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:http_proxy</span><span style="color:#666">]</span>)
registry_key <span style="color:#4070a0">'HKCU\Software\Microsoft\path\to\key\Internet Settings'</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{<span style="color:#007020">name</span>: <span style="color:#4070a0">'ProxyEnable'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:reg_dword</span>, <span style="color:#517918">data</span>: <span style="color:#40a070">1</span>},
          {<span style="color:#007020">name</span>: <span style="color:#4070a0">'ProxyServer'</span>, <span style="color:#517918">data</span>: <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>proxy<span style="color:#666">.</span>host<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">:</span><span style="color:#70a0d0;font-style:italic">#{</span>proxy<span style="color:#666">.</span>port<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>},
          {<span style="color:#007020">name</span>: <span style="color:#4070a0">'ProxyOverride'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:reg_string</span>, <span style="color:#517918">data</span>: <span style="color:#666">&lt;</span>local<span style="color:#666">&gt;</span>},
         <span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Set the name of a registry key to “(Default)"</strong></p> <p>Use a double-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'Set (Default) value'</span> <span style="color:#007020;font-weight:700">do</span>
  key <span style="color:#4070a0">"HKLM</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Software</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Test</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Key</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Path"</span>
  values <span style="color:#666">[</span>
    {<span style="color:#007020">name</span>: <span style="color:#4070a0">''</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:string</span>, <span style="color:#517918">data</span>: <span style="color:#4070a0">'test'</span>},
  <span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or a single-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'Set (Default) value'</span> <span style="color:#007020;font-weight:700">do</span>
  key <span style="color:#4070a0">'HKLM\Software\Test\Key\Path'</span>
  values <span style="color:#666">[</span>
    {<span style="color:#007020">name</span>: <span style="color:#4070a0">''</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:string</span>, <span style="color:#517918">data</span>: <span style="color:#4070a0">'test'</span>},
  <span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where <code>name: ''</code> contains an empty string, which will set the name of the registry key to <code>(Default)</code>.</p> <h2 id="remote-directory-resource">remote_directory resource</h2> <a href="remote_directory/index.html">remote_directory resource page</a> <hr> <p>Use the <strong>remote_directory</strong> resource to incrementally transfer a directory from a cookbook to a node. The directory that is copied from the cookbook should be located under <code>COOKBOOK_NAME/files/default/REMOTE_DIRECTORY</code>. The <code>remote_directory</code> resource will obey file specificity.</p> <h3 id="syntax-remote-directory">Syntax</h3> <hr> 
<p>A <strong>remote_directory</strong> resource block transfers a directory from a cookbook to a node, and then assigns the permissions needed on that directory. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_directory <span style="color:#4070a0">'/etc/apache2'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'apache2'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>'/etc/apache2'</code> specifies the directory</li> <li>
<code>source</code> specifies a directory in the current cookbook (use the <code>cookbook</code> property to specify a file that is in a different cookbook)</li> <li>
<code>owner</code>, <code>group</code>, and <code>mode</code> define the permissions</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>remote_directory</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_directory <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  cookbook                   <span style="color:#007020">String</span>
  files_backup               <span style="color:#007020">Integer</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: 5</span>
  files_group                <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  files_mode                 <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 0644 on *nix systems</span>
  files_owner                <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  inherits                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  mode                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  overwrite                  <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  owner                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                       <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  purge                      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  recursive                  <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  rights                     <span style="color:#60add5">Hash</span>
  source                     <span style="color:#007020">String</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>remote_directory</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>cookbook</code>, <code>files_backup</code>, <code>files_group</code>, <code>files_mode</code>, <code>files_owner</code>, <code>group</code>, <code>mode</code>, <code>overwrite</code>, <code>owner</code>, <code>path</code>, <code>purge</code>, <code>recursive</code>, and <code>source</code> are the properties available to this resource.</li> </ul> <h3 id="actions-remote-directory">Actions</h3> <hr> <p>The <strong>remote_directory</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Create a directory and/or the contents of that directory. If a directory or its contents already exist (but does not match), update that directory or its contents to match.</dd> <dt><code>:create_if_missing</code></dt> <dd>Create a directory and/or the contents of that directory, but only if it does not exist.</dd> <dt><code>:delete</code></dt> <dd>Delete a directory, including the contents of that directory.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-remote-directory">Properties</h3> <hr> <p>The <strong>remote_directory</strong> resource has the following properties:</p> <dl> <dt> <code>cookbook</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The cookbook in which a file is located (if it is not located in the current cookbook). The default value is the current cookbook.</p> </dd> </dl> <dl> <dt> <code>files_backup</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, false | <strong>Default Value:</strong> <code>5</code> <p>The number of backup copies to keep for files in the directory.</p> </dd> </dl> <dl> <dt> <code>files_group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>Configure group permissions for files. A string or ID that identifies the group owner by group name, including fully qualified group names such as <code>domain\group</code> or <code>group@domain</code>. If this value is not specified, existing groups remain unchanged and new group assignments use the default POSIX group (if available).</p> </dd> </dl> <dl> <dt> <code>files_mode</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>0644 on *nix systems</code> 
<p>The octal mode for a file.</p> <p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If the value is specified as a quoted string, it works exactly as if the <code>chmod</code> command was passed. If the value is specified as an integer, prepend a zero (<code>0</code>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <code>'0777'</code> or <code>'777'</code>; for the same rights, plus the sticky bit, use <code>01777</code> or <code>'1777'</code>.</p> <p>Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. Values up to <code>'0777'</code> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <code>4</code> equals <code>GENERIC_READ</code>, <code>2</code> equals <code>GENERIC_WRITE</code>, and <code>1</code> equals <code>GENERIC_EXECUTE</code>. This property cannot be used to set <code>:full_control</code>. This property has no effect if not specified, but when it and <code>rights</code> are both specified, the effects are cumulative.</p> </dd> </dl> <dl> <dt> <code>files_owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>Configure owner permissions for files. A string or ID that identifies the group owner by user name, including fully qualified user names such as <code>domain\user</code> or <code>user@domain</code>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>Use to configure permissions for directories. A string or ID that identifies the group owner by group name or SID, including fully qualified group names such as <code>domain\group</code> or <code>group@domain</code>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <code>POSIX</code> group (if available).</p> </dd> </dl> <dl> <dt> <code>inherits</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Microsoft Windows only. Whether a file inherits rights from its parent directory.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String 
<p>A quoted 3-5 character string that defines the octal mode. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If <code>mode</code> is not specified and if the directory already exists, the existing mode on the directory is used. If <code>mode</code> is not specified, the directory does not exist, and the <code>:create</code> action is specified, Chef Infra Client assumes a mask value of <code>'0777'</code>, and then applies the umask for the system on which the directory is to be created to the <code>mask</code> value. For example, if the umask on a system is <code>'022'</code>, Chef Infra Client uses the default value of <code>'0755'</code>.</p> <p>The behavior is different depending on the platform.</p> <p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If the value is specified as a quoted string, it works exactly as if the <code>chmod</code> command was passed. If the value is specified as an integer, prepend a zero (<code>0</code>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <code>'0777'</code> or <code>'777'</code>; for the same rights, plus the sticky bit, use <code>01777</code> or <code>'1777'</code>.</p> <p>Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. Values up to <code>'0777'</code> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <code>4</code> equals <code>GENERIC_READ</code>, <code>2</code> equals <code>GENERIC_WRITE</code>, and <code>1</code> equals <code>GENERIC_EXECUTE</code>. This property cannot be used to set <code>:full_control</code>. This property has no effect if not specified, but when it and <code>rights</code> are both specified, the effects are cumulative.</p> </dd> </dl> <dl> <dt> <code>overwrite</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Overwrite a file when it is different.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>Use to configure permissions for directories. A string or ID that identifies the group owner by user name or SID, including fully qualified user names such as <code>domain\user</code> or <code>user@domain</code>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The path to the directory. Using a fully qualified path is recommended, but is not always required. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <dl> <dt> <code>purge</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Purge extra files found in the target directory.</p> </dd> </dl> <dl> <dt> <code>recursive</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Create or delete directories recursively. Chef Infra Client must be able to create the directory structure, including parent directories (if missing), as defined in <code>COOKBOOK_NAME/files/default/REMOTE_DIRECTORY</code>.</p> </dd> </dl> <dl> <dt> <code>rights</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <code>rights &lt;permissions&gt;, &lt;principal&gt;, &lt;options&gt;</code> where <code>&lt;permissions&gt;</code> specifies the rights granted to the principal, <code>&lt;principal&gt;</code> is the group or user name, and <code>&lt;options&gt;</code> is a Hash with one (or more) advanced rights options.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The base portion of the 'path' property.</code> <p>The base name of the source file (and inferred from the <code>path</code> property). For example, in the default value, ‘/some/path/’ would be ‘path’.</p> </dd> </dl> <h4 id="directory-recursive-directories-remote-directory">Recursive Directories</h4> <p>The <strong>remote_directory</strong> resource can be used to recursively create the path outside of remote directory structures, but the permissions of those outside paths are not managed. This is because the <code>recursive</code> attribute only applies <code>group</code>, <code>mode</code>, and <code>owner</code> attribute values to the remote directory itself and any inner directories the resource copies.</p> <p>A directory structure:</p> <pre class="highlight" data-language="ruby"><code>/foo
  /bar
    /baz
</code></pre> <p>The following example shows a way create a file in the <code>/baz</code> directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_directory <span style="color:#4070a0">'/foo/bar/baz'</span> <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>But with this example, the <code>group</code>, <code>mode</code>, and <code>owner</code> attribute values will only be applied to <code>/baz</code>. Which is fine, if that’s what you want. But most of the time, when the entire <code>/foo/bar/baz</code> directory structure is not there, you must be explicit about each directory. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#c65d09">%w( /foo /foo/bar /foo/bar/baz )</span><span style="color:#666">.</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>path<span style="color:#666">|</span>
  remote_directory path <span style="color:#007020;font-weight:700">do</span>
    owner <span style="color:#4070a0">'root'</span>
    group <span style="color:#4070a0">'root'</span>
    mode <span style="color:#4070a0">'0755'</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This approach will create the correct hierarchy—<code>/foo</code>, then <code>/bar</code> in <code>/foo</code>, and then <code>/baz</code> in <code>/bar</code>—and also with the correct attribute values for <code>group</code>, <code>mode</code>, and <code>owner</code>.</p> <br> <h3 id="functionality-remote-directory">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-remote-directory">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-remote-directory">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-remote-directory">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h4 id="recursive-directories-remote-directory">Recursive Directories</h4> <p>The <strong>remote_directory</strong> resource can be used to recursively create the path outside of remote directory structures, but the permissions of those outside paths are not managed. This is because the <code>recursive</code> attribute only applies <code>group</code>, <code>mode</code>, and <code>owner</code> attribute values to the remote directory itself and any inner directories the resource copies.</p> <p>A directory structure:</p> <pre class="highlight" data-language="ruby"><code>/foo
  /bar
    /baz
</code></pre> <p>The following example shows a way create a file in the <code>/baz</code> directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_directory <span style="color:#4070a0">'/foo/bar/baz'</span> <span style="color:#007020;font-weight:700">do</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>But with this example, the <code>group</code>, <code>mode</code>, and <code>owner</code> attribute values will only be applied to <code>/baz</code>. Which is fine, if that’s what you want. But most of the time, when the entire <code>/foo/bar/baz</code> directory structure is not there, you must be explicit about each directory. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#c65d09">%w( /foo /foo/bar /foo/bar/baz )</span><span style="color:#666">.</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>path<span style="color:#666">|</span>
  remote_directory path <span style="color:#007020;font-weight:700">do</span>
    owner <span style="color:#4070a0">'root'</span>
    group <span style="color:#4070a0">'root'</span>
    mode <span style="color:#4070a0">'0755'</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This approach will create the correct hierarchy—<code>/foo</code>, then <code>/bar</code> in <code>/foo</code>, and then <code>/baz</code> in <code>/bar</code>—and also with the correct attribute values for <code>group</code>, <code>mode</code>, and <code>owner</code>.</p> <h5 id="recursive-directories-example-remote-directory">Example</h5> <p>This section contains a more detailed example of how Chef Infra Client manages recursive directory structures:</p> <ul> <li>A cookbook named <code>cumbria</code> that is used to build a website</li> <li>A subfolder in the <code>/files/default</code> directory named <code>/website</code>
</li> <li>A file named <code>index.html</code>, which is the root page for the website</li> <li>Directories within <code>/website</code> named <code>/cities</code>, <code>/places</code>, and <code>/football</code>, which contains pages about cities, places, and football teams</li> <li>A directory named <code>/images</code>, which contains images</li> </ul> <p>These files are placed in the <code>/files/default</code> directory in the <code>cumbria</code> cookbook, like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-text" data-lang="text">cumbria
  /files
    /default
      /website
        index.html
        /cities
          carisle.html
          kendal.html
          penrith.html
          windermere.html
        /football
          carisle_united.html
        /images
          carisle_united.png
          furness_abbey.png
          hadrians_wall.png
          kendal.png
        /places
          furness_abbey.html
          hadrians_wall.html
</code></pre></div>
<p>The <strong>remote_directory</strong> resource can be used to build a website using these files. This website is being run on an Apache web server. The resource would be similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_directory <span style="color:#4070a0">'/var/www/html'</span> <span style="color:#007020;font-weight:700">do</span>
  files_mode <span style="color:#4070a0">'0440'</span>
  files_owner <span style="color:#4070a0">'yan'</span>
  mode <span style="color:#4070a0">'0770'</span>
  owner <span style="color:#4070a0">'hamilton'</span>
  source <span style="color:#4070a0">'website'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>When Chef Infra Client runs, the <strong>remote_directory</strong> resource will tell Chef Infra Client to copy the directory tree from the cookbook to the file system using the structure defined in cookbook:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-text" data-lang="text">/var
  /www
    /html
      index.html
      /cities
        carisle.html
        kendal.html
        penrith.html
        windermere.html
      /football
        carisle_united.html
      /images
        carisle_united.png
        furness_abbey.png
        hadrians_wall.png
        kendal.png
      /places
        furness_abbey.html
        hadrians_wall.html
</code></pre></div>
<p>Chef Infra Client will manage the permissions of the entire directory structure below <code>/html</code>, for a total of 12 files and 4 directories. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">dr-xr-xr-x <span style="color:#40a070">2</span> root     root <span style="color:#40a070">4096</span> /var/www/html
dr--r----- <span style="color:#40a070">1</span> yan      root <span style="color:#40a070">4096</span> /var/www/html/index.html
drwxrwx--- <span style="color:#40a070">2</span> hamilton root <span style="color:#40a070">4096</span> /var/www/html/cities
dr--r----- <span style="color:#40a070">1</span> yan      root <span style="color:#40a070">4096</span> /var/www/html/cities/carlisle.html
dr--r----- <span style="color:#40a070">1</span> yan      root <span style="color:#40a070">4096</span> /var/www/html/cities/kendal.html
dr--r----- <span style="color:#40a070">1</span> yan      root <span style="color:#40a070">4096</span> /var/www/html/cities/penrith.html
dr--r----- <span style="color:#40a070">1</span> yan      root <span style="color:#40a070">4096</span> /var/www/html/cities/windermere.html
drwxrwx--- <span style="color:#40a070">2</span> hamilton root <span style="color:#40a070">4096</span> /var/www/html/football
dr--r----- <span style="color:#40a070">1</span> yan      root <span style="color:#40a070">4096</span> /var/www/html/football/carlisle_united.html
drwxrwx--- <span style="color:#40a070">2</span> hamilton root <span style="color:#40a070">4096</span> /var/www/html/images
dr--r----- <span style="color:#40a070">1</span> yan      root <span style="color:#40a070">4096</span> /var/www/html/images/carlisle_united/png
dr--r----- <span style="color:#40a070">1</span> yan      root <span style="color:#40a070">4096</span> /var/www/html/images/furness_abbey/png
dr--r----- <span style="color:#40a070">1</span> yan      root <span style="color:#40a070">4096</span> /var/www/html/images/hadrians_wall.png
dr--r----- <span style="color:#40a070">1</span> yan      root <span style="color:#40a070">4096</span> /var/www/html/images/kendal.png
drwxrwx--- <span style="color:#40a070">2</span> hamilton root <span style="color:#40a070">4096</span> /var/www/html/places
dr--r----- <span style="color:#40a070">1</span> yan      root <span style="color:#40a070">4096</span> /var/www/html/places/furness_abbey.html
dr--r----- <span style="color:#40a070">1</span> yan      root <span style="color:#40a070">4096</span> /var/www/html/places/hadrians_wall.html
</code></pre></div> <h4 id="common-windows-security-remote-directory">Windows File Security</h4> To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes. <strong>Access Control Lists (ACLs)</strong> <p>The <code>rights</code> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <code>rights</code> property can be used as many times as necessary; Chef Infra Client will apply them to the file or directory as required. The syntax for the <code>rights</code> property is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights permission, principal, option_type <span style="color:#666">=&gt;</span> value
</code></pre></div>
<p>where</p> <dl> <dt><code>permission</code></dt> <dd> <p>Use to specify which rights are granted to the <code>principal</code>. The possible values are: <code>:read</code>, <code>:write</code>, <code>read_execute</code>, <code>:modify</code>, <code>:full_control</code>, or an integer.</p> </dd> <dd> <p>Integers used for permissions must match the following list <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.accesscontrol.filesystemrights?view=windowsdesktop-5.0#fields">FileSystemRights Enum</a> fields.</p> </dd> </dl> <pre class="highlight" data-language="ruby"><code>These permissions are cumulative. If `:write` is specified, then it
includes `:read`. If `:full_control` is specified, then it includes
both `:write` and `:read`.

(For those who know the Microsoft Windows API: `:read` corresponds
to `GENERIC_READ`; `:write` corresponds to `GENERIC_WRITE`;
`:read_execute` corresponds to `GENERIC_READ` and `GENERIC_EXECUTE`;
`:modify` corresponds to `GENERIC_WRITE`, `GENERIC_READ`,
`GENERIC_EXECUTE`, and `DELETE`; `:full_control` corresponds to
`GENERIC_ALL`, which allows a user to change the owner and other
metadata about a file.)
</code></pre> <dl> <dt><code>principal</code></dt> <dd> <p>Use to specify a group or user. The principal can be specified by either name or SID. When using name, this is identical to what is entered in the login box for Microsoft Windows, such as <code>user_name</code>, <code>domain\user_name</code>, or <code>user_name@fully_qualified_domain_name</code>. When using a SID, you may use either the standard string representation of a SID (S-R-I-S-S) or one of the <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/sid-strings">SDDL string constants</a>. Chef Infra Client does not need to know if a principal is a user or a group.</p> </dd> <dt><code>option_type</code></dt> <dd> <p>A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <code>rights :write, 'domain\group_name', :one_level_deep =&gt; true</code>. Possible option types:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Option Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>:applies_to_children</code></td> <td>Specify how permissions are applied to children. Possible values: <code>true</code> to inherit both child directories and files; <code>false</code> to not inherit any child directories or files; <code>:containers_only</code> to inherit only child directories (and not files); <code>:objects_only</code> to recursively inherit files (and not child directories).</td> </tr> <tr> <td><code>:applies_to_self</code></td> <td>Indicates whether a permission is applied to the parent directory. Possible values: <code>true</code> to apply to the parent directory or file and its children; <code>false</code> to not apply only to child directories and files.</td> </tr> <tr> <td><code>:one_level_deep</code></td> <td>Indicates the depth to which permissions will be applied. Possible values: <code>true</code> to apply only to the first level of children; <code>false</code> to apply to all children.</td> </tr> </tbody> </table> </dd> </dl> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'S-1-1-0'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Administrators Everyone)</span>
rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'Users'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'Sally'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#517918">:containers_only</span>, <span style="color:#517918">applies_to_self</span>: <span style="color:#007020">false</span>, <span style="color:#517918">one_level_deep</span>: <span style="color:#007020">true</span>
</code></pre></div>
<p>Some other important things to know when using the <code>rights</code> attribute:</p> <ul> <li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li> <li>If rights are not specified, nothing will be changed. Chef Infra Client does not clear out the rights on a file or directory if rights are not specified.</li> <li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li> </ul> <p>Use the <code>deny_rights</code> property to deny specific rights to specific users. The ordering is independent of using the <code>rights</code> property. For example, it doesn’t matter if rights are granted to everyone is placed before or after <code>deny_rights :read, ['Julian', 'Lewis']</code>, both Julian and Lewis will be unable to read the document. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'Everyone'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Julian Lewis)</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">deny_rights <span style="color:#517918">:full_control</span>, <span style="color:#666">[</span><span style="color:#4070a0">'Sally'</span><span style="color:#666">]</span>
</code></pre></div> <strong>Inheritance</strong> <p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <code>inherits</code> property can be used to specifically tell Chef Infra Client to apply (or not apply) inherited rights from its parent directory.</p> <p>For example, the following example specifies the rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  inherits <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># Sauron is the only person who should have any sort of access</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>If the <code>deny_rights</code> permission were to be used instead, something could slip through unless all users and groups were denied.</p> <p>Another example also shows how to specify rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'SHIRE\Frodo'</span> <span style="color:#60a0b0;font-style:italic"># Who put that there I didn't put that there</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>but then not use the <code>inherits</code> property to deny those rights on a child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span> <span style="color:#60a0b0;font-style:italic"># Oops, not specific enough</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Because the <code>inherits</code> property is not specified, Chef Infra Client will default it to <code>true</code>, which will ensure that security settings for existing files remain unchanged.</p> <h3 id="examples-remote-directory">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>remote_directory</strong> resource in recipes:</p> <p>Recursively transfer a directory from a remote location</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># create up to 10 backups of the files</span>
<span style="color:#60a0b0;font-style:italic"># set the files owner different from the directory</span>
remote_directory <span style="color:#4070a0">'/tmp/remote_something'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'something'</span>
  files_backup <span style="color:#40a070">10</span>
  files_owner <span style="color:#4070a0">'root'</span>
  files_group <span style="color:#4070a0">'root'</span>
  files_mode <span style="color:#4070a0">'0644'</span>
  owner <span style="color:#4070a0">'nobody'</span>
  group <span style="color:#4070a0">'nobody'</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use with the chef_handler resource</p> <p>The following example shows how to use the <strong>remote_directory</strong> resource and the <strong>chef_handler</strong> resource to reboot a handler named <code>WindowsRebootHandler</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># the following code sample comes from the</span>
<span style="color:#60a0b0;font-style:italic"># ``reboot_handler`` recipe in the ``windows`` cookbook:</span>
<span style="color:#60a0b0;font-style:italic"># https://github.com/chef-cookbooks/windows</span>

remote_directory node<span style="color:#666">[</span><span style="color:#4070a0">'chef_handler'</span><span style="color:#666">][</span><span style="color:#4070a0">'handler_path'</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'handlers'</span>
  recursive <span style="color:#007020">true</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>

chef_handler <span style="color:#4070a0">'WindowsRebootHandler'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_handler'</span><span style="color:#666">][</span><span style="color:#4070a0">'handler_path'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/windows_reboot_handler.rb"</span>
  arguments node<span style="color:#666">[</span><span style="color:#4070a0">'windows'</span><span style="color:#666">][</span><span style="color:#4070a0">'allow_pending_reboots'</span><span style="color:#666">]</span>
  supports <span style="color:#517918">:report</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>, <span style="color:#517918">:exception</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">false</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="remote-file-resource">remote_file resource</h2> <a href="remote_file/index.html">remote_file resource page</a> <hr> <p>Use the <strong>remote_file</strong> resource to transfer a file from a remote location using file specificity. This resource is similar to the <strong>file</strong> resource.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Fetching files from the <code>files/</code> directory in a cookbook should be done with the <strong>cookbook_file</strong> resource.</p> </div> </div> <h3 id="syntax-remote-file">Syntax</h3> <hr> 
<p>A <strong>remote_file</strong> resource block manages files by using files that exist remotely. For example, to write the home page for an Apache website:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'/var/www/customers/public_html/index.html'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'http://somesite.com/index.html'</span>
  owner <span style="color:#4070a0">'web_admin'</span>
  group <span style="color:#4070a0">'web_admin'</span>
  mode <span style="color:#4070a0">'0755'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>'/var/www/customers/public_html/index.html'</code> is path to the file to be created</li> <li>
<code>'http://somesite.com/index.html'</code> specifies the location of the remote file, the file is downloaded from there</li> <li>
<code>owner</code>, <code>group</code>, and <code>mode</code> define the permissions</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>remote_file</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  atomic_update              <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  authentication             <span style="color:#60a0b0;font-style:italic"># default value: remote</span>
  backup                     <span style="color:#007020">Integer</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: 5</span>
  checksum                   <span style="color:#007020">String</span>
  content                    <span style="color:#007020">String</span>, <span style="color:#007020">nil</span>
  force_unlink               <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  ftp_active_mode            <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  headers                    <span style="color:#60add5">Hash</span>
  inherits                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  manage_symlink_source      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  mode                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  notifies                   <span style="color:#60a0b0;font-style:italic"># see description</span>
  owner                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                       <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># defaults to 'name' if not specified</span>
  rights                     <span style="color:#60add5">Hash</span>
  source                     <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  subscribes                 <span style="color:#60a0b0;font-style:italic"># see description</span>
  use_conditional_get        <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  verify                     <span style="color:#007020">String</span>, <span style="color:#60add5">Block</span>
  remote_domain              <span style="color:#007020">String</span>
  remote_password            <span style="color:#007020">String</span>
  remote_user                <span style="color:#007020">String</span>
  show_progress              <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  use_etag                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  use_last_modified          <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  sensitive                  <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  verifications              <span style="color:#007020">Array</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>remote_file</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>atomic_update</code>, <code>authentication</code>, <code>backup</code>, <code>checksum</code>, <code>content</code>, <code>force_unlink</code>, <code>ftp_active_mode</code>, <code>group</code>, <code>headers</code>, <code>http_options</code>, <code>manage_symlink_source</code>, <code>mode</code>, <code>owner</code>, <code>path</code>, <code>remote_domain</code>, <code>remote_password</code>, <code>remote_user</code>, <code>show_progress</code>, <code>ssl_verify_mode</code>, <code>use_etag</code>, and <code>use_last_modified</code> are the properties available to this resource.</li> </ul> <h3 id="actions-remote-file">Actions</h3> <hr> <p>The <strong>remote_file</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Create a file. If a file already exists (but does not match), update that file to match.</dd> <dt><code>:create_if_missing</code></dt> <dd>Create a file only if the file does not exist. When the file exists, nothing happens.</dd> <dt><code>:delete</code></dt> <dd>Delete a file.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:touch</code></dt> <dd>Touch a file. This updates the access (atime) and file modification (mtime) times for a file. (This action may be used with this resource, but is typically only used with the <strong>file</strong> resource.)</dd> </dl> <h3 id="properties-remote-file">Properties</h3> <hr> <p>The <strong>remote_file</strong> resource has the following properties:</p> <dl> <dt> <code>atomic_update</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>False if modifying /etc/hosts, /etc/hostname, or /etc/resolv.conf within Docker containers. Otherwise default to the client.rb 'file_atomic_update' config value.</code> <p>Perform atomic file updates on a per-resource basis. Set to true for atomic file updates. Set to false for non-atomic file updates. This setting overrides <code>file_atomic_update</code>, which is a global setting found in the <code>client.rb</code> file.</p> </dd> </dl> <dl> <dt> <code>authentication</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:remote</code> <strong>Allowed Values:</strong> <code>:local, :remote</code>  </dd> </dl> <dl> <dt> <code>backup</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, false | <strong>Default Value:</strong> <code>5</code> <p>The number of backups to be kept in <code>/var/chef/backup</code> (for UNIX- and Linux-based platforms) or <code>C:/chef/backup</code> (for the Microsoft Windows platform). Set to <code>false</code> to prevent backups from being kept.</p> </dd> </dl> <dl> <dt> <code>checksum</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Optional, see <code>use_conditional_get</code>. The SHA-256 checksum of the file. Use to prevent a file from being re-downloaded. When the local file matches the checksum, Chef Infra Client does not download it.</p> </dd> </dl> <dl> <dt> <code>force_unlink</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>How Chef Infra Client handles certain situations when the target file turns out not to be a file. For example, when a target file is actually a symlink. Set to <code>true</code> for Chef Infra Client to delete the non-file target and replace it with the specified file. Set to <code>false</code> for Chef Infra Client to raise an error.</p> </dd> </dl> <dl> <dt> <code>ftp_active_mode</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Whether Chef Infra Client uses active or passive FTP. Set to <code>true</code> to use active FTP.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>A string or ID that identifies the group owner by group name or SID, including fully qualified group names such as <code>domain\group</code> or <code>group@domain</code>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <code>POSIX</code> group (if available).</p> </dd> </dl> <dl> <dt> <code>headers</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> 
<p>A Hash of custom headers. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">headers({ <span style="color:#4070a0">"Cookie"</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"user=user_name; pass=p@ssw0rd!"</span> })
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">headers({ <span style="color:#4070a0">"Referer"</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>header<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> })
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">headers( <span style="color:#4070a0">"Authorization"</span><span style="color:#666">=&gt;</span><span style="color:#4070a0">"Basic </span><span style="color:#70a0d0;font-style:italic">#{</span> <span style="color:#60add5">Base64</span><span style="color:#666">.</span>encode64(<span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>username<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">:</span><span style="color:#70a0d0;font-style:italic">#{</span>password<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>)<span style="color:#666">.</span>gsub(<span style="color:#4070a0">"</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">"</span>, <span style="color:#4070a0">""</span>) <span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> )
</code></pre></div> </dd> </dl> <dl> <dt> <code>inherits</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Microsoft Windows only. Whether a file inherits rights from its parent directory.</p> </dd> </dl> <dl> <dt> <code>http_options</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{}</code> <p>A Hash of custom HTTP options. For example: <code>http_options({ http_retry_count: 0, http_retry_delay: 2 })</code></p> <p> New in Chef Infra Client 17.5 </p> </dd> </dl> <dl> <dt> <code>manage_symlink_source</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> 
<p>(with warning)</p> <p>Change the behavior of the file resource if it is pointed at a symlink. When this value is set to <code>true</code>, the Chef Infra Client will manage the symlink’s permissions or will replace the symlink with a normal file if the resource has content. When this value is set to <code>false</code>, Chef Infra Client will follow the symlink and will manage the permissions and content of the symlink’s target file.</p> <p>The default behavior is <code>true</code> but emits a warning that the default value will be changed to <code>false</code> in a future version; setting this explicitly to <code>true</code> or <code>false</code> suppresses this warning.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String 
<p>A quoted 3-5 character string that defines the octal mode. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If <code>mode</code> is not specified and if the file already exists, the existing mode on the file is used. If <code>mode</code> is not specified, the file does not exist, and the <code>:create</code> action is specified, Chef Infra Client assumes a mask value of <code>'0777'</code> and then applies the umask for the system on which the file is to be created to the <code>mask</code> value. For example, if the umask on a system is <code>'022'</code>, Chef Infra Client uses the default value of <code>'0755'</code>.</p> <p>The behavior is different depending on the platform.</p> <p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If the value is specified as a quoted string, it works exactly as if the <code>chmod</code> command was passed. If the value is specified as an integer, prepend a zero (<code>0</code>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <code>'0777'</code> or <code>'777'</code>; for the same rights, plus the sticky bit, use <code>01777</code> or <code>'1777'</code>.</p> <p>Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. Values up to <code>'0777'</code> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <code>4</code> equals <code>GENERIC_READ</code>, <code>2</code> equals <code>GENERIC_WRITE</code>, and <code>1</code> equals <code>GENERIC_EXECUTE</code>. This property cannot be used to set <code>:full_control</code>. This property has no effect if not specified, but when it and <code>rights</code> are both specified, the effects are cumulative.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>A string or ID that identifies the group owner by user name or SID, including fully qualified user names such as <code>domain\user</code> or <code>user@domain</code>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The full path to the file, including the file name and its extension. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <dl> <dt> <code>remote_domain</code> </dt> <dd> <strong>Ruby Type:</strong> String <p><strong>Windows only</strong> The domain of the user specified by the <code>remote_user</code> property. By default the resource will authenticate against the domain of the remote system, or as a local account if the remote system is not joined to a domain. If the remote system is not part of a domain, it is necessary to authenticate as a local user on the remote system by setting the domain to <code>.</code>, for example: remote_domain ‘.’. The domain may also be specified as part of the <code>remote_user</code> property.</p> <p> New in Chef Client 13.4 </p> </dd> </dl> <dl> <dt> <code>remote_password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p><strong>Windows only</strong> The password of the user specified by the <code>remote_user</code> property. This property is required if <code>remote_user</code> is specified and may only be specified if <code>remote_user</code> is specified. The <code>sensitive</code> property for this resource will automatically be set to <code>true</code> if <code>remote_password</code> is specified.</p> <p> New in Chef Client 13.4 </p> </dd> </dl> <dl> <dt> <code>remote_user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p><strong>Windows only</strong> The name of a user with access to the remote file specified by the source property. The user name may optionally be specified with a domain, such as: <code>domain\user</code> or <code>user@my.dns.domain.com</code> via Universal Principal Name (UPN) format. The domain may also be set using the <code>remote_domain</code> property. Note that this property is ignored if source is not a UNC path. If this property is specified, the <code>remote_password</code> property is required.</p> <p> New in Chef Client 13.4 </p> </dd> </dl> <dl> <dt> <code>rights</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <code>rights &lt;permissions&gt;, &lt;principal&gt;, &lt;options&gt;</code> where <code>&lt;permissions&gt;</code> specifies the rights granted to the principal, <code>&lt;principal&gt;</code> is the group or user name, and <code>&lt;options&gt;</code> is a Hash with one (or more) advanced rights options.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array 
<p>Required. The location of the source file. The location of the source file may be HTTP (<code>http://</code>), FTP (<code>ftp://</code>), SFTP (<code>sftp://</code>), local (<code>file:///</code>), or UNC (<code>\\host\share\file.tar.gz</code>).</p> <p>There are many ways to define the location of a source file. By using a path:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">source <span style="color:#4070a0">'http://couchdb.apache.org/img/sketch.png'</span>
</code></pre></div>
<p>By using FTP:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">source <span style="color:#4070a0">'ftp://remote_host/path/to/img/sketch.png'</span>
</code></pre></div>
<p>By using SFTP:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">source <span style="color:#4070a0">'sftp://username:password@remote_host:22/path/to/img/sketch.png'</span>
</code></pre></div>
<p>By using a local path:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">source <span style="color:#4070a0">'file:///path/to/img/sketch.png'</span>
</code></pre></div>
<p>By using a Microsoft Windows UNC:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">source <span style="color:#4070a0">'\\\\path\\to\\img\\sketch.png'</span>
</code></pre></div>
<p>By using a node attribute:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">source node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'foo123'</span><span style="color:#666">][</span><span style="color:#4070a0">'url'</span><span style="color:#666">]</span>
</code></pre></div>
<p>By using attributes to define paths:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">source <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'url'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span>version<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/Python-</span><span style="color:#70a0d0;font-style:italic">#{</span>version<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.tar.bz2"</span>
</code></pre></div>
<p>By defining multiple paths for multiple locations:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">source <span style="color:#4070a0">'http://seapower/spring.png'</span>, <span style="color:#4070a0">'http://seapower/has_sprung.png'</span>
</code></pre></div>
<p>By defining those same multiple paths as an array:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">source <span style="color:#666">[</span><span style="color:#4070a0">'http://seapower/spring.png'</span>, <span style="color:#4070a0">'http://seapower/has_sprung.png'</span><span style="color:#666">]</span>
</code></pre></div>
<p>When multiple paths are specified, Chef Infra Client will attempt to download the files in the order listed, stopping after the first successful download.</p> </dd> </dl> <dl> <dt> <code>use_conditional_get</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Enable conditional HTTP requests by using a conditional <code>GET</code> (with the If-Modified-Since header) or an opaque identifier (ETag). To use If-Modified-Since headers, <code>use_last_modified</code> must also be set to <code>true</code>. To use ETag headers, <code>use_etag</code> must also be set to <code>true</code>.</p> </dd> </dl> <dl> <dt> <code>show_progress</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Displays the progress of the file download.</p> </dd> </dl> <dl> <dt> <code>ssl_verify_mode</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol <strong>Allowed Values:</strong> <code>:verify_none, :verify_peer</code> <p>Optional property to override SSL policy. If not specified, uses the SSL policy from <code>config.rb</code>.</p> <p> New in Chef Infra Client 16.2 </p> </dd> </dl> <dl> <dt> <code>use_etag</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Enable ETag headers. Set to <code>false</code> to disable ETag headers. To use this setting, <code>use_conditional_get</code> must also be set to true.</p> </dd> </dl> <dl> <dt> <code>use_last_modified</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Enable <code>If-Modified-Since</code> headers. Set to <code>false</code> to disable <code>If-Modified-Since</code> headers. To use this setting, <code>use_conditional_get</code> must also be set to <code>true</code>.</p> </dd> </dl> <dl> <dt> <code>verify</code> </dt> <dd> <strong>Ruby Type:</strong> String, Block 
<p>A block or a string that returns <code>true</code> or <code>false</code>. A string, when <code>true</code> is executed as a system command.</p> <p>A block is arbitrary Ruby defined within the resource block by using the <code>verify</code> property. When a block is <code>true</code>, Chef Infra Client will continue to update the file as appropriate.</p> <p>For example, this should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'/tmp/baz'</span> <span style="color:#007020;font-weight:700">do</span>
  verify { <span style="color:#40a070">1</span> <span style="color:#666">==</span> <span style="color:#40a070">1</span> }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'/etc/nginx.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  verify <span style="color:#4070a0">'nginx -t -c %{path}'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> 
<p>This should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'/tmp/bar'</span> <span style="color:#007020;font-weight:700">do</span>
  verify { <span style="color:#40a070">1</span> <span style="color:#666">==</span> <span style="color:#40a070">1</span>}
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>And this should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'/tmp/foo'</span> <span style="color:#007020;font-weight:700">do</span>
  verify <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>path<span style="color:#666">|</span>
    <span style="color:#007020">true</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Whereas, this should return <code>false</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'/tmp/turtle'</span> <span style="color:#007020;font-weight:700">do</span>
  verify <span style="color:#4070a0">'/usr/bin/false'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>If a string or a block return <code>false</code>, the Chef Infra Client run will stop and an error is returned.</p> </dd> </dl> <h4 id="common-atomic-update-remote-file">Atomic File Updates</h4> <p>Atomic updates are used with <strong>file</strong>-based resources to help ensure that file updates can be made when updating a binary or if disk space runs out.</p> <p>Atomic updates are enabled by default. They can be managed globally using the <code>file_atomic_update</code> setting in the client.rb file. They can be managed on a per-resource basis using the <code>atomic_update</code> property that is available with the <strong>cookbook_file</strong>, <strong>file</strong>, <strong>remote_file</strong>, and <strong>template</strong> resources.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>On certain platforms, and after a file has been moved into place, Chef Infra Client may modify file permissions to support features specific to those platforms. On platforms with SELinux enabled, Chef Infra Client will fix up the security contexts after a file has been moved into the correct location by running the <code>restorecon</code> command. On the Microsoft Windows platform, Chef Infra Client will create files so that ACL inheritance works as expected.</p> </div> </div> <h4 id="common-windows-security-remote-file">Windows File Security</h4> To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes. <strong>Access Control Lists (ACLs)</strong> <p>The <code>rights</code> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <code>rights</code> property can be used as many times as necessary; Chef Infra Client will apply them to the file or directory as required. The syntax for the <code>rights</code> property is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights permission, principal, option_type <span style="color:#666">=&gt;</span> value
</code></pre></div>
<p>where</p> <dl> <dt><code>permission</code></dt> <dd> <p>Use to specify which rights are granted to the <code>principal</code>. The possible values are: <code>:read</code>, <code>:write</code>, <code>read_execute</code>, <code>:modify</code>, <code>:full_control</code>, or an integer.</p> </dd> <dd> <p>Integers used for permissions must match the following list <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.accesscontrol.filesystemrights?view=windowsdesktop-5.0#fields">FileSystemRights Enum</a> fields.</p> </dd> </dl> <pre class="highlight" data-language="ruby"><code>These permissions are cumulative. If `:write` is specified, then it
includes `:read`. If `:full_control` is specified, then it includes
both `:write` and `:read`.

(For those who know the Microsoft Windows API: `:read` corresponds
to `GENERIC_READ`; `:write` corresponds to `GENERIC_WRITE`;
`:read_execute` corresponds to `GENERIC_READ` and `GENERIC_EXECUTE`;
`:modify` corresponds to `GENERIC_WRITE`, `GENERIC_READ`,
`GENERIC_EXECUTE`, and `DELETE`; `:full_control` corresponds to
`GENERIC_ALL`, which allows a user to change the owner and other
metadata about a file.)
</code></pre> <dl> <dt><code>principal</code></dt> <dd> <p>Use to specify a group or user. The principal can be specified by either name or SID. When using name, this is identical to what is entered in the login box for Microsoft Windows, such as <code>user_name</code>, <code>domain\user_name</code>, or <code>user_name@fully_qualified_domain_name</code>. When using a SID, you may use either the standard string representation of a SID (S-R-I-S-S) or one of the <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/sid-strings">SDDL string constants</a>. Chef Infra Client does not need to know if a principal is a user or a group.</p> </dd> <dt><code>option_type</code></dt> <dd> <p>A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <code>rights :write, 'domain\group_name', :one_level_deep =&gt; true</code>. Possible option types:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Option Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>:applies_to_children</code></td> <td>Specify how permissions are applied to children. Possible values: <code>true</code> to inherit both child directories and files; <code>false</code> to not inherit any child directories or files; <code>:containers_only</code> to inherit only child directories (and not files); <code>:objects_only</code> to recursively inherit files (and not child directories).</td> </tr> <tr> <td><code>:applies_to_self</code></td> <td>Indicates whether a permission is applied to the parent directory. Possible values: <code>true</code> to apply to the parent directory or file and its children; <code>false</code> to not apply only to child directories and files.</td> </tr> <tr> <td><code>:one_level_deep</code></td> <td>Indicates the depth to which permissions will be applied. Possible values: <code>true</code> to apply only to the first level of children; <code>false</code> to apply to all children.</td> </tr> </tbody> </table> </dd> </dl> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'S-1-1-0'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Administrators Everyone)</span>
rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'Users'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'Sally'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#517918">:containers_only</span>, <span style="color:#517918">applies_to_self</span>: <span style="color:#007020">false</span>, <span style="color:#517918">one_level_deep</span>: <span style="color:#007020">true</span>
</code></pre></div>
<p>Some other important things to know when using the <code>rights</code> attribute:</p> <ul> <li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li> <li>If rights are not specified, nothing will be changed. Chef Infra Client does not clear out the rights on a file or directory if rights are not specified.</li> <li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li> </ul> <p>Use the <code>deny_rights</code> property to deny specific rights to specific users. The ordering is independent of using the <code>rights</code> property. For example, it doesn’t matter if rights are granted to everyone is placed before or after <code>deny_rights :read, ['Julian', 'Lewis']</code>, both Julian and Lewis will be unable to read the document. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'Everyone'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Julian Lewis)</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">deny_rights <span style="color:#517918">:full_control</span>, <span style="color:#666">[</span><span style="color:#4070a0">'Sally'</span><span style="color:#666">]</span>
</code></pre></div> <strong>Inheritance</strong> <p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <code>inherits</code> property can be used to specifically tell Chef Infra Client to apply (or not apply) inherited rights from its parent directory.</p> <p>For example, the following example specifies the rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  inherits <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># Sauron is the only person who should have any sort of access</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>If the <code>deny_rights</code> permission were to be used instead, something could slip through unless all users and groups were denied.</p> <p>Another example also shows how to specify rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'SHIRE\Frodo'</span> <span style="color:#60a0b0;font-style:italic"># Who put that there I didn't put that there</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>but then not use the <code>inherits</code> property to deny those rights on a child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span> <span style="color:#60a0b0;font-style:italic"># Oops, not specific enough</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Because the <code>inherits</code> property is not specified, Chef Infra Client will default it to <code>true</code>, which will ensure that security settings for existing files remain unchanged.</p> <h4 id="prevent-re-downloads-remote-file">Prevent Re-downloads</h4> <p>To prevent Chef Infra Client from re-downloading files that are already present on a node, use one of the following attributes in a recipe: <code>use_conditional_get</code> (default) or <code>checksum</code>.</p> <ul> <li>The <code>use_conditional_get</code> attribute is the default behavior of Chef Infra Client. If the remote file is located on a server that supports ETag and/or If-Modified-Since headers, Chef Infra Client will use a conditional <code>GET</code> to determine if the file has been updated. If the file has been updated, Chef Infra Client will re-download the file.</li> <li>The <code>checksum</code> attribute will ask Chef Infra Client to compare the checksum for the local file to the one at the remote location. If they match, Chef Infra Client will not re-download the file. Using a local checksum for comparison requires that the local checksum be the correct checksum.</li> </ul> <p>The desired approach just depends on the desired workflow. For example, if a node requires a new file every day, using the checksum approach would require that the local checksum be updated and/or verified every day as well, in order to ensure that the local checksum was the correct one. Using a conditional <code>GET</code> in this scenario will greatly simplify the management required to ensure files are being updated accurately.</p> <h4 id="access-a-remote-unc-path-on-windows-remote-file">Access a remote UNC path on Windows</h4> <p>The <code>remote_file</code> resource on Windows supports accessing files from a remote SMB/CIFS share. The file name should be specified in the source property as a UNC path e.g. <code>\myserver\myshare\mydirectory\myfile.txt</code>. This allows access to the file at that path location even if the Chef Infra Client process identity does not have permission to access the file. Credentials for authenticating to the remote system can be specified using the <code>remote_user</code>, <code>remote_domain</code>, and <code>remote_password</code> properties when the user that Chef Infra Client is running does not have access to the remote file. See the “Properties” section for more details on these options.</p> <p><strong>Note</strong>: This is primarily for accessing remote files when the user that Chef Infra Client is running as does not have sufficient access, and alternative credentials need to be specified. If the user already has access, the credentials do not need to be specified. In a case where the local system and remote system are in the same domain, the <code>remote_user</code> and <code>remote_password</code> properties often do not need to be specified, as the user may already have access to the remote file share.</p> <p>Examples:</p> <p><strong>Access a file from a different domain account:</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'E:/domain_test.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'\\myserver\myshare\mydirectory\myfile.txt'</span>
  remote_domain <span style="color:#4070a0">'domain'</span>
  remote_user <span style="color:#4070a0">'username'</span>
  remote_password <span style="color:#4070a0">'password'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>OR</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'E:/domain_test.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'\\myserver\myshare\mydirectory\myfile.txt'</span>
  remote_user <span style="color:#4070a0">'domain\username'</span>
  remote_password <span style="color:#4070a0">'password'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Access a file using a local account on the remote machine:</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'E:/domain_test.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'\\myserver\myshare\mydirectory\myfile.txt'</span>
  remote_domain <span style="color:#4070a0">'.'</span>
  remote_user <span style="color:#4070a0">'username'</span>
  remote_password <span style="color:#4070a0">'password'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>OR</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">remote_file <span style="color:#4070a0">'E:/domain_test.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'\\myserver\myshare\mydirectory\myfile.txt'</span>
  remote_user <span style="color:#4070a0">'.\username'</span>
  remote_password <span style="color:#4070a0">'password'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h3 id="examples-remote-file">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>remote_file</strong> resource in recipes:</p> <p><strong>Download a file without checking the checksum</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  remote_file <span style="color:#4070a0">'/tmp/remote.txt'</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">'https://example.org/remote.txt'</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Download a file with a checksum to validate</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  remote_file <span style="color:#4070a0">'/tmp/test_file'</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">'http://www.example.com/tempfiles/test_file'</span>
    mode <span style="color:#4070a0">'0755'</span>
    checksum <span style="color:#4070a0">'3a7dac00b1'</span> <span style="color:#60a0b0;font-style:italic"># A SHA256 (or portion thereof) of the file.</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Download a file only if it’s not already present</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  remote_file <span style="color:#4070a0">'/tmp/remote.txt'</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">'https://example.org/remote.txt'</span>
    checksum <span style="color:#4070a0">'3a7dac00b1'</span> <span style="color:#60a0b0;font-style:italic"># A SHA256 (or portion thereof) of the file.</span>
    action <span style="color:#517918">:create_if_missing</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Using HTTP Basic Authentication in Headers</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  remote_file <span style="color:#4070a0">'/tmp/remote.txt'</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">'https://example.org/remote.txt'</span>
    headers(<span style="color:#4070a0">'Authorization'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"Basic </span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Base64</span><span style="color:#666">.</span>encode64(<span style="color:#4070a0">"USERNAME_VALUE:PASSWORD_VALUE"</span>)<span style="color:#666">.</span>delete(<span style="color:#4070a0">"</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">"</span>)<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>)
    checksum <span style="color:#4070a0">'3a7dac00b1'</span> <span style="color:#60a0b0;font-style:italic"># A SHA256 (or portion thereof) of the file.</span>
    action <span style="color:#517918">:create_if_missing</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Downloading a file to the Chef file cache dir for execution</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  remote_file <span style="color:#4070a0">'#{Chef::Config['</span>file_cache_path<span style="color:#4070a0">']}/install.sh'</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">'https://example.org/install.sh'</span>
    action <span style="color:#517918">:create_if_missing</span>
  <span style="color:#007020;font-weight:700">end</span>

  execute <span style="color:#4070a0">'#{Chef::Config['</span>file_cache_path<span style="color:#4070a0">']}/install.sh'</span>
</code></pre></div>
<p><strong>Specify advanced HTTP connection options including Net::HTTP (nethttp) options:</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">  remote_file <span style="color:#4070a0">'/tmp/remote.txt'</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">'https://example.org/remote.txt'</span>
    http_options({
      <span style="color:#517918">http_retry_delay</span>: <span style="color:#40a070">0</span>,
      <span style="color:#517918">http_retry_count</span>: <span style="color:#40a070">0</span>,
      <span style="color:#517918">keepalives</span>: <span style="color:#007020">false</span>,
      <span style="color:#517918">nethttp</span>: {
        <span style="color:#517918">continue_timeout</span>: <span style="color:#40a070">5</span>,
        <span style="color:#517918">max_retries</span>: <span style="color:#40a070">5</span>,
        <span style="color:#517918">read_timeout</span>: <span style="color:#40a070">5</span>,
        <span style="color:#517918">write_timeout</span>: <span style="color:#40a070">5</span>,
        <span style="color:#517918">ssl_timeout</span>: <span style="color:#40a070">5</span>,
      },
    })
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="rhsm-errata-resource">rhsm_errata resource</h2> <a href="rhsm_errata/index.html">rhsm_errata resource page</a> <hr> <p>Use the <strong>rhsm_errata</strong> resource to install packages associated with a given Red Hat Subscription Manager Errata ID. This is helpful if packages to mitigate a single vulnerability must be installed on your hosts.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-rhsm-errata">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>rhsm_errata</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rhsm_errata <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  errata_id      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action         <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>rhsm_errata</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>errata_id</code> is the property available to this resource.</li> </ul> <h3 id="actions-rhsm-errata">Actions</h3> <hr> <p>The <strong>rhsm_errata</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install a package for a specific errata ID. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-rhsm-errata">Properties</h3> <hr> <p>The <strong>rhsm_errata</strong> resource has the following properties:</p> <dl> <dt> <code>errata_id</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property for specifying the errata ID if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-rhsm-errata">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-rhsm-errata">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-rhsm-errata">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-rhsm-errata">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-rhsm-errata">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>rhsm_errata</strong> resource in recipes:</p> <p><strong>Install a package from an Errata ID</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rhsm_errata <span style="color:#4070a0">'RHSA:2018-1234'</span>
</code></pre></div>
<p><strong>Specify an Errata ID that differs from the resource name</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rhsm_errata <span style="color:#4070a0">'errata-install'</span>
  errata_id <span style="color:#4070a0">'RHSA:2018-1234'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="rhsm-errata-level-resource">rhsm_errata_level resource</h2> <a href="rhsm_errata_level/index.html">rhsm_errata_level resource page</a> <hr> <p>Use the <strong>rhsm_errata_level</strong> resource to install all packages of a specified errata level from the Red Hat Subscription Manager. For example, you can ensure that all packages associated with errata marked at a ‘Critical’ security level are installed.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-rhsm-errata-level">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>rhsm_errata_level</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rhsm_errata_level <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  errata_level      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>rhsm_errata_level</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>errata_level</code> is the property available to this resource.</li> </ul> <h3 id="actions-rhsm-errata-level">Actions</h3> <hr> <p>The <strong>rhsm_errata_level</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install all packages of the specified errata level. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-rhsm-errata-level">Properties</h3> <hr> <p>The <strong>rhsm_errata_level</strong> resource has the following properties:</p> <dl> <dt> <code>errata_level</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <strong>Allowed Values:</strong> <code>"critical", "important", "low", "moderate"</code> <p>An optional property for specifying the errata level of packages to install if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-rhsm-errata-level">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-rhsm-errata-level">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-rhsm-errata-level">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-rhsm-errata-level">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-rhsm-errata-level">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>rhsm_errata_level</strong> resource in recipes:</p> <p><strong>Specify an errata level that differs from the resource name</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rhsm_errata_level <span style="color:#4070a0">'example_install_moderate'</span> <span style="color:#007020;font-weight:700">do</span>
  errata_level <span style="color:#4070a0">'moderate'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="rhsm-register-resource">rhsm_register resource</h2> <a href="rhsm_register/index.html">rhsm_register resource page</a> <hr> <p>Use the <strong>rhsm_register</strong> resource to register a node with the Red Hat Subscription Manager or a local Red Hat Satellite server.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-rhsm-register">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>rhsm_register</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rhsm_register <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  activation_key             <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  auto_attach                <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  base_url                   <span style="color:#007020">String</span>
  environment                <span style="color:#007020">String</span>
  force                      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  https_for_ca_consumer      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  install_katello_agent      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  organization               <span style="color:#007020">String</span>
  password                   <span style="color:#007020">String</span>
  release                    <span style="color:#007020">Float</span>, <span style="color:#007020">String</span>
  satellite_host             <span style="color:#007020">String</span>
  server_url                 <span style="color:#007020">String</span>
  service_level              <span style="color:#007020">String</span>
  system_name                <span style="color:#007020">String</span>
  username                   <span style="color:#007020">String</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :register if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>rhsm_register</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>activation_key</code>, <code>auto_attach</code>, <code>base_url</code>, <code>environment</code>, <code>force</code>, <code>https_for_ca_consumer</code>, <code>install_katello_agent</code>, <code>organization</code>, <code>password</code>, <code>release</code>, <code>satellite_host</code>, <code>server_url</code>, <code>service_level</code>, <code>system_name</code>, and <code>username</code> are the properties available to this resource.</li> </ul> <h3 id="actions-rhsm-register">Actions</h3> <hr> <p>The <strong>rhsm_register</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:register</code></dt> <dd>Register the node with RHSM. (default)</dd> <dt><code>:unregister</code></dt> <dd>Unregister the node from RHSM.</dd> </dl> <h3 id="properties-rhsm-register">Properties</h3> <hr> <p>The <strong>rhsm_register</strong> resource has the following properties:</p> <dl> <dt> <code>activation_key</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>A string or array of activation keys to use when registering; you must also specify the ‘organization’ property when using this property.</p> </dd> </dl> <dl> <dt> <code>auto_attach</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>If true, RHSM will attempt to automatically attach the host to applicable subscriptions. It is generally better to use an activation key with the subscriptions pre-defined.</p> </dd> </dl> <dl> <dt> <code>base_url</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The hostname of the content delivery server to use to receive updates. Both Customer Portal Subscription Management and Subscription Asset Manager use Red Hat’s hosted content delivery services, with the URL <a href="https://cdn.redhat.com">https://cdn.redhat.com</a>. Since Satellite 6 hosts its own content, the URL must be used for systems registered with Satellite 6.</p> <p> New in Chef Infra Client 17.8 </p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The environment to use when registering; required when using the username and password properties.</p> </dd> </dl> <dl> <dt> <code>force</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>If true, the system will be registered even if it is already registered. Normally, any register operations will fail if the machine has already been registered.</p> </dd> </dl> <dl> <dt> <code>https_for_ca_consumer</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>If true, Chef Infra Client will fetch the katello-ca-consumer-latest.noarch.rpm from the satellite_host using HTTPS.</p> <p> New in Chef Infra Client 15.9 </p> </dd> </dl> <dl> <dt> <code>install_katello_agent</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>If true, the ‘katello-agent’ RPM will be installed.</p> </dd> </dl> <dl> <dt> <code>organization</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The organization to use when registering; required when using the ‘activation_key’ property.</p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The password to use when registering. This property is not applicable if using an activation key. If specified, username and environment are also required.</p> </dd> </dl> <dl> <dt> <code>release</code> </dt> <dd> <strong>Ruby Type:</strong> Float, String <p>Sets the operating system minor release to use for subscriptions for the system. Products and updates are limited to the specified minor release version. This is used only used with the <code>auto_attach</code> option. For example, <code>release '6.4'</code> will append <code>--release=6.4</code> to the register command.</p> <p> New in Chef Infra Client 17.8 </p> </dd> </dl> <dl> <dt> <code>satellite_host</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The FQDN of the Satellite host to register with. If this property is not specified, the host will register with Red Hat’s public RHSM service.</p> </dd> </dl> <dl> <dt> <code>server_url</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The hostname of the subscription service to use. The default is Customer Portal Subscription Management, subscription.rhn.redhat.com. If you do not use this option, the system registers with Customer Portal Subscription Management.</p> <p> New in Chef Infra Client 17.8 </p> </dd> </dl> <dl> <dt> <code>service_level</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Sets the service level to use for subscriptions on the registering machine. This is only used with the <code>auto_attach</code> option.</p> <p> New in Chef Infra Client 17.8 </p> </dd> </dl> <dl> <dt> <code>system_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of the system to register, defaults to the hostname.</p> <p> New in Chef Infra Client 16.5 </p> </dd> </dl> <dl> <dt> <code>username</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The username to use when registering. This property is not applicable if using an activation key. If specified, password and environment properties are also required.</p> </dd> </dl> <br> <h3 id="functionality-rhsm-register">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-rhsm-register">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-rhsm-register">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-rhsm-register">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-rhsm-register">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>rhsm_register</strong> resource in recipes:</p> <p>*<em>Register a node with RHSM</em></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rhsm_register <span style="color:#4070a0">'my-host'</span> <span style="color:#007020;font-weight:700">do</span>
  activation_key <span style="color:#4070a0">'ABCD1234'</span>
  organization <span style="color:#4070a0">'my_org'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="rhsm-repo-resource">rhsm_repo resource</h2> <a href="rhsm_repo/index.html">rhsm_repo resource page</a> <hr> <p>Use the <strong>rhsm_repo</strong> resource to enable or disable Red Hat Subscription Manager repositories that are made available via attached subscriptions.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-rhsm-repo">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>rhsm_repo</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rhsm_repo <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  repo_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action         <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :enable if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>rhsm_repo</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>repo_name</code> is the property available to this resource.</li> </ul> <h3 id="actions-rhsm-repo">Actions</h3> <hr> <p>The <strong>rhsm_repo</strong> resource has the following actions:</p> <dl> <dt><code>:disable</code></dt> <dd>Disable a RHSM repository.</dd> <dt><code>:enable</code></dt> <dd>Enable a RHSM repository. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-rhsm-repo">Properties</h3> <hr> <p>The <strong>rhsm_repo</strong> resource has the following properties:</p> <dl> <dt> <code>repo_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property for specifying the repository name if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-rhsm-repo">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-rhsm-repo">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-rhsm-repo">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-rhsm-repo">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-rhsm-repo">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>rhsm_repo</strong> resource in recipes:</p> <p><strong>Enable an RHSM repository</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rhsm_repo <span style="color:#4070a0">'rhel-7-server-extras-rpms'</span>
</code></pre></div>
<p><strong>Disable an RHSM repository</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rhsm_repo <span style="color:#4070a0">'rhel-7-server-extras-rpms'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:disable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="rhsm-subscription-resource">rhsm_subscription resource</h2> <a href="rhsm_subscription/index.html">rhsm_subscription resource page</a> <hr> <p>Use the <strong>rhsm_subscription</strong> resource to add or remove Red Hat Subscription Manager subscriptions from your host. This can be used when a host’s activation_key does not attach all necessary subscriptions to your host.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-rhsm-subscription">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>rhsm_subscription</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rhsm_subscription <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  pool_id      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action       <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :attach if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>rhsm_subscription</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>pool_id</code> is the property available to this resource.</li> </ul> <h3 id="actions-rhsm-subscription">Actions</h3> <hr> <p>The <strong>rhsm_subscription</strong> resource has the following actions:</p> <dl> <dt><code>:attach</code></dt> <dd>Attach the node to a subscription pool. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove the node from a subscription pool.</dd> </dl> <h3 id="properties-rhsm-subscription">Properties</h3> <hr> <p>The <strong>rhsm_subscription</strong> resource has the following properties:</p> <dl> <dt> <code>pool_id</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property for specifying the Pool ID if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-rhsm-subscription">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-rhsm-subscription">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-rhsm-subscription">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-rhsm-subscription">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-rhsm-subscription">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="route-resource">route resource</h2> <a href="route/index.html">route resource page</a> <hr> <p>Use the <strong>route</strong> resource to manage the system routing table in a Linux environment.</p> <h3 id="syntax-route">Syntax</h3> <hr> 
<p>A <strong>route</strong> resource block manages the system routing table in a Linux environment:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">route <span style="color:#4070a0">'10.0.1.10/32'</span> <span style="color:#007020;font-weight:700">do</span>
  gateway <span style="color:#4070a0">'10.0.0.20'</span>
  device <span style="color:#4070a0">'eth1'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>The full syntax for all of the properties that are available to the <strong>route</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">route <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  comment         <span style="color:#007020">String</span>
  device          <span style="color:#007020">String</span>
  gateway         <span style="color:#007020">String</span>
  metric          <span style="color:#007020">Integer</span>
  netmask         <span style="color:#007020">String</span>
  route_type      <span style="color:#60add5">Symbol</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: :host</span>
  target          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action          <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>route</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>comment</code>, <code>device</code>, <code>gateway</code>, <code>metric</code>, <code>netmask</code>, <code>route_type</code>, and <code>target</code> are the properties available to this resource.</li> </ul> <h3 id="actions-route">Actions</h3> <hr> <p>The <strong>route</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Default. Add a route.</dd> <dt><code>:delete</code></dt> <dd>Delete a route.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-route">Properties</h3> <hr> <p>The <strong>route</strong> resource has the following properties:</p> <dl> <dt> <code>comment</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Add a comment for the route.</p> <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>device</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The network interface to which the route applies.</p> </dd> </dl> <dl> <dt> <code>gateway</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The gateway for the route.</p> </dd> </dl> <dl> <dt> <code>metric</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The route metric value.</p> </dd> </dl> <dl> <dt> <code>netmask</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The decimal representation of the network mask. For example: <code>255.255.255.0</code>.</p> </dd> </dl> <dl> <dt> <code>route_type</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, String | <strong>Default Value:</strong> <code>:host</code> <strong>Allowed Values:</strong> <code>:host, :net</code> </dd> </dl> <dl> <dt> <code>target</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The IP address of the target route.</p> </dd> </dl> <br> <h3 id="functionality-route">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-route">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-route">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-route">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-route">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="rpm-package-resource">rpm_package resource</h2> <a href="rpm_package/index.html">rpm_package resource page</a> <hr> <p>Use the <strong>rpm_package</strong> resource to manage packages using the RPM Package Manager.</p> <h3 id="syntax-rpm-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>rpm_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rpm_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  allow_downgrade      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  options              <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name         <span style="color:#007020">String</span>
  source               <span style="color:#007020">String</span>
  timeout              <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version              <span style="color:#007020">String</span>
  action               <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>rpm_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>allow_downgrade</code>, <code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-rpm-package">Actions</h3> <hr> <p>The <strong>rpm_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-rpm-package">Properties</h3> <hr> <p>The <strong>rpm_package</strong> resource has the following properties:</p> <dl> <dt> <code>allow_downgrade</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Allow downgrading a package to satisfy requested version requirements.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-rpm-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-rpm-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-rpm-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-rpm-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-rpm-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>rpm_package</strong> resource in recipes:</p> <p>Install a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rpm_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="ruby-resource">ruby resource</h2> <a href="ruby/index.html">ruby resource page</a> <hr> <p>Use the <strong>ruby</strong> resource to execute scripts using the Ruby interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <code>not_if</code> and <code>only_if</code> to guard this resource for idempotence.</p> <h3 id="syntax-ruby">Syntax</h3> <hr> 
<p>A <strong>ruby</strong> resource block executes scripts using Ruby:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ruby <span style="color:#4070a0">'hello world'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span style="color:#007020">puts</span> <span style="color:#4070a0">"Hello world! From Chef and Ruby."</span>
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>cwd</code> specifies the directory from which the command is run</li> <li>
<code>code</code> specifies the command to run</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>ruby</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ruby <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  code                       <span style="color:#007020">String</span>
  creates                    <span style="color:#007020">String</span>
  cwd                        <span style="color:#007020">String</span>
  environment                <span style="color:#60add5">Hash</span>
  flags                      <span style="color:#007020">String</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                       <span style="color:#007020">Array</span>
  returns                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span>
  timeout                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Float</span>
  user                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  umask                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>ruby</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>code</code>, <code>creates</code>, <code>cwd</code>, <code>environment</code>, <code>flags</code>, <code>group</code>, <code>path</code>, <code>returns</code>, <code>timeout</code>, <code>user</code>, and <code>umask</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-ruby">Actions</h3> <hr> <p>The <strong>ruby</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:run</code></dt> <dd>Default. Run a script.</dd> </dl> <h3 id="properties-ruby">Properties</h3> <hr> <p>The <strong>ruby</strong> resource has the following properties:</p> <dl> <dt> <code>code</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A quoted (" “) string of code to be executed.</p> </dd> </dl> <dl> <dt> <code>creates</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Prevent a command from creating a file when that file already exists.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The current working directory.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of environment variables in the form of <code>({"ENV_VARIABLE" =&gt; "VALUE"})</code>. (These variables must exist for a command to be run successfully.)</p> </dd> </dl> <dl> <dt> <code>flags</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One or more command line flags that are passed to the interpreter when a command is invoked.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group name or group ID that must be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>ignore_failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Continue running a recipe if a resource fails for any reason.</p> </dd> </dl> <dl> <dt> <code>notifies</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>returns</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Array | <strong>Default Value:</strong> <code>0</code> <p>The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match.</p> </dd> </dl> <dl> <dt> <code>subscribes</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, Chef::Resource\[String\] 
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p>  
<p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl>  
<p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Float | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) a command is to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The user name or user ID that should be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>umask</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The file mode creation mask, or umask.</p> </dd> </dl> <br> <h3 id="functionality-ruby">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="guards-ruby">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-ruby">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="ruby-block-resource">ruby_block resource</h2> <a href="ruby_block/index.html">ruby_block resource page</a> <hr> <p>Use the <strong>ruby_block</strong> resource to execute Ruby code during a Chef Infra Client run. Ruby code in the <code>ruby_block</code> resource is evaluated with other resources during convergence, whereas Ruby code outside of a <code>ruby_block</code> resource is evaluated before other resources, as the recipe is compiled.</p> <h3 id="syntax-ruby-block">Syntax</h3> <hr> 
<p>A <strong>ruby_block</strong> resource block executes a block of arbitrary Ruby code. For example, to reload the client.rb file during a Chef Infra Client run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ruby_block <span style="color:#4070a0">'reload_client_config'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">.</span>from_file(<span style="color:#4070a0">"/etc/chef/client.rb"</span>)
  <span style="color:#007020;font-weight:700">end</span>
  action <span style="color:#517918">:run</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>The full syntax for all of the properties that are available to the <strong>ruby_block</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ruby_block <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  block                      <span style="color:#60add5">Block</span>
  block_name                 <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># defaults to 'name' if not specified</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>ruby_block</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>block</code> is the block of Ruby code to be executed.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>block</code> and <code>block_name</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-ruby-block">Actions</h3> <hr> <p>The <strong>ruby_block</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>The same as <code>:run</code>.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:run</code></dt> <dd>Default. Run a Ruby block.</dd> </dl> <h3 id="properties-ruby-block">Properties</h3> <hr> <p>The <strong>ruby_block</strong> resource has the following properties:</p> <dl> <dt> <code>block</code> </dt> <dd> <strong>Ruby Type:</strong> Block <p>A block of Ruby code.</p> </dd> </dl> <dl> <dt> <code>block_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the Ruby block. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <h3 id="examples-ruby-block">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>ruby_block</strong> resource in recipes:</p> <p><strong>Re-read configuration data</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ruby_block <span style="color:#4070a0">'reload_client_config'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">.</span>from_file(<span style="color:#4070a0">'/etc/chef/client.rb'</span>)
  <span style="color:#007020;font-weight:700">end</span>
  action <span style="color:#517918">:run</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Run a block on a particular platform</strong></p> <p>The following example shows how an if statement can be used with the <code>windows?</code> method in the Chef Infra Language to run code specific to Microsoft Windows. The code is defined using the ruby_block resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">if</span> windows?
  ruby_block <span style="color:#4070a0">'copy libmysql.dll into ruby path'</span> <span style="color:#007020;font-weight:700">do</span>
    block <span style="color:#007020;font-weight:700">do</span>
      <span style="color:#007020">require</span> <span style="color:#4070a0">'fileutils'</span>
      <span style="color:#60add5">FileUtils</span><span style="color:#666">.</span>cp <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'client'</span><span style="color:#666">][</span><span style="color:#4070a0">'lib_dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">libmysql.dll"</span>,
        node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'client'</span><span style="color:#666">][</span><span style="color:#4070a0">'ruby_dir'</span><span style="color:#666">]</span>
    <span style="color:#007020;font-weight:700">end</span>
    not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(<span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'client'</span><span style="color:#666">][</span><span style="color:#4070a0">'ruby_dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">libmysql.dll"</span>) }
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Stash a file in a data bag</strong></p> <p>The following example shows how to use the ruby_block resource to stash a BitTorrent file in a data bag so that it can be distributed to nodes in the organization.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ruby_block <span style="color:#4070a0">'share the torrent file'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    f <span style="color:#666">=</span> <span style="color:#60add5">File</span><span style="color:#666">.</span>open(node<span style="color:#666">[</span><span style="color:#4070a0">'bittorrent'</span><span style="color:#666">][</span><span style="color:#4070a0">'torrent'</span><span style="color:#666">]</span>,<span style="color:#4070a0">'rb'</span>)
    <span style="color:#60a0b0;font-style:italic">#read the .torrent file and base64 encode it</span>
    enc <span style="color:#666">=</span> <span style="color:#60add5">Base64</span><span style="color:#666">.</span>encode64(f<span style="color:#666">.</span>read)
    data <span style="color:#666">=</span> {
      <span style="color:#4070a0">'id'</span><span style="color:#666">=&gt;</span>bittorrent_item_id(node<span style="color:#666">[</span><span style="color:#4070a0">'bittorrent'</span><span style="color:#666">][</span><span style="color:#4070a0">'file'</span><span style="color:#666">]</span>),
      <span style="color:#4070a0">'seed'</span><span style="color:#666">=&gt;</span>node<span style="color:#666">.</span>ipaddress,
      <span style="color:#4070a0">'torrent'</span><span style="color:#666">=&gt;</span>enc
    }
    item <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">DataBagItem</span><span style="color:#666">.</span>new
    item<span style="color:#666">.</span>data_bag(<span style="color:#4070a0">'bittorrent'</span>)
    item<span style="color:#666">.</span>raw_data <span style="color:#666">=</span> data
    item<span style="color:#666">.</span>save
  <span style="color:#007020;font-weight:700">end</span>
  action <span style="color:#517918">:nothing</span>
  subscribes <span style="color:#517918">:create</span>, <span style="color:#4070a0">"bittorrent_torrent[</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'bittorrent'</span><span style="color:#666">][</span><span style="color:#4070a0">'torrent'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">]"</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Update the /etc/hosts file</strong></p> <p>The following example shows how the ruby_block resource can be used to update the /etc/hosts file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ruby_block <span style="color:#4070a0">'edit etc hosts'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    rc <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Util</span><span style="color:#666">::</span><span style="color:#60add5">FileEdit</span><span style="color:#666">.</span>new(<span style="color:#4070a0">'/etc/hosts'</span>)
    rc<span style="color:#666">.</span>search_file_replace_line(<span style="color:#235388">/^127\.0\.0\.1 localhost$/</span>,
      <span style="color:#4070a0">'127.0.0.1 #{new_fqdn} #{new_hostname} localhost'</span>)
    rc<span style="color:#666">.</span>write_file
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Set environment variables</strong></p> <p>The following example shows how to use variables within a Ruby block to set environment variables using rbenv.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#517918">:rbenv</span><span style="color:#666">][</span><span style="color:#517918">:root</span><span style="color:#666">]</span> <span style="color:#666">=</span> rbenv_root
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#517918">:ruby_build</span><span style="color:#666">][</span><span style="color:#517918">:bin_path</span><span style="color:#666">]</span> <span style="color:#666">=</span> rbenv_binary_path

ruby_block <span style="color:#4070a0">'initialize'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#60add5">ENV</span><span style="color:#666">[</span><span style="color:#4070a0">'RBENV_ROOT'</span><span style="color:#666">]</span> <span style="color:#666">=</span> node<span style="color:#666">[</span><span style="color:#517918">:rbenv</span><span style="color:#666">][</span><span style="color:#517918">:root</span><span style="color:#666">]</span>
    <span style="color:#60add5">ENV</span><span style="color:#666">[</span><span style="color:#4070a0">'PATH'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#517918">:rbenv</span><span style="color:#666">][</span><span style="color:#517918">:root</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/bin:</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#517918">:ruby_build</span><span style="color:#666">][</span><span style="color:#517918">:bin_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">:</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">ENV</span><span style="color:#666">[</span><span style="color:#4070a0">'PATH'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Call methods in a gem</strong></p> <p>The following example shows how to call methods in gems not shipped in Chef Infra Client</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_gem <span style="color:#4070a0">'mongodb'</span>

ruby_block <span style="color:#4070a0">'config_replicaset'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#60add5">MongoDB</span><span style="color:#666">.</span>configure_replicaset(node, replicaset_name, rs_nodes)
  <span style="color:#007020;font-weight:700">end</span>
  action <span style="color:#517918">:run</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="script-resource">script resource</h2> <a href="script/index.html">script resource page</a> <hr> <p>Use the <strong>script</strong> resource to execute scripts using a specified interpreter, such as Bash, csh, Perl, Python, or Ruby. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <code>not_if</code> and <code>only_if</code> to guard this resource for idempotence.</p> 
<p>This resource is the base resource for several other resources used for scripting on specific platforms. For more information about specific resources for specific platforms, see the following topics:</p> <ul> <li><a href="bash/index.html">bash</a></li> <li><a href="csh/index.html">csh</a></li> <li><a href="ksh/index.html">ksh</a></li> <li><a href="perl/index.html">perl</a></li> <li><a href="python/index.html">python</a></li> <li><a href="ruby/index.html">ruby</a></li> </ul> <p>Changed in 12.19 to support windows alternate user identity in execute resources</p> <h3 id="syntax-script">Syntax</h3> <hr> 
<p>A <strong>script</strong> resource block typically executes scripts using a specified interpreter, such as Bash, csh, Perl, Python, or Ruby:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">script <span style="color:#4070a0">'extract_module'</span> <span style="color:#007020;font-weight:700">do</span>
  interpreter <span style="color:#4070a0">"bash"</span>
  cwd <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>dirname(src_filepath)
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    mkdir <span style="color:#666">-</span><span style="color:#007020">p</span> <span style="color:#60a0b0;font-style:italic">#{extract_path}</span>
    tar xzf <span style="color:#60a0b0;font-style:italic">#{src_filename} -C #{extract_path}</span>
    mv <span style="color:#60a0b0;font-style:italic">#{extract_path}/*/* #{extract_path}/</span>
  <span style="color:#60add5">EOH</span>
  not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(extract_path) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>interpreter</code> specifies the command shell to use</li> <li>
<code>cwd</code> specifies the directory from which the command is run</li> <li>
<p><code>code</code> specifies the command to run</p> <p>It is more common to use the <strong>script</strong>-based resource that is specific to the command shell. Chef has shell-specific resources for Bash, csh, ksh, Perl, Python, and Ruby.</p> <p>The same command as above, but run using the <strong>bash</strong> resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'extract_module'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>dirname(src_filepath)
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    mkdir <span style="color:#666">-</span><span style="color:#007020">p</span> <span style="color:#60a0b0;font-style:italic">#{extract_path}</span>
    tar xzf <span style="color:#60a0b0;font-style:italic">#{src_filename} -C #{extract_path}</span>
    mv <span style="color:#60a0b0;font-style:italic">#{extract_path}/*/* #{extract_path}/</span>
  <span style="color:#60add5">EOH</span>
  not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(extract_path) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>script</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">script <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  code                       <span style="color:#007020">String</span>
  creates                    <span style="color:#007020">String</span>
  cwd                        <span style="color:#007020">String</span>
  environment                <span style="color:#60add5">Hash</span>
  flags                      <span style="color:#007020">String</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  interpreter                <span style="color:#007020">String</span>
  path                       <span style="color:#007020">Array</span>
  returns                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span>
  timeout                    <span style="color:#007020">Integer</span>, <span style="color:#007020">Float</span>
  user                       <span style="color:#007020">String</span>
  password                   <span style="color:#007020">String</span>
  domain                     <span style="color:#007020">String</span>
  umask                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :run if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>script</code> is the resource</li> <li>
<code>name</code> is the name of the resource block</li> <li>
<code>cwd</code> is the location from which the command is run</li> <li>
<code>action</code> identifies the steps Chef Infra Client will take to bring the node into the desired state</li> <li>
<code>code</code>, <code>creates</code>, <code>cwd</code>, <code>environment</code>, <code>flags</code>, <code>group</code>, <code>interpreter</code>, <code>path</code>, <code>returns</code>, <code>timeout</code>, <code>user</code>, <code>password</code>, <code>domain</code> and <code>umask</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-script">Actions</h3> <hr> <p>The <strong>script</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>Prevent a command from running. This action is used to specify that a command is run only when another resource notifies it.</dd> <dt><code>:run</code></dt> <dd>Default. Run a script.</dd> </dl> <h3 id="properties-script">Properties</h3> <hr> <p>The <strong>script</strong> resource has the following properties:</p> <dl> <dt> <code>code</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A quoted (" “) string of code to be executed.</p> </dd> </dl> <dl> <dt> <code>creates</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Prevent a command from creating a file when that file already exists.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The current working directory from which the command will be run.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of environment variables in the form of <code>({"ENV_VARIABLE" =&gt; "VALUE"})</code>. (These variables must exist for a command to be run successfully.)</p> </dd> </dl> <dl> <dt> <code>flags</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One or more command line flags that are passed to the interpreter when a command is invoked.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The group name or group ID that must be changed before running a command.</p> </dd> </dl> <dl> <dt> <code>interpreter</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The script interpreter to use during code execution.</p> </dd> </dl> <dl> <dt> <code>returns</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Array | <strong>Default Value:</strong> <code>0</code> <p>The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Float | <strong>Default Value:</strong> <code>3600</code> <p>The amount of time (in seconds) a command is to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The user name of the user identity with which to launch the new process. Default value: <span class="title-ref">nil</span>. The user name may optionally be specified with a domain, i.e. <span class="title-ref">domainuser</span> or <span class="title-ref"><a href="mailto:user@my.dns.domain.com.html">user@my.dns.domain.com</a></span> via Universal Principal Name (UPN)format. It can also be specified without a domain simply as user if the domain is instead specified using the <span class="title-ref">domain</span> attribute. On Windows only, if this property is specified, the <span class="title-ref">password</span> property must be specified.</p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p><em>Windows only</em>: The password of the user specified by the <span class="title-ref">user</span> property. Default value: <span class="title-ref">nil</span>. This property is mandatory if <span class="title-ref">user</span> is specified on Windows and may only be specified if <span class="title-ref">user</span> is specified. The <span class="title-ref">sensitive</span> property for this resource will automatically be set to true if password is specified.</p> </dd> </dl> <dl> <dt> <code>domain</code> </dt> <dd> <strong>Ruby Type:</strong> String <p><em>Windows only</em>: The domain of the user user specified by the <span class="title-ref">user</span> property. Default value: <span class="title-ref">nil</span>. If not specified, the user name and password specified by the <span class="title-ref">user</span> and <span class="title-ref">password</span> properties will be used to resolve that user against the domain in which the system running Chef client is joined, or if that system is not joined to a domain it will resolve the user as a local account on that system. An alternative way to specify the domain is to leave this property unspecified and specify the domain as part of the <span class="title-ref">user</span> property.</p> </dd> </dl> <dl> <dt> <code>umask</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The file mode creation mask, or umask.</p> </dd> </dl> <br> <h3 id="functionality-script">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-script">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-script">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-script">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h4 id="guard-interpreter-script">Guard Interpreter</h4> <p> Any resource that passes a string command may also specify the interpreter that will be used to evaluate that string command. This is done by using the <code>guard_interpreter</code> property to specify a <strong>script</strong>-based resource. </p> <strong>Attributes</strong> 
<p>The <code>guard_interpreter</code> property may be set to any of the following values:</p> <dl> <dt><code>:bash</code></dt> <dd> <p>Evaluates a string command using the <strong>bash</strong> resource.</p> </dd> <dt><code>:batch</code></dt> <dd> <p>Evaluates a string command using the <strong>batch</strong> resource. Default value (within a <strong>batch</strong> resource block): <code>:batch</code>.</p> </dd> <dt><code>:csh</code></dt> <dd> <p>Evaluates a string command using the <strong>csh</strong> resource.</p> </dd> <dt><code>:default</code></dt> <dd> <p>Default. Executes the default interpreter as identified by Chef Infra Client.</p> </dd> <dt><code>:perl</code></dt> <dd> <p>Evaluates a string command using the <strong>perl</strong> resource.</p> </dd> <dt><code>:powershell_script</code></dt> <dd> <p>Evaluates a string command using the <strong>powershell_script</strong> resource. Default value (within a <strong>powershell_script</strong> resource block): <code>:powershell_script</code>.</p> </dd> <dt><code>:python</code></dt> <dd> <p>Evaluates a string command using the <strong>python</strong> resource.</p> </dd> <dt><code>:ruby</code></dt> <dd> <p>Evaluates a string command using the <strong>ruby</strong> resource.</p> </dd> </dl> <strong>Inheritance</strong> 
<p>The <code>guard_interpreter</code> property is set to <code>:default</code> by default for the <strong>bash</strong>, <strong>csh</strong>, <strong>perl</strong>, <strong>python</strong>, and <strong>ruby</strong> resources. When the <code>guard_interpreter</code> property is set to <code>:default</code>, <code>not_if</code> or <code>only_if</code> guard statements <strong>do not inherit</strong> properties that are defined by the <strong>script</strong>-based resource.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>The <strong>batch</strong> and <strong>powershell_script</strong> resources inherit properties by default. The <code>guard_interpreter</code> property is set to <code>:batch</code> or <code>:powershell_script</code> automatically when using a <code>not_if</code> or <code>only_if</code> guard statement within a <strong>batch</strong> or <strong>powershell_script</strong> resource, respectively.</p> </div> </div> <p>For example, the <code>not_if</code> guard statement in the following resource example <strong>does not inherit</strong> the <code>environment</code> property:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'javatooling'</span> <span style="color:#007020;font-weight:700">do</span>
  environment <span style="color:#4070a0">'JAVA_HOME'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/usr/lib/java/jdk1.7/home'</span>
  code <span style="color:#4070a0">'java-based-daemon-ctl.sh -start'</span>
  not_if <span style="color:#4070a0">'java-based-daemon-ctl.sh -test-started'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and requires adding the <code>environment</code> property to the <code>not_if</code> guard statement so that it may use the <code>JAVA_HOME</code> path as part of its evaluation:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'javatooling'</span> <span style="color:#007020;font-weight:700">do</span>
  environment <span style="color:#4070a0">'JAVA_HOME'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/usr/lib/java/jdk1.7/home'</span>
  code <span style="color:#4070a0">'java-based-daemon-ctl.sh -start'</span>
  not_if <span style="color:#4070a0">'java-based-daemon-ctl.sh -test-started'</span>, <span style="color:#517918">:environment</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'JAVA_HOME'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/usr/lib/java/jdk1.7/home'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>To inherit properties, add the <code>guard_interpreter</code> property to the resource block and set it to the appropriate value:</p> <ul> <li>
<code>:bash</code> for <strong>bash</strong>
</li> <li>
<code>:csh</code> for <strong>csh</strong>
</li> <li>
<code>:perl</code> for <strong>perl</strong>
</li> <li>
<code>:python</code> for <strong>python</strong>
</li> <li>
<code>:ruby</code> for <strong>ruby</strong>
</li> </ul> <p>For example, using the same example as from above, but this time adding the <code>guard_interpreter</code> property and setting it to <code>:bash</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'javatooling'</span> <span style="color:#007020;font-weight:700">do</span>
  guard_interpreter <span style="color:#517918">:bash</span>
  environment <span style="color:#4070a0">'JAVA_HOME'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/usr/lib/java/jdk1.7/home'</span>
  code <span style="color:#4070a0">'java-based-daemon-ctl.sh -start'</span>
  not_if <span style="color:#4070a0">'java-based-daemon-ctl.sh -test-started'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The <code>not_if</code> statement now inherits the <code>environment</code> property and will use the <code>JAVA_HOME</code> path as part of its evaluation.</p> <strong>Example</strong> 
<p>For example, the following code block will ensure the command is evaluated using the default interpreter as identified by Chef Infra Client:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  guard_interpreter <span style="color:#517918">:default</span>
  <span style="color:#60a0b0;font-style:italic"># code</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h3 id="examples-script">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>script</strong> resource in recipes:</p> <p>Use a named provider to run a script</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'install_something'</span> <span style="color:#007020;font-weight:700">do</span>
  user <span style="color:#4070a0">'root'</span>
  cwd <span style="color:#4070a0">'/tmp'</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    wget <span style="color:#517918">http</span>:<span style="color:#235388">//</span>www<span style="color:#666">.</span>example<span style="color:#666">.</span>com<span style="color:#666">/</span>tarball<span style="color:#666">.</span>tar<span style="color:#666">.</span>gz
    tar <span style="color:#666">-</span>zxf tarball<span style="color:#666">.</span>tar<span style="color:#666">.</span>gz
    cd tarball
    <span style="color:#666">.</span>/configure
    make
    make   install
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Run a script</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">script <span style="color:#4070a0">'install_something'</span> <span style="color:#007020;font-weight:700">do</span>
  interpreter <span style="color:#4070a0">'bash'</span>
  user <span style="color:#4070a0">'root'</span>
  cwd <span style="color:#4070a0">'/tmp'</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    wget <span style="color:#517918">http</span>:<span style="color:#235388">//</span>www<span style="color:#666">.</span>example<span style="color:#666">.</span>com<span style="color:#666">/</span>tarball<span style="color:#666">.</span>tar<span style="color:#666">.</span>gz
    tar <span style="color:#666">-</span>zxf tarball<span style="color:#666">.</span>tar<span style="color:#666">.</span>gz
    cd tarball
    <span style="color:#666">.</span>/configure
    make
    make install
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or something like:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'openvpn-server-key'</span> <span style="color:#007020;font-weight:700">do</span>
  environment(<span style="color:#4070a0">'KEY_CN'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'server'</span>)
  code <span style="color:#4070a0">&lt;&lt;-EOF
</span>    openssl req <span style="color:#666">-</span>batch <span style="color:#666">-</span>days <span style="color:#60a0b0;font-style:italic">#{node['openvpn']['key']['expire']} \</span>
      <span style="color:#666">-</span>nodes <span style="color:#666">-</span><span style="color:#007020">new</span> <span style="color:#666">-</span>newkey <span style="color:#517918">rsa</span>:<span style="color:#60a0b0;font-style:italic">#{key_size} -keyout #{key_dir}/server.key \</span>
      <span style="color:#666">-</span>out <span style="color:#60a0b0;font-style:italic">#{key_dir}/server.csr -extensions server \</span>
      <span style="color:#666">-</span>config <span style="color:#60a0b0;font-style:italic">#{key_dir}/openssl.cnf</span>
  <span style="color:#60add5">EOF</span>
  not_if { <span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(<span style="color:#4070a0">'#{key_dir}/server.crt'</span>) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where <code>code</code> contains the OpenSSL command to be run. The <code>not_if</code> property tells Chef Infra Client not to run the command if the file already exists.</p> <p>Install a file from a remote location using bash</p> <p>The following is an example of how to install the <code>foo123</code> module for Nginx. This module adds shell-style functionality to an Nginx configuration file and does the following:</p> <ul> <li>Declares three variables</li> <li>Gets the Nginx file from a remote location</li> <li>Installs the file using Bash to the path specified by the <code>src_filepath</code> variable</li> </ul> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># the following code sample is similar to the ``upload_progress_module``</span>
<span style="color:#60a0b0;font-style:italic"># recipe in the ``nginx`` cookbook:</span>
<span style="color:#60a0b0;font-style:italic"># https://github.com/chef-cookbooks/nginx</span>

src_filename <span style="color:#666">=</span> <span style="color:#4070a0">"foo123-nginx-module-v</span><span style="color:#70a0d0;font-style:italic">#{</span>
  node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'foo123'</span><span style="color:#666">][</span><span style="color:#4070a0">'version'</span><span style="color:#666">]</span>
<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.tar.gz"</span>
src_filepath <span style="color:#666">=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#4070a0">'file_cache_path'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span>src_filename<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
extract_path <span style="color:#666">=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>
  <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#4070a0">'file_cache_path'</span><span style="color:#666">]</span>
  <span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/nginx_foo123_module/</span><span style="color:#70a0d0;font-style:italic">#{</span>
  node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'foo123'</span><span style="color:#666">][</span><span style="color:#4070a0">'checksum'</span><span style="color:#666">]</span>
<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>

remote_file <span style="color:#4070a0">'src_filepath'</span> <span style="color:#007020;font-weight:700">do</span>
  source node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'foo123'</span><span style="color:#666">][</span><span style="color:#4070a0">'url'</span><span style="color:#666">]</span>
  checksum node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'foo123'</span><span style="color:#666">][</span><span style="color:#4070a0">'checksum'</span><span style="color:#666">]</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>

bash <span style="color:#4070a0">'extract_module'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>dirname(src_filepath)
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    mkdir <span style="color:#666">-</span><span style="color:#007020">p</span> <span style="color:#60a0b0;font-style:italic">#{extract_path}</span>
    tar xzf <span style="color:#60a0b0;font-style:italic">#{src_filename} -C #{extract_path}</span>
    mv <span style="color:#60a0b0;font-style:italic">#{extract_path}/*/* #{extract_path}/</span>
  <span style="color:#60add5">EOH</span>
  not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(extract_path) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Install an application from git using bash</p> <p>The following example shows how Bash can be used to install a plug-in for rbenv named <code>ruby-build</code>, which is located in git version source control. First, the application is synchronized, and then Bash changes its working directory to the location in which <code>ruby-build</code> is located, and then runs a command.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">git <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/ruby-build"</span> <span style="color:#007020;font-weight:700">do</span>
  repository <span style="color:#4070a0">'git://github.com/sstephenson/ruby-build.git'</span>
  revision <span style="color:#4070a0">'master'</span>
  action <span style="color:#517918">:sync</span>
<span style="color:#007020;font-weight:700">end</span>

bash <span style="color:#4070a0">'install_ruby_build'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/ruby-build"</span>
  user <span style="color:#4070a0">'rbenv'</span>
  group <span style="color:#4070a0">'rbenv'</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>    <span style="color:#666">.</span>/install<span style="color:#666">.</span>sh
  <span style="color:#60add5">EOH</span>
  environment <span style="color:#4070a0">'PREFIX'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/usr/local'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>To read more about <code>ruby-build</code>, see here: <a href="https://github.com/sstephenson/ruby-build">https://github.com/sstephenson/ruby-build</a>.</p> <p>Store certain settings</p> <p>The following recipe shows how an attributes file can be used to store certain settings. An attributes file is located in the <code>attributes/</code> directory in the same cookbook as the recipe which calls the attributes file. In this example, the attributes file specifies certain settings for Python that are then used across all nodes against which this recipe will run.</p> <p>Python packages have versions, installation directories, URLs, and checksum files. An attributes file that exists to support this type of recipe would include settings like the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'version'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'2.7.1'</span>

<span style="color:#007020;font-weight:700">if</span> python<span style="color:#666">[</span><span style="color:#4070a0">'install_method'</span><span style="color:#666">]</span> <span style="color:#666">==</span> <span style="color:#4070a0">'package'</span>
  default<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'prefix_dir'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'/usr'</span>
<span style="color:#007020;font-weight:700">else</span>
  default<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'prefix_dir'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'/usr/local'</span>
<span style="color:#007020;font-weight:700">end</span>

default<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'url'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'http://www.python.org/ftp/python'</span>
default<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'checksum'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'80e387...85fd61'</span>
</code></pre></div>
<p>and then the methods in the recipe may refer to these values. A recipe that is used to install Python will need to do the following:</p> <ul> <li>Identify each package to be installed (implied in this example, not shown)</li> <li>Define variables for the package <code>version</code> and the <code>install_path</code>
</li> <li>Get the package from a remote location, but only if the package does not already exist on the target system</li> <li>Use the <strong>bash</strong> resource to install the package on the node, but only when the package is not already installed</li> </ul> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic">#  the following code sample comes from the ``oc-nginx`` cookbook on |github|: https://github.com/cookbooks/oc-nginx</span>

version <span style="color:#666">=</span> node<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'version'</span><span style="color:#666">]</span>
install_path <span style="color:#666">=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'prefix_dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/lib/python</span><span style="color:#70a0d0;font-style:italic">#{</span>version<span style="color:#666">.</span>split(<span style="color:#235388">/(^\d+\.\d+)/</span>)<span style="color:#666">[</span><span style="color:#40a070">1</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>

remote_file <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/Python-</span><span style="color:#70a0d0;font-style:italic">#{</span>version<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.tar.bz2"</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'url'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span>version<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/Python-</span><span style="color:#70a0d0;font-style:italic">#{</span>version<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.tar.bz2"</span>
  checksum node<span style="color:#666">[</span><span style="color:#4070a0">'python'</span><span style="color:#666">][</span><span style="color:#4070a0">'checksum'</span><span style="color:#666">]</span>
  mode <span style="color:#4070a0">'0755'</span>
  not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(install_path) }
<span style="color:#007020;font-weight:700">end</span>

bash <span style="color:#4070a0">'build-and-install-python'</span> <span style="color:#007020;font-weight:700">do</span>
  cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
  code <span style="color:#4070a0">&lt;&lt;-EOF
</span>    tar <span style="color:#666">-</span>jxvf <span style="color:#60add5">Python</span><span style="color:#666">-</span><span style="color:#60a0b0;font-style:italic">#{version}.tar.bz2</span>
    (cd <span style="color:#60add5">Python</span><span style="color:#666">-</span><span style="color:#60a0b0;font-style:italic">#{version} &amp;&amp; ./configure #{configure_options})</span>
    (cd <span style="color:#60add5">Python</span><span style="color:#666">-</span><span style="color:#60a0b0;font-style:italic">#{version} &amp;&amp; make &amp;&amp; make install)</span>
  <span style="color:#60add5">EOF</span>
  not_if { <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(install_path) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Run a command as an alternate user</p> <p><em>Note</em>: When Chef is running as a service, this feature requires that the user that Chef runs as has ‘SeAssignPrimaryTokenPrivilege’ (aka ‘SE_ASSIGNPRIMARYTOKEN_NAME’) user right. By default only LocalSystem and NetworkService have this right when running as a service. This is necessary even if the user is an Administrator.</p> <p>This right can be added and checked in a recipe using this example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># Add 'SeAssignPrimaryTokenPrivilege' for the user</span>
<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">ReservedNames</span><span style="color:#666">::</span><span style="color:#60add5">Win32</span><span style="color:#666">::</span><span style="color:#60add5">Security</span><span style="color:#666">.</span>add_account_right(<span style="color:#4070a0">'&lt;user&gt;'</span>, <span style="color:#4070a0">'SeAssignPrimaryTokenPrivilege'</span>)

<span style="color:#60a0b0;font-style:italic"># Check if the user has 'SeAssignPrimaryTokenPrivilege' rights</span>
<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">ReservedNames</span><span style="color:#666">::</span><span style="color:#60add5">Win32</span><span style="color:#666">::</span><span style="color:#60add5">Security</span><span style="color:#666">.</span>get_account_right(<span style="color:#4070a0">'&lt;user&gt;'</span>)<span style="color:#666">.</span>include?(<span style="color:#4070a0">'SeAssignPrimaryTokenPrivilege'</span>)
</code></pre></div>
<p>The following example shows how to run <code>mkdir test_dir</code> from a Chef Infra Client run as an alternate user.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># Passing only username and password</span>
script <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 interpreter <span style="color:#4070a0">"bash"</span>
 code  <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 user <span style="color:#4070a0">"username"</span>
 password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Passing username and domain</span>
script <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 interpreter <span style="color:#4070a0">"bash"</span>
 code  <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 domain <span style="color:#4070a0">"domain-name"</span>
 user <span style="color:#4070a0">"username"</span>
 password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Passing username = 'domain-name\\username'. No domain is passed</span>
script <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 interpreter <span style="color:#4070a0">"bash"</span>
 code  <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 user <span style="color:#4070a0">"domain-name</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">username"</span>
 password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Passing username = 'username@domain-name'. No domain is passed</span>
script <span style="color:#4070a0">'mkdir test_dir'</span> <span style="color:#007020;font-weight:700">do</span>
 interpreter <span style="color:#4070a0">"bash"</span>
 code  <span style="color:#4070a0">"mkdir test_dir"</span>
 cwd <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:file_cache_path</span><span style="color:#666">]</span>
 user <span style="color:#4070a0">"username@domain-name"</span>
 password <span style="color:#4070a0">"password"</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="service-resource">service resource</h2> <a href="service/index.html">service resource page</a> <hr> <p>Use the <strong>service</strong> resource to manage a service.</p> <h3 id="syntax-service">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>service</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  init_command         <span style="color:#007020">String</span>
  options              <span style="color:#007020">Array</span>, <span style="color:#007020">String</span>
  parameters           <span style="color:#60add5">Hash</span>
  pattern              <span style="color:#007020">String</span>
  priority             <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span>, <span style="color:#60add5">Hash</span>
  reload_command       <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  restart_command      <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  run_levels           <span style="color:#007020">Array</span>
  service_name         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  start_command        <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  status_command       <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  stop_command         <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  supports             <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {"restart"=&gt;nil, "reload"=&gt;nil, "status"=&gt;nil}</span>
  timeout              <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 900</span>
  user                 <span style="color:#007020">String</span>
  action               <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :nothing if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>service</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>init_command</code>, <code>options</code>, <code>parameters</code>, <code>pattern</code>, <code>priority</code>, <code>reload_command</code>, <code>restart_command</code>, <code>run_levels</code>, <code>service_name</code>, <code>start_command</code>, <code>status_command</code>, <code>stop_command</code>, <code>supports</code>, <code>timeout</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h3 id="actions-service">Actions</h3> <hr> <p>The <strong>service</strong> resource has the following actions:</p> <dl> <dt><code>:disable</code></dt> <dd>Disable a service. This action is equivalent to a <code>Disabled</code> startup type on the Microsoft Windows platform. This action is not supported when using System Resource Controller (SRC) on the AIX platform because System Resource Controller (SRC) does not have a standard mechanism for enabling and disabling services on system boot.</dd> <dt><code>:enable</code></dt> <dd>Enable a service at boot. This action is equivalent to an <code>Automatic</code> startup type on the Microsoft Windows platform. This action is not supported when using System Resource Controller (SRC) on the AIX platform because System Resource Controller (SRC) does not have a standard mechanism for enabling and disabling services on system boot.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:reload</code></dt> <dd>Reload the configuration for this service.</dd> <dt><code>:restart</code></dt> <dd>Restart a service.</dd> <dt><code>:start</code></dt> <dd>Start a service, and keep it running until stopped or disabled.</dd> <dt><code>:stop</code></dt> <dd>Stop a service.</dd> </dl> <h3 id="properties-service">Properties</h3> <hr> <p>The <strong>service</strong> resource has the following properties:</p> <dl> <dt> <code>init_command</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to the init script that is associated with the service. Use <code>init_command</code> to prevent the need to specify overrides for the <code>start_command</code>, <code>stop_command</code>, and <code>restart_command</code> properties. When this property is not specified, Chef Infra Client will use the default init command for the service provider being used.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> Array, String <p>Solaris platform only. Options to pass to the service command. See the <code>svcadm</code> manual for details of possible options.</p> </dd> </dl> <dl> <dt> <code>parameters</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>Upstart only: A hash of parameters to pass to the service command for use in the service definition.</p> </dd> </dl> <dl> <dt> <code>pattern</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The value provided to 'service_name' or the resource block's name</code> <p>The pattern to look for in the process table.</p> </dd> </dl> <dl> <dt> <code>priority</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String, Hash <p>Debian platform only. The relative priority of the program for start and shutdown ordering. May be an integer or a Hash. An integer is used to define the start run levels; stop run levels are then 100-integer. A Hash is used to define values for specific run levels. For example, <code>{ 2 =&gt; [:start, 20], 3 =&gt; [:stop, 55] }</code> will set a priority of twenty for run level two and a priority of fifty-five for run level three.</p> </dd> </dl> <dl> <dt> <code>reload_command</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>The command used to tell a service to reload its configuration.</p> </dd> </dl> <dl> <dt> <code>restart_command</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>The command used to restart a service.</p> </dd> </dl> <dl> <dt> <code>run_levels</code> </dt> <dd> <strong>Ruby Type:</strong> Array <p>RHEL platforms only: Specific run_levels the service will run under.</p> </dd> </dl> <dl> <dt> <code>service_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the service name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>start_command</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>The command used to start a service.</p> </dd> </dl> <dl> <dt> <code>status_command</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>The command used to check the run status for a service.</p> </dd> </dl> <dl> <dt> <code>stop_command</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>The command used to stop a service.</p> </dd> </dl> <dl> <dt> <code>supports</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{"restart" =&gt; nil, "reload" =&gt; nil, "status" =&gt; nil}</code> <p>A list of properties that controls how Chef Infra Client is to attempt to manage a service: <code>:restart</code>, <code>:reload</code>, <code>:status</code>. For <code>:restart</code>, the init script or other service provider can use a restart command; if <code>:restart</code> is not specified, Chef Infra Client attempts to stop and then start a service. For <code>:reload</code>, the init script or other service provider can use a reload command. For <code>:status</code>, the init script or other service provider can use a status command to determine if the service is running; if <code>:status</code> is not specified, Chef Infra Client attempts to match the <code>service_name</code> against the process table as a regular expression, unless a pattern is specified as a parameter property. Default value: <code>{ restart: false, reload: false, status: false }</code> for all platforms (except for the Red Hat platform family, which defaults to <code>{ restart: false, reload: false, status: true }</code>.)</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>900</code> <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>systemd only: A username to run the service under.</p> <p> New in Chef Client 12.21 </p> </dd> </dl> <br> <h3 id="functionality-service">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-service">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-service">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-service">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-service">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>service</strong> resource in recipes:</p> <p>Start a service</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'example_service'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:start</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Start a service, enable it</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'example_service'</span> <span style="color:#007020;font-weight:700">do</span>
  supports <span style="color:#517918">status</span>: <span style="color:#007020">true</span>, <span style="color:#517918">restart</span>: <span style="color:#007020">true</span>, <span style="color:#517918">reload</span>: <span style="color:#007020">true</span>
  action <span style="color:#666">[</span> <span style="color:#517918">:enable</span>, <span style="color:#517918">:start</span> <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use a pattern</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'samba'</span> <span style="color:#007020;font-weight:700">do</span>
  pattern <span style="color:#4070a0">'smbd'</span>
  action <span style="color:#666">[</span><span style="color:#517918">:enable</span>, <span style="color:#517918">:start</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use the :nothing common action</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'memcached'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use the retries common attribute</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'apache'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#666">[</span> <span style="color:#517918">:enable</span>, <span style="color:#517918">:start</span> <span style="color:#666">]</span>
  retries <span style="color:#40a070">3</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Manage a service, depending on the node platform</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'example_service'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#007020;font-weight:700">if</span> redhat?
    service_name <span style="color:#4070a0">'redhat_name'</span>
  <span style="color:#007020;font-weight:700">else</span>
    service_name <span style="color:#4070a0">'other_name'</span>
  <span style="color:#007020;font-weight:700">end</span>
  supports <span style="color:#517918">restart</span>: <span style="color:#007020">true</span>
  action <span style="color:#666">[</span> <span style="color:#517918">:enable</span>, <span style="color:#517918">:start</span> <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Reload a service using a template</p> <p>To reload a service that is based on a template, use the <strong>template</strong> and <strong>service</strong> resources together in the same recipe, similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'apache'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:enable</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'template[/tmp/somefile]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the <code>subscribes</code> notification is used to reload the service whenever the template is modified.</p> <p>Enable a service after a restart or reload</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'apache'</span> <span style="color:#007020;font-weight:700">do</span>
  supports <span style="color:#517918">restart</span>: <span style="color:#007020">true</span>, <span style="color:#517918">reload</span>: <span style="color:#007020">true</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Set an IP address using variables and a template</p> <p>The following example shows how the <strong>template</strong> resource can be used in a recipe to combine settings stored in an attributes file, variables within a recipe, and a template to set the IP addresses that are used by the Nginx service. The attributes file contains the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'dir'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'/etc/nginx'</span>
</code></pre></div>
<p>The recipe then does the following to:</p> <ul> <li>Declare two variables at the beginning of the recipe, one for the remote IP address and the other for the authorized IP address</li> <li>Use the <strong>service</strong> resource to restart and reload the Nginx service</li> <li>Load a template named <code>authorized_ip.erb</code> from the <code>/templates</code> directory that is used to set the IP address values based on the variables specified in the recipe</li> </ul> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>default<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'remote_ip_var'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'remote_addr'</span>
node<span style="color:#666">.</span>default<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'authorized_ips'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#666">[</span><span style="color:#4070a0">'127.0.0.1/32'</span><span style="color:#666">]</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  supports <span style="color:#517918">:status</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>, <span style="color:#517918">:restart</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>, <span style="color:#517918">:reload</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>

template <span style="color:#4070a0">'authorized_ip'</span> <span style="color:#007020;font-weight:700">do</span>
  path <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/authorized_ip"</span>
  source <span style="color:#4070a0">'modules/authorized_ip.erb'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  variables(
    <span style="color:#517918">:remote_ip_var</span> <span style="color:#666">=&gt;</span> node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'remote_ip_var'</span><span style="color:#666">]</span>,
    <span style="color:#517918">:authorized_ips</span> <span style="color:#666">=&gt;</span> node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'authorized_ips'</span><span style="color:#666">]</span>
  )

  notifies <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'service[nginx]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the <code>variables</code> property tells the template to use the variables set at the beginning of the recipe and the <code>source</code> property is used to call a template file located in the cookbook’s <code>/templates</code> directory. The template file looks similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">geo $&lt;<span style="color:#4070a0">%= @remote_ip_var %&gt; $authorized_ip {
</span><span style="color:#4070a0">  default no;
</span><span style="color:#4070a0">  &lt;% @authorized_ips.each do |ip| %&gt;
</span><span style="color:#4070a0">  &lt;%=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>ip<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0"> yes;"</span> <span style="color:#4070a0">%&gt;
</span><span style="color:#4070a0">  &lt;% end %&gt;</span>
}
</code></pre></div>
<p>Use a cron timer to manage a service</p> <p>The following example shows how to install the crond application using two resources and a variable:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># the following code sample comes from the ``cron`` cookbook:</span>
<span style="color:#60a0b0;font-style:italic"># https://github.com/chef-cookbooks/cron</span>

cron_package <span style="color:#666">=</span> <span style="color:#007020;font-weight:700">case</span> node<span style="color:#666">[</span><span style="color:#4070a0">'platform'</span><span style="color:#666">]</span>
  <span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'redhat'</span>, <span style="color:#4070a0">'centos'</span>, <span style="color:#4070a0">'scientific'</span>, <span style="color:#4070a0">'fedora'</span>, <span style="color:#4070a0">'amazon'</span>
    node<span style="color:#666">[</span><span style="color:#4070a0">'platform_version'</span><span style="color:#666">].</span>to_f <span style="color:#666">&gt;=</span> <span style="color:#40a070">6</span><span style="color:#666">.</span><span style="color:#40a070">0</span> <span style="color:#666">?</span> <span style="color:#4070a0">'cronie'</span> : <span style="color:#4070a0">'vixie-cron'</span>
  <span style="color:#007020;font-weight:700">else</span>
    <span style="color:#4070a0">'cron'</span>
  <span style="color:#007020;font-weight:700">end</span>

package cron_package <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'crond'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#007020;font-weight:700">case</span> node<span style="color:#666">[</span><span style="color:#4070a0">'platform'</span><span style="color:#666">]</span>
  <span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'redhat'</span>, <span style="color:#4070a0">'centos'</span>, <span style="color:#4070a0">'scientific'</span>, <span style="color:#4070a0">'fedora'</span>, <span style="color:#4070a0">'amazon'</span>
    service_name <span style="color:#4070a0">'crond'</span>
  <span style="color:#007020;font-weight:700">when</span> <span style="color:#4070a0">'debian'</span>, <span style="color:#4070a0">'ubuntu'</span>, <span style="color:#4070a0">'suse'</span>
    service_name <span style="color:#4070a0">'cron'</span>
  <span style="color:#007020;font-weight:700">end</span>
  action <span style="color:#666">[</span><span style="color:#517918">:start</span>, <span style="color:#517918">:enable</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where</p> <ul> <li>
<code>cron_package</code> is a variable that is used to identify which platforms apply to which install packages</li> <li>the <strong>package</strong> resource uses the <code>cron_package</code> variable to determine how to install the crond application on various nodes (with various platforms)</li> <li>the <strong>service</strong> resource enables the crond application on nodes that have Red Hat, CentOS, Red Hat Enterprise Linux, Fedora, or Amazon Web Services (AWS), and the cron service on nodes that run Debian, Ubuntu, or openSUSE</li> </ul> <p>Restart a service, and then notify a different service</p> <p>The following example shows how start a service named <code>example_service</code> and immediately notify the Nginx service to restart.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'example_service'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:start</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[nginx]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Restart one service before restarting another</p> <p>This example uses the <code>:before</code> notification to restart the <code>php-fpm</code> service before restarting <code>nginx</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:restart</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[php-fpm]'</span>, <span style="color:#517918">:before</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>With the <code>:before</code> notification, the action specified for the <code>nginx</code> resource will not run until action has been taken on the notified resource (<code>php-fpm</code>).</p> <p>Stop a service, do stuff, and then restart it</p> <p>The following example shows how to use the <strong>execute</strong>, <strong>service</strong>, and <strong>mount</strong> resources together to ensure that a node running on Amazon EC2 is running MySQL. This example does the following:</p> <ul> <li>Checks to see if the Amazon EC2 node has MySQL</li> <li>If the node has MySQL, stops MySQL</li> <li>Installs MySQL</li> <li>Mounts the node</li> <li>Restarts MySQL</li> </ul> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># the following code sample comes from the ``server_ec2``</span>
<span style="color:#60a0b0;font-style:italic"># recipe in the following cookbook:</span>
<span style="color:#60a0b0;font-style:italic"># https://github.com/chef-cookbooks/mysql</span>

<span style="color:#007020;font-weight:700">if</span> (node<span style="color:#666">.</span>attribute?(<span style="color:#4070a0">'ec2'</span>) <span style="color:#666">&amp;&amp;</span> <span style="color:#666">!</span> <span style="color:#60add5">FileTest</span><span style="color:#666">.</span>directory?(node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span>))

  service <span style="color:#4070a0">'mysql'</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:stop</span>
  <span style="color:#007020;font-weight:700">end</span>

  execute <span style="color:#4070a0">'install-mysql'</span> <span style="color:#007020;font-weight:700">do</span>
    command <span style="color:#4070a0">"mv </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'data_dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
    not_if <span style="color:#007020;font-weight:700">do</span> <span style="color:#60add5">FileTest</span><span style="color:#666">.</span>directory?(node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span>) <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>

  <span style="color:#666">[</span>node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span>, node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'data_dir'</span><span style="color:#666">]].</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>dir<span style="color:#666">|</span>
    directory dir <span style="color:#007020;font-weight:700">do</span>
      owner <span style="color:#4070a0">'mysql'</span>
      group <span style="color:#4070a0">'mysql'</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>

  mount node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'data_dir'</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:700">do</span>
    device node<span style="color:#666">[</span><span style="color:#4070a0">'mysql'</span><span style="color:#666">][</span><span style="color:#4070a0">'ec2_path'</span><span style="color:#666">]</span>
    fstype <span style="color:#4070a0">'none'</span>
    options <span style="color:#4070a0">'bind,rw'</span>
    action <span style="color:#666">[</span><span style="color:#517918">:mount</span>, <span style="color:#517918">:enable</span><span style="color:#666">]</span>
  <span style="color:#007020;font-weight:700">end</span>

  service <span style="color:#4070a0">'mysql'</span> <span style="color:#007020;font-weight:700">do</span>
    action <span style="color:#517918">:start</span>
  <span style="color:#007020;font-weight:700">end</span>

<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where</p> <ul> <li>the two <strong>service</strong> resources are used to stop, and then restart the MySQL service</li> <li>the <strong>execute</strong> resource is used to install MySQL</li> <li>the <strong>mount</strong> resource is used to mount the node and enable MySQL</li> </ul> <p>Control a service using the execute resource</p> <div class="admonition-warning">
<p class="admonition-warning-title">Warning</p>
<div class="admonition-warning-text"> <p>This is an example of something that should NOT be done. Use the <strong>service</strong> resource to control a service, not the <strong>execute</strong> resource.</p> </div>
</div> <p>Do something like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'tomcat'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:start</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and NOT something like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'start-tomcat'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'/etc/init.d/tomcat6 start'</span>
  action <span style="color:#517918">:run</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>There is no reason to use the <strong>execute</strong> resource to control a service because the <strong>service</strong> resource exposes the <code>start_command</code> property directly, which gives a recipe full control over the command issued in a much cleaner, more direct manner.</p> <p>Enable a service on AIX using the mkitab command</p> <p>The <strong>service</strong> resource does not support using the <code>:enable</code> and <code>:disable</code> actions with resources that are managed using System Resource Controller (SRC). This is because System Resource Controller (SRC) does not have a standard mechanism for enabling and disabling services on system boot.</p> <p>One approach for enabling or disabling services that are managed by System Resource Controller (SRC) is to use the <strong>execute</strong> resource to invoke <code>mkitab</code>, and then use that command to enable or disable the service.</p> <p>The following example shows how to install a service:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">"install </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0"> in SRC"</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">"mkssys -s </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">                  -p </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'bin'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">                  -u root
</span><span style="color:#4070a0">                  -S
</span><span style="color:#4070a0">                  -n 15
</span><span style="color:#4070a0">                  -f 9
</span><span style="color:#4070a0">                  -o </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'log_dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/client.log
</span><span style="color:#4070a0">                  -e </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'log_dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/client.log -a '
</span><span style="color:#4070a0">                  -i </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'interval'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">                  -s </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'splay'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">'"</span>
  not_if <span style="color:#4070a0">"lssrc -s </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
  action <span style="color:#517918">:run</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then enable it using the <code>mkitab</code> command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">"enable </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">"mkitab '</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">:2:once:/usr/bin/startsrc
</span><span style="color:#4070a0">                  -s </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0"> &gt; /dev/console 2&gt;&amp;1'"</span>
  not_if <span style="color:#4070a0">"lsitab </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="smartos-package-resource">smartos_package resource</h2> <a href="smartos_package/index.html">smartos_package resource page</a> <hr> <p>Use the <strong>smartos_package</strong> resource to manage packages for the SmartOS platform.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <h3 id="syntax-smartos-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>smartos_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">smartos_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  options           <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name      <span style="color:#007020">String</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version           <span style="color:#007020">String</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>smartos_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-smartos-package">Actions</h3> <hr> <p>The <strong>smartos_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-smartos-package">Properties</h3> <hr> <p>The <strong>smartos_package</strong> resource has the following properties:</p> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-smartos-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-smartos-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-smartos-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-smartos-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-smartos-package">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="snap-package-resource">snap_package resource</h2> <a href="snap_package/index.html">snap_package resource page</a> <hr> <p>Use the <strong>snap_package</strong> resource to manage snap packages on Debian and Ubuntu platforms.</p> <p><strong>New in Chef Infra Client 15.0.</strong></p> <h3 id="syntax-snap-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>snap_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">snap_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  channel           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "stable"</span>
  options           <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name      <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version           <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>snap_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>channel</code>, <code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-snap-package">Actions</h3> <hr> <p>The <strong>snap_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:lock</code></dt> <dd>Locks the apt package to a specific version.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:reconfig</code></dt> <dd>Reconfigure a package. This action requires a response file.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:unlock</code></dt> <dd>Unlocks the apt package so that it can be upgraded to a newer version.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-snap-package">Properties</h3> <hr> <p>The <strong>snap_package</strong> resource has the following properties:</p> <dl> <dt> <code>channel</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>stable</code> <strong>Allowed Values:</strong> <code>"beta", "candidate", "edge", "stable"</code> <p>The default channel. For example: stable.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <h4 id="multiple-packages-properties-snap-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <br> <h3 id="functionality-snap-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-snap-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-snap-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-snap-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h4 id="multiple-packages-common-snap-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <h3 id="examples-snap-package">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="solaris-package-resource">solaris_package resource</h2> <a href="solaris_package/index.html">solaris_package resource page</a> <hr> <p>Use the <strong>solaris_package</strong> resource to manage packages on the Solaris platform.</p> <h3 id="syntax-solaris-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>solaris_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">solaris_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  options           <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name      <span style="color:#007020">String</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version           <span style="color:#007020">String</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>solaris_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-solaris-package">Actions</h3> <hr> <p>The <strong>solaris_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> </dl> <h3 id="properties-solaris-package">Properties</h3> <hr> <p>The <strong>solaris_package</strong> resource has the following properties:</p> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-solaris-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-solaris-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-solaris-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-solaris-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-solaris-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>solaris_package</strong> resource in recipes:</p> <p>Install a package</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">solaris_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'/packages_directory'</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="ssh-known-hosts-entry-resource">ssh_known_hosts_entry resource</h2> <a href="ssh_known_hosts_entry/index.html">ssh_known_hosts_entry resource page</a> <hr> <p>Use the <strong>ssh_known_hosts_entry</strong> resource to add an entry for the specified host in /etc/ssh/ssh_known_hosts or a user’s known hosts file if specified.</p> <p><strong>New in Chef Infra Client 14.3.</strong></p> <h3 id="syntax-ssh-known-hosts-entry">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>ssh_known_hosts_entry</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ssh_known_hosts_entry <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  file_location      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/etc/ssh/ssh_known_hosts"</span>
  group              <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: The root user's group depending on platform.</span>
  hash_entries       <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  host               <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  key                <span style="color:#007020">String</span>
  key_type           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "rsa"</span>
  mode               <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "0644"</span>
  owner              <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: "root"</span>
  port               <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 22</span>
  timeout            <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 30</span>
  action             <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>ssh_known_hosts_entry</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>file_location</code>, <code>group</code>, <code>hash_entries</code>, <code>host</code>, <code>key</code>, <code>key_type</code>, <code>mode</code>, <code>owner</code>, <code>port</code>, and <code>timeout</code> are the properties available to this resource.</li> </ul> <h3 id="actions-ssh-known-hosts-entry">Actions</h3> <hr> <p>The <strong>ssh_known_hosts_entry</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create an entry in the ssh_known_hosts file. (default)</dd> <dt><code>:flush</code></dt> <dd>Immediately flush the entries to the config file. Without this the actual writing of the file is delayed in the Chef Infra Client run so all entries can be accumulated before writing the file out.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-ssh-known-hosts-entry">Properties</h3> <hr> <p>The <strong>ssh_known_hosts_entry</strong> resource has the following properties:</p> <dl> <dt> <code>file_location</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/etc/ssh/ssh_known_hosts</code> <p>The location of the ssh known hosts file. Change this to set a known host file for a particular user.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>The root user's group depending on platform.</code> <p>The file group for the ssh_known_hosts file.</p> </dd> </dl> <dl> <dt> <code>hash_entries</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Hash the hostname and addresses in the ssh_known_hosts file for privacy.</p> </dd> </dl> <dl> <dt> <code>host</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The host to add to the known hosts file.</p> </dd> </dl> <dl> <dt> <code>key</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional key for the host. If not provided this will be automatically determined.</p> </dd> </dl> <dl> <dt> <code>key_type</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>rsa</code> <p>The type of key to store.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>0644</code> <p>The file mode for the ssh_known_hosts file.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>root</code> <p>The file owner for the ssh_known_hosts file.</p> </dd> </dl> <dl> <dt> <code>port</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>22</code> <p>The server port that the ssh-keyscan command will use to gather the public key.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>30</code> <p>The timeout in seconds for ssh-keyscan.</p> </dd> </dl> <br> <h3 id="functionality-ssh-known-hosts-entry">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-ssh-known-hosts-entry">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-ssh-known-hosts-entry">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-ssh-known-hosts-entry">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-ssh-known-hosts-entry">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>ssh_known_hosts_entry</strong> resource in recipes:</p> <p><strong>Add a single entry for github.com with the key auto detected</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ssh_known_hosts_entry <span style="color:#4070a0">'github.com'</span>
</code></pre></div>
<p><strong>Add a single entry with your own provided key</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ssh_known_hosts_entry <span style="color:#4070a0">'github.com'</span> <span style="color:#007020;font-weight:700">do</span>
  key <span style="color:#4070a0">'node.example.com ssh-rsa ...'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="subversion-resource">subversion resource</h2> <a href="subversion/index.html">subversion resource page</a> <hr> <p>Use the <strong>subversion</strong> resource to manage source control resources that exist in a Subversion repository.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>The subversion resource has known bugs and may not work as expected. For more information see Chef GitHub issues, particularly <a href="https://github.com/chef/chef/issues/4050">#4050</a> and <a href="https://github.com/chef/chef/issues/4257">#4257</a>.</p> </div> </div> <h3 id="syntax-subversion">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>subversion</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subversion <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  destination        <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  environment        <span style="color:#60add5">Hash</span>
  group              <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  repository         <span style="color:#007020">String</span>
  revision           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "HEAD"</span>
  svn_arguments      <span style="color:#007020">String</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: "--no-auth-cache"</span>
  svn_binary         <span style="color:#007020">String</span>
  svn_info_args      <span style="color:#007020">String</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: "--no-auth-cache"</span>
  svn_password       <span style="color:#007020">String</span>
  svn_username       <span style="color:#007020">String</span>
  timeout            <span style="color:#007020">Integer</span>
  user               <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action             <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :sync if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>subversion</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>destination</code>, <code>environment</code>, <code>group</code>, <code>repository</code>, <code>revision</code>, <code>svn_arguments</code>, <code>svn_binary</code>, <code>svn_info_args</code>, <code>svn_password</code>, <code>svn_username</code>, <code>timeout</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h3 id="actions-subversion">Actions</h3> <hr> <p>The <strong>subversion</strong> resource has the following actions:</p> <dl> <dt><code>:checkout</code></dt> <dd>Clone or check out the source. When a checkout is available, this provider does nothing.</dd> <dt><code>:export</code></dt> <dd>Export the source, excluding or removing any version control artifacts.</dd> <dt><code>:force_export</code></dt> <dd>Export the source, excluding or removing any version control artifacts and force an export of the source that is overwriting the existing copy (if it exists).</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:sync</code></dt> <dd>Update the source to the specified version, or get a new clone or checkout. This action causes a hard reset of the index and working tree, discarding any uncommitted changes. (default)</dd> </dl> <h3 id="properties-subversion">Properties</h3> <hr> <p>The <strong>subversion</strong> resource has the following properties:</p> <dl> <dt> <code>destination</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The location path to which the source is to be cloned, checked out, or exported. Default value: the name of the resource block.</p> </dd> </dl> <dl> <dt> <code>environment</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of environment variables in the form of ({‘ENV_VARIABLE’ =&gt; ‘VALUE’}).</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The system group that will own the checked-out code.</p> </dd> </dl> <dl> <dt> <code>repository</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The URI of the code repository.</p> </dd> </dl> <dl> <dt> <code>revision</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>HEAD</code> <p>A branch, tag, or commit to be synchronized with git. This can be symbolic, like <code>HEAD</code> or it can be a source control management-specific revision identifier.</p> </dd> </dl> <dl> <dt> <code>svn_arguments</code> </dt> <dd> <strong>Ruby Type:</strong> String, false | <strong>Default Value:</strong> <code>--no-auth-cache</code> <p>The extra arguments that are passed to the Subversion command.</p> </dd> </dl> <dl> <dt> <code>svn_binary</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The location of the svn binary.</p> </dd> </dl> <dl> <dt> <code>svn_info_args</code> </dt> <dd> <strong>Ruby Type:</strong> String, false | <strong>Default Value:</strong> <code>--no-auth-cache</code> <p>Use when the <code>svn info</code> command is used by Chef Infra Client and arguments need to be passed. The <code>svn_arguments</code> command does not work when the <code>svn info</code> command is used.</p> </dd> </dl> <dl> <dt> <code>svn_password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The password for a user that has access to the Subversion repository.</p> </dd> </dl> <dl> <dt> <code>svn_username</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The user name for a user that has access to the Subversion repository.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>`HOME` environment variable of the user running chef-client</code> <p>The system user that will own the checked-out code.</p> </dd> </dl> <br> <h3 id="functionality-subversion">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-subversion">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-subversion">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-subversion">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-subversion">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>subversion</strong> resource in recipes:</p> <p><strong>Get the latest version of an application</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subversion <span style="color:#4070a0">'CouchDB Edge'</span> <span style="color:#007020;font-weight:700">do</span>
  repository <span style="color:#4070a0">'http://svn.apache.org/repos/asf/couchdb/trunk'</span>
  revision <span style="color:#4070a0">'HEAD'</span>
  destination <span style="color:#4070a0">'/opt/my_sources/couch'</span>
  action <span style="color:#517918">:sync</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="sudo-resource">sudo resource</h2> <a href="sudo/index.html">sudo resource page</a> <hr> <p>Use the <strong>sudo</strong> resource to add or remove individual sudo entries using sudoers.d files. Sudo version 1.7.2 or newer is required to use the sudo resource, as it relies on the <code>#includedir</code> directive introduced in version 1.7.2. This resource does not enforce installation of the required sudo version. Chef-supported releases of Ubuntu, SuSE, Debian, and RHEL (6+) all support this feature.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-sudo">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>sudo</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">sudo <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  command_aliases        <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  commands               <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: ["ALL"]</span>
  config_prefix          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "Prefix values based on the node's platform"</span>
  defaults               <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  env_keep_add           <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  env_keep_subtract      <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  filename               <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  groups                 <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  host                   <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "ALL"</span>
  noexec                 <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  nopasswd               <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  runas                  <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "ALL"</span>
  setenv                 <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  template               <span style="color:#007020">String</span>
  users                  <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  variables              <span style="color:#60add5">Hash</span>
  visudo_binary          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/usr/sbin/visudo"</span>
  action                 <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>sudo</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>command_aliases</code>, <code>commands</code>, <code>config_prefix</code>, <code>defaults</code>, <code>env_keep_add</code>, <code>env_keep_subtract</code>, <code>filename</code>, <code>groups</code>, <code>host</code>, <code>noexec</code>, <code>nopasswd</code>, <code>runas</code>, <code>setenv</code>, <code>template</code>, <code>users</code>, <code>variables</code>, and <code>visudo_binary</code> are the properties available to this resource.</li> </ul> <h3 id="actions-sudo">Actions</h3> <hr> <p>The <strong>sudo</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create a single sudoers configuration file in the <code>sudoers.d</code> directory. (default)</dd> <dt><code>:delete</code></dt> <dd>Remove a sudoers configuration file from the <code>sudoers.d</code> directory.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-sudo">Properties</h3> <hr> <p>The <strong>sudo</strong> resource has the following properties:</p> <dl> <dt> <code>command_aliases</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>Command aliases that can be used as allowed commands later in the configuration.</p> </dd> </dl> <dl> <dt> <code>commands</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>["ALL"]</code> <p>An array of full paths to commands this sudoer can execute.</p> </dd> </dl> <dl> <dt> <code>config_prefix</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>Prefix values based on the node's platform</code> <p>The directory that contains the sudoers configuration file.</p> </dd> </dl> <dl> <dt> <code>defaults</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of defaults for the user/group.</p> </dd> </dl> <dl> <dt> <code>env_keep_add</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of strings to add to <code>env_keep</code>.</p> </dd> </dl> <dl> <dt> <code>env_keep_subtract</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of strings to remove from <code>env_keep</code>.</p> </dd> </dl> <dl> <dt> <code>filename</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the sudoers.d file if it differs from the name of the resource block</p> </dd> </dl> <dl> <dt> <code>groups</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>[]</code> <p>Group(s) to provide sudo privileges to. This property accepts either an array or a comma separated list. Leading % on group names is optional.</p> </dd> </dl> <dl> <dt> <code>host</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>ALL</code> <p>The host to set in the sudo configuration.</p> </dd> </dl> <dl> <dt> <code>noexec</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Prevent commands from shelling out.</p> </dd> </dl> <dl> <dt> <code>nopasswd</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Allow sudo to be run without specifying a password.</p> </dd> </dl> <dl> <dt> <code>runas</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>ALL</code> <p>User that the command(s) can be run as.</p> </dd> </dl> <dl> <dt> <code>setenv</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Determines whether or not to permit preservation of the environment with <code>sudo -E</code>.</p> </dd> </dl> <dl> <dt> <code>template</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of the erb template in your cookbook, if you wish to supply your own template.</p> </dd> </dl> <dl> <dt> <code>users</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>[]</code> <p>User(s) to provide sudo privileges to. This property accepts either an array or a comma separated list.</p> </dd> </dl> <dl> <dt> <code>variables</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>The variables to pass to the custom template. This property is ignored if not using a custom template.</p> </dd> </dl> <dl> <dt> <code>visudo_binary</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/usr/sbin/visudo</code> <p>The path to visudo for configuration verification.</p> </dd> </dl> <br> <h3 id="functionality-sudo">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-sudo">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-sudo">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-sudo">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-sudo">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>sudo</strong> resource in recipes:</p> <p><strong>Grant a user sudo privileges for any command</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">sudo <span style="color:#4070a0">'admin'</span> <span style="color:#007020;font-weight:700">do</span>
  user <span style="color:#4070a0">'admin'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Grant a user and groups sudo privileges for any command</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">sudo <span style="color:#4070a0">'admins'</span> <span style="color:#007020;font-weight:700">do</span>
  users <span style="color:#4070a0">'bob'</span>
  groups <span style="color:#4070a0">'sysadmins, superusers'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Grant passwordless sudo privileges for specific commands</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">sudo <span style="color:#4070a0">'passwordless-access'</span> <span style="color:#007020;font-weight:700">do</span>
  commands <span style="color:#666">[</span><span style="color:#4070a0">'/bin/systemctl restart httpd'</span>, <span style="color:#4070a0">'/bin/systemctl restart mysql'</span><span style="color:#666">]</span>
  nopasswd <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="swap-file-resource">swap_file resource</h2> <a href="swap_file/index.html">swap_file resource page</a> <hr> <p>Use the <strong>swap_file</strong> resource to create or delete swap files on Linux systems, and optionally to manage the swappiness configuration for a host.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-swap-file">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>swap_file</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">swap_file <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  path            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  persist         <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  size            <span style="color:#007020">Integer</span>
  swappiness      <span style="color:#007020">Integer</span>
  timeout         <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 600</span>
  action          <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>swap_file</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>path</code>, <code>persist</code>, <code>size</code>, <code>swappiness</code>, and <code>timeout</code> are the properties available to this resource.</li> </ul> <h3 id="actions-swap-file">Actions</h3> <hr> <p>The <strong>swap_file</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create a swapfile. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a swapfile and disable swap.</dd> </dl> <h3 id="properties-swap-file">Properties</h3> <hr> <p>The <strong>swap_file</strong> resource has the following properties:</p> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The path where the swap file will be created on the system if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>persist</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Persist the swapon.</p> </dd> </dl> <dl> <dt> <code>size</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The size (in MBs) of the swap file.</p> </dd> </dl> <dl> <dt> <code>swappiness</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>The swappiness value to set on the system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>600</code> <p>Timeout for <code>dd</code> / <code>fallocate</code> commands.</p> </dd> </dl> <br> <h3 id="functionality-swap-file">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-swap-file">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-swap-file">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-swap-file">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-swap-file">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>swap_file</strong> resource in recipes:</p> <p><strong>Create a swap file</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">swap_file <span style="color:#4070a0">'/dev/sda1'</span> <span style="color:#007020;font-weight:700">do</span>
  size <span style="color:#40a070">1024</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove a swap file</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">swap_file <span style="color:#4070a0">'/dev/sda1'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="sysctl-resource">sysctl resource</h2> <a href="sysctl/index.html">sysctl resource page</a> <hr> <p>Use the <strong>sysctl</strong> resource to set or remove kernel parameters using the <code>sysctl</code> command line tool and configuration files in the system’s <code>sysctl.d</code> directory. Configuration files managed by this resource are named <code>99-chef-KEYNAME.conf</code>.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-sysctl">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>sysctl</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">sysctl <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  comment           <span style="color:#007020">Array</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  conf_dir          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/etc/sysctl.d"</span>
  ignore_error      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  key               <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  value             <span style="color:#007020">Array</span>, <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>, <span style="color:#007020">Float</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :apply if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>sysctl</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>comment</code>, <code>conf_dir</code>, <code>ignore_error</code>, <code>key</code>, and <code>value</code> are the properties available to this resource.</li> </ul> <h3 id="actions-sysctl">Actions</h3> <hr> <p>The <strong>sysctl</strong> resource has the following actions:</p> <dl> <dt><code>:apply</code></dt> <dd>Set the kernel parameter and update the <code>sysctl</code> settings. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove the kernel parameter and update the <code>sysctl</code> settings.</dd> </dl> <h3 id="properties-sysctl">Properties</h3> <hr> <p>The <strong>sysctl</strong> resource has the following properties:</p> <dl> <dt> <code>comment</code> </dt> <dd> <strong>Ruby Type:</strong> Array, String | <strong>Default Value:</strong> <code>[]</code> <p>Comments, placed above the resource setting in the generated file. For multi-line comments, use an array of strings, one per line.</p> <p> New in Chef Infra Client 15.8 </p> </dd> </dl> <dl> <dt> <code>conf_dir</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/etc/sysctl.d</code> <p>The configuration directory to write the config to.</p> </dd> </dl> <dl> <dt> <code>ignore_error</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Ignore any errors when setting the value on the command line.</p> </dd> </dl> <dl> <dt> <code>key</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The kernel parameter key in dotted format if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>value</code> </dt> <dd> <strong>Ruby Type:</strong> Array, String, Integer, Float | <code>REQUIRED</code> <p>The value to set.</p> </dd> </dl> <br> <h3 id="functionality-sysctl">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-sysctl">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-sysctl">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-sysctl">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-sysctl">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>sysctl</strong> resource in recipes:</p> <p><strong>Set vm.swappiness</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">sysctl <span style="color:#4070a0">'vm.swappiness'</span> <span style="color:#007020;font-weight:700">do</span>
  value <span style="color:#40a070">19</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove kernel.msgmax</strong>:</p> <p><strong>Note</strong>: This only removes the sysctl.d config for kernel.msgmax. The value will be set back to the kernel default value.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">sysctl <span style="color:#4070a0">'kernel.msgmax'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Adding Comments to sysctl configuration files</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">sysctl <span style="color:#4070a0">'vm.swappiness'</span> <span style="color:#007020;font-weight:700">do</span>
  value <span style="color:#40a070">19</span>
  comment <span style="color:#4070a0">"define how aggressively the kernel will swap memory pages."</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This produces /etc/sysctl.d/99-chef-vm.swappiness.conf as follows:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code># define how aggressively the kernel will swap memory pages.
vm.swappiness = 1
</code></pre>
<p><strong>Converting sysctl settings from shell scripts</strong>:</p> <p>Example of existing settings:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">fs.aio-max-nr <span style="color:#666">=</span> <span style="color:#40a070">1048576</span> net.ipv4.ip_local_port_range <span style="color:#666">=</span> <span style="color:#40a070">9000</span> <span style="color:#40a070">65500</span> kernel.sem <span style="color:#666">=</span> <span style="color:#40a070">250</span> <span style="color:#40a070">32000</span> <span style="color:#40a070">100</span> <span style="color:#40a070">128</span>
</code></pre></div>
<p>Converted to sysctl resources:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">sysctl <span style="color:#4070a0">'fs.aio-max-nr'</span> <span style="color:#007020;font-weight:700">do</span>
  value <span style="color:#4070a0">'1048576'</span>
<span style="color:#007020;font-weight:700">end</span>

sysctl <span style="color:#4070a0">'net.ipv4.ip_local_port_range'</span> <span style="color:#007020;font-weight:700">do</span>
  value <span style="color:#4070a0">'9000 65500'</span>
<span style="color:#007020;font-weight:700">end</span>

sysctl <span style="color:#4070a0">'kernel.sem'</span> <span style="color:#007020;font-weight:700">do</span>
  value <span style="color:#4070a0">'250 32000 100 128'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="systemd-unit-resource">systemd_unit resource</h2> <a href="systemd_unit/index.html">systemd_unit resource page</a> <hr> <p>Use the <strong>systemd_unit</strong> resource to create, manage, and run <a href="https://www.freedesktop.org/software/systemd/man/systemd.html#Concepts">systemd units</a>.</p> <p><strong>New in Chef Infra Client 12.11.</strong></p> <h3 id="syntax-systemd-unit">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>systemd_unit</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">systemd_unit <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  content              <span style="color:#007020">String</span>, <span style="color:#60add5">Hash</span>
  triggers_reload      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  unit_name            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  user                 <span style="color:#007020">String</span>
  verify               <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  action               <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :nothing if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>systemd_unit</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>content</code>, <code>triggers_reload</code>, <code>unit_name</code>, <code>user</code>, and <code>verify</code> are the properties available to this resource.</li> </ul> <h3 id="actions-systemd-unit">Actions</h3> <hr> <p>The <strong>systemd_unit</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create a systemd unit file, if it does not already exist.</dd> <dt><code>:delete</code></dt> <dd>Delete a systemd unit file, if it exists.</dd> <dt><code>:disable</code></dt> <dd>Ensure the unit will not be started after the next system boot.</dd> <dt><code>:enable</code></dt> <dd>Ensure the unit will be started after the next system boot.</dd> <dt><code>:mask</code></dt> <dd>Ensure the unit will not start, even to satisfy dependencies.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:preset</code></dt> <dd>Restore the preset ‘<code>enable</code>/<code>disable</code>’ configuration for a systemd unit. <em>New in Chef Infra Client 14.0.</em>
</dd> <dt><code>:reenable</code></dt> <dd>Reenable a unit file. <em>New in Chef Infra Client 14.0.</em>
</dd> <dt><code>:reload</code></dt> <dd>Reload the configuration file for a systemd unit.</dd> <dt><code>:reload_or_restart</code></dt> <dd>For systemd units that are services, this action reloads the configuration of the service without restarting, if possible; otherwise, it will restart the service so the new configuration is applied.</dd> <dt><code>:reload_or_try_restart</code></dt> <dd>For systemd units that are services, this action reloads the configuration of the service without restarting, if possible; otherwise, it will try to restart the service so the new configuration is applied.</dd> <dt><code>:restart</code></dt> <dd>Restart a systemd unit.</dd> <dt><code>:revert</code></dt> <dd>Revert to a vendor’s version of a systemd unit file. <em>New in Chef Infra Client 14.0.</em>
</dd> <dt><code>:start</code></dt> <dd>Start a systemd unit.</dd> <dt><code>:stop</code></dt> <dd>Stop a running systemd unit.</dd> <dt><code>:try_restart</code></dt> <dd>Try to restart a systemd unit if the unit is running.</dd> <dt><code>:unmask</code></dt> <dd>Stop the unit from being masked and cause it to start as specified.</dd> </dl> <h3 id="properties-systemd-unit">Properties</h3> <hr> <p>The <strong>systemd_unit</strong> resource has the following properties:</p> <dl> <dt> <code>content</code> </dt> <dd> <strong>Ruby Type:</strong> String, Hash <p>A string or hash that contains a systemd <a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">unit file</a> definition that describes the properties of systemd-managed entities, such as services, sockets, devices, and so on. In Chef Infra Client 14.4 or later, repeatable options can be implemented with an array.</p> </dd> </dl> <dl> <dt> <code>triggers_reload</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Specifies whether to trigger a daemon reload when creating or deleting a unit.</p> </dd> </dl> <dl> <dt> <code>unit_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the unit file if it differs from the resource block’s name.</p> <p> New in Chef Client 13.7 </p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The user account that the systemd unit process is run under. The path to the unit for that user would be something like ‘/etc/systemd/user/sshd.service’. If no user account is specified, the systemd unit will run under a ‘system’ account, with the path to the unit being something like ‘/etc/systemd/system/sshd.service’.</p> </dd> </dl> <dl> <dt> <code>verify</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Specifies if the unit will be verified before installation. Systemd can be overly strict when verifying units, so in certain cases it is preferable not to verify the unit.</p> </dd> </dl> <h3 id="unit-file-verification">Unit file verification</h3> <p>The unit file is verified via a <code>systemd-analyze verify</code> call before being written to disk.</p> <p>Be aware that the referenced commands and files need to already exist before verification.</p> <br> <h3 id="functionality-systemd-unit">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-systemd-unit">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-systemd-unit">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-systemd-unit">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-systemd-unit">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>systemd_unit</strong> resource in recipes:</p> <p><strong>Create systemd service unit file from a Hash</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">systemd_unit <span style="color:#4070a0">'etcd.service'</span> <span style="color:#007020;font-weight:700">do</span>
  content({ <span style="color:#517918">Unit</span>: {
            <span style="color:#517918">Description</span>: <span style="color:#4070a0">'Etcd'</span>,
            <span style="color:#517918">Documentation</span>: <span style="color:#666">[</span><span style="color:#4070a0">'https://coreos.com/etcd'</span>, <span style="color:#4070a0">'man:etcd(1)'</span><span style="color:#666">]</span>,
            <span style="color:#517918">After</span>: <span style="color:#4070a0">'network.target'</span>,
          },
          <span style="color:#517918">Service</span>: {
            <span style="color:#517918">Type</span>: <span style="color:#4070a0">'notify'</span>,
            <span style="color:#517918">ExecStart</span>: <span style="color:#4070a0">'/usr/local/etcd'</span>,
            <span style="color:#517918">Restart</span>: <span style="color:#4070a0">'always'</span>,
          },
          <span style="color:#517918">Install</span>: {
            <span style="color:#517918">WantedBy</span>: <span style="color:#4070a0">'multi-user.target'</span>,
          } })
  action <span style="color:#666">[</span><span style="color:#517918">:create</span>, <span style="color:#517918">:enable</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create systemd service unit file from a String</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">systemd_unit <span style="color:#4070a0">'sysstat-collect.timer'</span> <span style="color:#007020;font-weight:700">do</span>
  content <span style="color:#666">&lt;&lt;~</span><span style="color:#60add5">EOU</span>
  <span style="color:#666">[</span><span style="color:#60add5">Unit</span><span style="color:#666">]</span>
  <span style="color:#60add5">Description</span><span style="color:#666">=</span><span style="color:#60add5">Run</span> <span style="color:#007020">system</span> activity accounting tool every <span style="color:#40a070">10</span> minutes

  <span style="color:#666">[</span><span style="color:#60add5">Timer</span><span style="color:#666">]</span>
  <span style="color:#60add5">OnCalendar</span><span style="color:#666">=*</span>:<span style="color:#40a070">00</span><span style="color:#666">/</span><span style="color:#40a070">10</span>

  <span style="color:#666">[</span><span style="color:#60add5">Install</span><span style="color:#666">]</span>
  <span style="color:#60add5">WantedBy</span><span style="color:#666">=</span>sysstat<span style="color:#666">.</span>service
  <span style="color:#60add5">EOU</span>

  action <span style="color:#666">[</span><span style="color:#517918">:create</span>, <span style="color:#517918">:enable</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="template-resource">template resource</h2> <a href="template/index.html">template resource page</a> <hr> <p> A cookbook template is an Embedded Ruby (ERB) template that is used to dynamically generate static text files. Templates may contain Ruby expressions and statements, and are a great way to manage configuration files. Use the <strong>template</strong> resource to add cookbook templates to recipes; place the corresponding Embedded Ruby (ERB) template file in a cookbook’s <code>/templates</code> directory. </p> <p>Use the <strong>template</strong> resource to manage the contents of a file using an Embedded Ruby (ERB) template by transferring files from a sub-directory of <code>COOKBOOK_NAME/templates/</code> to a specified path located on a host that is running Chef Infra Client. This resource includes actions and properties from the <strong>file</strong> resource. Template files managed by the <strong>template</strong> resource follow the same file specificity rules as the <strong>remote_file</strong> and <strong>file</strong> resources.</p> <h3 id="syntax-template">Syntax</h3> <hr> 
<p>A <strong>template</strong> resource block typically declares the location in which a file is to be created, the source template that will be used to create the file, and the permissions needed on that file. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/motd'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'motd.erb'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>'/etc/motd'</code> specifies the location in which the file is created</li> <li>
<code>'motd.erb'</code> specifies the name of a template that exists in in the <code>/templates</code> folder of a cookbook</li> <li>
<code>owner</code>, <code>group</code>, and <code>mode</code> define the permissions</li> </ul> <p>The full syntax for all of the properties that are available to the <strong>template</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  atomic_update              <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  backup                     <span style="color:#007020">false</span>, <span style="color:#007020">Integer</span>
  cookbook                   <span style="color:#007020">String</span>
  force_unlink               <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  group                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  helper(<span style="color:#517918">:method</span>)            <span style="color:#60add5">Method</span> { <span style="color:#007020">String</span> } <span style="color:#60a0b0;font-style:italic"># see Helpers below</span>
  helpers(module)            <span style="color:#60add5">Module</span> <span style="color:#60a0b0;font-style:italic"># see Helpers below</span>
  inherits                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  local                      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  manage_symlink_source      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  mode                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  owner                      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  path                       <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># defaults to 'name' if not specified</span>
  rights                     <span style="color:#60add5">Hash</span>
  sensitive                  <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  source                     <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  variables                  <span style="color:#60add5">Hash</span>
  verify                     <span style="color:#007020">String</span>, <span style="color:#60add5">Block</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>template</code> is the resource</li> <li>
<code>name</code> is the name of the resource block, typically the path to the location in which a file is created <em>and also</em> the name of the file to be managed. For example: <code>/var/www/html/index.html</code>, where <code>/var/www/html/</code> is the fully qualified path to the location and <code>index.html</code> is the name of the file</li> <li>
<code>source</code> is the template file that will be used to create the file on the node, for example: <code>index.html.erb</code>; the template file is located in the <code>/templates</code> directory of a cookbook</li> <li>
<code>action</code> identifies the steps Chef Infra Client will take to bring the node into the desired state</li> <li>
<code>atomic_update</code>, <code>backup</code>, <code>cookbook</code>, <code>force_unlink</code>, <code>group</code>, <code>helper</code>, <code>helpers</code>, <code>inherits</code>, <code>local</code>, <code>manage_symlink_source</code>, <code>mode</code>, <code>owner</code>, <code>path</code>, <code>rights</code>, <code>source</code>, <code>variables</code>, and <code>verify</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-template">Actions</h3> <hr> <p>The <strong>template</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Create a file. If a file already exists (but does not match), update that file to match.</dd> <dt><code>:create_if_missing</code></dt> <dd>Create a file only if the file does not exist. When the file exists, nothing happens.</dd> <dt><code>:delete</code></dt> <dd>Delete a file.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:touch</code></dt> <dd>Touch a file. This updates the access (atime) and file modification (mtime) times for a file. (This action may be used with this resource, but is typically only used with the <strong>file</strong> resource.)</dd> </dl> <h3 id="properties-template">Properties</h3> <hr> <p>The <strong>template</strong> resource has the following properties:</p> <dl> <dt> <code>atomic_update</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Perform atomic file updates on a per-resource basis. Set to <code>true</code> for atomic file updates. Set to <code>false</code> for non-atomic file updates. This setting overrides <code>file_atomic_update</code>, which is a global setting found in the client.rb file.</p> </dd> </dl> <dl> <dt> <code>backup</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, false | <strong>Default Value:</strong> <code>5</code> <p>The number of backups to be kept in <code>/var/chef/backup</code> (for UNIX- and Linux-based platforms) or <code>C:/chef/backup</code> (for the Microsoft Windows platform). Set to <code>false</code> to prevent backups from being kept.</p> </dd> </dl> <dl> <dt> <code>cookbook</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The cookbook in which a file is located (if it is not located in the current cookbook). The default value is the current cookbook.</p> </dd> </dl> <dl> <dt> <code>force_unlink</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>How Chef Infra Client handles certain situations when the target file turns out not to be a file. For example, when a target file is actually a symlink. Set to <code>true</code> for Chef Infra Client to delete the non-file target and replace it with the specified file. Set to <code>false</code> for Chef Infra Client to raise an error.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>A string or ID that identifies the group owner by group name or SID, including fully qualified group names such as <code>domain\group</code> or <code>group@domain</code>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <code>POSIX</code> group (if available).</p> </dd> </dl> <dl> <dt> <code>helper</code> </dt> <dd> <strong>Ruby Type:</strong> Method | <strong>Default Value:</strong> <code>{}</code> <p>Define a helper method inline. For example: <code>helper(:hello_world) { "hello world" }</code> or <code>helper(:app) { node["app"] }</code> or <code>helper(:app_conf) { |setting| node["app"][setting] }</code>.</p> </dd> </dl> <dl> <dt> <code>helpers</code> </dt> <dd> <strong>Ruby Type:</strong> Module | <strong>Default Value:</strong> <code>[]</code> <p>Define a helper module inline or in a library. For example, an inline module: <code>helpers do</code>, which is then followed by a block of Ruby code. And for a library module: <code>helpers(MyHelperModule)</code>.</p> </dd> </dl> <dl> <dt> <code>inherits</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Microsoft Windows only. Whether a file inherits rights from its parent directory.</p> </dd> </dl> <dl> <dt> <code>local</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Load a template from a local path. By default, Chef Infra Client loads templates from a cookbook’s <code>/templates</code> directory. When this property is set to <code>true</code>, use the <code>source</code> property to specify the path to a template on the local node.</p> </dd> </dl> <dl> <dt> <code>manage_symlink_source</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> 
<p>(with warning)</p> <p>Change the behavior of the file resource if it is pointed at a symlink. When this value is set to <code>true</code>, Chef Infra Client will manage the symlink’s permissions or will replace the symlink with a normal file if the resource has content. When this value is set to <code>false</code>, Chef will follow the symlink and will manage the permissions and content of the symlink’s target file.</p> <p>The default behavior is <code>true</code> but emits a warning that the default value will be changed to <code>false</code> in a future version; setting this explicitly to <code>true</code> or <code>false</code> suppresses this warning.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String 
<p>A quoted 3-5 character string that defines the octal mode. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If <code>mode</code> is not specified and if the file already exists, the existing mode on the file is used. If <code>mode</code> is not specified, the file does not exist, and the <code>:create</code> action is specified, Chef Infra Client assumes a mask value of <code>'0777'</code> and then applies the umask for the system on which the file is to be created to the <code>mask</code> value. For example, if the umask on a system is <code>'022'</code>, Chef Infra Client uses the default value of <code>'0755'</code>.</p> <p>The behavior is different depending on the platform.</p> <p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. If the value is specified as a quoted string, it works exactly as if the <code>chmod</code> command was passed. If the value is specified as an integer, prepend a zero (<code>0</code>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <code>'0777'</code> or <code>'777'</code>; for the same rights, plus the sticky bit, use <code>01777</code> or <code>'1777'</code>.</p> <p>Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <code>'755'</code>, <code>'0755'</code>, or <code>00755</code>. Values up to <code>'0777'</code> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <code>4</code> equals <code>GENERIC_READ</code>, <code>2</code> equals <code>GENERIC_WRITE</code>, and <code>1</code> equals <code>GENERIC_EXECUTE</code>. This property cannot be used to set <code>:full_control</code>. This property has no effect if not specified, but when it and <code>rights</code> are both specified, the effects are cumulative.</p> </dd> </dl> <dl> <dt> <code>owner</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>A string or ID that identifies the group owner by user name or SID, including fully qualified user names such as <code>domain\user</code> or <code>user@domain</code>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> 
<p>The full path to the file, including the file name and its extension.</p> <p>Microsoft Windows: A path that begins with a forward slash (<code>/</code>) will point to the root of the current working directory of Chef Infra Client process. This path can vary from system to system. Therefore, using a path that begins with a forward slash (<code>/</code>) is not recommended.</p> </dd> </dl> <dl> <dt> <code>rights</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String <p>Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <code>rights &lt;permissions&gt;, &lt;principal&gt;, &lt;options&gt;</code> where <code>&lt;permissions&gt;</code> specifies the rights granted to the principal, <code>&lt;principal&gt;</code> is the group or user name, and <code>&lt;options&gt;</code> is a Hash with one (or more) advanced rights options.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The location of a template file. By default, Chef Infra Client looks for a template file in the <code>/templates</code> directory of a cookbook. When the <code>local</code> property is set to <code>true</code>, use to specify the path to a template on the local node. This property may also be used to distribute specific files to specific platforms. See “File Specificity” below for more information. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <dl> <dt> <code>variables</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>A Hash of variables that are passed into a Ruby template file.</p> 
<p>The <code>variables</code> property of the <strong>template</strong> resource can be used to reference a partial template file by using a Hash. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/file/name.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  variables <span style="color:#517918">partials</span>: {
    <span style="color:#4070a0">'partial_name_1.txt.erb'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'message'</span>,
    <span style="color:#4070a0">'partial_name_2.txt.erb'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'message'</span>,
    <span style="color:#4070a0">'partial_name_3.txt.erb'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'message'</span>,
  }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where each of the partial template files can then be combined using normal Ruby template patterns within a template file, such as:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">&lt;</span><span style="color:#c65d09">% @partials.each </span> <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>partial, message<span style="color:#666">|</span> <span style="color:#4070a0">%&gt;
</span><span style="color:#4070a0">  Here is &lt;%= partial %&gt;</span>
  <span style="color:#666">&lt;</span><span style="color:#4070a0">%= render partial, :variables =</span><span style="color:#666">&gt;</span> {<span style="color:#517918">:message</span> <span style="color:#666">=&gt;</span> message} <span style="color:#4070a0">%&gt;
</span><span style="color:#4070a0">&lt;% end %&gt;</span>
</code></pre></div> </dd> </dl> <dl> <dt> <code>verify</code> </dt> <dd> <strong>Ruby Type:</strong> String, Block 
<p>A block or a string that returns <code>true</code> or <code>false</code>. A string, when <code>true</code> is executed as a system command.</p> <p>A block is arbitrary Ruby defined within the resource block by using the <code>verify</code> property. When a block is <code>true</code>, Chef Infra Client will continue to update the file as appropriate.</p> <p>For example, this should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/baz'</span> <span style="color:#007020;font-weight:700">do</span>
  verify { <span style="color:#40a070">1</span> <span style="color:#666">==</span> <span style="color:#40a070">1</span> }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/nginx.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  verify <span style="color:#4070a0">'nginx -t -c %{path}'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> 
<p>This should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/bar'</span> <span style="color:#007020;font-weight:700">do</span>
  verify { <span style="color:#40a070">1</span> <span style="color:#666">==</span> <span style="color:#40a070">1</span>}
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>And this should return <code>true</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/foo'</span> <span style="color:#007020;font-weight:700">do</span>
  verify <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>path<span style="color:#666">|</span>
    <span style="color:#007020">true</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Whereas, this should return <code>false</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/turtle'</span> <span style="color:#007020;font-weight:700">do</span>
  verify <span style="color:#4070a0">'/usr/bin/false'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>If a string or a block return <code>false</code>, the Chef Infra Client run will stop and an error is returned.</p> </dd> </dl> <h4 id="common-atomic-update-template">Atomic File Updates</h4> <p>Atomic updates are used with <strong>file</strong>-based resources to help ensure that file updates can be made when updating a binary or if disk space runs out.</p> <p>Atomic updates are enabled by default. They can be managed globally using the <code>file_atomic_update</code> setting in the client.rb file. They can be managed on a per-resource basis using the <code>atomic_update</code> property that is available with the <strong>cookbook_file</strong>, <strong>file</strong>, <strong>remote_file</strong>, and <strong>template</strong> resources.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>On certain platforms, and after a file has been moved into place, Chef Infra Client may modify file permissions to support features specific to those platforms. On platforms with SELinux enabled, Chef Infra Client will fix up the security contexts after a file has been moved into the correct location by running the <code>restorecon</code> command. On the Microsoft Windows platform, Chef Infra Client will create files so that ACL inheritance works as expected.</p> </div> </div> <h4 id="common-windows-security-template">Windows File Security</h4> To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes. <strong>Access Control Lists (ACLs)</strong> <p>The <code>rights</code> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <code>rights</code> property can be used as many times as necessary; Chef Infra Client will apply them to the file or directory as required. The syntax for the <code>rights</code> property is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights permission, principal, option_type <span style="color:#666">=&gt;</span> value
</code></pre></div>
<p>where</p> <dl> <dt><code>permission</code></dt> <dd> <p>Use to specify which rights are granted to the <code>principal</code>. The possible values are: <code>:read</code>, <code>:write</code>, <code>read_execute</code>, <code>:modify</code>, <code>:full_control</code>, or an integer.</p> </dd> <dd> <p>Integers used for permissions must match the following list <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.accesscontrol.filesystemrights?view=windowsdesktop-5.0#fields">FileSystemRights Enum</a> fields.</p> </dd> </dl> <pre class="highlight" data-language="ruby"><code>These permissions are cumulative. If `:write` is specified, then it
includes `:read`. If `:full_control` is specified, then it includes
both `:write` and `:read`.

(For those who know the Microsoft Windows API: `:read` corresponds
to `GENERIC_READ`; `:write` corresponds to `GENERIC_WRITE`;
`:read_execute` corresponds to `GENERIC_READ` and `GENERIC_EXECUTE`;
`:modify` corresponds to `GENERIC_WRITE`, `GENERIC_READ`,
`GENERIC_EXECUTE`, and `DELETE`; `:full_control` corresponds to
`GENERIC_ALL`, which allows a user to change the owner and other
metadata about a file.)
</code></pre> <dl> <dt><code>principal</code></dt> <dd> <p>Use to specify a group or user. The principal can be specified by either name or SID. When using name, this is identical to what is entered in the login box for Microsoft Windows, such as <code>user_name</code>, <code>domain\user_name</code>, or <code>user_name@fully_qualified_domain_name</code>. When using a SID, you may use either the standard string representation of a SID (S-R-I-S-S) or one of the <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/sid-strings">SDDL string constants</a>. Chef Infra Client does not need to know if a principal is a user or a group.</p> </dd> <dt><code>option_type</code></dt> <dd> <p>A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <code>rights :write, 'domain\group_name', :one_level_deep =&gt; true</code>. Possible option types:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Option Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>:applies_to_children</code></td> <td>Specify how permissions are applied to children. Possible values: <code>true</code> to inherit both child directories and files; <code>false</code> to not inherit any child directories or files; <code>:containers_only</code> to inherit only child directories (and not files); <code>:objects_only</code> to recursively inherit files (and not child directories).</td> </tr> <tr> <td><code>:applies_to_self</code></td> <td>Indicates whether a permission is applied to the parent directory. Possible values: <code>true</code> to apply to the parent directory or file and its children; <code>false</code> to not apply only to child directories and files.</td> </tr> <tr> <td><code>:one_level_deep</code></td> <td>Indicates the depth to which permissions will be applied. Possible values: <code>true</code> to apply only to the first level of children; <code>false</code> to apply to all children.</td> </tr> </tbody> </table> </dd> </dl> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'S-1-1-0'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Administrators Everyone)</span>
rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'Users'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'Sally'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#517918">:containers_only</span>, <span style="color:#517918">applies_to_self</span>: <span style="color:#007020">false</span>, <span style="color:#517918">one_level_deep</span>: <span style="color:#007020">true</span>
</code></pre></div>
<p>Some other important things to know when using the <code>rights</code> attribute:</p> <ul> <li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li> <li>If rights are not specified, nothing will be changed. Chef Infra Client does not clear out the rights on a file or directory if rights are not specified.</li> <li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li> </ul> <p>Use the <code>deny_rights</code> property to deny specific rights to specific users. The ordering is independent of using the <code>rights</code> property. For example, it doesn’t matter if rights are granted to everyone is placed before or after <code>deny_rights :read, ['Julian', 'Lewis']</code>, both Julian and Lewis will be unable to read the document. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource <span style="color:#4070a0">'x.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'Everyone'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'domain\group'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'group_name_or_user_name'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'user_name'</span>, <span style="color:#517918">applies_to_children</span>: <span style="color:#007020">true</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#c65d09">%w(Julian Lewis)</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">deny_rights <span style="color:#517918">:full_control</span>, <span style="color:#666">[</span><span style="color:#4070a0">'Sally'</span><span style="color:#666">]</span>
</code></pre></div> <strong>Inheritance</strong> <p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <code>inherits</code> property can be used to specifically tell Chef Infra Client to apply (or not apply) inherited rights from its parent directory.</p> <p>For example, the following example specifies the rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  inherits <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># Sauron is the only person who should have any sort of access</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>If the <code>deny_rights</code> permission were to be used instead, something could slip through unless all users and groups were denied.</p> <p>Another example also shows how to specify rights for a directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor'</span> <span style="color:#007020;font-weight:700">do</span>
  rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span>
  rights <span style="color:#517918">:full_control</span>, <span style="color:#4070a0">'MORDOR\Sauron'</span>
  rights <span style="color:#517918">:write</span>, <span style="color:#4070a0">'SHIRE\Frodo'</span> <span style="color:#60a0b0;font-style:italic"># Who put that there I didn't put that there</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>but then not use the <code>inherits</code> property to deny those rights on a child directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">directory <span style="color:#4070a0">'C:\mordor\mount_doom'</span> <span style="color:#007020;font-weight:700">do</span>
  deny_rights <span style="color:#517918">:read</span>, <span style="color:#4070a0">'MORDOR\Minions'</span> <span style="color:#60a0b0;font-style:italic"># Oops, not specific enough</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Because the <code>inherits</code> property is not specified, Chef Infra Client will default it to <code>true</code>, which will ensure that security settings for existing files remain unchanged.</p> <h3 id="template-requirements">Using Templates</h3> <p>To use a template, two things must happen:</p> <ol> <li>A template resource must be added to a recipe</li> <li>An Embedded Ruby (ERB) template must be added to a cookbook</li> </ol> <p>For example, the following template file and template resource settings can be used to manage a configuration file named <code>/etc/sudoers</code>. Within a cookbook that uses sudo, the following resource could be added to <code>/recipes/default.rb</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/sudoers'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'sudoers.erb'</span>
  mode <span style="color:#4070a0">'0440'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  variables(<span style="color:#517918">sudoers_groups</span>: node<span style="color:#666">[</span><span style="color:#4070a0">'authorization'</span><span style="color:#666">][</span><span style="color:#4070a0">'sudo'</span><span style="color:#666">][</span><span style="color:#4070a0">'groups'</span><span style="color:#666">]</span>,
            <span style="color:#517918">sudoers_users</span>: node<span style="color:#666">[</span><span style="color:#4070a0">'authorization'</span><span style="color:#666">][</span><span style="color:#4070a0">'sudo'</span><span style="color:#666">][</span><span style="color:#4070a0">'users'</span><span style="color:#666">]</span>)
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>And then create a template called <code>sudoers.erb</code> and save it to <code>templates/default/sudoers.erb</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic">#</span>
<span style="color:#60a0b0;font-style:italic"># /etc/sudoers</span>
<span style="color:#60a0b0;font-style:italic">#</span>
<span style="color:#60a0b0;font-style:italic"># Generated by Chef for &lt;%= node['fqdn'] %&gt;</span>
<span style="color:#60a0b0;font-style:italic">#</span>

<span style="color:#60add5">Defaults</span>        <span style="color:#666">!</span>lecture,tty_tickets,<span style="color:#666">!</span>fqdn

<span style="color:#60a0b0;font-style:italic"># User privilege specification</span>
root          <span style="color:#60add5">ALL</span><span style="color:#666">=</span>(<span style="color:#60add5">ALL</span>) <span style="color:#60add5">ALL</span>

<span style="color:#666">&lt;</span><span style="color:#c65d09">% @sudoers_users.each </span> <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>user<span style="color:#666">|</span> <span style="color:#666">-</span><span style="color:#4070a0">%&gt;
</span><span style="color:#4070a0">&lt;%= user %&gt;</span>   <span style="color:#60add5">ALL</span><span style="color:#666">=</span>(<span style="color:#60add5">ALL</span>) <span style="color:#666">&lt;</span><span style="color:#4070a0">%= "NOPASSWD:" if @passwordless %&gt;ALL
</span><span style="color:#4070a0">&lt;% end -%&gt;
</span><span style="color:#4070a0"># Members of the sysadmin group may gain root privileges
</span><span style="color:#4070a0">%sysadmin     ALL=</span>(<span style="color:#60add5">ALL</span>) <span style="color:#666">&lt;</span><span style="color:#4070a0">%= "NOPASSWD:" if @passwordless %&gt;ALL
</span><span style="color:#4070a0">&lt;% @sudoers_groups.each do |group| -%&gt;
</span><span style="color:#4070a0"># Members of the group '&lt;%=</span> group <span style="color:#4070a0">%&gt;' may gain root privileges
</span><span style="color:#4070a0">&lt;%= group %&gt;</span> <span style="color:#60add5">ALL</span><span style="color:#666">=</span>(<span style="color:#60add5">ALL</span>) <span style="color:#666">&lt;%=</span> <span style="color:#4070a0">"NOPASSWD:"</span> <span style="color:#007020;font-weight:700">if</span> @passwordless <span style="color:#4070a0">%&gt;ALL
</span><span style="color:#4070a0">&lt;% end -%&gt;</span>
</code></pre></div>
<p>And then set the default attributes in <code>attributes/default.rb</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default<span style="color:#666">[</span><span style="color:#4070a0">'authorization'</span><span style="color:#666">][</span><span style="color:#4070a0">'sudo'</span><span style="color:#666">][</span><span style="color:#4070a0">'groups'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#c65d09">%w(sysadmin wheel admin)</span>
default<span style="color:#666">[</span><span style="color:#4070a0">'authorization'</span><span style="color:#666">][</span><span style="color:#4070a0">'sudo'</span><span style="color:#666">][</span><span style="color:#4070a0">'users'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#c65d09">%w(jerry greg)</span>
</code></pre></div> <h4 id="template-specificity">File Specificity</h4> A cookbook is frequently designed to work across many platforms and is often required to distribute a specific template to a specific platform. A cookbook can be designed to support the distribution of templates across platforms, while ensuring that the correct template ends up on each system. <p>The pattern for template specificity depends on two things: the lookup path and the source. The first pattern that matches is used:</p> <ol> <li><code>/host-$fqdn/$source</code></li> <li><code>/$platform-$platform_version/$source</code></li> <li><code>/$platform/$source</code></li> <li><code>/default/$source</code></li> <li><code>/$source</code></li> </ol> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>To specify a particular Windows version, use the <a href="https://docs.microsoft.com/en-us/windows/win32/sysinfo/operating-system-version">operating system version number</a>. For example, a template in <code>templates/windows-6.3</code> will be deployed on systems installed with Windows 8.1.</p> </div> </div> <p>Use an array with the <code>source</code> property to define an explicit lookup path. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/test'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#666">[</span><span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">.</span>chef_environment<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.erb"</span>, <span style="color:#4070a0">'default.erb'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The following example emulates the entire file specificity pattern by defining it as an explicit path:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/test'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#c65d09">%W(
</span><span style="color:#c65d09">    host-</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'fqdn'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">/test.erb
</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'platform'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">-</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'platform_version'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">/test.erb
</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'platform'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">/test.erb
</span><span style="color:#c65d09">    default/test.erb
</span><span style="color:#c65d09">  )</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>A cookbook may have a <code>/templates</code> directory structure like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#235388">/templates/</span>
  windows<span style="color:#666">-</span><span style="color:#40a070">10</span>
  windows<span style="color:#666">-</span><span style="color:#40a070">6</span><span style="color:#666">.</span><span style="color:#40a070">3</span>
  windows
  default
</code></pre></div>
<p>and a resource that looks something like the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'C:\path\to\file\text_file.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'text_file.txt'</span>
  mode <span style="color:#4070a0">'0755'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This resource would be matched in the same order as the <code>/templates</code> directory structure. For a node named <code>host-node-desktop</code> that is running Windows 8.1, the second item would be the matching item and the location:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#235388">/templates
</span><span style="color:#235388">  windows-10/</span>text_file<span style="color:#666">.</span>txt
  windows<span style="color:#666">-</span><span style="color:#40a070">6</span><span style="color:#666">.</span><span style="color:#40a070">3</span><span style="color:#666">/</span>text_file<span style="color:#666">.</span>txt
  windows<span style="color:#666">/</span>text_file<span style="color:#666">.</span>txt
  default<span style="color:#666">/</span>text_file<span style="color:#666">.</span>txt
</code></pre></div> <h4 id="template-helpers">Helpers</h4> <p>A helper is a method or a module that can be used to extend a template. There are three approaches:</p> <ul> <li>An inline helper method</li> <li>An inline helper module</li> <li>A cookbook library module</li> </ul> <p>Use the <code>helper</code> attribute in a recipe to define an inline helper method. Use the <code>helpers</code> attribute to define an inline helper module or a cookbook library module.</p> <h5 id="template-inline-method">Inline Methods</h5> <p>A template helper method is always defined inline on a per-resource basis. A simple example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/path'</span> <span style="color:#007020;font-weight:700">do</span>
  helper(<span style="color:#517918">:hello_world</span>) { <span style="color:#4070a0">'hello world'</span> }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Another way to define an inline helper method is to reference a node object so that repeated calls to one (or more) cookbook attributes can be done efficiently:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/path'</span> <span style="color:#007020;font-weight:700">do</span>
  helper(<span style="color:#517918">:app</span>) { node<span style="color:#666">[</span><span style="color:#4070a0">'app'</span><span style="color:#666">]</span> }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>An inline helper method can also take arguments:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/path'</span> <span style="color:#007020;font-weight:700">do</span>
  helper(<span style="color:#517918">:app_conf</span>) { <span style="color:#666">|</span>setting<span style="color:#666">|</span> node<span style="color:#666">[</span><span style="color:#4070a0">'app'</span><span style="color:#666">][</span>setting<span style="color:#666">]</span> }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Once declared, a template can then use the helper methods to build a file. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60add5">Say</span> <span style="color:#517918">hello</span>: <span style="color:#666">&lt;%=</span> hello_world <span style="color:#666">%&gt;</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">[</span><span style="color:#4070a0">'app'</span><span style="color:#666">][</span><span style="color:#4070a0">'listen_port'</span><span style="color:#666">]</span> <span style="color:#517918">is</span>: <span style="color:#666">&lt;%=</span> app<span style="color:#666">[</span><span style="color:#4070a0">'listen_port'</span><span style="color:#666">]</span> <span style="color:#666">%&gt;</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">[</span><span style="color:#4070a0">'app'</span><span style="color:#666">][</span><span style="color:#4070a0">'log_location'</span><span style="color:#666">]</span> <span style="color:#517918">is</span>: <span style="color:#666">&lt;%=</span> app_conf(<span style="color:#4070a0">'log_location'</span>) <span style="color:#666">%&gt;</span>
</code></pre></div> <h5 id="template-inline-module">Inline Modules</h5> <p>A template helper module can be defined inline on a per-resource basis. This approach can be useful when a template requires more complex information. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/path'</span> <span style="color:#007020;font-weight:700">do</span>
  helpers <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">hello_world</span>
      <span style="color:#4070a0">'hello world'</span>
    <span style="color:#007020;font-weight:700">end</span>

    <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">app</span>
      node<span style="color:#666">[</span><span style="color:#4070a0">'app'</span><span style="color:#666">]</span>
    <span style="color:#007020;font-weight:700">end</span>

    <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">app_conf</span>(setting)
      node<span style="color:#666">[</span><span style="color:#4070a0">'app'</span><span style="color:#666">][</span><span style="color:#4070a0">'setting'</span><span style="color:#666">]</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the <code>hello_world</code>, <code>app</code>, and <code>app_conf(setting)</code> methods comprise the module that extends a template.</p> <h5 id="template-library-module">Library Modules</h5> <p>A template helper module can be defined in a library. This is useful when extensions need to be reused across recipes or to make it easier to manage code that would otherwise be defined inline on a per-recipe basis.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/path/to/template.erb'</span> <span style="color:#007020;font-weight:700">do</span>
  helpers(<span style="color:#60add5">MyHelperModule</span>)
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h4 id="template-host-notation">Host Notation</h4> The naming of folders within cookbook directories must literally match the host notation used for template specificity matching. For example, if a host is named <code>foo.example.com</code>, then the folder must be named <code>host-foo.example.com</code>. <h4 id="template-partials">Partial Templates</h4> <p>A template can be built in a way that allows it to contain references to one (or more) smaller template files. (These smaller template files are also referred to as partials.) A partial can be referenced from a template file in one of the following ways:</p> <ul> <li>By using the <code>render</code> method in the template file</li> <li>By using the <strong>template</strong> resource and the <code>variables</code> property.</li> </ul> <h5 id="template-partials-render-method">render Method</h5> <p>Use the <code>render</code> method in a template to reference a partial template file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">&lt;</span><span style="color:#4070a0">%= render 'partial_name.txt.erb', :option =</span><span style="color:#666">&gt;</span> {} <span style="color:#666">%&gt;</span>
</code></pre></div>
<p>where <code>partial_name</code> is the name of the partial template file and <code>:option</code> is one (or more) of the following:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Option</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>:cookbook</code></td> <td>By default, a partial template file is assumed to be located in the cookbook that contains the top-level template. Use this option to specify the path to a different cookbook</td> </tr> <tr> <td><code>:local</code></td> <td>Indicates that the name of the partial template file should be interpreted as a path to a file in the local file system or looked up in a cookbook using the normal rules for template files. Set to <code>true</code> to interpret as a path to a file in the local file system and to <code>false</code> to use the normal rules for template files</td> </tr> <tr> <td><code>:source</code></td> <td>By default, a partial template file is identified by its file name. Use this option to specify a different name or a local path to use (instead of the name of the partial template file)</td> </tr> <tr> <td><code>:variables</code></td> <td>A hash of <code>variable_name =&gt; value</code> that will be made available to the partial template file. When this option is used, any variables that are defined in the top-level template that are required by the partial template file must have them defined explicitly using this option</td> </tr> </tbody> </table> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">&lt;</span><span style="color:#4070a0">%= render 'simple.txt.erb', :variables =</span><span style="color:#666">&gt;</span> {<span style="color:#517918">:user</span> <span style="color:#666">=&gt;</span> <span style="color:#60add5">Etc</span><span style="color:#666">.</span>getlogin }, <span style="color:#517918">:local</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span> <span style="color:#666">%&gt;</span>
</code></pre></div> <h4 id="template-transfer-frequency">Transfer Frequency</h4> The Chef Infra Client caches a template when it is first requested. On each subsequent request for that template, the Chef Infra Client compares that request to the template located on the Chef Infra Server. If the templates are the same, no transfer occurs. <h4 id="template-variables">Variables</h4> <p>An Embedded Ruby (ERB) template allows Ruby code to be embedded inside a text file within specially formatted tags. Ruby code can be embedded using expressions and statements. An expression is delimited by <code>&lt;%=</code> and <code>%&gt;</code>. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">&lt;%=</span> <span style="color:#4070a0">"my name is </span><span style="color:#70a0d0;font-style:italic">#{</span>$ruby<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#666">%&gt;</span>
</code></pre></div>
<p>A statement is delimited by a modifier, such as <code>if</code>, <code>elsif</code>, and <code>else</code>. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">if</span> <span style="color:#007020">false</span>
<span style="color:#60a0b0;font-style:italic"># this won't happen</span>
<span style="color:#007020;font-weight:700">elsif</span> <span style="color:#007020">nil</span>
      <span style="color:#60a0b0;font-style:italic"># this won't either</span>
    <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Using a Ruby expression is the most common approach for defining template variables because this is how all variables that are sent to a template are referenced. Whenever a template needs to use an <code>each</code>, <code>if</code>, or <code>end</code>, use a Ruby statement.</p> <p>When a template is rendered, Ruby expressions and statements are evaluated by Chef Infra Client. The variables listed in the <strong>template</strong> resource’s <code>variables</code> parameter and in the node object are evaluated. Chef Infra Client then passes these variables to the template, where they will be accessible as instance variables within the template. The node object can be accessed just as if it were part of a recipe, using the same syntax.</p> <p>For example, a simple template resource like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">[</span><span style="color:#4070a0">'fqdn'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'latte'</span>
template <span style="color:#4070a0">'/tmp/foo'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'foo.erb'</span>
  variables(<span style="color:#517918">x_men</span>: <span style="color:#4070a0">'are keen'</span>)
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>And a simple Embedded Ruby (ERB) template like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60add5">The</span> node <span style="color:#666">&lt;</span><span style="color:#4070a0">%= node[:fqdn] %&gt; thinks the x-men &lt;%=</span> @x_men <span style="color:#666">%&gt;</span>
</code></pre></div>
<p>Would render something like:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code>The node latte thinks the x-men are keen
</code></pre>
<p>Even though this is a very simple example, the full capabilities of Ruby can be used to tackle even the most complex and demanding template requirements.</p> <br> <h3 id="functionality-template">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-template">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-template">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-template">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-template">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>template</strong> resource in recipes:</p> <p>Configure a file from a template</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/config.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'config.conf.erb'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Configure a file from a local template</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/config.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  local <span style="color:#007020">true</span>
  source <span style="color:#4070a0">'/tmp/config.conf.erb'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Configure a file using a variable map</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/config.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'config.conf.erb'</span>
  variables(
    <span style="color:#517918">:config_var</span> <span style="color:#666">=&gt;</span> node<span style="color:#666">[</span><span style="color:#4070a0">'configs'</span><span style="color:#666">][</span><span style="color:#4070a0">'config_var'</span><span style="color:#666">]</span>
  )
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use the not_if condition</p> <p>The following example shows how to use the <code>not_if</code> condition to create a file based on a template and using the presence of an attribute value on the node to specify the condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  not_if { node<span style="color:#666">[</span><span style="color:#4070a0">'some_value'</span><span style="color:#666">]</span> }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The following example shows how to use the <code>not_if</code> condition to create a file based on a template and then Ruby code to specify the condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  not_if <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(<span style="color:#4070a0">'/etc/passwd'</span>)
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The following example shows how to use the <code>not_if</code> condition to create a file based on a template and using a Ruby block (with curly braces) to specify the condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  not_if { <span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(<span style="color:#4070a0">'/etc/passwd'</span>) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The following example shows how to use the <code>not_if</code> condition to create a file based on a template and using a string to specify the condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  not_if <span style="color:#4070a0">'test -f /etc/passwd'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use the only_if condition</p> <p>The following example shows how to use the <code>only_if</code> condition to create a file based on a template and using the presence of an attribute on the node to specify the condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  only_if { node<span style="color:#666">[</span><span style="color:#4070a0">'some_value'</span><span style="color:#666">]</span> }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The following example shows how to use the <code>only_if</code> condition to create a file based on a template, and then use Ruby to specify a condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  only_if { <span style="color:#666">!</span> <span style="color:#666">::</span><span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(<span style="color:#4070a0">'/etc/passwd'</span>) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The following example shows how to use the <code>only_if</code> condition to create a file based on a template and using a string to specify the condition:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  only_if <span style="color:#4070a0">'test -f /etc/passwd'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use a whitespace array (%w)</p> <p>The following example shows how to use a Ruby whitespace array to define a list of configuration tools, and then use that list of tools within the <strong>template</strong> resource to ensure that all of these configuration tools are using the same RSA key:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#c65d09">%w{openssl.cnf pkitool vars Rakefile}</span><span style="color:#666">.</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>f<span style="color:#666">|</span>
  template <span style="color:#4070a0">"/etc/openvpn/easy-rsa/</span><span style="color:#70a0d0;font-style:italic">#{</span>f<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#007020;font-weight:700">do</span>
    source <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>f<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.erb"</span>
    owner <span style="color:#4070a0">'root'</span>
    group <span style="color:#4070a0">'root'</span>
    mode <span style="color:#4070a0">'0755'</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use a relative path</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">ENV</span><span style="color:#666">[</span><span style="color:#4070a0">'HOME'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/chef-getting-started.txt"</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef-getting-started.txt.erb'</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Delay notifications</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/nagios3/configures-nagios.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic"># other parameters</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[test-nagios-config]'</span>, <span style="color:#517918">:delayed</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notify immediately</p> <p>By default, notifications are <code>:delayed</code>, that is they are queued up as they are triggered, and then executed at the very end of a Chef Infra Client run. To run an action immediately, use <code>:immediately</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/nagios3/configures-nagios.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic"># other parameters</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[test-nagios-config]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then Chef Infra Client would immediately run the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'test-nagios-config'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'nagios3 --verify-config'</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notify multiple resources</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/chef/server.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'server.rb.erb'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[chef-solr]'</span>, <span style="color:#517918">:delayed</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[chef-solr-indexer]'</span>, <span style="color:#517918">:delayed</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[chef-server]'</span>, <span style="color:#517918">:delayed</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Reload a service</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/tmp/somefile'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0755'</span>
  source <span style="color:#4070a0">'somefile.erb'</span>
  notifies <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'service[apache]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Restart a service when a template is modified</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/www/configures-apache.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[apache]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Send notifications to multiple resources</p> <p>To send notifications to multiple resources, just use multiple attributes. Multiple attributes will get sent to the notified resources in the order specified.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/netatalk/netatalk.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[afpd]'</span>, <span style="color:#517918">:immediately</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[cnid]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'afpd'</span>
service <span style="color:#4070a0">'cnid'</span>
</code></pre></div>
<p>Execute a command using a template</p> <p>The following example shows how to set up IPv4 packet forwarding using the <strong>execute</strong> resource to run a command named <code>forward_ipv4</code> that uses a template defined by the <strong>template</strong> resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'forward_ipv4'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'echo &gt; /proc/.../ipv4/ip_forward'</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

template <span style="color:#4070a0">'/etc/file_name.conf'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'routing/file_name.conf.erb'</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[forward_ipv4]'</span>, <span style="color:#517918">:delayed</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the <code>command</code> property for the <strong>execute</strong> resource contains the command that is to be run and the <code>source</code> property for the <strong>template</strong> resource specifies which template to use. The <code>notifies</code> property for the <strong>template</strong> specifies that the <code>execute[forward_ipv4]</code> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of a Chef Infra Client run.</p> <p>Set an IP address using variables and a template</p> <p>The following example shows how the <strong>template</strong> resource can be used in a recipe to combine settings stored in an attributes file, variables within a recipe, and a template to set the IP addresses that are used by the Nginx service. The attributes file contains the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'dir'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'/etc/nginx'</span>
</code></pre></div>
<p>The recipe then does the following to:</p> <ul> <li>Declare two variables at the beginning of the recipe, one for the remote IP address and the other for the authorized IP address</li> <li>Use the <strong>service</strong> resource to restart and reload the Nginx service</li> <li>Load a template named <code>authorized_ip.erb</code> from the <code>/templates</code> directory that is used to set the IP address values based on the variables specified in the recipe</li> </ul> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>default<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'remote_ip_var'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'remote_addr'</span>
node<span style="color:#666">.</span>default<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'authorized_ips'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#666">[</span><span style="color:#4070a0">'127.0.0.1/32'</span><span style="color:#666">]</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  supports <span style="color:#517918">:status</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>, <span style="color:#517918">:restart</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>, <span style="color:#517918">:reload</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>

template <span style="color:#4070a0">'authorized_ip'</span> <span style="color:#007020;font-weight:700">do</span>
  path <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/authorized_ip"</span>
  source <span style="color:#4070a0">'modules/authorized_ip.erb'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  variables(
    <span style="color:#517918">:remote_ip_var</span> <span style="color:#666">=&gt;</span> node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'remote_ip_var'</span><span style="color:#666">]</span>,
    <span style="color:#517918">:authorized_ips</span> <span style="color:#666">=&gt;</span> node<span style="color:#666">[</span><span style="color:#4070a0">'nginx'</span><span style="color:#666">][</span><span style="color:#4070a0">'authorized_ips'</span><span style="color:#666">]</span>
  )

  notifies <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'service[nginx]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the <code>variables</code> property tells the template to use the variables set at the beginning of the recipe and the <code>source</code> property is used to call a template file located in the cookbook’s <code>/templates</code> directory. The template file looks similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">geo $&lt;<span style="color:#4070a0">%= @remote_ip_var %&gt; $authorized_ip {
</span><span style="color:#4070a0">  default no;
</span><span style="color:#4070a0">  &lt;% @authorized_ips.each do |ip| %&gt;
</span><span style="color:#4070a0">  &lt;%=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>ip<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0"> yes;"</span> <span style="color:#4070a0">%&gt;
</span><span style="color:#4070a0">  &lt;% end %&gt;</span>
}
</code></pre></div>
<p>Add a rule to an IP table</p> <p>The following example shows how to add a rule named <code>test_rule</code> to an IP table using the <strong>execute</strong> resource to run a command using a template that is defined by the <strong>template</strong> resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">'test_rule'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'command_to_run
</span><span style="color:#4070a0">    --option value
</span><span style="color:#4070a0">    ...
</span><span style="color:#4070a0">    --option value
</span><span style="color:#4070a0">    --source #{node[:name_of_node][:ipsec][:local][:subnet]}
</span><span style="color:#4070a0">    -j test_rule'</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

template <span style="color:#4070a0">'/etc/file_name.local'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'routing/file_name.local.erb'</span>
  notifies <span style="color:#517918">:run</span>, <span style="color:#4070a0">'execute[test_rule]'</span>, <span style="color:#517918">:delayed</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the <code>command</code> property for the <strong>execute</strong> resource contains the command that is to be run and the <code>source</code> property for the <strong>template</strong> resource specifies which template to use. The <code>notifies</code> property for the <strong>template</strong> specifies that the <code>execute[test_rule]</code> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of a Chef Infra Client run.</p> <p>Apply proxy settings consistently across a Chef organization</p> <p>The following example shows how a template can be used to apply consistent proxy settings for all nodes of the same type:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'matching_node'</span><span style="color:#666">][</span><span style="color:#4070a0">'dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/sites-available/site_proxy.conf"</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'site_proxy.matching_node.conf.erb'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  variables(
    <span style="color:#517918">:ssl_certificate</span> <span style="color:#666">=&gt;</span>    <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'matching_node'</span><span style="color:#666">][</span><span style="color:#4070a0">'dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/shared/certificates/site_proxy.crt"</span>,
    <span style="color:#517918">:ssl_key</span> <span style="color:#666">=&gt;</span>            <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'matching_node'</span><span style="color:#666">][</span><span style="color:#4070a0">'dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/shared/certificates/site_proxy.key"</span>,
    <span style="color:#517918">:listen_port</span> <span style="color:#666">=&gt;</span>        node<span style="color:#666">[</span><span style="color:#4070a0">'site'</span><span style="color:#666">][</span><span style="color:#4070a0">'matching_node_proxy'</span><span style="color:#666">][</span><span style="color:#4070a0">'listen_port'</span><span style="color:#666">]</span>,
    <span style="color:#517918">:server_name</span> <span style="color:#666">=&gt;</span>        node<span style="color:#666">[</span><span style="color:#4070a0">'site'</span><span style="color:#666">][</span><span style="color:#4070a0">'matching_node_proxy'</span><span style="color:#666">][</span><span style="color:#4070a0">'server_name'</span><span style="color:#666">]</span>,
    <span style="color:#517918">:fqdn</span> <span style="color:#666">=&gt;</span>               node<span style="color:#666">[</span><span style="color:#4070a0">'fqdn'</span><span style="color:#666">]</span>,
    <span style="color:#517918">:server_options</span> <span style="color:#666">=&gt;</span>     node<span style="color:#666">[</span><span style="color:#517918">:site</span><span style="color:#666">][</span><span style="color:#4070a0">'matching_node'</span><span style="color:#666">][</span><span style="color:#4070a0">'server'</span><span style="color:#666">][</span><span style="color:#4070a0">'options'</span><span style="color:#666">]</span>,
    <span style="color:#517918">:proxy_options</span> <span style="color:#666">=&gt;</span>      node<span style="color:#666">[</span><span style="color:#517918">:site</span><span style="color:#666">][</span><span style="color:#4070a0">'matching_node'</span><span style="color:#666">][</span><span style="color:#4070a0">'proxy'</span><span style="color:#666">][</span><span style="color:#4070a0">'options'</span><span style="color:#666">]</span>
  )
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where <code>matching_node</code> represents a type of node (like Nginx) and <code>site_proxy</code> represents the type of proxy being used for that type of node (like Nexus).</p> <p>Get template settings from a local file</p> <p>The <strong>template</strong> resource can be used to render a template based on settings contained in a local file on disk or to get the settings from a template in a cookbook. Most of the time, the settings are retrieved from a template in a cookbook. The following example shows how the <strong>template</strong> resource can be used to retrieve these settings from a local file.</p> <p>The following example is based on a few assumptions:</p> <ul> <li>The environment is a Ruby on Rails application that needs render a file named <code>database.yml</code>
</li> <li>Information about the application—the user, their password, the server—is stored in a data bag on the Chef server</li> <li>The application is already deployed to the system and that only requirement in this example is to render the <code>database.yml</code> file</li> </ul> <p>The application source tree looks something like:</p> <pre class="highlight" data-language="ruby"><code>  myapp/
  -&gt; config/
     -&gt; database.yml.erb
</code></pre> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>There should not be a file named <code>database.yml</code> (without the <code>.erb</code>), as the <code>database.yml</code> file is what will be rendered using the <strong>template</strong> resource.</p> </div> </div> <p>The deployment of the app will end up in <code>/srv</code>, so the full path to this template would be something like <code>/srv/myapp/current/config/database.yml.erb</code>.</p> <p>The content of the template itself may look like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">&lt;</span><span style="color:#4070a0">%= @rails_env %&gt;:
</span><span style="color:#4070a0">   adapter: &lt;%=</span> @adapter <span style="color:#4070a0">%&gt;
</span><span style="color:#4070a0">   host: &lt;%= @host %&gt;</span>
   <span style="color:#517918">database</span>: <span style="color:#666">&lt;</span><span style="color:#4070a0">%= @database %&gt;
</span><span style="color:#4070a0">   username: &lt;%=</span> @username <span style="color:#4070a0">%&gt;
</span><span style="color:#4070a0">   password: &lt;%= @password %&gt;</span>
   <span style="color:#517918">encoding</span>: <span style="color:#4070a0">'utf8'</span>
   <span style="color:#517918">reconnect</span>: <span style="color:#007020">true</span>
</code></pre></div>
<p>The recipe will be similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">results <span style="color:#666">=</span> search(<span style="color:#517918">:node</span>, <span style="color:#4070a0">"role:myapp_database_master AND chef_environment:</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">.</span>chef_environment<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>)
db_master <span style="color:#666">=</span> results<span style="color:#666">[</span><span style="color:#40a070">0</span><span style="color:#666">]</span>

template <span style="color:#4070a0">'/srv/myapp/shared/database.yml'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'/srv/myapp/current/config/database.yml.erb'</span>
  local <span style="color:#007020">true</span>
  variables(
    <span style="color:#517918">:rails_env</span> <span style="color:#666">=&gt;</span> node<span style="color:#666">.</span>chef_environment,
    <span style="color:#517918">:adapter</span> <span style="color:#666">=&gt;</span> db_master<span style="color:#666">[</span><span style="color:#4070a0">'myapp'</span><span style="color:#666">][</span><span style="color:#4070a0">'db_adapter'</span><span style="color:#666">]</span>,
    <span style="color:#517918">:host</span> <span style="color:#666">=&gt;</span> db_master<span style="color:#666">[</span><span style="color:#4070a0">'fqdn'</span><span style="color:#666">]</span>,
    <span style="color:#517918">:database</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"myapp_</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">.</span>chef_environment<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>,
    <span style="color:#517918">:username</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"myapp"</span>,
    <span style="color:#517918">:password</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"SUPERSECRET"</span>,
  )
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where:</p> <ul> <li>the <code>search</code> method in the Chef Infra Language is used to find the first node that is the database master (of which there should only be one)</li> <li>the <code>:adapter</code> variable property may also require an attribute to have been set on a role, which then determines the correct adapter</li> </ul> <p>The template will render similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#517918">production</span>:
  <span style="color:#517918">adapter</span>: mysql
  <span style="color:#517918">host</span>: domU<span style="color:#666">-</span><span style="color:#40a070">12</span><span style="color:#666">-</span><span style="color:#40a070">31</span><span style="color:#666">-</span><span style="color:#40a070">39</span><span style="color:#666">-</span><span style="color:#40a070">14</span><span style="color:#666">-</span><span style="color:#60add5">F1</span><span style="color:#666">-</span><span style="color:#60add5">C3</span><span style="color:#666">.</span>compute<span style="color:#666">-</span><span style="color:#40a070">1</span><span style="color:#666">.</span>internal
  <span style="color:#517918">database</span>: myapp_production
  <span style="color:#517918">username</span>: myapp
  <span style="color:#517918">password</span>: <span style="color:#60add5">SUPERSECRET</span>
  <span style="color:#517918">encoding</span>: utf8
  <span style="color:#517918">reconnect</span>: <span style="color:#007020">true</span>
</code></pre></div>
<p>This example showed how to use the <strong>template</strong> resource to render a template based on settings contained in a local file. Some other issues that should be considered when using this type of approach include:</p> <ul> <li>Should the <code>database.yml</code> file be in a <code>.gitignore</code> file?</li> <li>How do developers run the application locally?</li> <li>Does this work with chef-solo?</li> </ul> <p>Pass values from recipe to template</p> <p>The following example shows how pass a value to a template using the <code>variables</code> property in the <strong>template</strong> resource. The template file is similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">[</span>tcpout<span style="color:#666">]</span>
defaultGroup <span style="color:#666">=</span> splunk_indexers_<span style="color:#666">&lt;</span><span style="color:#4070a0">%= node['splunk']['receiver_port'] %&gt;
</span><span style="color:#4070a0">disabled=</span><span style="color:#007020">false</span>

<span style="color:#666">[</span><span style="color:#517918">tcpout</span>:splunk_indexers_<span style="color:#666">&lt;</span><span style="color:#4070a0">%= node['splunk']['receiver_port'] %&gt;]
</span><span style="color:#4070a0">server=</span><span style="color:#666">&lt;</span><span style="color:#c65d09">% @splunk_servers.map </span> <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>s<span style="color:#666">|</span> <span style="color:#666">-</span><span style="color:#4070a0">%&gt;&lt;%= s['ipaddress'] %&gt;</span><span style="color:#517918">:&lt;</span><span style="color:#4070a0">%= s['splunk']['receiver_port'] %&gt; &lt;% end.join(', ') -%&gt;
</span><span style="color:#4070a0">&lt;% @outputs_conf.each_pair do |name, value| -%&gt;
</span><span style="color:#4070a0">&lt;%=</span> <span style="color:#007020">name</span> <span style="color:#4070a0">%&gt; = &lt;%= value %&gt;</span>
<span style="color:#666">&lt;</span><span style="color:#c65d09">% end </span> <span style="color:#666">-%&gt;</span>
</code></pre></div>
<p>The recipe then uses the <code>variables</code> attribute to find the values for <code>splunk_servers</code> and <code>outputs_conf</code>, before passing them into the template:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>splunk_dir<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/etc/system/local/outputs.conf"</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'outputs.conf.erb'</span>
  mode <span style="color:#4070a0">'0755'</span>
  variables <span style="color:#517918">:splunk_servers</span> <span style="color:#666">=&gt;</span> splunk_servers, <span style="color:#517918">:outputs_conf</span> <span style="color:#666">=&gt;</span> node<span style="color:#666">[</span><span style="color:#4070a0">'splunk'</span><span style="color:#666">][</span><span style="color:#4070a0">'outputs_conf'</span><span style="color:#666">]</span>
  notifies <span style="color:#517918">:restart</span>, <span style="color:#4070a0">'service[splunk]'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This example can be found in the <code>client.rb</code> recipe and the <code>outputs.conf.erb</code> template files that are located in the <a href="https://github.com/chef-cookbooks/chef-splunk/">chef-splunk cookbook</a> that is maintained by Chef.</p> <h2 id="timezone-resource">timezone resource</h2> <a href="timezone/index.html">timezone resource page</a> <hr> <p>Use the <strong>timezone</strong> resource to change the system timezone on Windows, Linux, and macOS hosts. Timezones are specified in tz database format, with a complete list of available TZ values for Linux and macOS here: <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">https://en.wikipedia.org/wiki/List_of_tz_database_time_zones</a>. On Windows systems run <code>tzutil /l</code> for a complete list of valid timezones.</p> <p><strong>New in Chef Infra Client 14.6.</strong></p> <h3 id="syntax-timezone">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>timezone</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">timezone <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  timezone      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action        <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :set if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>timezone</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>timezone</code> is the property available to this resource.</li> </ul> <h3 id="actions-timezone">Actions</h3> <hr> <p>The <strong>timezone</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:set</code></dt> <dd>Set the system timezone. (default)</dd> </dl> <h3 id="properties-timezone">Properties</h3> <hr> <p>The <strong>timezone</strong> resource has the following properties:</p> <dl> <dt> <code>timezone</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the timezone value if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-timezone">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-timezone">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-timezone">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-timezone">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-timezone">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>timezone</strong> resource in recipes:</p> <p><strong>Set the timezone to UTC</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">timezone <span style="color:#4070a0">'UTC'</span>
</code></pre></div>
<p><strong>Set the timezone to America/Los_Angeles with a friendly resource name on Linux/macOS</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">timezone <span style="color:#4070a0">"Set the host's timezone to America/Los_Angeles"</span> <span style="color:#007020;font-weight:700">do</span>
  timezone <span style="color:#4070a0">'America/Los_Angeles'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Set the timezone to PST with a friendly resource name on Windows</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">timezone <span style="color:#4070a0">"Set the host's timezone to PST"</span> <span style="color:#007020;font-weight:700">do</span>
  timezone <span style="color:#4070a0">'Pacific Standard time'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="user-resource">user resource</h2> <a href="user/index.html">user resource page</a> <hr> <p>Use the <strong>user</strong> resource to add users, update existing users, remove users, and to lock/unlock user passwords.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>System attributes are collected by Ohai at the start of every Chef Infra Client run. By design, the actions available to the <strong>user</strong> resource are processed <strong>after</strong> the start of a Chef Infra Client run. This means that system attributes added or modified by the <strong>user</strong> resource during a Chef Infra Client run must be reloaded before they can be available to Chef Infra Client. These system attributes can be reloaded in two ways: by picking up the values at the start of the (next) Chef Infra Client run or by using the <a href="ohai/index.html">ohai resource</a> to reload the system attributes during the current Chef Infra Client run.</p> </div> </div> <h3 id="syntax-user">Syntax</h3> <hr> 
<p>A <strong>user</strong> resource block manages users on a node:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">user <span style="color:#4070a0">'a user'</span> <span style="color:#007020;font-weight:700">do</span>
  comment <span style="color:#4070a0">'A random user'</span>
  uid <span style="color:#40a070">1234</span>
  gid <span style="color:#4070a0">'groupname'</span>
  home <span style="color:#4070a0">'/home/random'</span>
  shell <span style="color:#4070a0">'/bin/bash'</span>
  password <span style="color:#4070a0">'$1$JJsvHslasdfjVEroftprNn4JHtDi'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>The full syntax for all of the properties that are available to the <strong>user</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">user <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  comment                    <span style="color:#007020">String</span>
  force                      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># see description</span>
  gid                        <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  home                       <span style="color:#007020">String</span>
  iterations                 <span style="color:#007020">Integer</span>
  manage_home                <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  non_unique                 <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  password                   <span style="color:#007020">String</span>
  salt                       <span style="color:#007020">String</span>
  shell                      <span style="color:#007020">String</span>
  <span style="color:#007020">system</span>                     <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  uid                        <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  username                   <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># defaults to 'name' if not specified</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>user</code> is the resource</li> <li>
<code>name</code> is the name of the resource block</li> <li>
<code>action</code> identifies the steps Chef Infra Client will take to bring the node into the desired state</li> <li>
<code>comment</code>, <code>force</code>, <code>gid</code>, <code>home</code>, <code>iterations</code>, <code>manage_home</code>, <code>non_unique</code>, <code>password</code>, <code>salt</code>, <code>shell</code>, <code>system</code>, <code>uid</code>, and <code>username</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-user">Actions</h3> <hr> <p>The <strong>user</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Create a user with given properties. If a user already exists (but does not match), update that user to match.</dd> <dt><code>:lock</code></dt> <dd>Lock a user’s password.</dd> <dt><code>:manage</code></dt> <dd>Manage an existing user. This action does nothing if the user does not exist.</dd> <dt><code>:modify</code></dt> <dd>Modify an existing user. This action raises an exception if the user does not exist.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a user.</dd> <dt><code>:unlock</code></dt> <dd>Unlock a user’s password.</dd> </dl> <h3 id="properties-user">Properties</h3> <hr> <p>The <strong>user</strong> resource has the following properties:</p> <dl> <dt> <code>comment</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One (or more) comments about the user.</p> </dd> </dl> <dl> <dt> <code>force</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Force the removal of a user. May be used only with the <code>:remove</code> action.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>Using this property may leave the system in an inconsistent state. For example, a user account will be removed even if the user is logged in. A user’s home directory will be removed, even if that directory is shared by multiple users.</p> </div> </div> </dd> </dl> <dl> <dt> <code>gid</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The identifier for the group. This property was previously named <code>group</code> and both continue to function.</p> </dd> </dl> <dl> <dt> <code>home</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The location of the home directory.</p> </dd> </dl> <dl> <dt> <code>iterations</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>macOS platform only. The number of iterations for a password with a SALTED-SHA512-PBKDF2 shadow hash.</p> </dd> </dl> <dl> <dt> <code>manage_home</code> </dt> <dd> <strong>Ruby Type:</strong> true, false 
<p>Manage a user’s home directory.</p> <p>When used with the <code>:create</code> action, a user’s home directory is created based on <code>HOME_DIR</code>. If the home directory is missing, it is created unless <code>CREATE_HOME</code> in <code>/etc/login.defs</code> is set to <code>no</code>. When created, a skeleton set of files and subdirectories are included within the home directory.</p> <p>When used with the <code>:modify</code> action, a user’s home directory is moved to <code>HOME_DIR</code>. If the home directory is missing, it is created unless <code>CREATE_HOME</code> in <code>/etc/login.defs</code> is set to <code>no</code>. The contents of the user’s home directory are moved to the new location.</p> </dd> </dl> <dl> <dt> <code>non_unique</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Create a duplicate (non-unique) user account.</p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The password shadow hash</p> </dd> </dl> <dl> <dt> <code>salt</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A SALTED-SHA512-PBKDF2 hash.</p> </dd> </dl> <dl> <dt> <code>shell</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The login shell.</p> </dd> </dl> <dl> <dt> <code>system</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Create a system user. This property may be used with <code>useradd</code> as the provider to create a system user which passes the <code>-r</code> flag to <code>useradd</code>.</p> </dd> </dl> <dl> <dt> <code>uid</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The numeric user identifier.</p> </dd> </dl> <dl> <dt> <code>username</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of the user. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <br> <h3 id="functionality-user">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-user">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-user">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-user">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-user">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>user</strong> resource in recipes:</p> <p>Create a system user</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">user <span style="color:#4070a0">'systemguy'</span> <span style="color:#007020;font-weight:700">do</span>
  comment <span style="color:#4070a0">'system guy'</span>
  <span style="color:#007020">system</span> <span style="color:#007020">true</span>
  shell <span style="color:#4070a0">'/bin/false'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create a system user with a variable</p> <p>The following example shows how to create a system user. In this instance, the <code>home</code> value is calculated and stored in a variable called <code>user_home</code> which sets the user’s <code>home</code> attribute.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">user_home <span style="color:#666">=</span> <span style="color:#4070a0">"/home/</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'cookbook_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'user'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>

user node<span style="color:#666">[</span><span style="color:#4070a0">'cookbook_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'user'</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:700">do</span>
  gid node<span style="color:#666">[</span><span style="color:#4070a0">'cookbook_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'group'</span><span style="color:#666">]</span>
  shell <span style="color:#4070a0">'/bin/bash'</span>
  home user_home
  <span style="color:#007020">system</span> <span style="color:#007020">true</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use SALTED-SHA512-PBKDF2 passwords</p> <p>macOS 10.8 (and higher) calculates the password shadow hash using SALTED-SHA512-PBKDF2. The length of the shadow hash value is 128 bytes, the salt value is 32 bytes, and an integer specifies the number of iterations. The following code will calculate password shadow hashes for macOS 10.8 (and higher):</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">password <span style="color:#666">=</span> <span style="color:#4070a0">'my_awesome_password'</span>
salt <span style="color:#666">=</span> <span style="color:#60add5">OpenSSL</span><span style="color:#666">::</span><span style="color:#60add5">Random</span><span style="color:#666">.</span>random_bytes(<span style="color:#40a070">32</span>)
iterations <span style="color:#666">=</span> <span style="color:#40a070">25000</span> <span style="color:#60a0b0;font-style:italic"># Any value above 20k should be fine.</span>

shadow_hash <span style="color:#666">=</span> <span style="color:#60add5">OpenSSL</span><span style="color:#666">::</span><span style="color:#60add5">PKCS5</span><span style="color:#666">::</span>pbkdf2_hmac(
  password,
  salt,
  iterations,
  <span style="color:#40a070">128</span>,
  <span style="color:#60add5">OpenSSL</span><span style="color:#666">::</span><span style="color:#60add5">Digest</span><span style="color:#666">::</span><span style="color:#60add5">SHA512</span><span style="color:#666">.</span>new
)<span style="color:#666">.</span>unpack(<span style="color:#4070a0">'H*'</span>)<span style="color:#666">.</span>first
salt_value <span style="color:#666">=</span> salt<span style="color:#666">.</span>unpack(<span style="color:#4070a0">'H*'</span>)<span style="color:#666">.</span>first
</code></pre></div>
<p>Use the calculated password shadow hash with the <strong>user</strong> resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">user <span style="color:#4070a0">'my_awesome_user'</span> <span style="color:#007020;font-weight:700">do</span>
  password <span style="color:#4070a0">'cbd1a....fc843'</span>  <span style="color:#60a0b0;font-style:italic"># Length: 256</span>
  salt <span style="color:#4070a0">'bd1a....fc83'</span>        <span style="color:#60a0b0;font-style:italic"># Length: 64</span>
  iterations <span style="color:#40a070">25000</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="user-ulimit-resource">user_ulimit resource</h2> <a href="user_ulimit/index.html">user_ulimit resource page</a> <hr> <p>Use the <strong>user_ulimit</strong> resource to create individual ulimit files that are installed into the <code>/etc/security/limits.d/</code> directory.</p> <p><strong>New in Chef Infra Client 16.0.</strong></p> <h3 id="syntax-user-ulimit">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>user_ulimit</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">user_ulimit <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  core_hard_limit            <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  core_limit                 <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  core_soft_limit            <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  filehandle_hard_limit      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  filehandle_limit           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  filehandle_soft_limit      <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  filename                   <span style="color:#007020">String</span>
  memory_limit               <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  process_hard_limit         <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  process_limit              <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  process_soft_limit         <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  rtprio_hard_limit          <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  rtprio_limit               <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  rtprio_soft_limit          <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  stack_hard_limit           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  stack_limit                <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  stack_soft_limit           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  username                   <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  virt_limit                 <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>user_ulimit</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>core_hard_limit</code>, <code>core_limit</code>, <code>core_soft_limit</code>, <code>filehandle_hard_limit</code>, <code>filehandle_limit</code>, <code>filehandle_soft_limit</code>, <code>filename</code>, <code>memory_limit</code>, <code>process_hard_limit</code>, <code>process_limit</code>, <code>process_soft_limit</code>, <code>rtprio_hard_limit</code>, <code>rtprio_limit</code>, <code>rtprio_soft_limit</code>, <code>stack_hard_limit</code>, <code>stack_limit</code>, <code>stack_soft_limit</code>, <code>username</code>, and <code>virt_limit</code> are the properties available to this resource.</li> </ul> <h3 id="actions-user-ulimit">Actions</h3> <hr> <p>The <strong>user_ulimit</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create a ulimit configuration file. (default)</dd> <dt><code>:delete</code></dt> <dd>Delete an existing ulimit configuration file.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-user-ulimit">Properties</h3> <hr> <p>The <strong>user_ulimit</strong> resource has the following properties:</p> <dl> <dt> <code>core_hard_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>core_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>core_soft_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>filehandle_hard_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>filehandle_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>filehandle_soft_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>filename</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>lazy default</code>  </dd> </dl> <dl> <dt> <code>memory_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>process_hard_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>process_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>process_soft_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>rtprio_hard_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>rtprio_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>rtprio_soft_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>stack_hard_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>stack_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>stack_soft_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <dl> <dt> <code>username</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code>  </dd> </dl> <dl> <dt> <code>virt_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer  </dd> </dl> <br> <h3 id="functionality-user-ulimit">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-user-ulimit">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-user-ulimit">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-user-ulimit">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-user-ulimit">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>user_ulimit</strong> resource in recipes:</p> <p><strong>Set filehandle limit for the tomcat user</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">user_ulimit <span style="color:#4070a0">'tomcat'</span> <span style="color:#007020;font-weight:700">do</span>
  filehandle_limit <span style="color:#40a070">8192</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Specify a username that differs from the name given to the resource block</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">user_ulimit <span style="color:#4070a0">'Bump filehandle limits for tomcat user'</span> <span style="color:#007020;font-weight:700">do</span>
  username <span style="color:#4070a0">'tomcat'</span>
  filehandle_limit <span style="color:#40a070">8192</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Set filehandle limit for the tomcat user with a non-default filename</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">user_ulimit <span style="color:#4070a0">'tomcat'</span> <span style="color:#007020;font-weight:700">do</span>
  filehandle_limit <span style="color:#40a070">8192</span>
  filename <span style="color:#4070a0">'tomcat_filehandle_limits.conf'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-ad-join-resource">windows_ad_join resource</h2> <a href="windows_ad_join/index.html">windows_ad_join resource page</a> <hr> <p>Use the <strong>windows_ad_join</strong> resource to join a Windows Active Directory domain.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-windows-ad-join">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_ad_join</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_ad_join <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  domain_name          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  domain_password      <span style="color:#007020">String</span>
  domain_user          <span style="color:#007020">String</span>
  new_hostname         <span style="color:#007020">String</span>
  ou_path              <span style="color:#007020">String</span>
  reboot               <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :immediate</span>
  reboot_delay         <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 0</span>
  workgroup_name       <span style="color:#007020">String</span>
  action               <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :join if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_ad_join</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>domain_name</code>, <code>domain_password</code>, <code>domain_user</code>, <code>new_hostname</code>, <code>ou_path</code>, <code>reboot</code>, <code>reboot_delay</code>, and <code>workgroup_name</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-ad-join">Actions</h3> <hr> <p>The <strong>windows_ad_join</strong> resource has the following actions:</p> <dl> <dt><code>:join</code></dt> <dd>Join the Active Directory domain. (default)</dd> <dt><code>:leave</code></dt> <dd>Leave an Active Directory domain and re-join a workgroup.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-ad-join">Properties</h3> <hr> <p>The <strong>windows_ad_join</strong> resource has the following properties:</p> <dl> <dt> <code>domain_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the FQDN of the Active Directory domain to join if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>domain_password</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The password for the domain user. Note that this resource is set to hide sensitive information by default.</p> </dd> </dl> <dl> <dt> <code>domain_user</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The domain user that will be used to join the domain.</p> </dd> </dl> <dl> <dt> <code>new_hostname</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specifies a new hostname for the computer in the new domain.</p> <p> New in Chef Client 14.5 </p> </dd> </dl> <dl> <dt> <code>ou_path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to the Organizational Unit where the host will be placed.</p> </dd> </dl> <dl> <dt> <code>reboot</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:immediate</code> <strong>Allowed Values:</strong> <code>:delayed, :immediate, :never, :reboot_now, :request_reboot</code> <p>Controls the system reboot behavior post domain joining. Reboot immediately, after the Chef Infra Client run completes, or never. Note that a reboot is necessary for changes to take effect.</p> </dd> </dl> <dl> <dt> <code>reboot_delay</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code> <p>The amount of time (in minutes) to delay a reboot request.</p> <p> New in Chef Infra Client 16.5 </p> </dd> </dl> <dl> <dt> <code>workgroup_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specifies the name of a workgroup to which the computer is added to when it is removed from the domain. The default value is WORKGROUP. This property is only applicable to the :leave action.</p> <p> New in Chef Infra Client 15.4 </p> </dd> </dl> <br> <h3 id="functionality-windows-ad-join">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-ad-join">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-ad-join">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-ad-join">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-ad-join">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_ad_join</strong> resource in recipes:</p> <p><strong>Join a domain</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_ad_join <span style="color:#4070a0">'ad.example.org'</span> <span style="color:#007020;font-weight:700">do</span>
  domain_user <span style="color:#4070a0">'nick'</span>
  domain_password <span style="color:#4070a0">'p@ssw0rd1'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Join a domain, as <code>win-workstation</code></strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_ad_join <span style="color:#4070a0">'ad.example.org'</span> <span style="color:#007020;font-weight:700">do</span>
  domain_user <span style="color:#4070a0">'nick'</span>
  domain_password <span style="color:#4070a0">'p@ssw0rd1'</span>
  new_hostname <span style="color:#4070a0">'win-workstation'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Leave the current domain and re-join the <code>local</code> workgroup</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_ad_join <span style="color:#4070a0">'Leave domain'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:leave</span>
  workgroup <span style="color:#4070a0">'local'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-audit-policy-resource">windows_audit_policy resource</h2> <a href="windows_audit_policy/index.html">windows_audit_policy resource page</a> <hr> <p>Use the <strong>windows_audit_policy</strong> resource to configure system level and per-user Windows advanced audit policy settings.</p> <p><strong>New in Chef Infra Client 16.2.</strong></p> <h3 id="syntax-windows-audit-policy">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_audit_policy</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_audit_policy <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  audit_base_directories       <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  audit_base_objects           <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  crash_on_audit_fail          <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  exclude_user                 <span style="color:#007020">String</span>
  failure                      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  full_privilege_auditing      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  include_user                 <span style="color:#007020">String</span>
  subcategory                  <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  success                      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  action                       <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :set if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_audit_policy</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>audit_base_directories</code>, <code>audit_base_objects</code>, <code>crash_on_audit_fail</code>, <code>exclude_user</code>, <code>failure</code>, <code>full_privilege_auditing</code>, <code>include_user</code>, <code>subcategory</code>, and <code>success</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-audit-policy">Actions</h3> <hr> <p>The <strong>windows_audit_policy</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:set</code></dt> <dd>Configure an audit policy. (default)</dd> </dl> <h3 id="properties-windows-audit-policy">Properties</h3> <hr> <p>The <strong>windows_audit_policy</strong> resource has the following properties:</p> <dl> <dt> <code>audit_base_directories</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Setting this audit policy option to true will force the system to assign a System Access Control List to named objects to enable auditing of container objects such as directories.</p> </dd> </dl> <dl> <dt> <code>audit_base_objects</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Setting this audit policy option to true will force the system to assign a System Access Control List to named objects to enable auditing of base objects such as mutexes.</p> </dd> </dl> <dl> <dt> <code>crash_on_audit_fail</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Setting this audit policy option to true will cause the system to crash if the auditing system is unable to log events.</p> </dd> </dl> <dl> <dt> <code>exclude_user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The audit policy specified by the category or subcategory is applied per-user if specified. When a user is specified, exclude user. Include and exclude cannot be used at the same time.</p> </dd> </dl> <dl> <dt> <code>failure</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Specify failure auditing. By setting this property to true the resource will enable failure for the category or sub category. Success is the default and is applied if neither success nor failure are specified.</p> </dd> </dl> <dl> <dt> <code>full_privilege_auditing</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Setting this audit policy option to true will force the audit of all privilege changes except SeAuditPrivilege. Setting this property may cause the logs to fill up more quickly.</p> </dd> </dl> <dl> <dt> <code>include_user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The audit policy specified by the category or subcategory is applied per-user if specified. When a user is specified, include user. Include and exclude cannot be used at the same time.</p> </dd> </dl> <dl> <dt> <code>subcategory</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The audit policy subcategory, specified by GUID or name. Applied system-wide if no user is specified.</p> </dd> </dl> <dl> <dt> <code>success</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Specify success auditing. By setting this property to true the resource will enable success for the category or sub category. Success is the default and is applied if neither success nor failure are specified.</p> </dd> </dl> <br> <h3 id="functionality-windows-audit-policy">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-audit-policy">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-audit-policy">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-audit-policy">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-audit-policy">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_audit_policy</strong> resource in recipes:</p> <p><strong>Set Logon and Logoff policy to “Success and Failure”</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_audit_policy <span style="color:#4070a0">"Set Audit Policy for 'Logon and Logoff' actions to 'Success and Failure'"</span> <span style="color:#007020;font-weight:700">do</span>
  subcategory <span style="color:#c65d09">%w(Logon Logoff)</span>
  success <span style="color:#007020">true</span>
  failure <span style="color:#007020">true</span>
  action <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Set Credential Validation policy to “Success”</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_audit_policy <span style="color:#4070a0">"Set Audit Policy for 'Credential Validation' actions to 'Success'"</span> <span style="color:#007020;font-weight:700">do</span>
  subcategory <span style="color:#4070a0">'Credential Validation'</span>
  success <span style="color:#007020">true</span>
  failure <span style="color:#007020">false</span>
  action <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Enable CrashOnAuditFail option</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_audit_policy <span style="color:#4070a0">'Enable CrashOnAuditFail option'</span> <span style="color:#007020;font-weight:700">do</span>
  crash_on_audit_fail <span style="color:#007020">true</span>
  action <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-auto-run-resource">windows_auto_run resource</h2> <a href="windows_auto_run/index.html">windows_auto_run resource page</a> <hr> <p>Use the <strong>windows_auto_run</strong> resource to set applications to run at login.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-windows-auto-run">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_auto_run</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_auto_run <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  args              <span style="color:#007020">String</span>
  path              <span style="color:#007020">String</span>
  program_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  root              <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :machine</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_auto_run</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>args</code>, <code>path</code>, <code>program_name</code>, and <code>root</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-auto-run">Actions</h3> <hr> <p>The <strong>windows_auto_run</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create an item to be run at login. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove an item that was previously configured to run at login.</dd> </dl> <h3 id="properties-windows-auto-run">Properties</h3> <hr> <p>The <strong>windows_auto_run</strong> resource has the following properties:</p> <dl> <dt> <code>args</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Any arguments to be used with the program.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to the program that will run at login.</p> </dd> </dl> <dl> <dt> <code>program_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the program to run at login if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>root</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:machine</code> <strong>Allowed Values:</strong> <code>:machine, :user</code> <p>The registry root key to put the entry under.</p> </dd> </dl> <br> <h3 id="functionality-windows-auto-run">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-auto-run">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-auto-run">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-auto-run">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-auto-run">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_auto_run</strong> resource in recipes:</p> <p><strong>Run BGInfo at login</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_auto_run <span style="color:#4070a0">'BGINFO'</span> <span style="color:#007020;font-weight:700">do</span>
  program <span style="color:#4070a0">'C:/Sysinternals/bginfo.exe'</span>
  args    <span style="color:#4070a0">''</span><span style="color:#517918">C</span>:<span style="color:#235388">/Sysinternals/</span><span style="color:#60add5">Config</span><span style="color:#666">.</span>bgi<span style="color:#4070a0">' /NOLICPROMPT /TIMER:0'</span>
  action  <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-certificate-resource">windows_certificate resource</h2> <a href="windows_certificate/index.html">windows_certificate resource page</a> <hr> <p>Use the <strong>windows_certificate</strong> resource to install a certificate into the Windows certificate store from a file. The resource grants read-only access to the private key for designated accounts. Due to current limitations in WinRM, installing certificates remotely may not work if the operation requires a user profile. Operations on the local machine store should still work.</p> <p><strong>New in Chef Infra Client 14.7.</strong></p> <h3 id="syntax-windows-certificate">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_certificate</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_certificate <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  exportable           <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  output_path          <span style="color:#007020">String</span>
  pfx_password         <span style="color:#007020">String</span>
  private_key_acl      <span style="color:#007020">Array</span>
  source               <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  store_name           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "MY"</span>
  user_store           <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  action               <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_certificate</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>exportable</code>, <code>output_path</code>, <code>pfx_password</code>, <code>private_key_acl</code>, <code>source</code>, <code>store_name</code>, and <code>user_store</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-certificate">Actions</h3> <hr> <p>The <strong>windows_certificate</strong> resource has the following actions:</p> <dl> <dt><code>:acl_add</code></dt> <dd>Adds read-only entries to a certificate’s private key ACL.</dd> <dt><code>:create</code></dt> <dd>Creates or updates a certificate. (default)</dd> <dt><code>:delete</code></dt> <dd>Deletes a certificate.</dd> <dt><code>:fetch</code></dt> <dd>Fetches a certificate.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:verify</code></dt> <dd>Verifies a certificate and logs the result.</dd> </dl> <h3 id="properties-windows-certificate">Properties</h3> <hr> <p>The <strong>windows_certificate</strong> resource has the following properties:</p> <dl> <dt> <code>exportable</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Ensure that imported pfx certificate is exportable. Please provide ‘true’ if you want the certificate to be exportable.</p> <p> New in Chef Infra Client 16.8 </p> </dd> </dl> <dl> <dt> <code>output_path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A path on the node where a certificate object (PFX, PEM, CER, KEY, etc) can be exported to.</p> <p> New in Chef Infra Client 17.0 </p> </dd> </dl> <dl> <dt> <code>pfx_password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The password to access the object with if it is a PFX file.</p> </dd> </dl> <dl> <dt> <code>private_key_acl</code> </dt> <dd> <strong>Ruby Type:</strong> Array <p>An array of ‘domain\account’ entries to be granted read-only access to the certificate’s private key. Not idempotent.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The source file (for <code>create</code> and <code>acl_add</code>), thumbprint (for <code>delete</code>, <code>export</code>, and <code>acl_add</code>), or subject (for <code>delete</code> or <code>export</code>) if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>store_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>MY</code> <strong>Allowed Values:</strong> <code>"AUTHROOT", "CA", "CLIENTAUTHISSUER", "DISALLOWED", "MY", "REMOTE DESKTOP", "ROOT", "SMARTCARDROOT", "TRUST", "TRUSTEDDEVICES", "TRUSTEDPEOPLE", "TRUSTEDPUBLISHER", "TrustedPublisher", "WEBHOSTING"</code> <p>The certificate store to manipulate.</p> </dd> </dl> <dl> <dt> <code>user_store</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Use the <code>CurrentUser</code> store instead of the default <code>LocalMachine</code> store.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Prior to chef-client. 16.10 this property was ignored.</p> </div> </div> </dd> </dl> <br> <h3 id="functionality-windows-certificate">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-certificate">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-certificate">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-certificate">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-certificate">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_certificate</strong> resource in recipes:</p> <p><strong>Add PFX cert to local machine personal store and grant accounts read-only access to private key</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_certificate <span style="color:#4070a0">'c:/test/mycert.pfx'</span> <span style="color:#007020;font-weight:700">do</span>
  pfx_password <span style="color:#4070a0">'password'</span>
  private_key_acl <span style="color:#666">[</span><span style="color:#4070a0">"acme</span><span style="color:#4070a0;font-weight:700">\f</span><span style="color:#4070a0">red"</span>, <span style="color:#4070a0">"pc\jane"</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add cert to trusted intermediate store</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_certificate <span style="color:#4070a0">'c:/test/mycert.cer'</span> <span style="color:#007020;font-weight:700">do</span>
  store_name <span style="color:#4070a0">'CA'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove all certificates matching the subject</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_certificate <span style="color:#4070a0">'me.acme.com'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-defender-resource">windows_defender resource</h2> <a href="windows_defender/index.html">windows_defender resource page</a> <hr> <p>Use the <strong>windows_defender</strong> resource to enable or disable the Microsoft Windows Defender service.</p> <p><strong>New in Chef Infra Client 17.3.</strong></p> <h3 id="syntax-windows-defender">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_defender</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_defender <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  intrusion_protection_system      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  lock_ui                          <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  realtime_protection              <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  scan_archives                    <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  scan_email                       <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  scan_mapped_drives               <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  scan_network_files               <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  scan_removable_drives            <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  scan_scripts                     <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  action                           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :enable if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_defender</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>intrusion_protection_system</code>, <code>lock_ui</code>, <code>realtime_protection</code>, <code>scan_archives</code>, <code>scan_email</code>, <code>scan_mapped_drives</code>, <code>scan_network_files</code>, <code>scan_removable_drives</code>, and <code>scan_scripts</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-defender">Actions</h3> <hr> <p>The <strong>windows_defender</strong> resource has the following actions:</p> <dl> <dt><code>:disable</code></dt> <dd>Disable Windows Defender.</dd> <dt><code>:enable</code></dt> <dd>Enable and configure Windows Defender. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-defender">Properties</h3> <hr> <p>The <strong>windows_defender</strong> resource has the following properties:</p> <dl> <dt> <code>intrusion_protection_system</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Enable network protection against exploitation of known vulnerabilities.</p> </dd> </dl> <dl> <dt> <code>lock_ui</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Lock the UI to prevent users from changing Windows Defender settings.</p> </dd> </dl> <dl> <dt> <code>realtime_protection</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Enable realtime scanning of downloaded files and attachments.</p> </dd> </dl> <dl> <dt> <code>scan_archives</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Scan file archives such as .zip or .gz archives.</p> </dd> </dl> <dl> <dt> <code>scan_email</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Scan e-mails for malware.</p> </dd> </dl> <dl> <dt> <code>scan_mapped_drives</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Scan files on mapped network drives.</p> </dd> </dl> <dl> <dt> <code>scan_network_files</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Scan files on a network.</p> </dd> </dl> <dl> <dt> <code>scan_removable_drives</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Scan content of removable drives.</p> </dd> </dl> <dl> <dt> <code>scan_scripts</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Scan scripts in malware scans.</p> </dd> </dl> <br> <h3 id="functionality-windows-defender">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-defender">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-defender">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-defender">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-defender">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_defender</strong> resource in recipes:</p> <p><strong>Configure Windows Defender AV settings</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_defender <span style="color:#4070a0">'Configure Defender'</span> <span style="color:#007020;font-weight:700">do</span>
  realtime_protection <span style="color:#007020">true</span>
  intrusion_protection_system <span style="color:#007020">true</span>
  lock_ui <span style="color:#007020">true</span>
  scan_archives <span style="color:#007020">true</span>
  scan_scripts <span style="color:#007020">true</span>
  scan_email <span style="color:#007020">true</span>
  scan_removable_drives <span style="color:#007020">true</span>
  scan_network_files <span style="color:#007020">false</span>
  scan_mapped_drives <span style="color:#007020">false</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Disable Windows Defender AV</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_defender <span style="color:#4070a0">'Disable Defender'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:disable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-defender-exclusion-resource">windows_defender_exclusion resource</h2> <a href="windows_defender_exclusion/index.html">windows_defender_exclusion resource page</a> <hr> <p>Use the <strong>windows_defender_exclusion</strong> resource to exclude paths, processes, or file types from Windows Defender realtime protection scanning.</p> <p><strong>New in Chef Infra Client 17.3.</strong></p> <h3 id="syntax-windows-defender-exclusion">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_defender_exclusion</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_defender_exclusion <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  extensions         <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  paths              <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  process_paths      <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  action             <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_defender_exclusion</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>extensions</code>, <code>paths</code>, and <code>process_paths</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-defender-exclusion">Actions</h3> <hr> <p>The <strong>windows_defender_exclusion</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Add an exclusion to Windows Defender. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove an exclusion to Windows Defender.</dd> </dl> <h3 id="properties-windows-defender-exclusion">Properties</h3> <hr> <p>The <strong>windows_defender_exclusion</strong> resource has the following properties:</p> <dl> <dt> <code>extensions</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>[]</code> <p>File extensions to exclude from scanning.</p> </dd> </dl> <dl> <dt> <code>paths</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>[]</code> <p>File or directory paths to exclude from scanning.</p> </dd> </dl> <dl> <dt> <code>process_paths</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>[]</code> <p>Paths to executables to exclude from scanning.</p> </dd> </dl> <br> <h3 id="functionality-windows-defender-exclusion">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-defender-exclusion">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-defender-exclusion">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-defender-exclusion">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-defender-exclusion">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_defender_exclusion</strong> resource in recipes:</p> <p><strong>Add excluded items to Windows Defender scans</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_defender_exclusion <span style="color:#4070a0">'Add to things to be excluded from scanning'</span> <span style="color:#007020;font-weight:700">do</span>
  paths <span style="color:#4070a0">'c:\foo\bar, d:\bar\baz'</span>
  extensions <span style="color:#4070a0">'png, foo, ppt, doc'</span>
  process_paths <span style="color:#4070a0">'c:\windows\system32'</span>
  action <span style="color:#517918">:add</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove excluded items from Windows Defender scans</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_defender_exclusion <span style="color:#4070a0">'Remove things from the list to be excluded'</span> <span style="color:#007020;font-weight:700">do</span>
  process_paths <span style="color:#4070a0">'c:\windows\system32'</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-dfs-folder-resource">windows_dfs_folder resource</h2> <a href="windows_dfs_folder/index.html">windows_dfs_folder resource page</a> <hr> <p>Use the <strong>windows_dfs_folder</strong> resource to creates a folder within DFS as many levels deep as required.</p> <p><strong>New in Chef Infra Client 15.0.</strong></p> <h3 id="syntax-windows-dfs-folder">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_dfs_folder</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_dfs_folder <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  description         <span style="color:#007020">String</span>
  folder_path         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  namespace_name      <span style="color:#007020">String</span>
  target_path         <span style="color:#007020">String</span>
  action              <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_dfs_folder</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>description</code>, <code>folder_path</code>, <code>namespace_name</code>, and <code>target_path</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-dfs-folder">Actions</h3> <hr> <p>The <strong>windows_dfs_folder</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Creates the folder in dfs namespace. (default)</dd> <dt><code>:delete</code></dt> <dd>Deletes the folder in the dfs namespace.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-dfs-folder">Properties</h3> <hr> <p>The <strong>windows_dfs_folder</strong> resource has the following properties:</p> <dl> <dt> <code>description</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Description for the share.</p> </dd> </dl> <dl> <dt> <code>folder_path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the path of the dfs folder if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>namespace_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The namespace this should be created within.</p> </dd> </dl> <dl> <dt> <code>target_path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The target that this path will connect you to.</p> </dd> </dl> <br> <h3 id="functionality-windows-dfs-folder">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-dfs-folder">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-dfs-folder">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-dfs-folder">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-dfs-folder">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="windows-dfs-namespace-resource">windows_dfs_namespace resource</h2> <a href="windows_dfs_namespace/index.html">windows_dfs_namespace resource page</a> <hr> <p>Use the <strong>windows_dfs_namespace</strong> resource to creates a share and DFS namespace on a Windows server.</p> <p><strong>New in Chef Infra Client 15.0.</strong></p> <h3 id="syntax-windows-dfs-namespace">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_dfs_namespace</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_dfs_namespace <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  change_users        <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  description         <span style="color:#007020">String</span>
  full_users          <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: ["BUILTIN\\administrators"]</span>
  namespace_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  read_users          <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  root                <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "C:\\DFSRoots"</span>
  action              <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_dfs_namespace</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>change_users</code>, <code>description</code>, <code>full_users</code>, <code>namespace_name</code>, <code>read_users</code>, and <code>root</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-dfs-namespace">Actions</h3> <hr> <p>The <strong>windows_dfs_namespace</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Creates the dfs namespace on the server. (default)</dd> <dt><code>:delete</code></dt> <dd>Deletes a DFS Namespace including the directory on disk.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-dfs-namespace">Properties</h3> <hr> <p>The <strong>windows_dfs_namespace</strong> resource has the following properties:</p> <dl> <dt> <code>change_users</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>Determines which users should have change access to the share.</p> </dd> </dl> <dl> <dt> <code>description</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>Description of the share.</p> </dd> </dl> <dl> <dt> <code>full_users</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>["BUILTIN\\administrators"]</code> <p>Determines which users should have full access to the share.</p> </dd> </dl> <dl> <dt> <code>namespace_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the dfs namespace if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>read_users</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>Determines which users should have read access to the share.</p> </dd> </dl> <dl> <dt> <code>root</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>C:\DFSRoots</code> <p>The root from which to create the DFS tree. Defaults to C:\DFSRoots.</p> </dd> </dl> <br> <h3 id="functionality-windows-dfs-namespace">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-dfs-namespace">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-dfs-namespace">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-dfs-namespace">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-dfs-namespace">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="windows-dfs-server-resource">windows_dfs_server resource</h2> <a href="windows_dfs_server/index.html">windows_dfs_server resource page</a> <hr> <p>Use the <strong>windows_dfs_server</strong> resource to set system-wide DFS settings.</p> <p><strong>New in Chef Infra Client 15.0.</strong></p> <h3 id="syntax-windows-dfs-server">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_dfs_server</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_dfs_server <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  enable_site_costed_referrals      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  ldap_timeout_secs                 <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 30</span>
  prefer_login_dc                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  sync_interval_secs                <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 3600</span>
  use_fqdn                          <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  action                            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :configure if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_dfs_server</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>enable_site_costed_referrals</code>, <code>ldap_timeout_secs</code>, <code>prefer_login_dc</code>, <code>sync_interval_secs</code>, and <code>use_fqdn</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-dfs-server">Actions</h3> <hr> <p>The <strong>windows_dfs_server</strong> resource has the following actions:</p> <dl> <dt><code>:configure</code></dt> <dd>Configure DFS settings (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-dfs-server">Properties</h3> <hr> <p>The <strong>windows_dfs_server</strong> resource has the following properties:</p> <dl> <dt> <code>enable_site_costed_referrals</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> </dd> </dl> <dl> <dt> <code>ldap_timeout_secs</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>30</code> </dd> </dl> <dl> <dt> <code>prefer_login_dc</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> </dd> </dl> <dl> <dt> <code>sync_interval_secs</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>3600</code> </dd> </dl> <dl> <dt> <code>use_fqdn</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Indicates whether a DFS namespace server uses FQDNs in referrals. If this property is set to true, the server uses FQDNs in referrals. If this property is set to false then the server uses NetBIOS names.</p> </dd> </dl> <br> <h3 id="functionality-windows-dfs-server">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-dfs-server">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-dfs-server">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-dfs-server">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-dfs-server">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="windows-dns-record-resource">windows_dns_record resource</h2> <a href="windows_dns_record/index.html">windows_dns_record resource page</a> <hr> <p>The windows_dns_record resource creates a DNS record for the given domain.</p> <p><strong>New in Chef Infra Client 15.0.</strong></p> <h3 id="syntax-windows-dns-record">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_dns_record</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_dns_record <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  dns_server       <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "localhost"</span>
  record_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  record_type      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "ARecord"</span>
  target           <span style="color:#007020">String</span>
  zone             <span style="color:#007020">String</span>
  action           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_dns_record</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>dns_server</code>, <code>record_name</code>, <code>record_type</code>, <code>target</code>, and <code>zone</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-dns-record">Actions</h3> <hr> <p>The <strong>windows_dns_record</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Creates and updates the DNS entry. (default)</dd> <dt><code>:delete</code></dt> <dd>Deletes a DNS entry.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-dns-record">Properties</h3> <hr> <p>The <strong>windows_dns_record</strong> resource has the following properties:</p> <dl> <dt> <code>dns_server</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>localhost</code> <p>The name of the DNS server on which to create the record.</p> <p> New in Chef Infra Client 16.3 </p> </dd> </dl> <dl> <dt> <code>record_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the dns record name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>record_type</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>ARecord</code> <strong>Allowed Values:</strong> <code>"ARecord", "CNAME", "PTR"</code> <p>The type of record to create, can be either ARecord, CNAME or PTR.</p> </dd> </dl> <dl> <dt> <code>target</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The target for the record.</p> </dd> </dl> <dl> <dt> <code>zone</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The zone to create the record in.</p> </dd> </dl> <br> <h3 id="functionality-windows-dns-record">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-dns-record">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-dns-record">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-dns-record">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-dns-record">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="windows-dns-zone-resource">windows_dns_zone resource</h2> <a href="windows_dns_zone/index.html">windows_dns_zone resource page</a> <hr> <p>The windows_dns_zone resource creates an Active Directory Integrated DNS Zone on the local server.</p> <p><strong>New in Chef Infra Client 15.0.</strong></p> <h3 id="syntax-windows-dns-zone">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_dns_zone</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_dns_zone <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  replication_scope      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "Domain"</span>
  server_type            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "Domain"</span>
  zone_name              <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action                 <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_dns_zone</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>replication_scope</code>, <code>server_type</code>, and <code>zone_name</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-dns-zone">Actions</h3> <hr> <p>The <strong>windows_dns_zone</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Creates and updates a DNS Zone. (default)</dd> <dt><code>:delete</code></dt> <dd>Deletes a DNS Zone.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-dns-zone">Properties</h3> <hr> <p>The <strong>windows_dns_zone</strong> resource has the following properties:</p> <dl> <dt> <code>replication_scope</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>Domain</code> <p>The replication scope for the zone, required if server_type set to ‘Domain’.</p> </dd> </dl> <dl> <dt> <code>server_type</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>Domain</code> <strong>Allowed Values:</strong> <code>"Domain", "Standalone"</code> <p>The type of DNS server, Domain or Standalone.</p> </dd> </dl> <dl> <dt> <code>zone_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the dns zone name if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-windows-dns-zone">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-dns-zone">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-dns-zone">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-dns-zone">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-dns-zone">Examples</h3> <hr> <p>This resource does not have any examples.</p> <h2 id="windows-env-resource">windows_env resource</h2> <a href="windows_env/index.html">windows_env resource page</a> <hr> 
<p>Use the <strong>windows_env</strong> resource to manage environment keys in Microsoft Windows. After an environment key is set, Microsoft Windows must be restarted before the environment key will be available to the Task Scheduler.</p> <p>This resource was previously called the <strong>env</strong> resource; its name was updated in Chef Infra Client 14.0 to reflect the fact that only Windows is supported. Existing cookbooks using <code>env</code> will continue to function, but should be updated to use the new name.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>On UNIX-based systems, the best way to manipulate environment keys is with the <code>ENV</code> variable in Ruby; however, this approach does not have the same permanent effect as using the windows_env resource.</p> </div> </div> <h3 id="syntax-windows-env">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_env</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_env <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  delim         <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  key_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  user          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "&lt;System&gt;"</span>
  value         <span style="color:#007020">String</span>
  action        <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_env</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>delim</code>, <code>key_name</code>, <code>user</code>, and <code>value</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-env">Actions</h3> <hr> <p>The <strong>windows_env</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create an environment variable. If an environment variable already exists (but does not match), update that environment variable to match. (default)</dd> <dt><code>:delete</code></dt> <dd>Delete an environment variable.</dd> <dt><code>:modify</code></dt> <dd>Modify an existing environment variable. This prepends the new value to the existing value, using the delimiter specified by the <code>delim</code> property.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-env">Properties</h3> <hr> <p>The <strong>windows_env</strong> resource has the following properties:</p> <dl> <dt> <code>delim</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>The delimiter that is used to separate multiple values for a single key.</p> </dd> </dl> <dl> <dt> <code>key_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the name of the key that is to be created, deleted, or modified if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>&lt;System&gt;</code>  </dd> </dl> <dl> <dt> <code>value</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The value of the environmental variable to set.</p> </dd> </dl> <br> <h3 id="functionality-windows-env">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-env">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-env">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-env">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-env">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_env</strong> resource in recipes:</p> <p><strong>Set an environment variable</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_env <span style="color:#4070a0">'ComSpec'</span> <span style="color:#007020;font-weight:700">do</span>
  value <span style="color:#4070a0">'C:\Windows\system32\cmd.exe'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-feature-resource">windows_feature resource</h2> <a href="windows_feature/index.html">windows_feature resource page</a> <hr> <p>Use the <strong>windows_feature</strong> resource to add, remove or entirely delete Windows features and roles. This resource calls the <a href="windows_feature_dism/index.html">windows_feature_dism</a> or <a href="windows_feature_powershell/index.html">windows_feature_powershell</a> resources depending on the specified installation method, and defaults to DISM, which is available on both Workstation and Server editions of Windows.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-windows-feature">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_feature</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  all                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  feature_name          <span style="color:#007020">Array</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  install_method        <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :windows_feature_dism</span>
  management_tools      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  source                <span style="color:#007020">String</span>
  timeout               <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 600</span>
  action                <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_feature</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>all</code>, <code>feature_name</code>, <code>install_method</code>, <code>management_tools</code>, <code>source</code>, and <code>timeout</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-feature">Actions</h3> <hr> <p>The <strong>windows_feature</strong> resource has the following actions:</p> <dl> <dt><code>:delete</code></dt> <dd>Remove a Windows role or feature from the image.</dd> <dt><code>:install</code></dt> <dd>Install a Windows role or feature. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a Windows role or feature.</dd> </dl> <h3 id="properties-windows-feature">Properties</h3> <hr> <p>The <strong>windows_feature</strong> resource has the following properties:</p> <dl> <dt> <code>all</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Install all sub-features.</p> </dd> </dl> <dl> <dt> <code>feature_name</code> </dt> <dd> <strong>Ruby Type:</strong> Array, String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the feature(s) or role(s) to install if they differ from the resource block’s name. The same feature may have different names depending on the underlying installation method being used (ie DHCPServer vs DHCP; DNS-Server-Full-Role vs DNS).</p> </dd> </dl> <dl> <dt> <code>install_method</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:windows_feature_dism</code> <strong>Allowed Values:</strong> <code>:windows_feature_dism, :windows_feature_powershell, :windows_feature_servermanagercmd</code> <p>The underlying installation method to use for feature installation. Specify <code>:windows_feature_dism</code> for DISM or <code>:windows_feature_powershell</code> for PowerShell.</p> </dd> </dl> <dl> <dt> <code>management_tools</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Install all applicable management tools for the roles, role services, or features (PowerShell-only).</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specify a local repository for the feature install.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>600</code> <p>Specifies a timeout (in seconds) for the feature installation.</p> </dd> </dl> <br> <h3 id="functionality-windows-feature">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-feature">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-feature">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-feature">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-feature">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_feature</strong> resource in recipes:</p> <p><strong>Install the DHCP Server feature</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature <span style="color:#4070a0">'DHCPServer'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install the .Net 3.5.1 feature using repository files on DVD</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature <span style="color:#4070a0">"NetFx3"</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  source <span style="color:#4070a0">'d:\sources\sxs'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove Telnet Server and Client features</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature <span style="color:#c65d09">%w(TelnetServer TelnetClient)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add the SMTP Server feature using the PowerShell provider</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature <span style="color:#4070a0">'smtp-server'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  all <span style="color:#007020">true</span>
  install_method <span style="color:#517918">:windows_feature_powershell</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install multiple features using one resource with the PowerShell provider</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature <span style="color:#c65d09">%w(Web-Asp-Net45 Web-Net-Ext45)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  install_method <span style="color:#517918">:windows_feature_powershell</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install the Network Policy and Access Service feature, including the management tools</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature <span style="color:#4070a0">'NPAS'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  management_tools <span style="color:#007020">true</span>
  install_method <span style="color:#517918">:windows_feature_powershell</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-feature-dism-resource">windows_feature_dism resource</h2> <a href="windows_feature_dism/index.html">windows_feature_dism resource page</a> <hr> <p>Use the <strong>windows_feature_dism</strong> resource to add, remove, or entirely delete Windows features and roles using DISM.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-windows-feature-dism">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_feature_dism</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature_dism <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  all               <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  feature_name      <span style="color:#007020">Array</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  source            <span style="color:#007020">String</span>
  timeout           <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 600</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_feature_dism</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>all</code>, <code>feature_name</code>, <code>source</code>, and <code>timeout</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-feature-dism">Actions</h3> <hr> <p>The <strong>windows_feature_dism</strong> resource has the following actions:</p> <dl> <dt><code>:delete</code></dt> <dd>Remove a Windows role or feature from the image using DISM.</dd> <dt><code>:install</code></dt> <dd>Install a Windows role/feature using DISM. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a Windows role or feature using DISM.</dd> </dl> <h3 id="properties-windows-feature-dism">Properties</h3> <hr> <p>The <strong>windows_feature_dism</strong> resource has the following properties:</p> <dl> <dt> <code>all</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Install all sub-features. When set to <code>true</code>, this is the equivalent of specifying the <code>/All</code> switch to <code>dism.exe</code></p> </dd> </dl> <dl> <dt> <code>feature_name</code> </dt> <dd> <strong>Ruby Type:</strong> Array, String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the feature(s) or role(s) to install if they differ from the resource name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specify a local repository for the feature install.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>600</code> <p>Specifies a timeout (in seconds) for the feature installation.</p> </dd> </dl> <br> <h3 id="functionality-windows-feature-dism">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-feature-dism">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-feature-dism">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-feature-dism">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-feature-dism">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_feature_dism</strong> resource in recipes:</p> <p><strong>Installing the TelnetClient service</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature_dism <span style="color:#4070a0">"TelnetClient"</span>
</code></pre></div>
<p><strong>Installing two features by using an array</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature_dism <span style="color:#c65d09">%w(TelnetClient TFTP)</span>
</code></pre></div> <h2 id="windows-feature-powershell-resource">windows_feature_powershell resource</h2> <a href="windows_feature_powershell/index.html">windows_feature_powershell resource page</a> <hr> <p>Use the <strong>windows_feature_powershell</strong> resource to add, remove, or entirely delete Windows features and roles using PowerShell. This resource offers significant speed benefits over the <a href="windows_feature_dism/index.html">windows_feature_dism</a> resource, but requires installation of the Remote Server Administration Tools on non-server releases of Windows.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-windows-feature-powershell">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_feature_powershell</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature_powershell <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  all                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  feature_name          <span style="color:#007020">Array</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  management_tools      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  source                <span style="color:#007020">String</span>
  timeout               <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 600</span>
  action                <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_feature_powershell</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>all</code>, <code>feature_name</code>, <code>management_tools</code>, <code>source</code>, and <code>timeout</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-feature-powershell">Actions</h3> <hr> <p>The <strong>windows_feature_powershell</strong> resource has the following actions:</p> <dl> <dt><code>:delete</code></dt> <dd>Delete a Windows role or feature from the image using PowerShell.</dd> <dt><code>:install</code></dt> <dd>Install a Windows role or feature using PowerShell. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a Windows role or feature using PowerShell.</dd> </dl> <h3 id="properties-windows-feature-powershell">Properties</h3> <hr> <p>The <strong>windows_feature_powershell</strong> resource has the following properties:</p> <dl> <dt> <code>all</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Install all subfeatures. When set to <code>true</code>, this is the equivalent of specifying the <code>-InstallAllSubFeatures</code> switch with <code>Add-WindowsFeature</code>.</p> </dd> </dl> <dl> <dt> <code>feature_name</code> </dt> <dd> <strong>Ruby Type:</strong> Array, String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The name of the feature(s) or role(s) to install if they differ from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>management_tools</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Install all applicable management tools for the roles, role services, or features.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specify a local repository for the feature install.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>600</code> <p>Specifies a timeout (in seconds) for the feature installation.</p> </dd> </dl> <br> <h3 id="functionality-windows-feature-powershell">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-feature-powershell">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-feature-powershell">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-feature-powershell">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-feature-powershell">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_feature_powershell</strong> resource in recipes:</p> <p><strong>Add the SMTP Server feature</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature_powershell <span style="color:#4070a0">"smtp-server"</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  all <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install multiple features using one resource</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature_powershell <span style="color:#666">[</span><span style="color:#4070a0">'Web-Asp-Net45'</span>, <span style="color:#4070a0">'Web-Net-Ext45'</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install the Network Policy and Access Service feature</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_feature_powershell <span style="color:#4070a0">'NPAS'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  management_tools <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-firewall-profile-resource">windows_firewall_profile resource</h2> <a href="windows_firewall_profile/index.html">windows_firewall_profile resource page</a> <hr> <p>Use the <strong>windows_firewall_profile</strong> resource to enable, disable, and configure the Windows firewall.</p> <p><strong>New in Chef Infra Client 16.3.</strong></p> <h3 id="syntax-windows-firewall-profile">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_firewall_profile</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_firewall_profile <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  allow_inbound_rules             <span style="color:#007020">true</span>, <span style="color:#007020">false</span>, <span style="color:#007020">String</span>
  allow_local_firewall_rules      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>, <span style="color:#007020">String</span>
  allow_local_ipsec_rules         <span style="color:#007020">true</span>, <span style="color:#007020">false</span>, <span style="color:#007020">String</span>
  allow_unicast_response          <span style="color:#007020">true</span>, <span style="color:#007020">false</span>, <span style="color:#007020">String</span>
  allow_user_apps                 <span style="color:#007020">true</span>, <span style="color:#007020">false</span>, <span style="color:#007020">String</span>
  allow_user_ports                <span style="color:#007020">true</span>, <span style="color:#007020">false</span>, <span style="color:#007020">String</span>
  default_inbound_action          <span style="color:#007020">String</span>
  default_outbound_action         <span style="color:#007020">String</span>
  display_notification            <span style="color:#007020">true</span>, <span style="color:#007020">false</span>, <span style="color:#007020">String</span>
  profile                         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action                          <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :enable if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_firewall_profile</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>allow_inbound_rules</code>, <code>allow_local_firewall_rules</code>, <code>allow_local_ipsec_rules</code>, <code>allow_unicast_response</code>, <code>allow_user_apps</code>, <code>allow_user_ports</code>, <code>default_inbound_action</code>, <code>default_outbound_action</code>, <code>display_notification</code>, and <code>profile</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-firewall-profile">Actions</h3> <hr> <p>The <strong>windows_firewall_profile</strong> resource has the following actions:</p> <dl> <dt><code>:disable</code></dt> <dd>Disable a Windows Firewall profile.</dd> <dt><code>:enable</code></dt> <dd>Enable and optionally configure a Windows Firewall profile. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-firewall-profile">Properties</h3> <hr> <p>The <strong>windows_firewall_profile</strong> resource has the following properties:</p> <dl> <dt> <code>allow_inbound_rules</code> </dt> <dd> <strong>Ruby Type:</strong> true, false, String <strong>Allowed Values:</strong> <code>true, false, "NotConfigured"</code> <p>Allow users to set inbound firewall rules</p> </dd> </dl> <dl> <dt> <code>allow_local_firewall_rules</code> </dt> <dd> <strong>Ruby Type:</strong> true, false, String <strong>Allowed Values:</strong> <code>true, false, "NotConfigured"</code> <p>Merges inbound firewall rules into the policy</p> </dd> </dl> <dl> <dt> <code>allow_local_ipsec_rules</code> </dt> <dd> <strong>Ruby Type:</strong> true, false, String <strong>Allowed Values:</strong> <code>true, false, "NotConfigured"</code> <p>Allow users to manage local connection security rules</p> </dd> </dl> <dl> <dt> <code>allow_unicast_response</code> </dt> <dd> <strong>Ruby Type:</strong> true, false, String <strong>Allowed Values:</strong> <code>true, false, "NotConfigured"</code> <p>Allow unicast responses to multicast and broadcast messages</p> </dd> </dl> <dl> <dt> <code>allow_user_apps</code> </dt> <dd> <strong>Ruby Type:</strong> true, false, String <strong>Allowed Values:</strong> <code>true, false, "NotConfigured"</code> <p>Allow user applications to manage firewall</p> </dd> </dl> <dl> <dt> <code>allow_user_ports</code> </dt> <dd> <strong>Ruby Type:</strong> true, false, String <strong>Allowed Values:</strong> <code>true, false, "NotConfigured"</code> <p>Allow users to manage firewall port rules</p> </dd> </dl> <dl> <dt> <code>default_inbound_action</code> </dt> <dd> <strong>Ruby Type:</strong> String <strong>Allowed Values:</strong> <code>"Allow", "Block", "NotConfigured"</code> <p>Set the default policy for inbound network traffic</p> </dd> </dl> <dl> <dt> <code>default_outbound_action</code> </dt> <dd> <strong>Ruby Type:</strong> String <strong>Allowed Values:</strong> <code>"Allow", "Block", "NotConfigured"</code> <p>Set the default policy for outbound network traffic</p> </dd> </dl> <dl> <dt> <code>display_notification</code> </dt> <dd> <strong>Ruby Type:</strong> true, false, String <strong>Allowed Values:</strong> <code>true, false, "NotConfigured"</code> <p>Display a notification when firewall blocks certain activity</p> </dd> </dl> <dl> <dt> <code>profile</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <strong>Allowed Values:</strong> <code>"Domain", "Private", "Public"</code> <p>Set the Windows Profile being configured</p> </dd> </dl> <br> <h3 id="functionality-windows-firewall-profile">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-firewall-profile">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-firewall-profile">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-firewall-profile">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-firewall-profile">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_firewall_profile</strong> resource in recipes:</p> <p><strong>Enable and Configure the Private Profile of the Windows Profile</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_firewall_profile <span style="color:#4070a0">'Private'</span> <span style="color:#007020;font-weight:700">do</span>
  default_inbound_action <span style="color:#4070a0">'Block'</span>
  default_outbound_action <span style="color:#4070a0">'Allow'</span>
  allow_inbound_rules <span style="color:#007020">true</span>
  display_notification <span style="color:#007020">false</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Enable and Configure the Public Profile of the Windows Firewall</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_firewall_profile <span style="color:#4070a0">'Public'</span> <span style="color:#007020;font-weight:700">do</span>
  default_inbound_action <span style="color:#4070a0">'Block'</span>
  default_outbound_action <span style="color:#4070a0">'Allow'</span>
  allow_inbound_rules <span style="color:#007020">false</span>
  display_notification <span style="color:#007020">false</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Disable the Domain Profile of the Windows Firewall</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_firewall_profile <span style="color:#4070a0">'Disable the Domain Profile of the Windows Firewall'</span> <span style="color:#007020;font-weight:700">do</span>
  profile <span style="color:#4070a0">'Domain'</span>
  action <span style="color:#517918">:disable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-firewall-rule-resource">windows_firewall_rule resource</h2> <a href="windows_firewall_rule/index.html">windows_firewall_rule resource page</a> <hr> <p>Use the <strong>windows_firewall_rule</strong> resource to create, change or remove Windows firewall rules.</p> <p><strong>New in Chef Infra Client 14.7.</strong></p> <h3 id="syntax-windows-firewall-rule">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_firewall_rule</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_firewall_rule <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  description          <span style="color:#007020">String</span>
  direction            <span style="color:#60add5">Symbol</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: :inbound</span>
  displayname          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: The rule_name property value.</span>
  enabled              <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  firewall_action      <span style="color:#60add5">Symbol</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: :allow</span>
  group                <span style="color:#007020">String</span>
  icmp_type            <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: "Any"</span>
  interface_type       <span style="color:#60add5">Symbol</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: :any</span>
  local_address        <span style="color:#007020">String</span>
  local_port           <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span>
  profile              <span style="color:#60add5">Symbol</span>, <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: :any</span>
  program              <span style="color:#007020">String</span>
  protocol             <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "TCP"</span>
  remote_address       <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  remote_port          <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span>
  rule_name            <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  service              <span style="color:#007020">String</span>
  action               <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_firewall_rule</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>description</code>, <code>direction</code>, <code>displayname</code>, <code>enabled</code>, <code>firewall_action</code>, <code>group</code>, <code>icmp_type</code>, <code>interface_type</code>, <code>local_address</code>, <code>local_port</code>, <code>profile</code>, <code>program</code>, <code>protocol</code>, <code>remote_address</code>, <code>remote_port</code>, <code>rule_name</code>, and <code>service</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-firewall-rule">Actions</h3> <hr> <p>The <strong>windows_firewall_rule</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create a Windows firewall entry. (default)</dd> <dt><code>:delete</code></dt> <dd>Delete an existing Windows firewall entry.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-firewall-rule">Properties</h3> <hr> <p>The <strong>windows_firewall_rule</strong> resource has the following properties:</p> <dl> <dt> <code>description</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The description to assign to the firewall rule.</p> </dd> </dl> <dl> <dt> <code>direction</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, String | <strong>Default Value:</strong> <code>:inbound</code> <strong>Allowed Values:</strong> <code>:inbound, :outbound</code> <p>The direction of the firewall rule. Direction means either inbound or outbound traffic.</p> </dd> </dl> <dl> <dt> <code>displayname</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The rule_name property value.</code> <p>The displayname to assign to the firewall rule.</p> <p> New in Chef Infra Client 16.0 </p> </dd> </dl> <dl> <dt> <code>enabled</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Whether or not to enable the firewall rule.</p> </dd> </dl> <dl> <dt> <code>firewall_action</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, String | <strong>Default Value:</strong> <code>:allow</code> <strong>Allowed Values:</strong> <code>:allow, :block, :notconfigured</code> <p>The action of the firewall rule.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specifies that only matching firewall rules of the indicated group association are copied.</p> <p> New in Chef Infra Client 16.0 </p> </dd> </dl> <dl> <dt> <code>icmp_type</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>Any</code> <p>Specifies the ICMP Type parameter for using a protocol starting with ICMP</p> <p> New in Chef Infra Client 16.0 </p> </dd> </dl> <dl> <dt> <code>interface_type</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, String | <strong>Default Value:</strong> <code>:any</code> <strong>Allowed Values:</strong> <code>:any, :remoteaccess, :wired, :wireless</code> <p>The interface type the firewall rule applies to.</p> </dd> </dl> <dl> <dt> <code>local_address</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The local address the firewall rule applies to.</p> </dd> </dl> <dl> <dt> <code>local_port</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer, Array <p>The local port the firewall rule applies to.</p> </dd> </dl> <dl> <dt> <code>profile</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, String, Array | <strong>Default Value:</strong> <code>:any</code> <p>The profile the firewall rule applies to.</p> </dd> </dl> <dl> <dt> <code>program</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The program the firewall rule applies to.</p> </dd> </dl> <dl> <dt> <code>protocol</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>TCP</code> <p>The protocol the firewall rule applies to.</p> </dd> </dl> <dl> <dt> <code>remote_address</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The remote address(es) the firewall rule applies to.</p> </dd> </dl> <dl> <dt> <code>remote_port</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer, Array <p>The remote port the firewall rule applies to.</p> </dd> </dl> <dl> <dt> <code>rule_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the name of the firewall rule to assign if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>service</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The service the firewall rule applies to.</p> </dd> </dl> <br> <h3 id="functionality-windows-firewall-rule">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-firewall-rule">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-firewall-rule">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-firewall-rule">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-firewall-rule">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_firewall_rule</strong> resource in recipes:</p> <p><strong>Allowing port 80 access</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_firewall_rule <span style="color:#4070a0">'IIS'</span> <span style="color:#007020;font-weight:700">do</span>
  local_port <span style="color:#4070a0">'80'</span>
  protocol <span style="color:#4070a0">'TCP'</span>
  firewall_action <span style="color:#517918">:allow</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Configuring multiple remote-address ports on a rule</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_firewall_rule <span style="color:#4070a0">'MyRule'</span> <span style="color:#007020;font-weight:700">do</span>
  description          <span style="color:#4070a0">'Testing out remote address arrays'</span>
  enabled              <span style="color:#007020">false</span>
  local_port           <span style="color:#40a070">1434</span>
  remote_address       <span style="color:#c65d09">%w(10.17.3.101 172.7.7.53)</span>
  protocol             <span style="color:#4070a0">'TCP'</span>
  action               <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Allow protocol ICMPv6 with ICMP Type</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_firewall_rule <span style="color:#4070a0">'CoreNet-Rule'</span> <span style="color:#007020;font-weight:700">do</span>
  rule_name <span style="color:#4070a0">'CoreNet-ICMP6-LR2-In'</span>
  display_name <span style="color:#4070a0">'Core Networking - Multicast Listener Report v2 (ICMPv6-In)'</span>
  local_port <span style="color:#4070a0">'RPC'</span>
  protocol <span style="color:#4070a0">'ICMPv6'</span>
  icmp_type <span style="color:#4070a0">'8'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Blocking WinRM over HTTP on a particular IP</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_firewall_rule <span style="color:#4070a0">'Disable WinRM over HTTP'</span> <span style="color:#007020;font-weight:700">do</span>
  local_port <span style="color:#4070a0">'5985'</span>
  protocol <span style="color:#4070a0">'TCP'</span>
  firewall_action <span style="color:#517918">:block</span>
  local_address <span style="color:#4070a0">'192.168.1.1'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Deleting an existing rule</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_firewall_rule <span style="color:#4070a0">'Remove the SSH rule'</span> <span style="color:#007020;font-weight:700">do</span>
  rule_name <span style="color:#4070a0">'ssh'</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-font-resource">windows_font resource</h2> <a href="windows_font/index.html">windows_font resource page</a> <hr> <p>Use the <strong>windows_font</strong> resource to install font files on Windows. By default, the font is sourced from the cookbook using the resource, but a URI source can be specified as well.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-windows-font">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_font</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_font <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  font_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  source         <span style="color:#007020">String</span>
  action         <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_font</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>font_name</code> and <code>source</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-font">Actions</h3> <hr> <p>The <strong>windows_font</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Install a font to the system fonts directory. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-font">Properties</h3> <hr> <p>The <strong>windows_font</strong> resource has the following properties:</p> <dl> <dt> <code>font_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the name of the font to install if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A local filesystem path or URI that is used to source the font file.</p> </dd> </dl> <br> <h3 id="functionality-windows-font">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-font">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-font">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-font">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-font">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_font</strong> resource in recipes:</p> <p><strong>Install a font from a https source</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_font <span style="color:#4070a0">'Custom.otf'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'https://example.com/Custom.otf'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-package-resource">windows_package resource</h2> <a href="windows_package/index.html">windows_package resource page</a> <hr> 
<p>Use the <strong>windows_package</strong> resource to manage packages on the Microsoft Windows platform. The <strong>windows_package</strong> resource supports these installer formats:</p> <ul> <li>Microsoft Installer Package (MSI)</li> <li>Nullsoft Scriptable Install System (NSIS)</li> <li>Inno Setup (inno)</li> <li>Wise</li> <li>InstallShield</li> <li>Custom installers such as installing a non-.msi file that embeds an .msi-based installer</li> </ul> <p>To enable idempotence of the <code>:install</code> action or to enable the <code>:remove</code> action with no source property specified, <code>package_name</code> MUST be an exact match of the name used by the package installer. The names of installed packages Windows knows about can be found in <strong>Add/Remove programs</strong>, in the output of <code>ohai packages</code>, or in the <code>DisplayName</code> property in one of the following in the Windows registry:</p> <ul> <li><code>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Uninstall</code></li> <li><code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Uninstall</code></li> <li><code>HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall</code></li> </ul> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If there are multiple versions of a package installed with the same display name, all of those packages will be removed unless a version is provided in the <strong>version</strong> property or unless it can be discovered in the installer file specified by the <strong>source</strong> property.</p> </div> </div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <h3 id="syntax-windows-package">Syntax</h3> <hr> 
<p>A <strong>windows_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>windows_package</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_package <span style="color:#4070a0">'package_name'</span>
</code></pre></div>
<p>which will install the named package using all of the default options and the default action (<code>:install</code>).</p> <p>The full syntax for all of the properties that are available to the <strong>windows_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  checksum                    <span style="color:#007020">String</span>
  installer_type              <span style="color:#60add5">Symbol</span>
  options                     <span style="color:#007020">String</span>
  package_name                <span style="color:#007020">String</span>
  remote_file_attributes      <span style="color:#60add5">Hash</span>
  returns                     <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>, <span style="color:#007020">Array</span>
  source                      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "The resource block's name"</span>
  timeout                     <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: "600 (seconds)"</span>
  version                     <span style="color:#007020">String</span>
  action                      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>checksum</code>, <code>installer_type</code>, <code>options</code>, <code>package_name</code>, <code>remote_file_attributes</code>, <code>returns</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-package">Actions</h3> <hr> <p>The <strong>windows_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> </dl> <h3 id="properties-windows-package">Properties</h3> <hr> <p>The <strong>windows_package</strong> resource has the following properties:</p> <dl> <dt> <code>checksum</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The SHA-256 checksum of the file. Use to prevent a file from being re-downloaded. When the local file matches the checksum, Chef Infra Client does not download it. Use when a URL is specified by the <code>source</code> property.</p> </dd> </dl> <dl> <dt> <code>installer_type</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol <strong>Allowed Values:</strong> <code>:custom, :inno, :installshield, :msi, :nsis, :wise</code> <p>A symbol that specifies the type of package. Possible values: <code>:custom</code> (such as installing a non-.msi file that embeds an .msi-based installer), <code>:inno</code> (Inno Setup), <code>:installshield</code> (InstallShield), <code>:msi</code> (Microsoft Installer Package (MSI)), <code>:nsis</code> (Nullsoft Scriptable Install System (NSIS)), <code>:wise</code> (Wise).</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>One (or more) additional options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>remote_file_attributes</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>This property allows you to define a hash of properties and their value if the source package to be installed is at a remote location. This hash will be used by the underlying <strong>remote_file</strong> resource which will fetch the source package.</p> </dd> </dl> <dl> <dt> <code>returns</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer, Array of integers | <strong>Default Value:</strong> <code>0 (success) and 3010 (success where a reboot is necessary)</code> <p>A comma-delimited list of return codes that indicate the success or failure of the package command that was run.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> 
<p>The path to a package in the local file system. The location of the package may be at a URL.</p> <p>If the <code>source</code> property is not specified, the package name MUST be exactly the same as the display name found in <strong>Add/Remove programs</strong> or exactly the same as the <code>DisplayName</code> property in the appropriate registry key, which may be one of the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60add5">HKEY_LOCAL_MACHINE</span>\<span style="color:#60add5">Software</span>\<span style="color:#60add5">Microsoft</span>\<span style="color:#60add5">Windows</span>\<span style="color:#60add5">CurrentVersion</span>\<span style="color:#60add5">Uninstall</span>
<span style="color:#60add5">HKEY_CURRENT_USER</span>\<span style="color:#60add5">Software</span>\<span style="color:#60add5">Microsoft</span>\<span style="color:#60add5">Windows</span>\<span style="color:#60add5">CurrentVersion</span>\<span style="color:#60add5">Uninstall</span>
<span style="color:#60add5">HKEY_LOCAL_MACHINE</span>\<span style="color:#60add5">Software</span>\<span style="color:#60add5">Wow6432Node</span>\<span style="color:#60add5">Microsoft</span>\<span style="color:#60add5">Windows</span>\<span style="color:#60add5">CurrentVersion</span>\<span style="color:#60add5">Uninstall</span>
</code></pre></div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If there are multiple versions of a package installed with the same display name, all of those packages will be removed unless a version is provided in the <code>version</code> property or unless it can be discovered in the installer file specified by the <code>source</code> property.</p> </div> </div> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>600 (seconds)</code> <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <br> <h3 id="functionality-windows-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_package</strong> resource in recipes:</p> <p><strong>Install a package</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_package <span style="color:#4070a0">'7zip'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  source <span style="color:#4070a0">'C:\7z920.msi'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Specify a URL for the source attribute</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_package <span style="color:#4070a0">'7zip'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'http://www.7-zip.org/a/7z938-x64.msi'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Specify path and checksum</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_package <span style="color:#4070a0">'7zip'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'http://www.7-zip.org/a/7z938-x64.msi'</span>
  checksum <span style="color:#4070a0">'7c8e873991c82ad9cfc123415254ea6101e9a645e12977dcd518979e50fdedf3'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Modify remote_file resource attributes</strong>:</p> <p>The windows_package resource may specify a package at a remote location using the remote_file_attributes property. This uses the remote_file resource to download the contents at the specified URL and passes in a Hash that modifies the properties of the remote_file resource.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_package <span style="color:#4070a0">'7zip'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'http://www.7-zip.org/a/7z938-x64.msi'</span>
  remote_file_attributes ({
    <span style="color:#517918">:path</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'C:\7zip.msi'</span>,
    <span style="color:#517918">:checksum</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'7c8e873991c82ad9cfc123415254ea6101e9a645e12977dcd518979e50fdedf3'</span>
  })
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Download a nsis (Nullsoft) package resource</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_package <span style="color:#4070a0">'Mercurial 3.6.1 (64-bit)'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'http://mercurial.selenic.com/release/windows/Mercurial-3.6.1-x64.exe'</span>
  checksum <span style="color:#4070a0">'febd29578cb6736163d232708b834a2ddd119aa40abc536b2c313fc5e1b5831d'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Download a custom package</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_package <span style="color:#4070a0">'Microsoft Visual C++ 2005 Redistributable'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'https://download.microsoft.com/download/6/B/B/6BB661D6-A8AE-4819-B79F-236472F6070C/vcredist_x86.exe'</span>
  installer_type <span style="color:#517918">:custom</span>
  options <span style="color:#4070a0">'/Q'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-pagefile-resource">windows_pagefile resource</h2> <a href="windows_pagefile/index.html">windows_pagefile resource page</a> <hr> <p>Use the <strong>windows_pagefile</strong> resource to configure pagefile settings on Windows.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-windows-pagefile">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_pagefile</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_pagefile <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  automatic_managed      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  initial_size           <span style="color:#007020">Integer</span>
  maximum_size           <span style="color:#007020">Integer</span>
  path                   <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  system_managed         <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  action                 <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :set if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_pagefile</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>automatic_managed</code>, <code>initial_size</code>, <code>maximum_size</code>, <code>path</code>, and <code>system_managed</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-pagefile">Actions</h3> <hr> <p>The <strong>windows_pagefile</strong> resource has the following actions:</p> <dl> <dt><code>:delete</code></dt> <dd>Deletes the specified pagefile.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:set</code></dt> <dd>Configures the default pagefile, creating if it doesn’t exist. (default)</dd> </dl> <h3 id="properties-windows-pagefile">Properties</h3> <hr> <p>The <strong>windows_pagefile</strong> resource has the following properties:</p> <dl> <dt> <code>automatic_managed</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Enable automatic management of pagefile initial and maximum size. Setting this to true ignores <code>initial_size</code> and <code>maximum_size</code> properties.</p> </dd> </dl> <dl> <dt> <code>initial_size</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>Initial size of the pagefile in megabytes.</p> </dd> </dl> <dl> <dt> <code>maximum_size</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>Maximum size of the pagefile in megabytes.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the pagefile name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>system_managed</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Configures whether the system manages the pagefile size.</p> </dd> </dl> <br> <h3 id="functionality-windows-pagefile">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-pagefile">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-pagefile">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-pagefile">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-pagefile">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_pagefile</strong> resource in recipes:</p> <p><strong>Set the system to manage pagefiles</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_pagefile <span style="color:#4070a0">'Enable automatic management of pagefiles'</span> <span style="color:#007020;font-weight:700">do</span>
  automatic_managed <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Delete a pagefile</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_pagefile <span style="color:#4070a0">'Delete the pagefile'</span> <span style="color:#007020;font-weight:700">do</span>
  path <span style="color:#4070a0">'C'</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Switch to system managed pagefiles</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_pagefile <span style="color:#4070a0">'Change the pagefile to System Managed'</span> <span style="color:#007020;font-weight:700">do</span>
  path <span style="color:#4070a0">'E:'</span>
  system_managed <span style="color:#007020">true</span>
  action <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a pagefile with an initial and maximum size</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_pagefile <span style="color:#4070a0">'create the pagefile with these sizes'</span> <span style="color:#007020;font-weight:700">do</span>
  path <span style="color:#4070a0">'f:'</span>
  initial_size <span style="color:#40a070">100</span>
  maximum_size <span style="color:#40a070">200</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-path-resource">windows_path resource</h2> <a href="windows_path/index.html">windows_path resource page</a> <hr> <p>Use the <strong>windows_path</strong> resource to manage the path environment variable on Microsoft Windows.</p> <p><strong>New in Chef Infra Client 13.4.</strong></p> <h3 id="syntax-windows-path">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_path</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_path <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  path      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action    <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_path</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>path</code> is the property available to this resource.</li> </ul> <h3 id="actions-windows-path">Actions</h3> <hr> <p>The <strong>windows_path</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Add an item to the system path. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove an item from the system path.</dd> </dl> <h3 id="properties-windows-path">Properties</h3> <hr> <p>The <strong>windows_path</strong> resource has the following properties:</p> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the path value if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-windows-path">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-path">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-path">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-path">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-path">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_path</strong> resource in recipes:</p> <p><strong>Add Sysinternals to the system path</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_path <span style="color:#4070a0">'C:\Sysinternals'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:add</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove 7-Zip from the system path</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_path <span style="color:#4070a0">'C:\7-Zip'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-printer-resource">windows_printer resource</h2> <a href="windows_printer/index.html">windows_printer resource page</a> <hr> <p>Use the <strong>windows_printer</strong> resource to setup Windows printers. This resource will automatically install the driver specified in the <code>driver_name</code> property and will automatically create a printer port using either the <code>ipv4_address</code> property or the <code>port_name</code> property.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-windows-printer">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_printer</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_printer <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  comment           <span style="color:#007020">String</span>
  create_port       <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  default           <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  device_id         <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  driver_name       <span style="color:#007020">String</span>
  ipv4_address      <span style="color:#007020">String</span>
  location          <span style="color:#007020">String</span>
  port_name         <span style="color:#007020">String</span>
  share_name        <span style="color:#007020">String</span>
  shared            <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_printer</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>comment</code>, <code>create_port</code>, <code>default</code>, <code>device_id</code>, <code>driver_name</code>, <code>ipv4_address</code>, <code>location</code>, <code>port_name</code>, <code>share_name</code>, and <code>shared</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-printer">Actions</h3> <hr> <p>The <strong>windows_printer</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create a new printer and printer port, if one doesn’t already. (default)</dd> <dt><code>:delete</code></dt> <dd>Delete an existing printer. Note that this resource does not delete the associated printer port.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-printer">Properties</h3> <hr> <p>The <strong>windows_printer</strong> resource has the following properties:</p> <dl> <dt> <code>comment</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Optional descriptor for the printer queue.</p> </dd> </dl> <dl> <dt> <code>create_port</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Create a printer port for the printer. Set this to false and specify the <code>port_name</code> property if using the <code>windows_printer_port</code> resource to create the port instead.</p> <p> New in Chef Infra Client 17.3 </p> </dd> </dl> <dl> <dt> <code>default</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Determines whether or not this should be the system’s default printer.</p> </dd> </dl> <dl> <dt> <code>device_id</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the printer queue name if it differs from the resource block’s name. Example: <code>HP LJ 5200 in fifth floor copy room</code>.</p> </dd> </dl> <dl> <dt> <code>driver_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The exact name of printer driver installed on the system.</p> </dd> </dl> <dl> <dt> <code>ipv4_address</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The IPv4 address of the printer, such as <code>10.4.64.23</code></p> </dd> </dl> <dl> <dt> <code>location</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Printer location, such as <code>Fifth floor copy room</code>.</p> </dd> </dl> <dl> <dt> <code>port_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block name or the ipv4_address prepended with IP_.</code> <p>The port name.</p> <p> New in Chef Infra Client 17.3 </p> </dd> </dl> <dl> <dt> <code>share_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name used to identify the shared printer.</p> </dd> </dl> <dl> <dt> <code>shared</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Determines whether or not the printer is shared.</p> </dd> </dl> <br> <h3 id="functionality-windows-printer">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-printer">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-printer">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-printer">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-printer">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_printer</strong> resource in recipes:</p> <p><strong>Create a printer</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_printer <span style="color:#4070a0">'HP LaserJet 5th Floor'</span> <span style="color:#007020;font-weight:700">do</span>
  driver_name <span style="color:#4070a0">'HP LaserJet 4100 Series PCL6'</span>
  ipv4_address <span style="color:#4070a0">'10.4.64.38'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Delete a printer</strong>:</p> <p>Note: this doesn’t delete the associated printer port. See windows_printer_port above for how to delete the port.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_printer <span style="color:#4070a0">'HP LaserJet 5th Floor'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a printer port and a printer that uses that port (new in 17.3)</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_printer_port <span style="color:#4070a0">'10.4.64.39'</span> <span style="color:#007020;font-weight:700">do</span>
  port_name <span style="color:#4070a0">'My awesome printer port'</span>
  snmp_enabled <span style="color:#007020">true</span>
  port_protocol <span style="color:#40a070">2</span>
<span style="color:#007020;font-weight:700">end</span>

windows_printer <span style="color:#4070a0">'HP LaserJet 5th Floor'</span> <span style="color:#007020;font-weight:700">do</span>
  driver_name <span style="color:#4070a0">'HP LaserJet 4100 Series PCL6'</span>
  port_name <span style="color:#4070a0">'My awesome printer port'</span>
  ipv4_address <span style="color:#4070a0">'10.4.64.38'</span>
  create_port <span style="color:#007020">false</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-printer-port-resource">windows_printer_port resource</h2> <a href="windows_printer_port/index.html">windows_printer_port resource page</a> <hr> <p>Use the <strong>windows_printer_port</strong> resource to create and delete TCP/IPv4 printer ports on Windows.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-windows-printer-port">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_printer_port</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_printer_port <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  ipv4_address       <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  port_name          <span style="color:#007020">String</span>
  port_number        <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 9100</span>
  port_protocol      <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 1</span>
  snmp_enabled       <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  action             <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_printer_port</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>ipv4_address</code>, <code>port_name</code>, <code>port_number</code>, <code>port_protocol</code>, and <code>snmp_enabled</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-printer-port">Actions</h3> <hr> <p>The <strong>windows_printer_port</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create or update the printer port. (default)</dd> <dt><code>:delete</code></dt> <dd>Delete an existing printer port.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-printer-port">Properties</h3> <hr> <p>The <strong>windows_printer_port</strong> resource has the following properties:</p> <dl> <dt> <code>ipv4_address</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property for the IPv4 address of the printer if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>port_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block name or the ipv4_address prepended with IP_.</code> <p>The port name.</p> </dd> </dl> <dl> <dt> <code>port_number</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>9100</code> <p>The TCP port number.</p> </dd> </dl> <dl> <dt> <code>port_protocol</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>1</code> <strong>Allowed Values:</strong> <code>1, 2</code> <p>The printer port protocol: 1 (RAW) or 2 (LPR).</p> </dd> </dl> <dl> <dt> <code>snmp_enabled</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Determines if SNMP is enabled on the port.</p> </dd> </dl> <br> <h3 id="functionality-windows-printer-port">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-printer-port">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-printer-port">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-printer-port">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-printer-port">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_printer_port</strong> resource in recipes:</p> <p><strong>Delete a printer port</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_printer_port <span style="color:#4070a0">'10.4.64.37'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Delete a port with a custom port_name</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_printer_port <span style="color:#4070a0">'10.4.64.38'</span> <span style="color:#007020;font-weight:700">do</span>
  port_name <span style="color:#4070a0">'My awesome port'</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a port with more options</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_printer_port <span style="color:#4070a0">'10.4.64.39'</span> <span style="color:#007020;font-weight:700">do</span>
  port_name <span style="color:#4070a0">'My awesome port'</span>
  snmp_enabled <span style="color:#007020">true</span>
  port_protocol <span style="color:#40a070">2</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-security-policy-resource">windows_security_policy resource</h2> <a href="windows_security_policy/index.html">windows_security_policy resource page</a> <hr> <p>Use the <strong>windows_security_policy</strong> resource to set a security policy on the Microsoft Windows platform.</p> <p><strong>New in Chef Infra Client 16.0.</strong></p> <h3 id="syntax-windows-security-policy">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_security_policy</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_security_policy <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  secoption      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  secvalue       <span style="color:#007020">String</span>
  action         <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :set if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_security_policy</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>secoption</code> and <code>secvalue</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-security-policy">Actions</h3> <hr> <p>The <strong>windows_security_policy</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:set</code></dt> <dd>Set the Windows security policy (default)</dd> </dl> <h3 id="properties-windows-security-policy">Properties</h3> <hr> <p>The <strong>windows_security_policy</strong> resource has the following properties:</p> <dl> <dt> <code>secoption</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> | <code>REQUIRED</code> <strong>Allowed Values:</strong> <code>"AuditPolicyChange", "ClearTextPassword", "EnableAdminAccount", "EnableGuestAccount", "ForceLogoffWhenHourExpire", "LSAAnonymousNameLookup", "LockoutBadCount", "LockoutDuration", "LockoutDuration", "MaximumPasswordAge", "MinimumPasswordAge", "MinimumPasswordLength", "NewAdministratorName", "NewGuestName", "PasswordComplexity", "PasswordHistorySize", "RequireLogonToChangePassword", "ResetLockoutCount"</code> <p>The name of the policy to be set on windows platform to maintain its security.</p> </dd> </dl> <dl> <dt> <code>secvalue</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>Policy value to be set for policy name.</p> </dd> </dl> <br> <h3 id="functionality-windows-security-policy">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-security-policy">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-security-policy">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-security-policy">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-security-policy">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_security_policy</strong> resource in recipes:</p> <p><strong>Set Administrator Account to Enabled</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_security_policy <span style="color:#4070a0">'EnableAdminAccount'</span> <span style="color:#007020;font-weight:700">do</span>
  secvalue       <span style="color:#4070a0">'1'</span>
  action         <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Rename Administrator Account</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_security_policy <span style="color:#4070a0">'NewAdministratorName'</span> <span style="color:#007020;font-weight:700">do</span>
  secvalue       <span style="color:#4070a0">'AwesomeChefGuy'</span>
  action         <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Set Guest Account to Disabled</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_security_policy <span style="color:#4070a0">'EnableGuestAccount'</span> <span style="color:#007020;font-weight:700">do</span>
  secvalue       <span style="color:#4070a0">'0'</span>
  action         <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-service-resource">windows_service resource</h2> <a href="windows_service/index.html">windows_service resource page</a> <hr> <p>Use the <strong>windows_service</strong> resource to create, delete, or manage a service on the Microsoft Windows platform.</p> <h3 id="syntax-windows-service">Syntax</h3> <hr> 
<p>A <strong>windows_service</strong> resource block manages the state of a service on a machine that is running Microsoft Windows. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_service <span style="color:#4070a0">'BITS'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:configure_startup</span>
  startup_type <span style="color:#517918">:manual</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>The full syntax for all of the properties that are available to the <strong>windows_service</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_service <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  binary_path_name      <span style="color:#007020">String</span>
  delayed_start         <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  dependencies          <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  description           <span style="color:#007020">String</span>
  desired_access        <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 983551</span>
  display_name          <span style="color:#007020">String</span>
  error_control         <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 1</span>
  init_command          <span style="color:#007020">String</span>
  load_order_group      <span style="color:#007020">String</span>
  pattern               <span style="color:#007020">String</span>
  reload_command        <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  restart_command       <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  run_as_password       <span style="color:#007020">String</span>
  run_as_user           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "LocalSystem"</span>
  service_name          <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  service_type          <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: "SERVICE_WIN32_OWN_PROCESS"</span>
  start_command         <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  startup_type          <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :automatic</span>
  status_command        <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  stop_command          <span style="color:#007020">String</span>, <span style="color:#007020">false</span>
  supports              <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {"restart"=&gt;nil, "reload"=&gt;nil, "status"=&gt;nil}</span>
  timeout               <span style="color:#007020">Integer</span>
  action                <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :nothing if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_service</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>binary_path_name</code>, <code>display_name</code>, <code>desired_access</code>, <code>delayed_start</code>, <code>dependencies</code>, <code>description</code>, <code>error_control</code>, <code>init_command</code>, <code>load_order_group</code>, <code>pattern</code>, <code>reload_command</code>, <code>restart_command</code>, <code>run_as_password</code>, <code>run_as_user</code>, <code>service_name</code>, <code>service_type</code>, <code>start_command</code>, <code>startup_type</code>, <code>status_command</code>, <code>stop_command</code>, <code>supports</code>, and <code>timeout</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="actions-windows-service">Actions</h3> <hr> <p>The <strong>windows_service</strong> resource has the following actions:</p> <dl> <dt><code>:configure</code></dt> <dd>Configure a pre-existing service. <em>New in Chef Client 14.0.</em>
</dd> <dt><code>:configure_startup</code></dt> <dd>Configure a service based on the value of the <code>startup_type</code> property.</dd> <dt><code>:create</code></dt> <dd>Create the service based on the value of the <code>binary_path_name</code>, <code>service_name</code> and/or <code>display_name</code> property. <em>New in Chef Client 14.0.</em>
</dd> <dt><code>:delete</code></dt> <dd>Delete the service based on the value of the <code>service_name</code> property. <em>New in Chef Client 14.0.</em>
</dd> <dt><code>:disable</code></dt> <dd>Disable a service. This action is equivalent to a <code>Disabled</code> startup type on the Microsoft Windows platform.</dd> <dt><code>:enable</code></dt> <dd>Enable a service at boot. This action is equivalent to an <code>Automatic</code> startup type on the Microsoft Windows platform.</dd> <dt><code>:nothing</code></dt> <dd>Default. Do nothing with a service.</dd> <dt><code>:reload</code></dt> <dd>Reload the configuration for this service. This action is not supported on the Windows platform and will raise an error if used.</dd> <dt><code>:restart</code></dt> <dd>Restart a service.</dd> <dt><code>:start</code></dt> <dd>Start a service, and keep it running until stopped or disabled.</dd> <dt><code>:stop</code></dt> <dd>Stop a service.</dd> </dl> <h3 id="properties-windows-service">Properties</h3> <hr> <p>The <strong>windows_service</strong> resource has the following properties:</p> <dl> <dt> <code>binary_path_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The fully qualified path to the service binary file. The path can also include arguments for an auto-start service. This is required for <code>:create</code> and <code>:configure</code> actions</p> <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>delayed_start</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Set the startup type to delayed start. This only applies if <code>startup_type</code> is <code>:automatic</code></p> <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>dependencies</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>A pointer to a double null-terminated array of null-separated names of services or load ordering groups that the system must start before this service. Specify <code>nil</code> or an empty string if the service has no dependencies. Dependency on a group means that this service can run if at least one member of the group is running after an attempt to start all members of the group.</p> <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>description</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Description of the service.</p> <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>desired_access</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>983551</code>  <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>display_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The display name to be used by user interface programs to identify the service. This string has a maximum length of 256 characters.</p> <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>error_control</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>1</code>  <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>load_order_group</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of the service’s load ordering group(s).</p> <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>pattern</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The value provided to 'service_name' or the resource block's name</code> <p>The pattern to look for in the process table.</p> </dd> </dl> <dl> <dt> <code>reload_command</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>The command used to tell a service to reload its configuration.</p> </dd> </dl> <dl> <dt> <code>restart_command</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>The command used to restart a service.</p> </dd> </dl> <dl> <dt> <code>run_as_password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The password for the user specified by <code>run_as_user</code>.</p> </dd> </dl> <dl> <dt> <code>run_as_user</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>localsystem</code> <p>The user under which a Microsoft Windows service runs.</p> </dd> </dl> <dl> <dt> <code>service_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the service name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>service_type</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>16</code>  <p> New in Chef Client 14.0 </p> </dd> </dl> <dl> <dt> <code>start_command</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>The command used to start a service.</p> </dd> </dl> <dl> <dt> <code>startup_type</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:automatic</code> <strong>Allowed Values:</strong> <code>:automatic, :disabled, :manual</code> <p>Use to specify the startup type of the service.</p> </dd> </dl> <dl> <dt> <code>status_command</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>The command used to check the run status for a service.</p> </dd> </dl> <dl> <dt> <code>stop_command</code> </dt> <dd> <strong>Ruby Type:</strong> String, false <p>The command used to stop a service.</p> </dd> </dl> <dl> <dt> <code>supports</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{"restart"=&gt;nil, "reload"=&gt;nil, "status"=&gt;nil}</code> <p>A list of properties that controls how Chef Infra Client is to attempt to manage a service: <code>:restart</code>, <code>:reload</code>, <code>:status</code>. For <code>:restart</code>, the init script or other service provider can use a restart command; if <code>:restart</code> is not specified, Chef Infra Client attempts to stop and then start a service. For <code>:reload</code>, the init script or other service provider can use a reload command. For <code>:status</code>, the init script or other service provider can use a status command to determine if the service is running; if <code>:status</code> is not specified, Chef Infra Client attempts to match the <code>service_name</code> against the process table as a regular expression, unless a pattern is specified as a parameter property. Default value: <code>{ restart: false, reload: false, status: false }</code> for all platforms (except for the Red Hat platform family, which defaults to <code>{ restart: false, reload: false, status: true }</code>.)</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>60</code> <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <br> <h3 id="functionality-windows-service">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-service">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-service">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-service">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-service">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_service</strong> resource in recipes:</p> <p><strong>Starting Services</strong></p> <p>Start a service with a <code>manual</code> startup type:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_service <span style="color:#4070a0">'BITS'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:configure_startup</span>
  startup_type <span style="color:#517918">:manual</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Creating Services</strong></p> <p>Create a service named chef-client:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_service <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:create</span>
  binary_path_name <span style="color:#4070a0">"C:\opscode\chef</span><span style="color:#4070a0;font-weight:700">\b</span><span style="color:#4070a0">in"</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create a service with <code>service_name</code> and <code>display_name</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_service <span style="color:#4070a0">'Setup chef-client as a service'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:create</span>
  display_name <span style="color:#4070a0">'CHEF-CLIENT'</span>
  service_name <span style="color:#4070a0">'chef-client'</span>
  binary_path_name <span style="color:#4070a0">"C:\opscode\chef</span><span style="color:#4070a0;font-weight:700">\b</span><span style="color:#4070a0">in"</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create a service with the <code>manual</code> startup type:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_service <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:create</span>
  binary_path_name <span style="color:#4070a0">"C:\opscode\chef</span><span style="color:#4070a0;font-weight:700">\b</span><span style="color:#4070a0">in"</span>
  startup_type <span style="color:#517918">:manual</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create a service with the <code>disabled</code> startup type:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_service <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:create</span>
  binary_path_name <span style="color:#4070a0">"C:\opscode\chef</span><span style="color:#4070a0;font-weight:700">\b</span><span style="color:#4070a0">in"</span>
  startup_type <span style="color:#517918">:disabled</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create a service with the <code>automatic</code> startup type and delayed start enabled:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_service <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:create</span>
  binary_path_name <span style="color:#4070a0">"C:\opscode\chef</span><span style="color:#4070a0;font-weight:700">\b</span><span style="color:#4070a0">in"</span>
  startup_type <span style="color:#517918">:automatic</span>
  delayed_start <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Create a service with a description:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_service <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:create</span>
  binary_path_name <span style="color:#4070a0">"C:\opscode\chef</span><span style="color:#4070a0;font-weight:700">\b</span><span style="color:#4070a0">in"</span>
  startup_type <span style="color:#517918">:automatic</span>
  description <span style="color:#4070a0">"Chef client as service"</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Deleting Services</strong></p> <p>Delete a service named chef-client:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_service <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Delete a service with the <code>service_name</code> property:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_service <span style="color:#4070a0">'Delete chef client'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
  service_name <span style="color:#4070a0">'chef-client'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Configuring Services</strong></p> <p>Change an existing service from automatic to manual startup:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_service <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:configure</span>
  binary_path_name <span style="color:#4070a0">"C:\opscode\chef</span><span style="color:#4070a0;font-weight:700">\b</span><span style="color:#4070a0">in"</span>
  startup_type <span style="color:#517918">:manual</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-share-resource">windows_share resource</h2> <a href="windows_share/index.html">windows_share resource page</a> <hr> <p>Use the <strong>windows_share</strong> resource to create, modify and remove Windows shares.</p> <p><strong>New in Chef Infra Client 14.7.</strong></p> <h3 id="syntax-windows-share">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_share</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_share <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  ca_timeout                  <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 0</span>
  change_users                <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  concurrent_user_limit       <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 0</span>
  continuously_available      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  description                 <span style="color:#007020">String</span>
  encrypt_data                <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  full_users                  <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  path                        <span style="color:#007020">String</span>
  read_users                  <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  scope_name                  <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "*"</span>
  share_name                  <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  temporary                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  action                      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_share</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>ca_timeout</code>, <code>change_users</code>, <code>concurrent_user_limit</code>, <code>continuously_available</code>, <code>description</code>, <code>encrypt_data</code>, <code>full_users</code>, <code>path</code>, <code>read_users</code>, <code>scope_name</code>, <code>share_name</code>, and <code>temporary</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-share">Actions</h3> <hr> <p>The <strong>windows_share</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create or modify a Windows share. (default)</dd> <dt><code>:delete</code></dt> <dd>Delete an existing Windows share.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-share">Properties</h3> <hr> <p>The <strong>windows_share</strong> resource has the following properties:</p> <dl> <dt> <code>ca_timeout</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code> <p>The continuous availability time-out for the share.</p> </dd> </dl> <dl> <dt> <code>change_users</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>The users that should have ‘modify’ permission on the share in domain\username format.</p> </dd> </dl> <dl> <dt> <code>concurrent_user_limit</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code> <p>The maximum number of concurrently connected users the share can accommodate.</p> </dd> </dl> <dl> <dt> <code>continuously_available</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Indicates that the share is continuously available.</p> </dd> </dl> <dl> <dt> <code>description</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The description to be applied to the share.</p> </dd> </dl> <dl> <dt> <code>encrypt_data</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Indicates that the share is encrypted.</p> </dd> </dl> <dl> <dt> <code>full_users</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>The users that should have ‘Full control’ permissions on the share in domain\username format.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path of the folder to share. Required when creating. If the share already exists on a different path then it is deleted and re-created.</p> </dd> </dl> <dl> <dt> <code>read_users</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>The users that should have ‘read’ permission on the share in domain\username format.</p> </dd> </dl> <dl> <dt> <code>scope_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>*</code> <p>The scope name of the share.</p> </dd> </dl> <dl> <dt> <code>share_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the share name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>temporary</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>The lifetime of the new SMB share. A temporary share does not persist beyond the next restart of the computer.</p> </dd> </dl> <br> <h3 id="functionality-windows-share">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-share">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-share">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-share">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-share">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_share</strong> resource in recipes:</p> <p><strong>Create a share</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_share <span style="color:#4070a0">'foo'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:create</span>
  path <span style="color:#4070a0">'C:\foo'</span>
  full_users <span style="color:#666">[</span><span style="color:#4070a0">'DOMAIN_A\some_user'</span>, <span style="color:#4070a0">'DOMAIN_B\some_other_user'</span><span style="color:#666">]</span>
  read_users <span style="color:#666">[</span><span style="color:#4070a0">'DOMAIN_C\Domain users'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Delete a share</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_share <span style="color:#4070a0">'foo'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-shortcut-resource">windows_shortcut resource</h2> <a href="windows_shortcut/index.html">windows_shortcut resource page</a> <hr> <p>Use the <strong>windows_shortcut</strong> resource to create shortcut files on Windows.</p> <p><strong>New in Chef Infra Client 14.0.</strong></p> <h3 id="syntax-windows-shortcut">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_shortcut</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_shortcut <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  arguments          <span style="color:#007020">String</span>
  cwd                <span style="color:#007020">String</span>
  description        <span style="color:#007020">String</span>
  iconlocation       <span style="color:#007020">String</span>
  shortcut_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  target             <span style="color:#007020">String</span>
  action             <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_shortcut</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>arguments</code>, <code>cwd</code>, <code>description</code>, <code>iconlocation</code>, <code>shortcut_name</code>, and <code>target</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-shortcut">Actions</h3> <hr> <p>The <strong>windows_shortcut</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create or modify a Windows shortcut. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-shortcut">Properties</h3> <hr> <p>The <strong>windows_shortcut</strong> resource has the following properties:</p> <dl> <dt> <code>arguments</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Arguments to pass to the target when the shortcut is executed.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Working directory to use when the target is executed.</p> </dd> </dl> <dl> <dt> <code>description</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The description of the shortcut</p> </dd> </dl> <dl> <dt> <code>iconlocation</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Icon to use for the shortcut. Accepts the format of <code>path, index</code>, where index is the icon file to use. See Microsoft’s <a href="https://msdn.microsoft.com/en-us/library/3s9bx7at.aspx">documentation</a> for details</p> </dd> </dl> <dl> <dt> <code>shortcut_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the shortcut name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>target</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The destination that the shortcut links to.</p> </dd> </dl> <br> <h3 id="functionality-windows-shortcut">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-shortcut">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-shortcut">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-shortcut">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-shortcut">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_shortcut</strong> resource in recipes:</p> <p><strong>Create a shortcut with a description</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_shortcut <span style="color:#4070a0">'C:\shortcut_dir.lnk'</span> <span style="color:#007020;font-weight:700">do</span>
  target <span style="color:#4070a0">'C:\original_dir'</span>
  description <span style="color:#4070a0">'Make a shortcut to C:\original_dir'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-task-resource">windows_task resource</h2> <a href="windows_task/index.html">windows_task resource page</a> <hr> <p>Use the <strong>windows_task</strong> resource to create, delete or run a Windows scheduled task.</p> <p><strong>New in Chef Infra Client 13.0.</strong></p> <h3 id="syntax-windows-task">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_task</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_task <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  backup                              <span style="color:#007020">Integer</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: 5</span>
  command                             <span style="color:#007020">String</span>
  cwd                                 <span style="color:#007020">String</span>
  day                                 <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  description                         <span style="color:#007020">String</span>
  disallow_start_if_on_batteries      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  execution_time_limit                <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: "PT72H (72 hours in ISO8601 duration format)"</span>
  force                               <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  frequency                           <span style="color:#60add5">Symbol</span>
  frequency_modifier                  <span style="color:#007020">Integer</span>, <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 1</span>
  idle_time                           <span style="color:#007020">Integer</span>
  interactive_enabled                 <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  minutes_duration                    <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  minutes_interval                    <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  months                              <span style="color:#007020">String</span>
  password                            <span style="color:#007020">String</span>
  priority                            <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 7</span>
  random_delay                        <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  run_level                           <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :limited</span>
  start_day                           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: The current date.</span>
  start_time                          <span style="color:#007020">String</span>
  start_when_available                <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  stop_if_going_on_batteries          <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  task_name                           <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  user                                <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: The localized SYSTEM user for the node.</span>
  action                              <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_task</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>backup</code>, <code>command</code>, <code>cwd</code>, <code>day</code>, <code>description</code>, <code>disallow_start_if_on_batteries</code>, <code>execution_time_limit</code>, <code>force</code>, <code>frequency</code>, <code>frequency_modifier</code>, <code>idle_time</code>, <code>interactive_enabled</code>, <code>minutes_duration</code>, <code>minutes_interval</code>, <code>months</code>, <code>password</code>, <code>priority</code>, <code>random_delay</code>, <code>run_level</code>, <code>start_day</code>, <code>start_time</code>, <code>start_when_available</code>, <code>stop_if_going_on_batteries</code>, <code>task_name</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-task">Actions</h3> <hr> <p>The <strong>windows_task</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Creates a scheduled task, or updates an existing task if any property has changed. (default)</dd> <dt><code>:delete</code></dt> <dd>Deletes a scheduled task.</dd> <dt><code>:disable</code></dt> <dd>Disables a scheduled task.</dd> <dt><code>:enable</code></dt> <dd>Enables a scheduled task.</dd> <dt><code>:end</code></dt> <dd>Ends a scheduled task.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:run</code></dt> <dd>Runs a scheduled task.</dd> </dl> <h3 id="properties-windows-task">Properties</h3> <hr> <p>The <strong>windows_task</strong> resource has the following properties:</p> <dl> <dt> <code>backup</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, false | <strong>Default Value:</strong> <code>5</code> <p>Number of backups to keep of the task when modified/deleted. Set to false to disable backups.</p> <p> New in Chef Infra Client 17.0 </p> </dd> </dl> <dl> <dt> <code>command</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The command to be executed by the windows scheduled task.</p> </dd> </dl> <dl> <dt> <code>cwd</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The directory the task will be run from.</p> </dd> </dl> <dl> <dt> <code>day</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer 
<p>The day(s) on which the task runs.</p> <ul> <li>Use this property when setting <code>frequency</code> to <code>:monthly</code> or <code>:weekly</code>.</li> <li>Valid values with frequency <code>:weekly</code> are <code>MON</code>-<code>SUN</code> or <code>*</code>.</li> <li>Valid values with frequency <code>:monthly</code> are <code>1-31</code>, <code>MON</code>-<code>SUN</code>, and <code>LASTDAY</code>.</li> <li>Use <code>MON</code>-<code>SUN</code> or <code>LASTDAY</code> if you are setting <code>frequency_modifier</code> as “FIRST, SECOND, THIRD etc.” else use 1-31.</li> <li>Multiple days should be comma separated. e.g <code>1, 2, 3</code> or <code>MON, WED, FRI</code>.</li> </ul> </dd> </dl> <dl> <dt> <code>description</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The task description.</p> <p> New in Chef Client 14.7 </p> </dd> </dl> <dl> <dt> <code>disallow_start_if_on_batteries</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Disallow start of the task if the system is running on battery power.</p> <p> New in Chef Client 14.4 </p> </dd> </dl> <dl> <dt> <code>execution_time_limit</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>PT72H (72 hours in ISO8601 duration format)</code> <p>The maximum time the task will run. This field accepts either seconds or an ISO8601 duration value.</p> </dd> </dl> <dl> <dt> <code>force</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>When used with create, will update the task.</p> </dd> </dl> <dl> <dt> <code>frequency</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol <strong>Allowed Values:</strong> <code>:daily, :hourly, :minute, :monthly, :none, :on_idle, :on_logon, :once, :onstart, :weekly</code> <p>The frequency with which to run the task.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>This property is required in Chef Infra Client 14.1 or later.</p> </div> </div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The <code>:once</code> value requires the <code>start_time</code> property to be set.</p> </div> </div> </dd> </dl> <dl> <dt> <code>frequency_modifier</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, String | <strong>Default Value:</strong> <code>1</code> 
<ul> <li>For frequency <code>:minute</code> valid values are 1 to 1439</li> <li>For frequency <code>:hourly</code> valid values are 1 to 23</li> <li>For frequency <code>:daily</code> valid values are 1 to 365</li> <li>For frequency <code>:weekly</code> valid values are 1 to 52</li> <li>For frequency <code>:monthly</code> valid values are <code>('FIRST', 'SECOND', 'THIRD', 'FOURTH', 'LAST')</code> OR <code>1-12</code>. <ul> <li>e.g. If user want to run the task on <code>second week of the month</code> use <code>frequency_modifier</code> value as <code>SECOND</code>. Multiple values for weeks of the month should be comma separated e.g. <code>"FIRST, THIRD, LAST"</code>.</li> <li>To run task every (n) months use values 1 to 12.</li> </ul> </li> </ul> </dd> </dl> <dl> <dt> <code>idle_time</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>For <code>:on_idle</code> frequency, the time (in minutes) without user activity that must pass to trigger the task, from <code>1</code> - <code>999</code>.</p> </dd> </dl> <dl> <dt> <code>interactive_enabled</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Allow task to run interactively or non-interactively. Requires user and password to also be set.</p> </dd> </dl> <dl> <dt> <code>minutes_duration</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer </dd> </dl> <dl> <dt> <code>minutes_interval</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer </dd> </dl> <dl> <dt> <code>months</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The Months of the year on which the task runs, such as: <code>JAN, FEB</code> or <code>*</code>. Multiple months should be comma delimited. e.g. <code>Jan, Feb, Mar, Dec</code>.</p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The user’s password. The user property must be set if using this property.</p> </dd> </dl> <dl> <dt> <code>priority</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>7</code> <p>Use to set Priority Levels range from 0 to 10.</p> </dd> </dl> <dl> <dt> <code>random_delay</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>Delays the task up to a given time (in seconds).</p> </dd> </dl> <dl> <dt> <code>run_level</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:limited</code> <strong>Allowed Values:</strong> <code>:highest, :limited</code> <p>Run with <code>:limited</code> or <code>:highest</code> privileges.</p> </dd> </dl> <dl> <dt> <code>start_day</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The current date.</code> <p>Specifies the first date on which the task runs in <strong>MM/DD/YYYY</strong> format.</p> </dd> </dl> <dl> <dt> <code>start_time</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specifies the start time to run the task, in <strong>HH:mm</strong> format.</p> </dd> </dl> <dl> <dt> <code>start_when_available</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>To start the task at any time after its scheduled time has passed.</p> <p> New in Chef Client 14.15 </p> </dd> </dl> <dl> <dt> <code>stop_if_going_on_batteries</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Scheduled task option when system is switching on battery.</p> <p> New in Chef Client 14.4 </p> </dd> </dl> <dl> <dt> <code>task_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the task name if it differs from the resource block’s name. Example: <code>Task Name</code> or <code>/Task Name</code></p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The localized SYSTEM user for the node.</code> <p>The user to run the task as.</p> </dd> </dl> <br> <h3 id="functionality-windows-task">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-task">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-task">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-task">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-task">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_task</strong> resource in recipes:</p> <p><strong>Create a scheduled task to run every 15 minutes as the Administrator user</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_task <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  user <span style="color:#4070a0">'Administrator'</span>
  password <span style="color:#4070a0">'password'</span>
  command <span style="color:#4070a0">'chef-client'</span>
  run_level <span style="color:#517918">:highest</span>
  frequency <span style="color:#517918">:minute</span>
  frequency_modifier <span style="color:#40a070">15</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a scheduled task to run every 2 days</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_task <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'chef-client'</span>
  run_level <span style="color:#517918">:highest</span>
  frequency <span style="color:#517918">:daily</span>
  frequency_modifier <span style="color:#40a070">2</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a scheduled task to run on specific days of the week</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_task <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'chef-client'</span>
  run_level <span style="color:#517918">:highest</span>
  frequency <span style="color:#517918">:weekly</span>
  day <span style="color:#4070a0">'Mon, Thu'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a scheduled task to run only once</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_task <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'chef-client'</span>
  run_level <span style="color:#517918">:highest</span>
  frequency <span style="color:#517918">:once</span>
  start_time <span style="color:#4070a0">'16:10'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a scheduled task to run on current day every 3 weeks and delay upto 1 min</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_task <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'chef-client'</span>
  run_level <span style="color:#517918">:highest</span>
  frequency <span style="color:#517918">:weekly</span>
  frequency_modifier <span style="color:#40a070">3</span>
  random_delay <span style="color:#4070a0">'60'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a scheduled task to run weekly starting on Dec 28th 2018</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_task <span style="color:#4070a0">'chef-client 8'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'chef-client'</span>
  run_level <span style="color:#517918">:highest</span>
  frequency <span style="color:#517918">:weekly</span>
  start_day <span style="color:#4070a0">'12/28/2018'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a scheduled task to run every Monday, Friday every 2 weeks</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_task <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'chef-client'</span>
  run_level <span style="color:#517918">:highest</span>
  frequency <span style="color:#517918">:weekly</span>
  frequency_modifier <span style="color:#40a070">2</span>
  day <span style="color:#4070a0">'Mon, Fri'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Create a scheduled task to run when computer is idle with idle duration 20 min</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_task <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">'chef-client'</span>
  run_level <span style="color:#517918">:highest</span>
  frequency <span style="color:#517918">:on_idle</span>
  idle_time <span style="color:#40a070">20</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Delete a task named “old task”</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_task <span style="color:#4070a0">'old task'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Enable a task named “chef-client”</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_task <span style="color:#4070a0">'chef-client'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Disable a task named “ProgramDataUpdater” with TaskPath “\Microsoft\Windows\Application Experience\ProgramDataUpdater”</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_task <span style="color:#4070a0">'\Microsoft\Windows\Application Experience\ProgramDataUpdater'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:disable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-uac-resource">windows_uac resource</h2> <a href="windows_uac/index.html">windows_uac resource page</a> <hr> <p>The <em>windows_uac</em> resource configures UAC on Windows hosts by setting registry keys at <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</code></p> <p><strong>New in Chef Infra Client 15.0.</strong></p> <h3 id="syntax-windows-uac">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_uac</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_uac <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  consent_behavior_admins       <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :prompt_for_consent_non_windows_binaries</span>
  consent_behavior_users        <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :prompt_for_creds</span>
  detect_installers             <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  enable_uac                    <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  prompt_on_secure_desktop      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  require_signed_binaries       <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  action                        <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :configure if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_uac</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>consent_behavior_admins</code>, <code>consent_behavior_users</code>, <code>detect_installers</code>, <code>enable_uac</code>, <code>prompt_on_secure_desktop</code>, and <code>require_signed_binaries</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-uac">Actions</h3> <hr> <p>The <strong>windows_uac</strong> resource has the following actions:</p> <dl> <dt><code>:configure</code></dt> <dd>Configures UAC by setting registry keys at <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</code>. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-uac">Properties</h3> <hr> <p>The <strong>windows_uac</strong> resource has the following properties:</p> <dl> <dt> <code>consent_behavior_admins</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:prompt_for_consent_non_windows_binaries</code> <strong>Allowed Values:</strong> <code>:no_prompt, :prompt_for_consent, :prompt_for_consent_non_windows_binaries, :prompt_for_creds, :secure_prompt_for_consent, :secure_prompt_for_creds</code> <p>Behavior of the elevation prompt for administrators in Admin Approval Mode. Sets HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA\ConsentPromptBehaviorAdmin.</p> </dd> </dl> <dl> <dt> <code>consent_behavior_users</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:prompt_for_creds</code> <strong>Allowed Values:</strong> <code>:auto_deny, :prompt_for_creds, :secure_prompt_for_creds</code> <p>Behavior of the elevation prompt for standard users. Sets HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA\ConsentPromptBehaviorUser.</p> </dd> </dl> <dl> <dt> <code>detect_installers</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Detect application installations and prompt for elevation. Sets HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA\EnableInstallerDetection.</p> </dd> </dl> <dl> <dt> <code>enable_uac</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Enable or disable UAC Admin Approval Mode. If this is changed a system restart is required. Sets HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA.</p> </dd> </dl> <dl> <dt> <code>prompt_on_secure_desktop</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Switch to the secure desktop when prompting for elevation. Sets HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA\PromptOnSecureDesktop.</p> </dd> </dl> <dl> <dt> <code>require_signed_binaries</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Only elevate executables that are signed and validated. Sets HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA\ValidateAdminCodeSignatures.</p> </dd> </dl> <br> <h3 id="functionality-windows-uac">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-uac">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-uac">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-uac">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-uac">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_uac</strong> resource in recipes:</p> <p><strong>Disable UAC prompts for the admin</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_uac <span style="color:#4070a0">'Disable UAC prompts for the admin'</span> <span style="color:#007020;font-weight:700">do</span>
  enable_uac <span style="color:#007020">true</span>
  prompt_on_secure_desktop <span style="color:#007020">false</span>
  consent_behavior_admins <span style="color:#517918">:no_prompt</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Disable UAC entirely</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_uac <span style="color:#4070a0">'Disable UAC entirely'</span> <span style="color:#007020;font-weight:700">do</span>
  enable_uac <span style="color:#007020">false</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-update-settings-resource">windows_update_settings resource</h2> <a href="windows_update_settings/index.html">windows_update_settings resource page</a> <hr> <p>Use the <strong>windows_update_settings</strong> resource to manage the various Windows Update patching options.</p> <p><strong>New in Chef Infra Client 17.3.</strong></p> <h3 id="syntax-windows-update-settings">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_update_settings</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_update_settings <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  automatic_update_option                  <span style="color:#007020">Integer</span>, <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :download_and_schedule</span>
  automatically_install_minor_updates      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  block_windows_update_website             <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  custom_detection_frequency               <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 22</span>
  disable_automatic_updates                <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  disable_os_upgrades                      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  elevate_non_admins                       <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  enable_detection_frequency               <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  no_reboot_with_users_logged_on           <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  scheduled_install_day                    <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "Everyday"</span>
  scheduled_install_hour                   <span style="color:#007020">Integer</span>
  target_wsus_group_name                   <span style="color:#007020">String</span>
  update_other_ms_products                 <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  wsus_server_url                          <span style="color:#007020">String</span>
  action                                   <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :set if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_update_settings</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>automatic_update_option</code>, <code>automatically_install_minor_updates</code>, <code>block_windows_update_website</code>, <code>custom_detection_frequency</code>, <code>disable_automatic_updates</code>, <code>disable_os_upgrades</code>, <code>elevate_non_admins</code>, <code>enable_detection_frequency</code>, <code>no_reboot_with_users_logged_on</code>, <code>scheduled_install_day</code>, <code>scheduled_install_hour</code>, <code>target_wsus_group_name</code>, <code>update_other_ms_products</code>, and <code>wsus_server_url</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-update-settings">Actions</h3> <hr> <p>The <strong>windows_update_settings</strong> resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:set</code></dt> <dd>Set Windows Update settings. (default)</dd> </dl> <h3 id="properties-windows-update-settings">Properties</h3> <hr> <p>The <strong>windows_update_settings</strong> resource has the following properties:</p> <dl> <dt> <code>automatic_update_option</code> </dt> <dd> <strong>Ruby Type:</strong> Integer, Symbol | <strong>Default Value:</strong> <code>:download_and_schedule</code> <strong>Allowed Values:</strong> <code>:download_and_notify, :download_and_schedule, :local_admin_decides, :notify</code> <p>Control what to do when updates are found. This allows you to notify, automatically download and notify to install, automatically download and schedule the install, or let the local admin decide what action to take.</p> </dd> </dl> <dl> <dt> <code>automatically_install_minor_updates</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Automatically install minor updates.</p> </dd> </dl> <dl> <dt> <code>block_windows_update_website</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Block accessing the Windows Update website.</p> </dd> </dl> <dl> <dt> <code>custom_detection_frequency</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>22</code> <p>If you decided to override the OS default detection frequency, specify your choice here. Valid choices are 0 - 22</p> </dd> </dl> <dl> <dt> <code>disable_automatic_updates</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Disable Windows Update.</p> </dd> </dl> <dl> <dt> <code>disable_os_upgrades</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Disable OS upgrades.</p> </dd> </dl> <dl> <dt> <code>elevate_non_admins</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Allow normal user accounts to temporarily be elevated to install patches.</p> </dd> </dl> <dl> <dt> <code>enable_detection_frequency</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Used to override the OS default of how often to check for updates</p> </dd> </dl> <dl> <dt> <code>no_reboot_with_users_logged_on</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Prevents the OS from rebooting while someone is on the console.</p> </dd> </dl> <dl> <dt> <code>scheduled_install_day</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>Everyday</code> <strong>Allowed Values:</strong> <code>"Everyday", "Friday", "Monday", "Saturday", "Sunday", "Thursday", "Tuesday", "Wednesday"</code> <p>A day of the week to tell Windows when to install updates.</p> </dd> </dl> <dl> <dt> <code>scheduled_install_hour</code> </dt> <dd> <strong>Ruby Type:</strong> Integer <p>If you chose a scheduled day to install, then choose an hour on that day for you installation</p> </dd> </dl> <dl> <dt> <code>target_wsus_group_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Add the node to a WSUS Target Group.</p> </dd> </dl> <dl> <dt> <code>update_other_ms_products</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Allows for other Microsoft products to get updates too</p> </dd> </dl> <dl> <dt> <code>wsus_server_url</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The URL of your WSUS server if you use one.</p> </dd> </dl> <br> <h3 id="functionality-windows-update-settings">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-update-settings">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-update-settings">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-update-settings">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-update-settings">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_update_settings</strong> resource in recipes:</p> <p><strong>Set Windows Update settings</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_update_settings <span style="color:#4070a0">'Settings to Configure Windows Nodes to automatically receive updates'</span> <span style="color:#007020;font-weight:700">do</span>
  disable_os_upgrades <span style="color:#007020">true</span>
  elevate_non_admins <span style="color:#007020">true</span>
  block_windows_update_website <span style="color:#007020">true</span>
  automatically_install_minor_updates <span style="color:#007020">true</span>
  scheduled_install_day <span style="color:#4070a0">'Friday'</span>
  scheduled_install_hour <span style="color:#40a070">18</span>
  update_other_ms_products <span style="color:#007020">true</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-user-privilege-resource">windows_user_privilege resource</h2> <a href="windows_user_privilege/index.html">windows_user_privilege resource page</a> <hr> <p>The windows_user_privilege resource allows to add and set principal (User/Group) to the specified privilege. Ref: <a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/user-rights-assignment">https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/user-rights-assignment</a></p> <p><strong>New in Chef Infra Client 16.0.</strong></p> <h3 id="syntax-windows-user-privilege">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_user_privilege</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_user_privilege <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  principal      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  privilege      <span style="color:#007020">Array</span>, <span style="color:#007020">String</span>
  users          <span style="color:#007020">Array</span>, <span style="color:#007020">String</span>
  action         <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :add if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_user_privilege</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>principal</code>, <code>privilege</code>, and <code>users</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-user-privilege">Actions</h3> <hr> <p>The <strong>windows_user_privilege</strong> resource has the following actions:</p> <dl> <dt><code>:add</code></dt> <dd>Add a user privilege. (default)</dd> <dt><code>:clear</code></dt> <dd>Clear all user privileges</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a user privilege</dd> <dt><code>:set</code></dt> <dd>Set the privileges that are listed in the <code>privilege</code> property for only the users listed in the <code>users</code> property.</dd> </dl> <h3 id="properties-windows-user-privilege">Properties</h3> <hr> <p>The <strong>windows_user_privilege</strong> resource has the following properties:</p> <dl> <dt> <code>principal</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to add the user to the given privilege. Use only with add and remove action.</p> </dd> </dl> <dl> <dt> <code>privilege</code> </dt> <dd> <strong>Ruby Type:</strong> Array, String | <code>REQUIRED</code> <p>One or more privileges to set for users.</p> </dd> </dl> <dl> <dt> <code>users</code> </dt> <dd> <strong>Ruby Type:</strong> Array, String <p>An optional property to set the privilege for given users. Use only with set action.</p> </dd> </dl> <br> <h3 id="functionality-windows-user-privilege">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-user-privilege">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-user-privilege">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-user-privilege">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-user-privilege">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_user_privilege</strong> resource in recipes:</p> <p><strong>Set the SeNetworkLogonRight Privilege for the Builtin Administrators Group and Authenticated Users</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_user_privilege <span style="color:#4070a0">'Network Logon Rights'</span> <span style="color:#007020;font-weight:700">do</span>
  privilege      <span style="color:#4070a0">'SeNetworkLogonRight'</span>
  users          <span style="color:#666">[</span><span style="color:#4070a0">'BUILTIN\Administrators'</span>, <span style="color:#4070a0">'NT AUTHORITY\Authenticated Users'</span><span style="color:#666">]</span>
  action         <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Add the SeDenyRemoteInteractiveLogonRight Privilege to the Builtin Guests and Local Accounts User Groups</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_user_privilege <span style="color:#4070a0">'Remote interactive logon'</span> <span style="color:#007020;font-weight:700">do</span>
  privilege      <span style="color:#4070a0">'SeDenyRemoteInteractiveLogonRight'</span>
  users          <span style="color:#666">[</span><span style="color:#4070a0">'Builtin\Guests'</span>, <span style="color:#4070a0">'NT AUTHORITY\Local Account'</span><span style="color:#666">]</span>
  action         <span style="color:#517918">:add</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Provide only the Builtin Guests and Administrator Groups with the SeCreatePageFile Privilege</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_user_privilege <span style="color:#4070a0">'Create Pagefile'</span> <span style="color:#007020;font-weight:700">do</span>
  privilege      <span style="color:#4070a0">'SeCreatePagefilePrivilege'</span>
  users          <span style="color:#666">[</span><span style="color:#4070a0">'BUILTIN\Guests'</span>, <span style="color:#4070a0">'BUILTIN\Administrators'</span><span style="color:#666">]</span>
  action         <span style="color:#517918">:set</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove the SeCreatePageFile Privilege from the Builtin Guests Group</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_user_privilege <span style="color:#4070a0">'Create Pagefile'</span> <span style="color:#007020;font-weight:700">do</span>
  privilege      <span style="color:#4070a0">'SeCreatePagefilePrivilege'</span>
  users          <span style="color:#666">[</span><span style="color:#4070a0">'BUILTIN\Guests'</span><span style="color:#666">]</span>
  action         <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Clear all users from the SeDenyNetworkLogonRight Privilege</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_user_privilege <span style="color:#4070a0">'Allow any user the Network Logon right'</span> <span style="color:#007020;font-weight:700">do</span>
  privilege      <span style="color:#4070a0">'SeDenyNetworkLogonRight'</span>
  action         <span style="color:#517918">:clear</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="windows-workgroup-resource">windows_workgroup resource</h2> <a href="windows_workgroup/index.html">windows_workgroup resource page</a> <hr> <p>Use the <strong>windows_workgroup</strong> resource to join or change the workgroup of a Windows host.</p> <p><strong>New in Chef Infra Client 14.5.</strong></p> <h3 id="syntax-windows-workgroup">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>windows_workgroup</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_workgroup <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  password            <span style="color:#007020">String</span>
  reboot              <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :immediate</span>
  user                <span style="color:#007020">String</span>
  workgroup_name      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action              <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :join if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>windows_workgroup</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>password</code>, <code>reboot</code>, <code>user</code>, and <code>workgroup_name</code> are the properties available to this resource.</li> </ul> <h3 id="actions-windows-workgroup">Actions</h3> <hr> <p>The <strong>windows_workgroup</strong> resource has the following actions:</p> <dl> <dt><code>:join</code></dt> <dd>Update the workgroup. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-windows-workgroup">Properties</h3> <hr> <p>The <strong>windows_workgroup</strong> resource has the following properties:</p> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The password for the local administrator user. Required if using the <code>user</code> property.</p> </dd> </dl> <dl> <dt> <code>reboot</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:immediate</code> <strong>Allowed Values:</strong> <code>:never, :reboot_now, :request_reboot</code> <p>Controls the system reboot behavior post workgroup joining. Reboot immediately, after the Chef Infra Client run completes, or never. Note that a reboot is necessary for changes to take effect.</p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The local administrator user to use to change the workgroup. Required if using the <code>password</code> property.</p> </dd> </dl> <dl> <dt> <code>workgroup_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the workgroup name if it differs from the resource block’s name.</p> </dd> </dl> <br> <h3 id="functionality-windows-workgroup">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-windows-workgroup">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-windows-workgroup">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-windows-workgroup">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-windows-workgroup">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>windows_workgroup</strong> resource in recipes:</p> <p><strong>Join a workgroup</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_workgroup <span style="color:#4070a0">'myworkgroup'</span>
</code></pre></div>
<p><strong>Join a workgroup using a specific user</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">windows_workgroup <span style="color:#4070a0">'myworkgroup'</span> <span style="color:#007020;font-weight:700">do</span>
  user <span style="color:#4070a0">'Administrator'</span>
  password <span style="color:#4070a0">'passw0rd'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="yum-package-resource">yum_package resource</h2> <a href="yum_package/index.html">yum_package resource page</a> <hr> <p>Use the <strong>yum_package</strong> resource to install, upgrade, and remove packages with Yum for the Red Hat and CentOS platforms. The yum_package resource is able to resolve <code>provides</code> data for packages much like Yum can do when it is run from the command line. This allows a variety of options for installing packages, like minimum versions, virtual provides, and library names.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Support for using file names to install packages (as in <code>yum_package '/bin/sh'</code>) is not available because the volume of data required to parse for this is excessive.</p> </div> </div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <h3 id="syntax-yum-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>yum_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  allow_downgrade      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  arch                 <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  flush_cache          <span style="color:#60add5">Hash</span> <span style="color:#60a0b0;font-style:italic"># default value: {"before"=&gt;false, "after"=&gt;false}</span>
  options              <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name         <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  source               <span style="color:#007020">String</span>
  timeout              <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version              <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  yum_binary           <span style="color:#007020">String</span>
  action               <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>yum_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>allow_downgrade</code>, <code>arch</code>, <code>flush_cache</code>, <code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, <code>version</code>, and <code>yum_binary</code> are the properties available to this resource.</li> </ul> <h3 id="actions-yum-package">Actions</h3> <hr> <p>The <strong>yum_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:lock</code></dt> <dd>Locks the yum package to a specific version.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:unlock</code></dt> <dd>Unlocks the yum package so that it can be upgraded to a newer version.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version. This action will ignore the <code>version</code> attribute.</dd> </dl> <h3 id="properties-yum-package">Properties</h3> <hr> <p>The <strong>yum_package</strong> resource has the following properties:</p> <dl> <dt> <code>allow_downgrade</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Allow downgrading a package to satisfy requested version requirements.</p> </dd> </dl> <dl> <dt> <code>arch</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The architecture of the package to be installed or upgraded. This value can also be passed as part of the package name.</p> </dd> </dl> <dl> <dt> <code>flush_cache</code> </dt> <dd> <strong>Ruby Type:</strong> Hash | <strong>Default Value:</strong> <code>{"before"=&gt;false, "after"=&gt;false}</code> <p>Flush the in-memory cache before or after a Yum operation that installs, upgrades, or removes a package. Accepts a Hash in the form: { :before =&gt; true/false, :after =&gt; true/false } or an Array in the form [ :before, :after ].</p> <p> Yum automatically synchronizes remote metadata to a local cache. Chef Infra Client creates a copy of the local cache, and then stores it in-memory during a Chef Infra Client run. The in-memory cache allows packages to be installed during a Chef Infra Client run without the need to continue synchronizing the remote metadata to the local cache while the Chef Infra Client run is in-progress. </p> 
<p>As an array:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'some-package'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic">#...</span>
  flush_cache <span style="color:#666">[</span> <span style="color:#517918">:before</span> <span style="color:#666">]</span>
  <span style="color:#60a0b0;font-style:italic">#...</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and as a Hash:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'some-package'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic">#...</span>
  flush_cache( { <span style="color:#517918">:after</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span> } )
  <span style="color:#60a0b0;font-style:italic">#...</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The <code>flush_cache</code> property does not flush the local Yum cache! Use Yum tools—<code>yum clean headers</code>, <code>yum clean packages</code>, <code>yum clean all</code>—to clean the local Yum cache.</p> </div> </div> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One of the following: the name of a package, the name of a package and its architecture, the name of a dependency. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The version of a package to be installed or upgraded. This property is ignored when using the <code>:upgrade</code> action.</p> </dd> </dl> <dl> <dt> <code>yum_binary</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The path to the yum binary.</p> </dd> </dl> <h4 id="multiple-packages-properties-yum-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <br> <h3 id="functionality-yum-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-yum-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-yum-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-yum-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h4 id="multiple-packages-common-yum-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <h3 id="examples-yum-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>yum_package</strong> resource in recipes:</p> <p><strong>Install an exact version</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'netpbm = 10.35.58-8.el8'</span>
</code></pre></div>
<p><strong>Install a minimum version</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'netpbm &gt;= 10.35.58-8.el8'</span>
</code></pre></div>
<p><strong>Install a minimum version using the default action</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'netpbm'</span>
</code></pre></div>
<p><strong>Install a version without worrying about the exact release</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'netpbm-10.35*'</span>
</code></pre></div>
<p><strong>To install a package</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'netpbm'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>To install a partial minimum version</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'netpbm &gt;= 10'</span>
</code></pre></div>
<p><strong>To install a specific architecture</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'netpbm'</span> <span style="color:#007020;font-weight:700">do</span>
  arch <span style="color:#4070a0">'i386'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'netpbm.x86_64'</span>
</code></pre></div>
<p><strong>To install a specific version-release</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_package <span style="color:#4070a0">'netpbm'</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#4070a0">'10.35.58-8.el8'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Handle cookbook_file and yum_package resources in the same recipe</strong>:</p> <p>When a <strong>cookbook_file</strong> resource and a <strong>yum_package</strong> resource are both called from within the same recipe, use the <code>flush_cache</code> attribute to dump the in-memory Yum cache, and then use the repository immediately to ensure that the correct package is installed:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook_file <span style="color:#4070a0">'/etc/yum.repos.d/custom.repo'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'custom'</span>
  mode <span style="color:#4070a0">'0755'</span>
<span style="color:#007020;font-weight:700">end</span>

yum_package <span style="color:#4070a0">'pkg-that-is-only-in-custom-repo'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  flush_cache <span style="color:#666">[</span> <span style="color:#517918">:before</span> <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="yum-repository-resource">yum_repository resource</h2> <a href="yum_repository/index.html">yum_repository resource page</a> <hr> <p>Use the <strong>yum_repository</strong> resource to manage a Yum repository configuration file located at <code>/etc/yum.repos.d/repositoryid.repo</code> on the local machine. This configuration file specifies which repositories to reference, how to handle cached data, etc.</p> <p><strong>New in Chef Infra Client 12.14.</strong></p> <h3 id="syntax-yum-repository">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>yum_repository</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_repository <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  baseurl                    <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  clean_metadata             <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  cost                       <span style="color:#007020">String</span>
  description                <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "Yum Repository"</span>
  enabled                    <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  enablegroups               <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  exclude                    <span style="color:#007020">String</span>
  failovermethod             <span style="color:#007020">String</span>
  fastestmirror_enabled      <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  gpgcheck                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  gpgkey                     <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  http_caching               <span style="color:#007020">String</span>
  include_config             <span style="color:#007020">String</span>
  includepkgs                <span style="color:#007020">String</span>
  keepalive                  <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  make_cache                 <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  max_retries                <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  metadata_expire            <span style="color:#007020">String</span>
  metalink                   <span style="color:#007020">String</span>
  mirror_expire              <span style="color:#007020">String</span>
  mirrorlist                 <span style="color:#007020">String</span>
  mirrorlist_expire          <span style="color:#007020">String</span>
  mode                       <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: "0644"</span>
  options                    <span style="color:#60add5">Hash</span>
  password                   <span style="color:#007020">String</span>
  priority                   <span style="color:#007020">String</span>
  proxy                      <span style="color:#007020">String</span>
  proxy_password             <span style="color:#007020">String</span>
  proxy_username             <span style="color:#007020">String</span>
  repo_gpgcheck              <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  report_instanceid          <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  reposdir                   <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "/etc/yum.repos.d/"</span>
  repositoryid               <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  skip_if_unavailable        <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  source                     <span style="color:#007020">String</span>
  sslcacert                  <span style="color:#007020">String</span>
  sslclientcert              <span style="color:#007020">String</span>
  sslclientkey               <span style="color:#007020">String</span>
  sslverify                  <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  throttle                   <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  timeout                    <span style="color:#007020">String</span>
  username                   <span style="color:#007020">String</span>
  action                     <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>yum_repository</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>baseurl</code>, <code>clean_metadata</code>, <code>cost</code>, <code>description</code>, <code>enabled</code>, <code>enablegroups</code>, <code>exclude</code>, <code>failovermethod</code>, <code>fastestmirror_enabled</code>, <code>gpgcheck</code>, <code>gpgkey</code>, <code>http_caching</code>, <code>include_config</code>, <code>includepkgs</code>, <code>keepalive</code>, <code>make_cache</code>, <code>max_retries</code>, <code>metadata_expire</code>, <code>metalink</code>, <code>mirror_expire</code>, <code>mirrorlist</code>, <code>mirrorlist_expire</code>, <code>mode</code>, <code>options</code>, <code>password</code>, <code>priority</code>, <code>proxy</code>, <code>proxy_password</code>, <code>proxy_username</code>, <code>repo_gpgcheck</code>, <code>report_instanceid</code>, <code>reposdir</code>, <code>repositoryid</code>, <code>skip_if_unavailable</code>, <code>source</code>, <code>sslcacert</code>, <code>sslclientcert</code>, <code>sslclientkey</code>, <code>sslverify</code>, <code>throttle</code>, <code>timeout</code>, and <code>username</code> are the properties available to this resource.</li> </ul> <h3 id="actions-yum-repository">Actions</h3> <hr> <p>The <strong>yum_repository</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create a repository based on the properties. (default)</dd> <dt><code>:delete</code></dt> <dd>Remove a repository.</dd> <dt><code>:makecache</code></dt> <dd>Force the creation of the repository cache. This is also done automatically when a repository is updated.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h3 id="properties-yum-repository">Properties</h3> <hr> <p>The <strong>yum_repository</strong> resource has the following properties:</p> <dl> <dt> <code>baseurl</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>URL to the directory where the Yum repository’s <code>repodata</code> directory lives. Can be an <code>http://</code>, <code>https://</code> or a <code>ftp://</code> URLs. You can specify multiple URLs in one <code>baseurl</code> statement.</p> </dd> </dl> <dl> <dt> <code>clean_metadata</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Specifies whether you want to purge all of the packages downloaded from a Yum repository and held in a cache directory.</p> </dd> </dl> <dl> <dt> <code>cost</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Relative cost of accessing this repository. Useful for weighing one repo’s packages as greater/less than any other.</p> </dd> </dl> <dl> <dt> <code>description</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>Yum Repository</code> <p>Descriptive name for the repository channel and maps to the ‘name’ parameter in a repository .conf.</p> </dd> </dl> <dl> <dt> <code>enabled</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Specifies whether or not Yum should use this repository.</p> </dd> </dl> <dl> <dt> <code>enablegroups</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Specifies whether Yum will allow the use of package groups for this repository.</p> </dd> </dl> <dl> <dt> <code>exclude</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>List of packages to exclude from updates or installs. This should be a space separated list. Shell globs using wildcards (eg. * and ?) are allowed.</p> </dd> </dl> <dl> <dt> <code>failovermethod</code> </dt> <dd> <strong>Ruby Type:</strong> String <strong>Allowed Values:</strong> <code>"priority", "roundrobin"</code> <p>Method to determine how to switch to a new server if the current one fails, which can either be <code>roundrobin</code> or <code>priority</code>. <code>roundrobin</code> randomly selects a URL out of the list of URLs to start with and proceeds through each of them as it encounters a failure contacting the host. <code>priority</code> starts from the first <code>baseurl</code> listed and reads through them sequentially.</p> </dd> </dl> <dl> <dt> <code>fastestmirror_enabled</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Specifies whether to use the fastest mirror from a repository configuration when more than one mirror is listed in that configuration.</p> </dd> </dl> <dl> <dt> <code>gpgcheck</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Specifies whether or not Yum should perform a GPG signature check on the packages received from a repository.</p> </dd> </dl> <dl> <dt> <code>gpgkey</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>URL pointing to the ASCII-armored GPG key file for the repository. This is used if Yum needs a public key to verify a package and the required key hasn’t been imported into the RPM database. If this option is set, Yum will automatically import the key from the specified URL. Multiple URLs may be specified in the same manner as the baseurl option. If a GPG key is required to install a package from a repository, all keys specified for that repository will be installed. Multiple URLs may be specified in the same manner as the baseurl option. If a GPG key is required to install a package from a repository, all keys specified for that repository will be installed.</p> </dd> </dl> <dl> <dt> <code>http_caching</code> </dt> <dd> <strong>Ruby Type:</strong> String <strong>Allowed Values:</strong> <code>"all", "none", "packages"</code> 
<p>Determines how upstream HTTP caches are instructed to handle any HTTP downloads that Yum does. This option can take the following values:</p> <ul> <li>
<code>all</code> means all HTTP downloads should be cached</li> <li>
<code>packages</code> means only RPM package downloads should be cached, but not repository metadata downloads</li> <li>
<code>none</code> means no HTTP downloads should be cached.</li> </ul> <p>The default value of <code>all</code> is recommended unless you are experiencing caching related issues.</p> </dd> </dl> <dl> <dt> <code>include_config</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>An external configuration file using the format <code>url://to/some/location</code>.</p> </dd> </dl> <dl> <dt> <code>includepkgs</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Inverse of exclude property. This is a list of packages you want to use from a repository. If this option lists only one package then that is all Yum will ever see from the repository.</p> </dd> </dl> <dl> <dt> <code>keepalive</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Determines whether or not HTTP/1.1 <code>keep-alive</code> should be used with this repository.</p> </dd> </dl> <dl> <dt> <code>make_cache</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Determines whether package files downloaded by Yum stay in cache directories. By using cached data, you can carry out certain operations without a network connection.</p> </dd> </dl> <dl> <dt> <code>max_retries</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>Number of times any attempt to retrieve a file should retry before returning an error. Setting this to <code>0</code> makes Yum try forever.</p> </dd> </dl> <dl> <dt> <code>metadata_expire</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Time (in seconds) after which the metadata will expire. If the current metadata downloaded is less than the value specified, then Yum will not update the metadata against the repository. If you find that Yum is not downloading information on updates as often as you would like lower the value of this option. You can also change from the default of using seconds to using days, hours or minutes by appending a <code>d</code>, <code>h</code> or <code>m</code> respectively. The default is six hours to compliment yum-updates running once per hour. It is also possible to use the word <code>never</code>, meaning that the metadata will never expire.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>When using a metalink file, the metalink must always be newer than the metadata for the repository due to the validation, so this timeout also applies to the metalink file.</p> </div> </div> </dd> </dl> <dl> <dt> <code>metalink</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specifies a URL to a metalink file for the repomd.xml, a list of mirrors for the entire repository are generated by converting the mirrors for the repomd.xml file to a baseurl.</p> </dd> </dl> <dl> <dt> <code>mirror_expire</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Time (in seconds) after which the mirrorlist locally cached will expire. If the current mirrorlist is less than this many seconds old then Yum will not download another copy of the mirrorlist, it has the same extra format as metadata_expire. If you find that Yum is not downloading the mirrorlists as often as you would like lower the value of this option. You can also change from the default of using seconds to using days, hours or minutes by appending a <code>d</code>, <code>h</code> or <code>m</code> respectively.</p> </dd> </dl> <dl> <dt> <code>mirrorlist</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>URL to a file containing a list of baseurls. This can be used instead of or with the baseurl option. Substitution variables, described below, can be used with this option.</p> </dd> </dl> <dl> <dt> <code>mirrorlist_expire</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Specifies the time (in seconds) after which the mirrorlist locally cached will expire. If the current mirrorlist is less than the value specified, then Yum will not download another copy of the mirrorlist. You can also change from the default of using seconds to using days, hours or minutes by appending a <code>d</code>, <code>h</code> or <code>m</code> respectively.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>0644</code> <p>Permissions mode of .repo file on disk. This is useful for scenarios where secrets are in the repo file. If this value is set to <code>600</code>, normal users will not be able to use Yum search, Yum info, etc.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> Hash <p>Specifies the repository options.</p> </dd> </dl> <dl> <dt> <code>password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Password to use with the username for basic authentication.</p> </dd> </dl> <dl> <dt> <code>priority</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Assigns a priority to a repository where the priority value is between <code>1</code> and <code>99</code> inclusive. Priorities are used to enforce ordered protection of repositories. Packages from repositories with a lower priority (higher numerical value) will never be used to upgrade packages that were installed from a repository with a higher priority (lower numerical value). The repositories with the lowest numerical priority number have the highest priority.</p> </dd> </dl> <dl> <dt> <code>proxy</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>URL to the proxy server that Yum should use.</p> </dd> </dl> <dl> <dt> <code>proxy_password</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Password for this proxy.</p> </dd> </dl> <dl> <dt> <code>proxy_username</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Username to use for proxy.</p> </dd> </dl> <dl> <dt> <code>repo_gpgcheck</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Determines whether or not Yum should perform a GPG signature check on the repodata from this repository.</p> </dd> </dl> <dl> <dt> <code>report_instanceid</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Determines whether to report the instance ID when using Amazon Linux AMIs and repositories.</p> </dd> </dl> <dl> <dt> <code>reposdir</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>/etc/yum.repos.d/</code> <p>The directory where the Yum repository files should be stored</p> <p> New in Chef Infra Client 16.9 </p> </dd> </dl> <dl> <dt> <code>repositoryid</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the repository name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>skip_if_unavailable</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Allow yum to continue if this repository cannot be contacted for any reason.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Use a custom template source instead of the default one.</p> </dd> </dl> <dl> <dt> <code>sslcacert</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Path to the directory containing the databases of the certificate authorities Yum should use to verify SSL certificates.</p> </dd> </dl> <dl> <dt> <code>sslclientcert</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Path to the SSL client certificate Yum should use to connect to repos/remote sites.</p> </dd> </dl> <dl> <dt> <code>sslclientkey</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Path to the SSL client key Yum should use to connect to repos/remote sites.</p> </dd> </dl> <dl> <dt> <code>sslverify</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Determines whether Yum will verify SSL certificates/hosts.</p> </dd> </dl> <dl> <dt> <code>throttle</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>Enable bandwidth throttling for downloads.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Number of seconds to wait for a connection before timing out. Defaults to 30 seconds. This may be too short of a time for extremely overloaded sites.</p> </dd> </dl> <dl> <dt> <code>username</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Username to use for basic authentication to a repository.</p> </dd> </dl> <br> <h3 id="functionality-yum-repository">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-yum-repository">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-yum-repository">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-yum-repository">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-yum-repository">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>yum_repository</strong> resource in recipes:</p> <p><strong>Add an internal company repository</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_repository <span style="color:#4070a0">'OurCo'</span> <span style="color:#007020;font-weight:700">do</span>
  description <span style="color:#4070a0">'OurCo yum repository'</span>
  mirrorlist <span style="color:#4070a0">'http://artifacts.ourco.org/mirrorlist?repo=ourco-8&amp;arch=$basearch'</span>
  gpgkey <span style="color:#4070a0">'http://artifacts.ourco.org/pub/yum/RPM-GPG-KEY-OURCO-8'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Delete a repository</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_repository <span style="color:#4070a0">'CentOS-Media'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="zypper-package-resource">zypper_package resource</h2> <a href="zypper_package/index.html">zypper_package resource page</a> <hr> <p>Use the <strong>zypper_package</strong> resource to install, upgrade, and remove packages with Zypper for the SUSE Enterprise and openSUSE platforms.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, Chef Infra Client will use details that are collected by Ohai at the start of a Chef Infra Client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms. </div> </div> <h3 id="syntax-zypper-package">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>zypper_package</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">zypper_package <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  allow_downgrade      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  global_options       <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  gpg_check            <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: "true"</span>
  options              <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  package_name         <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  source               <span style="color:#007020">String</span>
  timeout              <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span>
  version              <span style="color:#007020">String</span>, <span style="color:#007020">Array</span>
  action               <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :install if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>zypper_package</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>allow_downgrade</code>, <code>global_options</code>, <code>gpg_check</code>, <code>options</code>, <code>package_name</code>, <code>source</code>, <code>timeout</code>, and <code>version</code> are the properties available to this resource.</li> </ul> <h3 id="actions-zypper-package">Actions</h3> <hr> <p>The <strong>zypper_package</strong> resource has the following actions:</p> <dl> <dt><code>:install</code></dt> <dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd> <dt><code>:lock</code></dt> <dd>Locks the zypper package to a specific version.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:purge</code></dt> <dd>Purge a package. This action typically removes the configuration files as well as the package.</dd> <dt><code>:reconfig</code></dt> <dd>Reconfigure a package. This action requires a response file.</dd> <dt><code>:remove</code></dt> <dd>Remove a package.</dd> <dt><code>:unlock</code></dt> <dd>Unlocks the zypper package so that it can be upgraded to a newer version.</dd> <dt><code>:upgrade</code></dt> <dd>Install a package and/or ensure that a package is the latest version.</dd> </dl> <h3 id="properties-zypper-package">Properties</h3> <hr> <p>The <strong>zypper_package</strong> resource has the following properties:</p> <dl> <dt> <code>allow_downgrade</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Allow downgrading a package to satisfy requested version requirements.</p> <p> New in Chef Client 13.6 </p> </dd> </dl> <dl> <dt> <code>global_options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command. For example, common zypper directives, such as <code>--no-recommends</code>. See the <a href="https://en.opensuse.org/SDB:Zypper_manual_(plain)">zypper man page</a> for the full list.</p> <p> New in Chef Client 14.6 </p> </dd> </dl> <dl> <dt> <code>gpg_check</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Verify the package’s GPG signature. Can also be controlled site-wide using the <code>zypper_check_gpg</code> config option.</p> </dd> </dl> <dl> <dt> <code>options</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>One (or more) additional command options that are passed to the command.</p> </dd> </dl> <dl> <dt> <code>package_name</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>An optional property to set the package name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The optional path to a package on the local file system.</p> </dd> </dl> <dl> <dt> <code>timeout</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer <p>The amount of time (in seconds) to wait before timing out.</p> </dd> </dl> <dl> <dt> <code>version</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array <p>The version of a package to be installed or upgraded.</p> </dd> </dl> <h4 id="multiple-packages-properties-zypper-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <br> <h3 id="functionality-zypper-package">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-zypper-package">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-zypper-package">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-zypper-package">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h4 id="multiple-packages-common-zypper-package">Multiple Packages</h4> <p>A resource may specify multiple packages and/or versions for platforms that use Apt, Chocolatey, DNF, Homebrew, Pacman, or Zypper package managers. Specifying multiple packages and/or versions allows a single transaction to:</p> <ul> <li>Download the specified packages and versions via a single HTTP transaction</li> <li>Update or install multiple packages with a single resource during a Chef Infra Client run</li> </ul> <p>For example, installing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span>
</code></pre></div>
<p>Installing multiple packages with versions:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  version <span style="color:#666">[</span> <span style="color:#4070a0">'1.3.4-2'</span>, <span style="color:#4070a0">'4.3.6-1'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Upgrading multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:upgrade</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Removing multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:remove</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Purging multiple packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:purge</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Notifications, via an implicit name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#c65d09">%w(package1 package2)</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:nothing</span>
<span style="color:#007020;font-weight:700">end</span>

log <span style="color:#4070a0">'call a notification'</span> <span style="color:#007020;font-weight:700">do</span>
  notifies <span style="color:#517918">:install</span>, <span style="color:#4070a0">'package[package1, package2]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <code>package_name</code> or <code>version</code> properties.</p> </div> </div> <h3 id="examples-zypper-package">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>zypper_package</strong> resource in recipes:</p> <p><strong>Install a package using package manager:</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">zypper_package <span style="color:#4070a0">'name of package'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install a package using local file:</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">zypper_package <span style="color:#4070a0">'jwhois'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
  source <span style="color:#4070a0">'/path/to/jwhois.rpm'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Install without using recommend packages as a dependency:</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">package <span style="color:#4070a0">'apache2'</span> <span style="color:#007020;font-weight:700">do</span>
  options <span style="color:#4070a0">'--no-recommends'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h2 id="zypper-repository-resource">zypper_repository resource</h2> <a href="zypper_repository/index.html">zypper_repository resource page</a> <hr> <p>Use the <strong>zypper_repository</strong> resource to create Zypper package repositories on SUSE Enterprise Linux and openSUSE systems. This resource maintains full compatibility with the <strong>zypper_repository</strong> resource in the existing <strong>zypper</strong> cookbook.</p> <p><strong>New in Chef Infra Client 13.3.</strong></p> <h3 id="syntax-zypper-repository">Syntax</h3> <hr>  <p>The full syntax for all of the properties that are available to the <strong>zypper_repository</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">zypper_repository <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  autorefresh            <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  baseurl                <span style="color:#007020">String</span>
  cookbook               <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "The cookbook containing the resource"</span>
  description            <span style="color:#007020">String</span>
  enabled                <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  gpgautoimportkeys      <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  gpgcheck               <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  gpgkey                 <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  keeppackages           <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  mirrorlist             <span style="color:#007020">String</span>
  mode                   <span style="color:#007020">String</span>, <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: "0644"</span>
  path                   <span style="color:#007020">String</span>
  priority               <span style="color:#007020">Integer</span> <span style="color:#60a0b0;font-style:italic"># default value: 99</span>
  refresh_cache          <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: true</span>
  repo_name              <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  source                 <span style="color:#007020">String</span>
  type                   <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: "NONE"</span>
  action                 <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>zypper_repository</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>autorefresh</code>, <code>baseurl</code>, <code>cookbook</code>, <code>description</code>, <code>enabled</code>, <code>gpgautoimportkeys</code>, <code>gpgcheck</code>, <code>gpgkey</code>, <code>keeppackages</code>, <code>mirrorlist</code>, <code>mode</code>, <code>path</code>, <code>priority</code>, <code>refresh_cache</code>, <code>repo_name</code>, <code>source</code>, and <code>type</code> are the properties available to this resource.</li> </ul> <h3 id="actions-zypper-repository">Actions</h3> <hr> <p>The <strong>zypper_repository</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Add a new Zypper repository. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:refresh</code></dt> <dd>Refresh Zypper repository.</dd> <dt><code>:remove</code></dt> <dd>Remove a Zypper repository.</dd> </dl> <h3 id="properties-zypper-repository">Properties</h3> <hr> <p>The <strong>zypper_repository</strong> resource has the following properties:</p> <dl> <dt> <code>autorefresh</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Determines whether or not the repository should be refreshed automatically.</p> </dd> </dl> <dl> <dt> <code>baseurl</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The base URL for the Zypper repository, such as <code>http://download.opensuse.org</code>.</p> </dd> </dl> <dl> <dt> <code>cookbook</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The cookbook containing the resource</code> <p>The cookbook to source the repository template file from. Only necessary if you’re using a custom template for the repository file.</p> </dd> </dl> <dl> <dt> <code>description</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The description of the repository that will be shown by the <code>zypper repos</code> command.</p> </dd> </dl> <dl> <dt> <code>enabled</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Determines whether or not the repository should be enabled.</p> </dd> </dl> <dl> <dt> <code>gpgautoimportkeys</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Automatically import the specified key when setting up the repository.</p> </dd> </dl> <dl> <dt> <code>gpgcheck</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Determines whether or not to perform a GPG signature check on the repository.</p> </dd> </dl> <dl> <dt> <code>gpgkey</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>[]</code> <p>The location of the repository key(s) to be imported.</p> </dd> </dl> <dl> <dt> <code>keeppackages</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>Determines whether or not packages should be saved.</p> </dd> </dl> <dl> <dt> <code>mirrorlist</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The URL of the mirror list that will be used.</p> </dd> </dl> <dl> <dt> <code>mode</code> </dt> <dd> <strong>Ruby Type:</strong> String, Integer | <strong>Default Value:</strong> <code>0644</code> <p>The file mode of the repository file.</p> </dd> </dl> <dl> <dt> <code>path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The relative path from the repository’s base URL.</p> </dd> </dl> <dl> <dt> <code>priority</code> </dt> <dd> <strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>99</code> <p>Determines the priority of the Zypper repository.</p> </dd> </dl> <dl> <dt> <code>refresh_cache</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>true</code> <p>Determines whether or not the package cache should be refreshed.</p> </dd> </dl> <dl> <dt> <code>repo_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>An optional property to set the repository name if it differs from the resource block’s name.</p> </dd> </dl> <dl> <dt> <code>source</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of the template for the repository file. Only necessary if you’re using a custom template for the repository file.</p> </dd> </dl> <dl> <dt> <code>type</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>NONE</code> <p>Specifies the repository type.</p> </dd> </dl> <br> <h3 id="functionality-zypper-repository">Common Resource Functionality</h3> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h4 id="common-properties-zypper-repository">Common Properties</h4> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h4 id="common-notifications-zypper-repository">Notifications</h4> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h4 id="guards-zypper-repository">Guards</h4> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h3 id="examples-zypper-repository">Examples</h3> <hr> <p>The following examples demonstrate various approaches for using the <strong>zypper_repository</strong> resource in recipes:</p> <p><strong>Add the Apache repo on openSUSE Leap 15</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">zypper_repository <span style="color:#4070a0">'apache'</span> <span style="color:#007020;font-weight:700">do</span>
  baseurl <span style="color:#4070a0">'http://download.opensuse.org/repositories/Apache'</span>
  path <span style="color:#4070a0">'/openSUSE_Leap_15.2'</span>
  type <span style="color:#4070a0">'rpm-md'</span>
  priority <span style="color:#4070a0">'100'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Remove the repo named ‘apache’</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">zypper_repository <span style="color:#4070a0">'apache'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Refresh the repo named ‘apache’</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">zypper_repository <span style="color:#4070a0">'apache'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:refresh</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/resources/" class="_attribution-link">https://docs.chef.io/resources/</a>
  </p>
</div>
