<div id="col-content" data-swiftype-index="true"> <div id="migrate-from-chef-automate-1"><h1>Migrate from Chef Automate 1</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/automate/blob/master/components/docs-chef-io/content/automate/migrate.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Chef Automate versions 1.0.0-1.8.96 reached end-of-life on December 31, 2019 and are no longer supported. For more information and for help upgrading your system, please contact your Chef account representative. The current Chef Automate versions includes significant architectural and technical improvements to the core product platform. This guide shows you how to migrate your existing Chef Automate installation to the current Chef Automate.</p> <p>In this guide, we call Chef Automate versions 1.0.0-1.8.96 “Chef Automate 1” and the current version “Chef Automate 2”.</p> <h2 id="overview">Overview</h2> <p>The Chef Automate migration process performs the following steps, in order:</p> <ol> <li>Runs preflight checks to ensure the system is suitable for Chef Automate 2, your Chef Automate 1 installation can be migrated safely, and that the upgrade process will be able to migrate your data.</li> <li>Analyzes your Chef Automate 1 configuration files and migrates the relevant settings to a configuration file for Chef Automate 2. If incompatibilities are detected, the migration process fails and emits a description of the problem. You will have an opportunity to make any necessary changes to the generated Chef Automate 2 configuration.</li> <li>Downloads Chef Automate 2. Chef Automate 2 is distributed via <a href="../../habitat/index.html">Habitat</a> packages that are installed early in the process to minimize the downtime required for the migration.</li> <li>Puts your Chef Automate 1 installation into maintenance mode, waits for queued data to be processed, and then backs up all Chef Automate 1 data. This ensures that data will not be lost in the migration process and that you will be able to recover to a working state should an unforeseen error occur.</li> <li>Creates a local snapshot of Chef Automate 1 data for import into Chef Automate 2.</li> <li>Shuts down Chef Automate 1.</li> <li>Imports the Chef Automate 1 snapshot into Chef Automate 2.</li> <li>Starts Chef Automate 2. On startup, each component service of Chef Automate 2 detects imported data. Once all component services perform this step, Chef Automate 2 is ready to use and can accept new data.</li> <li>Migrates imported historical data in the background. You will be notified when the migration completes.</li> </ol> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> Chef Automate 2 migrates only the LDAP configuration and local users (also referred to as “internal users”). SAML configuration is not migrated. </div> </div> <h2 id="prerequisites">Prerequisites</h2> <p>Before you start the migration process, fulfill the requirements detailed in this section.</p> <h3 id="command-line-tool">Command Line Tool</h3> <p>You will need the <code>chef-automate</code> command line tool to initiate your upgrade.</p> <ol> <li> <p>Download the latest version of the Chef Automate CLI:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-shell" data-lang="shell">wget https://packages.chef.io/files/current/automate/latest/chef-automate_linux_amd64.zip
</code></pre></div>
</li> <li> <p>Unzip the package:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-shell" data-lang="shell">unzip chef-automate_linux_amd64.zip
</code></pre></div>
</li> <li> <p>Move the unzipped <code>chef-automate</code> binary to <code>/usr/local/bin</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-shell" data-lang="shell">mv chef-automate /usr/local/bin
</code></pre></div>
</li> </ol> <h3 id="internet-access">Internet Access</h3> <p>The Chef Automate upgrade process requires connectivity to the internet to install the Chef Automate 2 binaries. The standard Chef Automate installation requires current versions for Chrome, Edge, or Firefox browsers. If you filter internet access via proxy or by other means, you must ensure the following domains are accessible:</p> <ul> <li><code>packages.chef.io</code></li> <li><code>licensing.chef.io</code></li> <li><code>raw.githubusercontent.com</code></li> <li><code>api.bintray.com</code></li> <li><code>bldr.habitat.sh</code></li> <li><code>akamai.bintray.com</code></li> <li><code>dl.bintray.com</code></li> <li><code>bintray.com</code></li> </ul> <h4 id="proxies">Proxies</h4> <p>The Chef Automate 2 installer respects the following environment variables:</p> <ul> <li>
<code>HTTPS_PROXY</code>/<code>https_proxy</code>
</li> <li>
<code>HTTP_PROXY</code>/<code>http_proxy</code>
</li> <li>
<code>NO_PROXY</code>/<code>no_proxy</code>
</li> </ul> <p>If you use a proxy to manage outbound HTTP(S) connections, ensure these variables are set when running the migration.</p> <h3 id="chef-automate-1-version">Chef Automate 1 Version</h3> <p>Recent versions of Chef Automate 1 contain enhancements that the migration process relies upon to ensure your data is safely migrated. Chef Automate 1.8.38 or greater is required.</p> <h3 id="systemd">Systemd</h3> <p>Chef Automate 2 requires the systemd init system. If you’re using Chef Automate 1 on an operating system that makes use of a different init system, we recommend consulting Customer Support for the appropriate migration strategy.</p> <h2 id="considerations">Considerations</h2> <p>While we’ve taken care to make the migration process as smooth as possible, this section outlines some caveats to consider before you proceed.</p> <h3 id="plan-for-downtime">Plan for Downtime</h3> <p>The Chef Automate 2 migration process puts your Chef Automate 1 installation into maintenance mode, shuts it down, and starts Chef Automate 2. During the downtime, the migration process takes a backup of your Chef Automate 1 data and exports some of its data to a local snapshot, which is imported into Chef Automate 2.</p> <p>To minimize this downtime, we recommended that you create an online backup of Chef Automate 1 just prior to the upgrade. Historical information such as Chef Infra Client run data and compliance scan data is backed up incrementally, which means that the upgrade only needs to transfer data that has been added since the last backup.</p> <p>By default, the Chef Automate 2 upgrade process will not proceed if your Chef Automate 1 installation does not have backups configured. Invoke the migration using the <code>--skip-backup-check</code> flag to avoid this check.</p> <h3 id="unsupported-features-and-topologies">Unsupported Features and Topologies</h3> <p>Chef Automate 2 includes significant architectural and technical improvements to the core product platform. If you rely on any of the capabilities listed below, we recommend you continue to using your existing Chef Automate installation.</p> <ul> <li>
<strong>Chef Manage:</strong> Chef Automate 2, unlike Chef Automate 1, cannot serve as a SAML auth proxy</li> <li>
<strong>FIPS:</strong> Chef Automate 2 cannot operate in FIPS mode</li> <li>
<strong>Disaster Recovery:</strong> Chef Automate 2 cannot operate in a primary/standby mode</li> <li>
<strong>Custom Kibana dashboards:</strong> Chef Automate 2 does not include Kibana in its technology stack</li> <li>
<strong>SAML config migration:</strong> Chef Automate 2 supports SAML integration, however due to configuration incompatibilities Chef Automate 2 cannot migrate Chef Automate 1 SAML settings to Chef Automate 2 as part of the upgrade. After the upgrade is completed, you may follow <a href="../configuration/index.html#saml">these configuration instructions</a> to set up SAML.</li> </ul> <p>To migrate to Chef Automate 2 without these features, invoke the migration with the appropriate flags:</p> <ul> <li><code>--skip-fips-check</code></li> <li><code>--skip-disaster-recovery-check</code></li> <li><code>--skip-saml-check</code></li> </ul> <p>These flags enable you to migrate by skipping preflight checks for unsupported features.</p> <h3 id="external-elasticsearch-cluster">External Elasticsearch cluster</h3> <p>The Chef Automate 2 migration process requires manual intervention to migrate a Chef Automate 1 installation that uses external Elasticsearch.</p> <p>To migrate an external Elasticsearch cluster, please reach out to a Customer Success or Customer Support representative for assistance.</p> <h3 id="new-data-paths">New Data Paths</h3> <p>Chef Automate 2 stores its data in directories named <code>/hab/svc/$service-name/data</code>. In particular:</p> <ul> <li>Elasticsearch data is stored in <code>/hab/svc/automate-elasticsearch/data/</code>
</li> <li>PostgreSQL data is stored in <code>/hab/svc/automate-postgresql/data/</code>
</li> </ul> <p>If you use dedicated disks or partitions for either of these applications in Chef Automate 1, you must modify your disk mount configuration to make these disks/partitions available to Chef Automate 2.</p> <h3 id="chef-automate-2-license">Chef Automate 2 License</h3> <p>Login to Chef Automate to start a trial. The trial provides you with a 60-day license. Requesting a trial license requires internet connectivity in your Chef Automate 2 instance (only at the time of the license request).</p> <p>If you are migrating an <a href="../../install_chef_air_gap/index.html#chef-automate">airgapped Chef Automate installation</a>, contact your Chef account representative for a Chef Automate 2 license.</p> <h2 id="migrate">Migrate</h2> <ol> <li> <p>Create a backup your Chef Automate 1 installation:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-shell" data-lang="shell">automate-ctl create-backup
</code></pre></div>
</li> <li> <p>Once the backup has completed, initiate the migration process. If your host is internet-connected, run the command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-shell" data-lang="shell">./chef-automate migrate-from-v1 --channel current
</code></pre></div>
<p>If your host is airgapped, run the command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-shell" data-lang="shell">./chef-automate migrate-from-v1 --airgap-bundle &lt;/path/to/bundle&gt;
</code></pre></div>
</li> </ol> <p>After the migration runs the preflight checks and analyzes your Chef Automate 1 configuration, it asks for confirmation to continue. Review the generated configuration file and if it is correct, type <code>yes</code> to continue.</p> <p>The migration process backs up your Chef Automate 1 data, shuts down Chef Automate 1, imports your data to Chef Automate 2, then starts Chef Automate 2. At this point, you can use your existing Chef Automate 1 user credentials to login to Chef Automate 2. If you’ve been using LDAP for authenticating users, that configuration will have been migrated as well, and you can use your LDAP credentials to login. Historical data will be migrated in the background.</p> <h3 id="upgrades">Upgrades</h3> <p>Chef Automate 2 handles upgrades differently than Chef Automate 1 did. The <a href="../install/index.html#upgrade">Installation</a> documentation and <a href="../airgapped_installation/index.html#upgrade">Airgapped Installation</a> documentation provide further detail.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/automate/migrate/" class="_attribution-link">https://docs.chef.io/automate/migrate/</a>
  </p>
</div>
