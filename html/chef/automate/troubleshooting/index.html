<div id="col-content" data-swiftype-index="true"> <div id="troubleshooting"><h1>Troubleshooting</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/automate/blob/master/components/docs-chef-io/content/automate/troubleshooting.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <h2 id="chef-automate-cli-errors">chef-automate CLI Errors</h2> <h3 id="error-unable-to-make-a-request-to-the-deployment-service">Error: Unable to make a request to the deployment-service</h3> <p>The <code>chef-automate</code> CLI emits this error when the CLI is unable to communicate with a Chef Automate deployment. In particular, when Chef Automate 2 (as distinct from Chef Automate 1) is not deployed, running <code>chef-automate</code> CLI commands such as <code>version</code> or <code>status</code> causes this error.</p> <h2 id="file-exists-os-error-17">File exists (os error 17)</h2> <p>It’s possible for the following error to be emitted when deploying Chef Automate:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">DeploymentServiceCallError: A request to the deployment-service failed: Request to configure deployment failed: rpc error: <span style="color:#bb60d5">code</span> <span style="color:#666">=</span> Unknown <span style="color:#bb60d5">desc</span> <span style="color:#666">=</span> failed to binlink <span style="color:#007020">command</span> <span style="color:#4070a0">"chef-automate"</span> in pkg <span style="color:#4070a0">"chef/automate-cli/0.1.0/20181212085335"</span> - hab output: &gt;&gt; Binlinking chef-automate from chef/automate-cli/0.1.0/20181212085335 into /bin
xxx
xxx File exists <span style="color:#666">(</span>os error 17<span style="color:#666">)</span>
xxx
: <span style="color:#007020">exit</span> status <span style="color:#40a070">1</span>
</code></pre></div>
<p>This problem can be fixed by removing the <code>chef-automate</code> binary from the <code>/bin</code> directory. The binary should not be placed in the PATH manually as the deployment process will do it.</p> <h2 id="compliance-report-display">Compliance Report Display</h2> <p>If the size of a Compliance Report is over 4MB, then the <em>Reports</em> page (Compliance &gt; Reports) may not display as expected. <a href="https://github.com/chef-cookbooks/audit">Audit Cookbook 9.4.0 and later</a> supports some attribute options that trims a report to its smallest size when combined with latest Chef Automate version. Contact Chef Support to determine the best way to manage your Compliance Report size.</p> <h2 id="low-disk-space">Low Disk Space</h2> <p>Chef Automate emits a warning when the available disk space on the system drops below 1 GB, for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">es-sidecar-service.default<span style="color:#666">(</span>O<span style="color:#666">)</span>: <span style="color:#bb60d5">time</span><span style="color:#666">=</span><span style="color:#4070a0">"2018-05-16T00:07:16Z"</span> <span style="color:#bb60d5">level</span><span style="color:#666">=</span>error <span style="color:#bb60d5">msg</span><span style="color:#666">=</span><span style="color:#4070a0">"Disk free below critical threshold"</span> <span style="color:#bb60d5">avail_bytes</span><span style="color:#666">=</span><span style="color:#40a070">43368448</span> <span style="color:#bb60d5">host</span><span style="color:#666">=</span>127.0.0.1 <span style="color:#bb60d5">mount</span><span style="color:#666">=</span><span style="color:#4070a0">"/ (overlay)"</span> <span style="color:#bb60d5">threshold_bytes</span><span style="color:#666">=</span><span style="color:#40a070">536870912</span> <span style="color:#bb60d5">total_bytes</span><span style="color:#666">=</span><span style="color:#40a070">31361703936</span>
</code></pre></div>
<h3 id="recovering-from-low-disk-conditions">Recovering from Low Disk Conditions</h3> <p>Chef Automate disables disk writes if available disk space drops below 250 MB and logs a message similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ingest-service.default<span style="color:#666">(</span>O<span style="color:#666">)</span>: <span style="color:#bb60d5">time</span><span style="color:#666">=</span><span style="color:#4070a0">"2018-05-16T00:10:09Z"</span> <span style="color:#bb60d5">level</span><span style="color:#666">=</span>error <span style="color:#bb60d5">msg</span><span style="color:#666">=</span><span style="color:#4070a0">"Message failure"</span> <span style="color:#bb60d5">error</span><span style="color:#666">=</span><span style="color:#4070a0">"rpc error: code = Internal desc = elastic: Error 403 (Forbidden): blocked by: [FORBIDDEN/12/index read-only / allow delete (api)]; [type=cluster_block_exception] elastic: Error 403 (Forbidden): blocked by: [FORBIDDEN/12/index read-only / allow delete (api)]; [type=cluster_block_exception]"</span>
</code></pre></div>
<p>After freeing up disk space, you will need to remove the write block on the Elasticsearch indices by running:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">curl -X PUT <span style="color:#4070a0">"localhost:10141/_all/_settings"</span> -H <span style="color:#4070a0">'Content-Type: application/json'</span> -d<span style="color:#4070a0">'
</span><span style="color:#4070a0">{
</span><span style="color:#4070a0">  "index.blocks.read_only_allow_delete": null
</span><span style="color:#4070a0">}
</span><span style="color:#4070a0">'</span>
</code></pre></div>
<p>To confirm that you’ve successfully removed the blocks, run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">curl <span style="color:#4070a0">'localhost:10141/_all/_settings'</span>
</code></pre></div>
<p>Verify that the output does not contain <code>"blocks":{"read_only_allow_delete":"true"}</code>.</p> <h2 id="uninstalling-chef-automate">Uninstalling Chef Automate</h2> <p>The following procedure will remove Chef Automate from your system, including all data. If you wish to preserve the data, make a backup before uninstalling.</p> <p>With the <code>chef-automate</code> CLI:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-automate uninstall
</code></pre></div>
<h2 id="resetting-the-admin-password">Resetting the Admin Password</h2> <p>Use the following command to completely reset a lost, forgotten, or compromised admin password:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-automate iam admin-access restore NEW_PASSWORD
</code></pre></div>
<p>This command causes Automate to inspect your A2 IAM resource and initiates a series of steps for applying the new password to the “admin” user–in effect reconstituting the admin–and connecting it with full administrative permissions.</p> <p>The process Automate follows for resetting the admin password may include: recreating the user record, recreating the “admins” local team, and recreating the default policy that grants access to all resources for the newly reconstituted local admin team.</p> <p>To see what exactly will happen in your system, pass <code>--dry-run</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-automate iam admin-access restore NEW_PASSWORD --dry-run
</code></pre></div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/automate/troubleshooting/" class="_attribution-link">https://docs.chef.io/automate/troubleshooting/</a>
  </p>
</div>
