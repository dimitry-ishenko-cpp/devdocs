<div id="col-content" data-swiftype-index="true"> <div id="about-policyfiles"><h1>About Policyfiles</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-web-docs/blob/main/content/policyfile.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>A Policyfile is a way to create immutable collections of cookbooks, cookbook dependencies, and attributes defined in a single document that is uploaded to the Chef Infra Server. The Policyfile is then associated with a group of nodes. When these nodes perform a Chef Infra Client run, they utilize recipes specified in the Policyfile.</p> <h2 id="why-policyfiles">Why Policyfiles?</h2> <p>Policyfiles make it easier to test and promote code safely with a simpler interface. Using a Policyfile improves the user experience and resolves real-world problems that some workflows built around Chef Infra must deal with. The following sections discuss in more detail some of the good reasons to use Policyfile, including:</p> <ul> <li>Focus the workflow on the entire system</li> <li>Safer development workflows</li> <li>Less expensive computation</li> <li>Code visibility</li> <li>Role mutability</li> <li>Cookbook mutability</li> <li>Replaces Berkshelf and the environment cookbook pattern</li> </ul> <h3 id="focused-system-workflows">Focused System Workflows</h3> <p>The knife command line tool maps very closely to the Chef Infra Server API and the objects defined by it: roles, environments, run-lists, cookbooks, data bags, nodes, and so on. Chef Infra Client assembles these pieces at run-time and configures a host to do useful work.</p> <p>Policyfile focuses that workflow onto the entire system, rather than the individual components. For example, Policyfile describes whole systems, whereas each individual revision of the <code>Policyfile.lock.json</code> file uploaded to the Chef Infra Server describes a part of that system, inclusive of roles, environments, cookbooks, and the other Chef Infra Server objects necessary to configure that part of the system.</p> <h3 id="safer-workflows">Safer Workflows</h3> <p>Policyfile encourages safer workflows by making it easier to publish development versions of cookbooks to the Chef Infra Server without the risk of mutating the production versions and without requiring a complicated versioning scheme to work around cookbook mutability issues. Roles are mutable and those changes are applied only to the nodes specified by the policy. Policyfile does not require any changes to your normal workflows. Use the same repositories you are already using, the same cookbooks, and workflows. Policyfile will prevent an updated cookbook or role from being applied immediately to all machines.</p> <h3 id="code-visibility">Code Visibility</h3> <p>When running Chef Infra without a Policyfile, the exact set of cookbooks that are applied to a node is defined by:</p> <ul> <li>The node’s <code>run_list</code> property</li> <li>Any roles that are present in the node’s run-list or recursively included by those roles</li> <li>The environment, which may restrict the set of valid cookbook versions for a node based on a variety of constraint operators</li> <li>Dependencies, as defined by each cookbook’s metadata</li> <li>Dependency resolution picks the “best” set of cookbooks that meet dependency and environment criteria</li> </ul> <p>These conditions are re-evaluated every time Chef Infra Client runs, which can make it harder to know which cookbooks will be run by Chef Infra Client or what the effects of updating a role or uploading a new cookbook will be.</p> <p>Policyfile simplifies this behavior by computing the cookbook set on the workstation, and then producing a readable document of that solution: a <code>Policyfile.lock.json</code> file. This pre-computed file is uploaded to the Chef Infra Server, and is then used in each Chef Infra Client run that is managed by that particular policy name and policy group.</p> <h3 id="less-expensive-computation">Less Expensive Computation</h3> <p>When running Chef Infra without Policyfile, the Chef Infra Server loads dependency data for all known versions of all known cookbooks, and then runs an expensive computation to determine the correct set.</p> <p>Policyfile moves this computation to the workstation, where it is done less frequently.</p> <h3 id="role-and-environment-mutability">Role and Environment Mutability</h3> <p>When running Chef Infra without Policyfile roles and environments are global objects. Changes to roles and environments are applied immediately to any node that contains that role in its run-list or belong to a particular environment. This can make it hard to update roles and environments and in some use cases discourages using them at all.</p> <p>Policyfile effectively replaces roles and environments. Policyfile files are versioned automatically and new versions are applied to systems only when promoted.</p> <h3 id="cookbook-mutability">Cookbook Mutability</h3> <p>When running Chef without Policyfile, existing versions of cookbooks are mutable. This is convenient for many use cases, especially if users upload in-development cookbook revisions to the Chef Infra Server. But this sometimes creates issues that are similar to role mutability by allowing those cookbook changes to be applied immediately to nodes that use that cookbook. Users account for this by rigorous testing processes to ensure that only fully integrated cookbooks are ever published. This process does enforce good development habits, but at the same time it shouldn’t be a required part of a workflow that ends with publishing an in-development cookbook to the Chef Infra Server for testing against real nodes Policyfile solves this issue by using a cookbook publishing API for the Chef Infra Server that does not provide cookbook mutability. Name collisions are prevented by storing cookbooks by name and an opaque identifier that is computed from the content of the cookbook itself.</p> <p>For example, name/version collisions can occur when users temporarily fork an upstream cookbook. Even if the user contributes their change and the maintainer is responsive, there may be a period of time where the user needs their fork in order to make progress. This situation presents a versioning dilemma: if the user doesn’t update their own version, they must overwrite the existing copy of that cookbook on the Chef Infra Server, wheres if they do update the version number it might conflict with the version number of the future release of that upstream cookbook.</p> <h4 id="opaque-ids">Opaque IDs</h4> <p>The opaque identifier that is computed from the content of a cookbook is the only place where an opaque identifier is necessary. When working with Policyfile, be sure to:</p> <ul> <li>Use the same names and version constraints as normal in the <code>Policyfile.rb</code> file</li> <li>Use the same references to cookbooks pulled from Chef Supermarket</li> <li>Use the same branch, tag, and revision patterns for cookbooks pulled from git</li> <li>Use the same paths for cookbooks pulled from disk</li> </ul> <p>Extra metadata about the cookbook is stored and included in Chef Infra Server API responses and in the <code>Policyfile.lock.json</code> file, including the source of a cookbook (Chef Supermarket, git, local disk, etc.), as well as any upstream identifiers, such as git revisions. For cookbooks that are loaded from the local disk that are in a git repo, the upstream URL, current revision ID, and the state of the repo are stored also.</p> <p>The opaque identifier is mostly behind the scenes and is only visible once published to the Chef Infra Server. Cookbooks that are uploaded to the Chef Infra Server may have extended version numbers such as <code>1.0.0-dev</code>.</p> <h3 id="environment-cookbooks">Environment Cookbooks</h3> <p>Policyfile replaces the environment cookbook pattern that is often required by Berkshelf, along with a dependency solver and fetcher. That said, Policyfile does not replace all Berkshelf scenarios.</p> <h2 id="knife-commands">Knife Commands</h2> <p>The following knife commands used to set the policy group and policy name on the Chef Infra Server. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife node policy <span style="color:#007020">set</span> test-node <span style="color:#4070a0">'test-policy-group-name'</span> <span style="color:#4070a0">'test-policy-name'</span>
</code></pre></div>
<h2 id="policyfilerb">Policyfile.rb</h2> <p>A Policyfile file allows you to specify in a single document the cookbook revisions and recipes that Chef Infra Client will apply. A Policyfile file is uploaded to the Chef Infra Server, where it is associated with a group of nodes. When these nodes are configured during a Chef Infra Client run, Chef Infra Client will make decisions based on your Policyfile settings and will build a run-list based on that information. A Policyfile file may be versioned, and then promoted through deployment stages to safely and reliably deploy new configuration.</p> <h3 id="syntax">Syntax</h3> <p>A <code>Policyfile.rb</code> is a Ruby file in which run-list and cookbook locations are specified. The syntax is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">name</span> <span style="color:#4070a0">"name"</span>
run_list <span style="color:#4070a0">"ITEM"</span>, <span style="color:#4070a0">"ITEM"</span>, <span style="color:#666">...</span>
default_source <span style="color:#517918">:SOURCE_TYPE</span>, <span style="color:#666">*</span>args
cookbook <span style="color:#4070a0">"NAME"</span> <span style="color:#666">[</span>, <span style="color:#4070a0">"VERSION_CONSTRAINT"</span><span style="color:#666">]</span> <span style="color:#666">[</span>, <span style="color:#60add5">SOURCE_OPTIONS</span><span style="color:#666">]</span>
</code></pre></div>
<h3 id="settings">Settings</h3> <p>A <code>Policyfile.rb</code> file may contain the following settings:</p> <dl> <dt><code>name "name"</code></dt> <dd> <p>Required. The name of the policy. Use a name that reflects the purpose of the machines against which the policy will run.</p> </dd> <dt><code>run_list "ITEM", "ITEM", ...</code></dt> <dd> <p>Required. The run-list Chef Infra Client will use to apply the policy to one (or more) nodes.</p> </dd> <dt><code>default_source :SOURCE_TYPE, *args</code></dt> <dd> <p>The location in which any cookbooks not specified by <code>cookbook</code> are located. Possible values: <code>chef_repo</code>, <code>chef_server</code>, <code>:supermarket</code>, and <code>:artifactory</code>. Use more than one <code>default_source</code> to specify more than one location for cookbooks.</p> <p><code>default_source :supermarket</code> pulls cookbooks from the public Chef Supermarket.</p> <p><code>default_source :supermarket, "https://mysupermarket.example"</code> pulls cookbooks from a named private Chef Supermarket.</p> <p><code>default_source :chef_server, "https://chef-server.example/organizations/example"</code> pulls cookbooks from the Chef Infra Server.</p> <p><code>default_source :chef_repo, "path/to/repo"</code> pulls cookbooks from a monolithic cookbook repository. This may be a path to the top-level of a cookbook repository or to the <code>/cookbooks</code> directory within that repository.</p> <p><code>default_source :artifactory, "https://artifactory.example/api/chef/my-supermarket"</code> pulls cookbooks from an Artifactory server. Requires either <code>artifactory_api_key</code> to be set in <code>config.rb</code> or <code>ARTIFACTORY_API_KEY</code> to be set in your environment.</p> <p>Multiple cookbook sources may be specified. For example from the public Chef Supermarket and a monolithic repository:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default_source <span style="color:#517918">:supermarket</span>
default_source <span style="color:#517918">:chef_repo</span>, <span style="color:#4070a0">'path/to/repo'</span>
</code></pre></div>
<p>or from both a public and private Chef Supermarket:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default_source <span style="color:#517918">:supermarket</span>
default_source <span style="color:#517918">:supermarket</span>, <span style="color:#4070a0">'https://supermarket.example'</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If a run-list or any dependencies require a cookbook that is present in more than one source, be explicit about which source is preferred. This will ensure that a cookbook is always pulled from an expected source. For example, an internally-developed cookbook named <code>chef-client</code> will conflict with the public <code>chef-client</code> cookbook that is maintained by Chef. To specify a named source for a cookbook:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default_source <span style="color:#517918">:supermarket</span>
default_source <span style="color:#517918">:supermarket</span>, <span style="color:#4070a0">'https://supermarket.example'</span> <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>s<span style="color:#666">|</span>
  s<span style="color:#666">.</span>preferred_for <span style="color:#4070a0">'chef-client'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>List multiple cookbooks on the same line:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default_source <span style="color:#517918">:supermarket</span>
default_source <span style="color:#517918">:supermarket</span>, <span style="color:#4070a0">'https://supermarket.example'</span> <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>s<span style="color:#666">|</span>
  s<span style="color:#666">.</span>preferred_for <span style="color:#4070a0">'chef-client'</span>, <span style="color:#4070a0">'nginx'</span>, <span style="color:#4070a0">'mysql'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
</div> </div> </dd> <dt><code>cookbook "NAME" [, "VERSION_CONSTRAINT"] [, SOURCE_OPTIONS]</code></dt> <dd> <p>Add cookbooks to the policy, specify a version constraint, or specify an alternate source location, such as Chef Supermarket. For example, add a cookbook:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook <span style="color:#4070a0">'apache2'</span>
</code></pre></div>
<p>Specify a version constraint:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">run_list <span style="color:#4070a0">'jenkins::master'</span>

<span style="color:#60a0b0;font-style:italic"># Restrict the jenkins cookbook to version 2.x, greater than 2.1</span>
cookbook <span style="color:#4070a0">'jenkins'</span>, <span style="color:#4070a0">'~&gt; 2.1'</span>
</code></pre></div>
<p>Specify an alternate source:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook <span style="color:#4070a0">'my_app'</span>, <span style="color:#517918">path</span>: <span style="color:#4070a0">'cookbooks/my_app'</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook <span style="color:#4070a0">'mysql'</span>, <span style="color:#517918">github</span>: <span style="color:#4070a0">'opscode-cookbooks/mysql'</span>, <span style="color:#517918">branch</span>: <span style="color:#4070a0">'master'</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">cookbook <span style="color:#4070a0">'chef-ingredient'</span>, <span style="color:#517918">git</span>: <span style="color:#4070a0">'https://github.com/chef-cookbooks/chef-ingredient.git'</span>, <span style="color:#517918">tag</span>: <span style="color:#4070a0">'v0.12.0'</span>
</code></pre></div>
</dd> <dt><code>named_run_list "NAME", "ITEM1", "ITEM2", ...</code></dt> <dd> <p>Specify a named run-list to be used as an alternative to the override run-list. This setting should be used carefully and for specific use cases, like running a small set of recipes to quickly converge configuration for a single application on a host or for one-time setup tasks. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">named_run_list <span style="color:#517918">:update_app</span>, <span style="color:#4070a0">'my_app_cookbook::default'</span>
</code></pre></div>
</dd> <dt><code>include_policy "NAME", *args</code></dt> <dd> <p>Specify a policyfile lock to be merged with this policy. Chef Workstation supports pulling this lock from a local or remote file, from a Chef Infra Server, or from a git repository. When the policyfile lock is included, its run-list will appear before the current policyfile’s run-list. This setting requires that the solved cookbooks appear as-is from the included policyfile lock. If conflicting attributes or cookbooks are provided, an error will be presented. See <a href="https://github.com/chef-boneyard/chef-rfc/blob/master/rfc097-policyfile-includes.md">RFC097</a> for the full specifications of this feature.</p> <p>Pull the policyfile lock from <code>./NAME.lock.json</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">include_policy <span style="color:#4070a0">'NAME'</span>, <span style="color:#517918">path</span>: <span style="color:#4070a0">'.'</span>
</code></pre></div>
<p>Pull the policyfile lock from <code>./foo.lock.json</code>.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">include_policy <span style="color:#4070a0">'NAME'</span>, <span style="color:#517918">path</span>: <span style="color:#4070a0">'./foo.lock.json'</span>
</code></pre></div>
<p>Pull the policyfile lock <code>foo.lock.json</code> from the <code>example/foo</code> Git repository on the <code>git.example.com</code> Git server.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">include_policy <span style="color:#4070a0">'NAME'</span>, <span style="color:#517918">git</span>: <span style="color:#4070a0">'https://git.example.com/example/foo'</span>, <span style="color:#517918">path</span>: <span style="color:#4070a0">'foo.lock.json'</span>
</code></pre></div>
<p>Pull the policyfile lock from <code>./bar.lock.json</code> with revision ID ‘revision1’.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">include_policy <span style="color:#4070a0">'NAME'</span>, <span style="color:#517918">policy_revision_id</span>: <span style="color:#4070a0">'revision1'</span>, <span style="color:#517918">path</span>: <span style="color:#4070a0">'./bar.lock.json'</span>
</code></pre></div>
<p>Pull the policyfile lock from a remote server <code>https://internal.example.com/foo.lock.json</code>.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">include_policy <span style="color:#4070a0">'NAME'</span>, <span style="color:#517918">remote</span>: <span style="color:#4070a0">'https://internal.example.com/foo.lock.json'</span>
</code></pre></div>
<p>Pull the policyfile lock from a remote server <code>https://internal.example.com/bar.lock.json</code> and with revision ID ‘revision1’.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">include_policy <span style="color:#4070a0">'NAME'</span>, <span style="color:#517918">policy_revision_id</span>: <span style="color:#4070a0">'revision1'</span>, <span style="color:#517918">remote</span>: <span style="color:#4070a0">'https://internal.example.com/foo.lock.json'</span>
</code></pre></div>
<p>Pull the policy <code>NAME</code> with revision ID <code>revision1</code> from the <code>http://chef-server.example</code> Chef Infra Server:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">include_policy <span style="color:#4070a0">'NAME'</span>, <span style="color:#517918">policy_revision_id</span>: <span style="color:#4070a0">'revision1'</span>, <span style="color:#517918">server</span>: <span style="color:#4070a0">'http://chef-server.example'</span>
</code></pre></div>
<p>Pull the policy <code>foo</code> with revision ID <code>revision1</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">include_policy <span style="color:#4070a0">'NAME'</span>, <span style="color:#517918">policy_name</span>: <span style="color:#4070a0">'foo'</span>, <span style="color:#517918">policy_revision_id</span>: <span style="color:#4070a0">'revision1'</span>, <span style="color:#517918">server</span>: <span style="color:#4070a0">'http://chef-server.example'</span>
</code></pre></div>
<p>Pull and lock the current revision for policy <code>foo</code> in policy group <code>prod</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">include_policy <span style="color:#4070a0">'NAME'</span>, <span style="color:#517918">policy_name</span>: <span style="color:#4070a0">'foo'</span>, <span style="color:#517918">policy_group</span>: <span style="color:#4070a0">'prod'</span>, <span style="color:#517918">server</span>: <span style="color:#4070a0">'http://chef-server.example'</span>
</code></pre></div>
</dd> </dl> <h3 id="example">Example</h3> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">name</span> <span style="color:#4070a0">'jenkins-master'</span>
run_list <span style="color:#4070a0">'java'</span>, <span style="color:#4070a0">'jenkins::master'</span>, <span style="color:#4070a0">'recipe[policyfile_demo]'</span>
default_source <span style="color:#517918">:supermarket</span>, <span style="color:#4070a0">'https://mysupermarket.example'</span>
cookbook <span style="color:#4070a0">'policyfile_demo'</span>, <span style="color:#517918">path</span>: <span style="color:#4070a0">'cookbooks/policyfile_demo'</span>
cookbook <span style="color:#4070a0">'jenkins'</span>, <span style="color:#4070a0">'~&gt; 8.2'</span>
cookbook <span style="color:#4070a0">'mysql'</span>, <span style="color:#517918">github</span>: <span style="color:#4070a0">'sous-chefs/mysql'</span>, <span style="color:#517918">branch</span>: <span style="color:#4070a0">'master'</span>
</code></pre></div>
<h2 id="clientrb-settings">client.rb Settings</h2> <p>The following settings may be configured in the client.rb file for use with Policyfile:</p> <dl> <dt><code>named_run_list</code></dt> <dd> <p>The run-list associated with a policy file.</p> </dd> <dt><code>policy_group</code></dt> <dd> <p>The name of a policy group that exists on the Chef Infra Server. <code>policy_name</code> must also be specified.</p> </dd> <dt><code>policy_name</code></dt> <dd> <p>The name of a policy, as identified by the <code>name</code> setting in a <code>Policyfile.rb</code> file. <code>policy_group</code> must also be specified.</p> </dd> <dt><code>use_policyfile</code></dt> <dd> <p>Chef Infra Client automatically checks the configuration, node JSON, and the stored node on the Chef Infra Server to determine if Policyfile files are being used, and then automatically updates this flag. Default value: <code>false</code>.</p> </dd> </dl> <h2 id="knife-bootstrap">knife bootstrap</h2> <p>A node may be bootstrapped to use Policyfile files. Use the following options as part of the bootstrap command:</p> <dl> <dt><code>--policy-group POLICY_GROUP</code></dt> <dd> <p>The name of a policy group that exists on the Chef Infra Server.</p> </dd> <dt><code>--policy-name POLICY_NAME</code></dt> <dd> <p>The name of a policy, as identified by the <code>name</code> setting in a <code>Policyfile.rb</code> file.</p> </dd> </dl> <p>For a customized bootstrap process, add <code>policy_name</code> and <code>policy_group</code> to the first-boot JSON file that is passed to Chef Infra Client.</p> <h2 id="knife-search">knife search</h2> <p>The <code>policy_name</code> and <code>policy_group</code> settings for a node are stored as searchable attributes and as such are available when using a fuzzy matching search pattern. For example: <code>knife search dev</code> will return nodes that are part of the <code>dev</code> policy group.</p> <h2 id="test-wkitchen">Test w/Kitchen</h2> <p>Kitchen may be used to test Policyfile files. Add the following to kitchen.yml:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:700">provisioner</span>:<span style="color:#062873;font-weight:700">name</span>:chef_zero</code></pre></div>
<p>A named run-list may be used on a per-suite basis:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:700">suites</span>:- <span style="color:#062873;font-weight:700">name</span>:client<span style="color:#062873;font-weight:700">provisioner</span>:<span style="color:#062873;font-weight:700">named_run_list</span>:test_client_recipe- <span style="color:#062873;font-weight:700">name</span>:server<span style="color:#062873;font-weight:700">provisioner</span>:<span style="color:#062873;font-weight:700">named_run_list</span>:test_server_recipe</code></pre></div>
<p>or globally:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:700">provisioner</span>:<span style="color:#062873;font-weight:700">name</span>:chef_zero<span style="color:#062873;font-weight:700">named_run_list</span>:integration_test_run_list</code></pre></div>
<p>or testing with policies per-suite, once the Policyfile files are available in your repo:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:700">suites</span>:- <span style="color:#062873;font-weight:700">name</span>:defaultmega<span style="color:#062873;font-weight:700">provisioner</span>:<span style="color:#062873;font-weight:700">policyfile</span>:policies/default.rb- <span style="color:#062873;font-weight:700">name</span>:defaultultra<span style="color:#062873;font-weight:700">provisioner</span>:<span style="color:#062873;font-weight:700">policyfile</span>:policies/defaulttwo.rb</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> As <code>chef_zero</code> explicitly tests outside the context of a Chef Infra Server, the <code>policy_groups</code> concept is not applicable. The value of <code>policy_group</code> during a converge will be set to <code>local</code>. </div> </div> <h2 id="chef-commands">chef Commands</h2> <p>The following commands are built into the <code>chef</code> executable and support the use of Policyfile files.</p> <h3 id="chef-clean-policy-cookbooks">chef clean-policy-cookbooks</h3> <p>Use the <code>chef clean-policy-cookbooks</code> subcommand to delete cookbooks that are not used by Policyfile files. Cookbooks are considered unused when they are not referenced by any policy revisions on the Chef Infra Server.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Cookbooks that are referenced by orphaned policy revisions are not removed. Use <code>chef clean-policy-revisions</code> to remove orphaned policies.</p> </div> </div> <h4 id="syntax-1">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef clean-policy-cookbooks <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-c CONFIG_FILE</code>, <code>--config CONFIG_FILE</code>
</dt> <dd> <p>The path to the knife configuration file.</p> </dd> <dt>
<code>-D</code>, <code>--debug</code>
</dt> <dd> <p>Enable stack traces and other debug output. Default value: <code>false</code>.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h3 id="chef-clean-policy-revisions">chef clean-policy-revisions</h3> <p>Use the <code>chef clean-policy-revisions</code> subcommand to delete orphaned policy revisions to Policyfile files from the Chef Infra Server. An orphaned policy revision is not associated to any policy group and therefore is not in active use by any node. Use <code>chef show-policy --orphans</code> to view a list of orphaned policy revisions.</p> <h4 id="syntax-2">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef clean-policy-revisions <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options-1">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-c CONFIG_FILE</code>, <code>--config CONFIG_FILE</code>
</dt> <dd> <p>The path to the knife configuration file.</p> </dd> <dt>
<code>-D</code>, <code>--debug</code>
</dt> <dd> <p>Enable stack traces and other debug output. Default value: <code>false</code>.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h3 id="chef-delete-policy">chef delete-policy</h3> <p>Use the <code>chef delete-policy</code> subcommand to delete all revisions of the named policy that exist on the Chef Infra Server. (The state of the policy revision is backed up locally and may be restored using the <code>chef undelete</code> subcommand.)</p> <h4 id="syntax-3">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef delete-policy POLICY_NAME <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options-2">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-c CONFIG_FILE</code>, <code>--config CONFIG_FILE</code>
</dt> <dd> <p>The path to the knife configuration file.</p> </dd> <dt>
<code>-D</code>, <code>--debug</code>
</dt> <dd> <p>Enable stack traces and other debug output. Default value: <code>false</code>.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h3 id="chef-delete-policy-group">chef delete-policy-group</h3> <p>Use the <code>chef delete-policy-group</code> subcommand to delete the named policy group from the Chef Infra Server. Any policy revision associated with that policy group is not deleted. (The state of the policy group is backed up locally and may be restored using the <code>chef undelete</code> subcommand.)</p> <h4 id="syntax-4">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef delete-policy-group POLICY_GROUP <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options-3">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-c CONFIG_FILE</code>, <code>--config CONFIG_FILE</code>
</dt> <dd> <p>The path to the knife configuration file.</p> </dd> <dt>
<code>-D</code>, <code>--debug</code>
</dt> <dd> <p>Enable stack traces and other debug output. Default value: <code>false</code>.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h3 id="chef-diff">chef diff</h3> <p>Use the <code>chef diff</code> subcommand to display an itemized comparison of two revisions of a <code>Policyfile.lock.json</code> file.</p> <h4 id="syntax-5">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef diff POLICY_FILE --head | --git POLICY_GROUP | POLICY_GROUP...POLICY_GROUP <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options-4">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-c CONFIG_FILE</code>, <code>--config CONFIG_FILE</code>
</dt> <dd> <p>The path to the knife configuration file.</p> </dd> <dt>
<code>-D</code>, <code>--debug</code>
</dt> <dd> <p>Enable stack traces and other debug output. Default value: <code>false</code>.</p> </dd> <dt>
<code>-g GIT_REF</code>, <code>--git GIT_REF</code>
</dt> <dd> <p>Compare the specified git reference against the current revision of a <code>Policyfile.lock.json</code> file or against another git reference.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt><code>--head</code></dt> <dd> <p>A shortcut for <code>chef diff --git HEAD</code>. When a git-specific flag is not provided, the on-disk <code>Policyfile.lock.json</code> file is compared to one on the Chef Infra Server or (if a <code>Policyfile.lock.json</code> file is not present on-disk) two <code>Policyfile.lock.json</code> files in the specified policy group on the Chef Infra Server are compared.</p> </dd> <dt><code>--[no-]pager</code></dt> <dd> <p>Use <code>--pager</code> to enable paged output for a <code>Policyfile.lock.json</code> file. Default value: <code>--pager</code>.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h4 id="examples">Examples</h4> <h5 id="compare-current-lock-to-latest-commit-on-latest-branch">Compare current lock to latest commit on latest branch</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef diff --git HEAD
</code></pre></div>
<h5 id="compare-current-lock-with-latest-commit-on-master-branch">Compare current lock with latest commit on master branch</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef diff --git master
</code></pre></div>
<h5 id="compare-current-lock-to-specified-revision">Compare current lock to specified revision</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef diff --git v1.0.0
</code></pre></div>
<h5 id="compare-lock-on-master-branch-to-lock-on-revision">Compare lock on master branch to lock on revision</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef diff --git master...dev
</code></pre></div>
<h5 id="compare-lock-for-version-with-latest-commit-on-master-branch">Compare lock for version with latest commit on master branch</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef diff --git v1.0.0...master
</code></pre></div>
<h5 id="compare-current-lock-with-latest-lock-for-policy-group">Compare current lock with latest lock for policy group</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef diff staging
</code></pre></div>
<h5 id="compare-locks-for-two-policy-group">Compare locks for two policy group</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef diff production...staging
</code></pre></div>
<h3 id="chef-export">chef export</h3> <p>Use the <code>chef export</code> subcommand to create a chef-zero-compatible chef-repo that contains the cookbooks described by a <code>Policyfile.lock.json</code> file. After a chef-zero-compatible chef-repo is copied to a node, the policy can be applied locally on that machine by running <code>chef-client -z</code> (local mode).</p> <h4 id="syntax-6">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#007020">export</span> POLICY_FILE DIRECTORY <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options-5">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-a</code>, <code>--archive</code>
</dt> <dd> <p>Export an archive as a tarball, instead as a directory. Default value: <code>false</code>.</p> </dd> <dt>
<code>-D</code>, <code>--debug</code>
</dt> <dd> <p>Enable stack traces and other debug output. Default value: <code>false</code>.</p> </dd> <dt>
<code>-f</code>, <code>--force</code>
</dt> <dd> <p>Remove the contents of the destination directory if that directory is not empty. Default value: <code>false</code>.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h3 id="chef-generate-policyfile">chef generate policyfile</h3> <p>Use the <code>chef generate policyfile</code> subcommand to generate a file to be used with Policyfile.</p> <h4 id="syntax-7">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef generate policyfile POLICY_NAME <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options-6">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h3 id="chef-generate-repo">chef generate repo</h3> <p>Use the <code>chef generate repo</code> subcommand to create a chef-repo. By default, the repo is a cookbook repo with options available to support generating a cookbook that supports Policyfile.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> This subcommand requires using one (or more) of the options (below) to support Policyfile files. </div> </div> <h4 id="syntax-8">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef generate repo REPO_NAME <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options-7">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-p</code>, <code>--policy-only</code>
</dt> <dd> <p>Create a repository that does not store cookbook files, only Policyfile files.</p> </dd> <dt>
<code>-P</code>, <code>--policy</code>
</dt> <dd> <p>Use Policyfile instead of Berkshelf.</p> </dd> <dt>
<code>-r</code>, <code>--roles</code>
</dt> <dd> <p>Create directories for <code>/roles</code> and <code>/environments</code> instead of creating directories for Policyfile.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h3 id="chef-install">chef install</h3> <p>Use the <code>chef install</code> subcommand to evaluate a policy file and find a compatible set of cookbooks, build a run-list, cache it locally, and then emit a <code>Policyfile.lock.json</code> file that describes the locked policy set. The <code>Policyfile.lock.json</code> file may be used to install the locked policy set to other machines and may be pushed to a policy group on the Chef Infra Server to apply that policy to a group of nodes that are under management by Chef.</p> <h4 id="syntax-9">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef install POLICY_FILE <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options-8">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-D</code>, <code>--debug</code>
</dt> <dd> <p>Enable stack traces and other debug output.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h4 id="policyfilelockjson">Policyfile.lock.json</h4> <p>When the <code>chef install</code> command is run, Chef Workstation caches any necessary cookbooks and emits a <code>Policyfile.lock.json</code> file that describes:</p> <ul> <li>The versions of cookbooks in use</li> <li>A Hash of cookbook content</li> <li>The source for all cookbooks</li> </ul> <p>A <code>Policyfile.lock.json</code> file is associated with a specific policy group, i.e. is associated with one (or more) nodes that use the same revision of a given policy.</p> <p>A <code>Policyfile.lock.json</code> file is similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"revision_id"</span><span style="color:#666">:</span> <span style="color:#4070a0">"288ed244f8db8bff3caf58147e840bbe079f76e0"</span>,
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"jenkins"</span>,
  <span style="color:#4070a0">"run_list"</span><span style="color:#666">:</span> [
    <span style="color:#4070a0">"recipe[java::default]"</span>,
    <span style="color:#4070a0">"recipe[jenkins::master]"</span>,
    <span style="color:#4070a0">"recipe[policyfile_demo::default]"</span>
  ],
  <span style="color:#4070a0">"cookbook_locks"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"policyfile_demo"</span><span style="color:#666">:</span> {
      <span style="color:#4070a0">"version"</span><span style="color:#666">:</span> <span style="color:#4070a0">"0.1.0"</span>,
      <span style="color:#4070a0">"identifier"</span><span style="color:#666">:</span> <span style="color:#4070a0">"f04cc40faf628253fe7d9566d66a1733fb1afbe9"</span>,
      <span style="color:#4070a0">"dotted_decimal_identifier"</span><span style="color:#666">:</span> <span style="color:#4070a0">"67638399371010690.23642238397896298.25512023620585"</span>,
      <span style="color:#4070a0">"source"</span><span style="color:#666">:</span> <span style="color:#4070a0">"cookbooks/policyfile_demo"</span>,
      <span style="color:#4070a0">"cache_key"</span><span style="color:#666">:</span> <span style="color:#007020;font-weight:700">null</span>,
      <span style="color:#4070a0">"scm_info"</span><span style="color:#666">:</span> <span style="color:#007020;font-weight:700">null</span>,
      <span style="color:#4070a0">"source_options"</span><span style="color:#666">:</span> {
        <span style="color:#4070a0">"path"</span><span style="color:#666">:</span> <span style="color:#4070a0">"cookbooks/policyfile_demo"</span>
      }
    },
  <span style="color:#4070a0">"java"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"version"</span><span style="color:#666">:</span> <span style="color:#4070a0">"1.24.0"</span>,
    <span style="color:#4070a0">"identifier"</span><span style="color:#666">:</span> <span style="color:#4070a0">"4c24ae46a6633e424925c24e683e0f43786236a3"</span>,
    <span style="color:#4070a0">"dotted_decimal_identifier"</span><span style="color:#666">:</span> <span style="color:#4070a0">"21432429158228798.18657774985439294.16782456927907"</span>,
    <span style="color:#4070a0">"cache_key"</span><span style="color:#666">:</span> <span style="color:#4070a0">"java-1.24.0-supermarket.chef.io"</span>,
    <span style="color:#4070a0">"origin"</span><span style="color:#666">:</span> <span style="color:#4070a0">"https://supermarket.chef.io/api/v1/cookbooks/java/versions/1.24.0/download"</span>,
    <span style="color:#4070a0">"source_options"</span><span style="color:#666">:</span> {
      <span style="color:#4070a0">"artifactserver"</span><span style="color:#666">:</span> <span style="color:#4070a0">"https://supermarket.chef.io/api/v1/cookbooks/java/versions/1.24.0/download"</span>,
      <span style="color:#4070a0">"version"</span><span style="color:#666">:</span> <span style="color:#4070a0">"1.24.0"</span>
    }
</code></pre></div>
<h3 id="chef-push">chef push</h3> <p>Use the <code>chef push</code> subcommand to upload an existing <code>Policyfile.lock.json</code> file to the Chef Infra Server, along with all of the cookbooks that are contained in the file. The <code>Policyfile.lock.json</code> file will be applied to the specified policy group, which is a set of nodes that share the same run-list and cookbooks.</p> <h4 id="syntax-10">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef push POLICY_GROUP POLICY_FILE <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options-9">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-c CONFIG_FILE</code>, <code>--config CONFIG_FILE</code>
</dt> <dd> <p>The path to the knife configuration file.</p> </dd> <dt>
<code>-D</code>, <code>--debug</code>
</dt> <dd> <p>Enable stack traces and other debug output.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h3 id="chef-push-archive">chef push-archive</h3> <p>The <code>chef push-archive</code> subcommand is used to publish a policy archive file to the Chef Infra Server. (A policy archive is created using the <code>chef export</code> subcommand.) The policy archive is assigned to the specified policy group, which is a set of nodes that share the same run-list and cookbooks.</p> <h4 id="syntax-11">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef push-archive POLICY_GROUP ARCHIVE_FILE <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options-10">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-c CONFIG_FILE</code>, <code>--config CONFIG_FILE</code>
</dt> <dd> <p>The path to the knife configuration file.</p> </dd> <dt>
<code>-D</code>, <code>--debug</code>
</dt> <dd> <p>Enable stack traces and other debug output. Default value: <code>false</code>.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h3 id="chef-show-policy">chef show-policy</h3> <p>Use the <code>chef show-policy</code> subcommand to display revisions for every <code>Policyfile.rb</code> file that is on the Chef Infra Server. By default, only active policy revisions are shown. When both a policy and policy group are specified, the contents of the active <code>Policyfile.lock.json</code> file for the policy group is returned.</p> <h4 id="syntax-12">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef show-policy POLICY_NAME POLICY_GROUP <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options-11">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-c CONFIG_FILE</code>, <code>--config CONFIG_FILE</code>
</dt> <dd> <p>The path to the knife configuration file.</p> </dd> <dt>
<code>-D</code>, <code>--debug</code>
</dt> <dd> <p>Enable stack traces and other debug output. Default value: <code>false</code>.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-o</code>, <code>--orphans</code>
</dt> <dd> <p>Show policy revisions that are not currently assigned to any policy group.</p> </dd> <dt><code>--[no-]pager</code></dt> <dd> <p>Use <code>--pager</code> to enable paged output for a <code>Policyfile.lock.json</code> file. Default value: <code>--pager</code>.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h3 id="chef-undelete">chef undelete</h3> <p>Use the <code>chef undelete</code> subcommand to recover a deleted policy or policy group. This command:</p> <ul> <li>Does not detect conflicts. If a deleted item has been recreated, running this command will overwrite it</li> <li>Does not include cookbooks that may be referenced by policy files; cookbooks that are cleaned after running this command may not be fully restorable to their previous state</li> <li>Does not store access control data</li> </ul> <h4 id="syntax-13">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef undelete <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<p>When run with no arguments, returns a list of available operations.</p> <h4 id="options-12">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-c CONFIG_FILE</code>, <code>--config CONFIG_FILE</code>
</dt> <dd> <p>The path to the knife configuration file.</p> </dd> <dt>
<code>-D</code>, <code>--debug</code>
</dt> <dd> <p>Enable stack traces and other debug output.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-i ID</code>, <code>--id ID</code>
</dt> <dd> <p>Undo the delete operation specified by <code>ID</code>.</p> </dd> <dt>
<code>-l</code>, <code>--last</code>
</dt> <dd> <p>Undo the most recent delete operation.</p> </dd> <dt><code>--list</code></dt> <dd> <p>Default. Return a list of available operations.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> <h3 id="chef-update">chef update</h3> <p>Use the <code>chef update</code> subcommand to read the <code>Policyfile.rb</code> file, and then apply any changes. This will resolve dependencies and will create a <code>Policyfile.lock.json</code> file. The locked policy will reflect any changes to the run-list and will pull in any cookbook updates that are compatible with any version constraints defined in the <code>Policyfile.rb</code> file.</p> <h4 id="syntax-14">Syntax</h4> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef update POLICY_FILE <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h4 id="options-13">Options</h4> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-a</code>, <code>--attributes</code>
</dt> <dd> <p>Update attributes. Default value: <code>false</code>.</p> </dd> <dt>
<code>-D</code>, <code>--debug</code>
</dt> <dd> <p>Enable stack traces and other debug output. Default value: <code>false</code>.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> </dl> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/policyfile/" class="_attribution-link">https://docs.chef.io/policyfile/</a>
  </p>
</div>
