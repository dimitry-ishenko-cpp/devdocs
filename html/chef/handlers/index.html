<div id="col-content" data-swiftype-index="true"> <div id="about-handlers"><h1>About Handlers</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-web-docs/blob/main/content/handlers.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Use a handler to identify situations that arise during a Chef Infra Client run, and then tell Chef Infra Client how to handle these situations when they occur.</p> <p>There are three types of handlers:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Handler</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>exception</td> <td>An exception handler is used to identify situations that have caused a Chef Infra Client run to fail. An exception handler can be loaded at the start of a Chef Infra Client run by adding a recipe that contains the <strong>chef_handler</strong> resource to a node's run-list. An exception handler runs when the <code>failed?</code> property for the <code>run_status</code> object returns <code>true</code>.</td> </tr> <tr> <td>report</td> <td>A report handler is used when a Chef Infra Client run succeeds and reports back on certain details about that Chef Infra Client run. A report handler can be loaded at the start of a Chef Infra Client run by adding a recipe that contains the <strong>chef_handler</strong> resource to a node's run-list. A report handler runs when the <code>success?</code> property for the <code>run_status</code> object returns <code>true</code>.</td> </tr> <tr> <td>start</td> <td>A start handler is used to run events at the beginning of a Chef Infra Client run. A start handler can be loaded at the start of a Chef Infra Client run by adding the start handler to the <code>start_handlers</code> setting in the client.rb file or by installing the gem that contains the start handler by using the <strong>chef_gem</strong> resource in a recipe in the <strong>chef-client</strong> cookbook. (A start handler may not be loaded using the <code>chef_handler</code> resource.)</td> </tr> </tbody> </table> <h2 id="exceptionreport-handlers">Exception/Report Handlers</h2> <p>Exception and report handlers are used to trigger certain behaviors in response to specific situations, typically identified during a Chef Infra Client run.</p> <ul> <li>An exception handler is used to trigger behaviors when a defined aspect of a Chef Infra Client run fails.</li> <li>A report handler is used to trigger behaviors when a defined aspect of a Chef Infra Client run is successful.</li> </ul> <p>Both types of handlers can be used to gather data about a Chef Infra Client run and can provide rich levels of data about all types of usage, which can be used later for trending and analysis across the entire organization.</p> <p>Exception and report handlers are made available to a Chef Infra Client run in one of the following ways:</p> <ul> <li>By adding the <strong>chef_handler</strong> resource to a recipe, and then adding that recipe to the run-list for a node. (The <strong>chef_handler</strong> resource is available from the <strong>chef_handler</strong> cookbook.)</li> <li>By adding the handler to one of the following settings in the node’s client.rb file: <code>exception_handlers</code> and/or <code>report_handlers</code>
</li> </ul> <h3 id="run-from-recipes">Run from Recipes</h3> <p>The <strong>chef_handler</strong> resource allows exception and report handlers to be enabled from within recipes, which can then added to the run-list for any node on which the exception or report handler should run. The <strong>chef_handler</strong> resource is available from the <strong>chef_handler</strong> cookbook.</p> <p>To use the <strong>chef_handler</strong> resource in a recipe, add code similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'name_of_handler'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'/path/to/handler/handler_name'</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>For example, a handler for Growl needs to be enabled at the beginning of a Chef Infra Client run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_gem <span style="color:#4070a0">'chef-handler-growl'</span>
</code></pre></div>
<p>and then is activated in a recipe by using the <strong>chef_handler</strong> resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'Chef::Handler::Growl'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef/handler/growl'</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="run-from-clientrb">Run from client.rb</h3> <p>A simple exception or report handler may be installed and configured at run-time. This requires editing of a node’s client.rb file to add the appropriate setting and information about that handler to the client.rb or solo.rb files. Depending on the handler type, one (or more) of the following settings must be added:</p> <table> <col style="width:40%"> <col style="width:60%"> <thead> <tr class="header"> <th>Setting</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>exception_handlers</code></td> <td>A list of exception handlers that are available to Chef Infra Client during a Chef Infra Client run.</td> </tr> <tr> <td><code>report_handlers</code></td> <td>A list of report handlers that are available to Chef Infra Client during a Chef Infra Client run.</td> </tr> </tbody> </table> <p>When this approach is used, the client.rb file must also tell Chef Infra Client how to install and run the handler. There is no default install location for handlers. The simplest way to distribute and install them is via RubyGems, though other methods such as GitHub or HTTP will also work. Once the handler is installed on the system, enable it in the client.rb file by requiring it. After the handler is installed, it may require additional configuration. This will vary from handler to handler. If a handler is a very simple handler, it may only require the creation of a new instance. For example, if a handler named <code>MyOrg::EmailMe</code> is hardcoded for all of the values required to send email, a new instance is required. And then the custom handler must be associated with each of the handler types for which it will run.</p> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'/var/chef/handlers/email_me'</span>         <span style="color:#60a0b0;font-style:italic"># the installation path</span>

email_handler <span style="color:#666">=</span> <span style="color:#60add5">MyOrg</span><span style="color:#666">::</span><span style="color:#60add5">EmailMe</span><span style="color:#666">.</span>new            <span style="color:#60a0b0;font-style:italic"># a simple handler</span>

start_handlers <span style="color:#666">&lt;&lt;</span> email_handler               <span style="color:#60a0b0;font-style:italic"># run at the start of the run</span>
report_handlers <span style="color:#666">&lt;&lt;</span> email_handler              <span style="color:#60a0b0;font-style:italic"># run at the end of a successful run</span>
exception_handlers <span style="color:#666">&lt;&lt;</span> email_handler           <span style="color:#60a0b0;font-style:italic"># run at the end of a failed run</span>
</code></pre></div>
<h2 id="start-handlers">Start Handlers</h2> <p>A start handler is not loaded into a Chef Infra Client run from a recipe, but is instead listed in the client.rb file using the <code>start_handlers</code> attribute. The start handler must be installed on the node and be available to Chef Infra Client prior to the start of a Chef Infra Client run. Use the <strong>chef-client</strong> cookbook to install the start handler.</p> <p>Start handlers are made available to a Chef Infra Client run in one of the following ways:</p> <ul> <li>By adding a start handler to the <strong>chef-client</strong> cookbook, which installs the handler on the node so that it is available to Chef Infra Client at the start of a Chef Infra Client run</li> <li>By adding the handler to one of the following settings in the node’s client.rb file: <code>start_handlers</code>
</li> </ul> <h3 id="run-from-recipes-1">Run from Recipes</h3> <p>The <strong>chef-client</strong> cookbook can be configured to automatically install and configure gems that are required by a start handler. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'load_gems'</span><span style="color:#666">][</span><span style="color:#4070a0">'chef-reporting'</span><span style="color:#666">]</span> <span style="color:#666">=</span> {
  <span style="color:#517918">require_name</span>: <span style="color:#4070a0">'chef_reporting'</span>,
  <span style="color:#517918">action</span>: <span style="color:#517918">:install</span>,
}

node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'start_handlers'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#666">[</span>
  {
    <span style="color:#517918">class</span>: <span style="color:#4070a0">'Chef::Reporting::StartHandler'</span>,
    <span style="color:#517918">arguments</span>: <span style="color:#666">[]</span>,
  },
<span style="color:#666">]</span>

include_recipe <span style="color:#4070a0">'chef-client::config'</span>
</code></pre></div>
<h3 id="run-from-clientrb-1">Run from client.rb</h3> <p>A start handler can be configured in the client.rb file by adding the following setting:</p> <table> <col style="width:40%"> <col style="width:60%"> <thead> <tr class="header"> <th>Setting</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>start_handlers</code></td> <td>A list of start handlers that are available to Chef Infra Client at the start of a Chef Infra Client run.</td> </tr> </tbody> </table> <p>For example, the Reporting start handler adds the following code to the top of the client.rb file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">begin</span>
  <span style="color:#007020">require</span> <span style="color:#4070a0">'chef_reporting'</span>
  start_handlers <span style="color:#666">&lt;&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Reporting</span><span style="color:#666">::</span><span style="color:#60add5">StartHandler</span><span style="color:#666">.</span>new()
<span style="color:#007020;font-weight:700">rescue</span> <span style="color:#60add5">LoadError</span>
  <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>warn <span style="color:#4070a0">'Failed to load #{lib}. This should be resolved after a chef run.'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This ensures that when a Chef Infra Client run begins the <code>chef_reporting</code> event handler is enabled. The <code>chef_reporting</code> event handler is part of a gem named <code>chef-reporting</code>. The <strong>chef_gem</strong> resource is used to install this gem:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_gem <span style="color:#4070a0">'chef-reporting'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:install</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h2 id="event-handlers">Event Handlers</h2> <p>Use the Handler DSL to attach a callback to an event. If the event occurs during a Chef Infra Client run, the associated callback is executed. For example:</p> <ul> <li>Sending email if a Chef Infra Client run fails</li> <li>Aggregating statistics about resources updated during a Chef Infra Client runs to StatsD</li> </ul> <h3 id="on-method">on Method</h3> <p>Use the <code>on</code> method to associate an event type with a callback. The callback defines what steps are taken if the event occurs during a Chef Infra Client run and is defined using arbitrary Ruby code. The syntax is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60add5">Chef</span><span style="color:#666">.</span>event_handler <span style="color:#007020;font-weight:700">do</span>
  on <span style="color:#517918">:event_type</span> <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#60a0b0;font-style:italic"># some Ruby</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where</p> <ul> <li>
<code>Chef.event_handler</code> declares a block of code within a recipe that is processed when the named event occurs during a Chef Infra Client run</li> <li>
<code>on</code> defines the block of code that will tell Chef Infra Client how to handle the event</li> <li>
<code>:event_type</code> is a valid exception event type, such as <code>:run_start</code>, <code>:run_failed</code>, <code>:converge_failed</code>, <code>:resource_failed</code>, or <code>:recipe_not_found</code>
</li> </ul> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">Chef.event_handler <span style="color:#007020;font-weight:700">do</span>
  on :converge_start <span style="color:#007020;font-weight:700">do</span>
    puts <span style="color:#4070a0">"Ohai! I have started a converge."</span>
  end
end
</code></pre></div>
<h3 id="event-types">Event Types</h3> <p>The following table describes the events that may occur during a Chef Infra Client run. Each of these events may be referenced in an <code>on</code> method block by declaring it as the event type.</p> <table> <col style="width:19%"> <col style="width:80%"> <thead> <tr class="header"> <th>Event</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>:run_start</code></td> <td>The start of a Chef Infra Client run.</td> </tr> <tr> <td><code>:run_started</code></td> <td>The Chef Infra Client run has started.</td> </tr> <tr> <td><code>:run_completed</code></td> <td>The Chef Infra Client run has completed.</td> </tr> <tr> <td><code>:run_failed</code></td> <td>The Chef Infra Client run has failed.</td> </tr> <tr> <td><code>:ohai_completed</code></td> <td>The Ohai run has completed.</td> </tr> <tr> <td><code>:skipping_registration</code></td> <td>The Chef Infra Client is not registering with the Chef Infra Server because it already has a private key or because it does not need one.</td> </tr> <tr> <td><code>:registration_start</code></td> <td>The Chef Infra Client is attempting to create a private key with which to register to the Chef Infra Server.</td> </tr> <tr> <td><code>:registration_completed</code></td> <td>The Chef Infra Client created its private key successfully.</td> </tr> <tr> <td><code>:registration_failed</code></td> <td>The Chef Infra Client encountered an error and was unable to register with the Chef Infra Server.</td> </tr> <tr> <td><code>:node_load_start</code></td> <td>The Chef Infra Client is attempting to load node data from the Chef Infra Server.</td> </tr> <tr> <td><code>:node_load_success</code></td> <td>The Chef Infra Client successfully loaded node data from the policy builder.</td> </tr> <tr> <td><code>:node_load_failed</code></td> <td>The Chef Infra Client encountered an error and was unable to load node data from the Chef Infra Server.</td> </tr> <tr> <td><code>:run_list_expand_failed</code></td> <td>The Chef Infra Client failed to expand the run-list.</td> </tr> <tr> <td><code>:node_load_completed</code></td> <td>The Chef Infra Client successfully loaded node data from the Chef Infra Server. Default and override attributes for roles have been computed, but are not yet applied.</td> </tr> <tr> <td><code>:policyfile_loaded</code></td> <td>The policy file was loaded.</td> </tr> <tr> <td><code>:cookbook_resolution_start</code></td> <td>The Chef Infra Client is attempting to pull down the cookbook collection from the Chef Infra Server.</td> </tr> <tr> <td><code>:cookbook_resolution_failed</code></td> <td>The Chef Infra Client failed to pull down the cookbook collection from the Chef Infra Server.</td> </tr> <tr> <td><code>:cookbook_resolution_complete</code></td> <td>The Chef Infra Client successfully pulled down the cookbook collection from the Chef Infra Server.</td> </tr> <tr> <td><code>:cookbook_clean_start</code></td> <td>The Chef Infra Client is attempting to remove unneeded cookbooks.</td> </tr> <tr> <td><code>:removed_cookbook_file</code></td> <td>The Chef Infra Client removed a file from a cookbook.</td> </tr> <tr> <td><code>:cookbook_clean_complete</code></td> <td>The Chef Infra Client is done removing cookbooks and/or cookbook files.</td> </tr> <tr> <td><code>:cookbook_sync_start</code></td> <td>The Chef Infra Client is attempting to synchronize cookbooks.</td> </tr> <tr> <td><code>:synchronized_cookbook</code></td> <td>The Chef Infra Client is attempting to synchronize the named cookbook.</td> </tr> <tr> <td><code>:updated_cookbook_file</code></td> <td>The Chef Infra Client updated the named file in the named cookbook.</td> </tr> <tr> <td><code>:cookbook_sync_failed</code></td> <td>The Chef Infra Client was unable to synchronize cookbooks.</td> </tr> <tr> <td><code>:cookbook_sync_complete</code></td> <td>The Chef Infra Client is finished synchronizing cookbooks.</td> </tr> <tr> <td><code>:cookbook_gem_start</code></td> <td>The Chef Infra Client is collecting gems from the cookbooks.</td> </tr> <tr> <td><code>:cookbook_gem_installing</code></td> <td>The Chef Infra Client is installing a cookbook gem.</td> </tr> <tr> <td><code>:cookbook_gem_using</code></td> <td>The Chef Infra Client is using a cookbook gem.</td> </tr> <tr> <td><code>:cookbook_gem_finished</code></td> <td>The Chef Infra Client finished installing cookbook gems.</td> </tr> <tr> <td><code>:cookbook_gem_failed</code></td> <td>The Chef Infra Client failed to install cookbook gems.</td> </tr> <tr> <td><code>:cookbook_compilation_start</code></td> <td> The Chef Infra Client created the run_context and is starting cookbook compilation.</td> </tr> <tr> <td><code>:library_load_start</code></td> <td>The Chef Infra Client is loading library files.</td> </tr> <tr> <td><code>:library_file_loaded</code></td> <td>The Chef Infra Client successfully loaded the named library file.</td> </tr> <tr> <td><code>:library_file_load_failed</code></td> <td>The Chef Infra Client was unable to load the named library file.</td> </tr> <tr> <td><code>:library_load_complete</code></td> <td>The Chef Infra Client is finished loading library files.</td> </tr> <tr> <td><code>:lwrp_load_start</code></td> <td>The Chef Infra Client is loading custom resources.</td> </tr> <tr> <td><code>:lwrp_file_loaded</code></td> <td>The Chef Infra Client successfully loaded the named custom resource.</td> </tr> <tr> <td><code>:lwrp_file_load_failed</code></td> <td>The Chef Infra Client was unable to load the named custom resource.</td> </tr> <tr> <td><code>:lwrp_load_complete</code></td> <td>The Chef Infra Client is finished loading custom resources.</td> </tr> <tr> <td><code>:ohai_plugin_load_start</code></td> <td>Ohai has started loading plugins.</td> </tr> <tr> <td><code>:ohai_plugin_file_loaded</code></td> <td>Ohai has loaded a plugin.</td> </tr> <tr> <td><code>:ohai_plugin_file_load_failed</code></td> <td>Ohai failed to load a plugin.</td> </tr> <tr> <td><code>:ohai_plugin_load_complete</code></td> <td>Ohai has completed loading plugins.</td> </tr> <tr> <td><code>:attribute_load_start</code></td> <td>The Chef Infra Client is loading attribute files.</td> </tr> <tr> <td><code>:attribute_file_loaded</code></td> <td>The Chef Infra Client successfully loaded the named attribute file.</td> </tr> <tr> <td><code>:attribute_file_load_failed</code></td> <td>The Chef Infra Client was unable to load the named attribute file.</td> </tr> <tr> <td><code>:attribute_load_complete</code></td> <td>The Chef Infra Client is finished loading attribute files.</td> </tr> <tr> <td><code>:definition_load_start</code></td> <td>The Chef Infra Client is loading definitions.</td> </tr> <tr> <td><code>:definition_file_loaded</code></td> <td>The Chef Infra Client successfully loaded the named definition.</td> </tr> <tr> <td><code>:definition_file_load_failed</code></td> <td>The Chef Infra Client was unable to load the named definition.</td> </tr> <tr> <td><code>:definition_load_complete</code></td> <td>The Chef Infra Client is finished loading definitions.</td> </tr> <tr> <td><code>:recipe_load_start</code></td> <td>The Chef Infra Client is loading recipes.</td> </tr> <tr> <td><code>:recipe_file_loaded</code></td> <td>The Chef Infra Client successfully loaded the named recipe.</td> </tr> <tr> <td><code>:recipe_file_load_failed</code></td> <td>The Chef Infra Client was unable to load the named recipe.</td> </tr> <tr> <td><code>:recipe_not_found</code></td> <td>The Chef Infra Client was unable to find the named recipe.</td> </tr> <tr> <td><code>:recipe_load_complete</code></td> <td>The Chef Infra Client is finished loading recipes.</td> </tr> <tr> <td><code>:cookbook_compilation_complete</code></td> <td>The Chef Infra Client completed all cookbook compilation phases.</td> </tr> <tr> <td><code>:converge_start</code></td> <td>The Chef Infra Client run converge phase has started.</td> </tr> <tr> <td><code>:action_collection_registration</code></td> <td>Provides a reference to the action_collection before cookbooks are compiled.</td> </tr> <tr> <td><code>:converge_complete</code></td> <td>The Chef Infra Client run converge phase is complete.</td> </tr> <tr> <td><code>:converge_failed</code></td> <td>The Chef Infra Client run converge phase has failed.</td> </tr> <tr> <td><code>:control_group_started</code></td> <td>The named control group is being processed.</td> </tr> <tr> <td><code>:control_example_success</code></td> <td>The named control group has been processed.</td> </tr> <tr> <td><code>:control_example_failure</code></td> <td>The named control group's processing has failed.</td> </tr> <tr> <td><code>:resource_action_start</code></td> <td>A resource action is starting.</td> </tr> <tr> <td><code>:resource_skipped</code></td> <td>A resource action was skipped.</td> </tr> <tr> <td><code>:resource_current_state_loaded</code></td> <td>A resource's current state was loaded.</td> </tr> <tr> <td><code>:resource_after_state_loaded</code></td> <td>A resource's after state was loaded.</td> </tr> <tr> <td><code>:resource_current_state_load_bypassed</code></td> <td>A resource's current state was not loaded because the resource does not support why-run mode.</td> </tr> <tr> <td><code>:resource_bypassed</code></td> <td>A resource action was skipped because the resource does not support why-run mode.</td> </tr> <tr> <td><code>:resource_update_applied</code></td> <td>A change has been made to a resource. (This event occurs for each change made to a resource.)</td> </tr>
<tr> <td><code>:resource_update_progress</code></td> <td>A resource sent a progress notification to the user to indicate overall progress of a long running operation.</td> </tr> <tr> <td><code>:resource_failed_retriable</code></td> <td>A resource action has failed and will be retried.</td> </tr> <tr> <td><code>:resource_failed</code></td> <td>A resource action has failed and will not be retried.</td> </tr> <tr> <td><code>:resource_updated</code></td> <td>A resource requires modification.</td> </tr> <tr> <td><code>:resource_up_to_date</code></td> <td>A resource is already correct.</td> </tr> <tr> <td><code>:resource_completed</code></td> <td>All actions for the resource are complete.</td> </tr> <tr> <td><code>:stream_opened</code></td> <td>A stream has opened.</td> </tr> <tr> <td><code>:stream_closed</code></td> <td>A stream has closed.</td> </tr> <tr> <td><code>:stream_output</code></td> <td>A chunk of data from a single named stream.</td> </tr> <tr> <td><code>:handlers_start</code></td> <td>The handler processing phase of a Chef Infra Client run has started.</td> </tr> <tr> <td><code>:handler_executed</code></td> <td>The named handler was processed.</td> </tr> <tr> <td><code>:handlers_completed</code></td> <td>The handler processing phase of a Chef Infra Client run is complete.</td> </tr> <tr> <td><code>:provider_requirement_failed</code></td> <td>An assertion declared by a provider has failed.</td> </tr> <tr> <td><code>:whyrun_assumption</code></td> <td>An assertion declared by a provider has failed, but execution is allowed to continue because the Chef Infra Client is running in why-run mode.</td> </tr> <td><code>:deprecation</code></td> <td>A deprecation message has been emitted.</td> <tr> <td><code>:attribute_changed</code></td> <td>Prints out all the attribute changes in cookbooks or sets a policy that override attributes should never be used.</td> </tr> </tbody> </table> <h3 id="examples">Examples</h3> <p>The following examples show ways to use the Handler DSL.</p> <h4 id="send-email">Send Email</h4> <p>Use the <code>on</code> method to create an event handler that sends email when a Chef Infra Client run fails. This will require:</p> <ul> <li>A way to tell Chef Infra Client how to send email</li> <li>An event handler that describes what to do when the <code>:run_failed</code> event is triggered</li> <li>A way to trigger the exception and test the behavior of the event handler</li> </ul> <h5 id="define-how-email-is-sent">Define How Email is Sent</h5> <p>Use a library to define the code that sends email when a Chef Infra Client run fails. Name the file <code>helper.rb</code> and add it to a cookbook’s <code>/libraries</code> directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'net/smtp'</span>

<span style="color:#007020;font-weight:700">module</span> <span style="color:#0e84b5;font-weight:700">HandlerSendEmail</span>
  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">Helper</span>
    <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">send_email_on_run_failure</span>(node_name)
      message <span style="color:#666">=</span> <span style="color:#4070a0">"From: Chef &lt;chef@chef.io&gt;</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">"</span>
      message <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">"To: Grant &lt;grantmc@chef.io&gt;</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">"</span>
      message <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">"Subject: Chef run failed</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">"</span>
      message <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">"Date: </span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Time</span><span style="color:#666">.</span>now<span style="color:#666">.</span>rfc2822<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\n\n</span><span style="color:#4070a0">"</span>
      message <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">"Chef run failed on </span><span style="color:#70a0d0;font-style:italic">#{</span>node_name<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">"</span>
      <span style="color:#60add5">Net</span><span style="color:#666">::</span><span style="color:#60add5">SMTP</span><span style="color:#666">.</span>start(<span style="color:#4070a0">'localhost'</span>, <span style="color:#40a070">25</span>) <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>smtp<span style="color:#666">|</span>
        smtp<span style="color:#666">.</span>send_message message, <span style="color:#4070a0">'chef@chef.io'</span>, <span style="color:#4070a0">'grantmc@chef.io'</span>
      <span style="color:#007020;font-weight:700">end</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <h5 id="add-the-handler">Add the Handler</h5> <p>Invoke the library helper in a recipe:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60add5">Chef</span><span style="color:#666">.</span>event_handler <span style="color:#007020;font-weight:700">do</span>
  on <span style="color:#517918">:run_failed</span> <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#60add5">HandlerSendEmail</span><span style="color:#666">::</span><span style="color:#60add5">Helper</span><span style="color:#666">.</span>new<span style="color:#666">.</span>send_email_on_run_failure(
      <span style="color:#60add5">Chef</span><span style="color:#666">.</span>run_context<span style="color:#666">.</span>node<span style="color:#666">.</span>name
    )
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<ul> <li>Use <code>Chef.event_handler</code> to define the event handler</li> <li>Use the <code>on</code> method to specify the event type</li> </ul> <p>Within the <code>on</code> block, tell Chef Infra Client how to handle the event when it’s triggered.</p> <h5 id="test-the-handler">Test the Handler</h5> <p>Use the following code block to trigger the exception and have the Chef Infra Client send email to the specified email address:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ruby_block <span style="color:#4070a0">'fail the run'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#007020;font-weight:700">raise</span> <span style="color:#4070a0">'deliberately fail the run'</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h4 id="etcd-locks">etcd Locks</h4> <p>The following example shows how to prevent concurrent Chef Infra Client runs from both holding a lock on etcd:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">lock_key <span style="color:#666">=</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">.</span>chef_environment<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">.</span>name<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>

<span style="color:#60add5">Chef</span><span style="color:#666">.</span>event_handler <span style="color:#007020;font-weight:700">do</span>
  on <span style="color:#517918">:converge_start</span> <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>run_context<span style="color:#666">|</span>
    <span style="color:#60add5">Etcd</span><span style="color:#666">.</span>lock_acquire(lock_key)
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60add5">Chef</span><span style="color:#666">.</span>event_handler <span style="color:#007020;font-weight:700">do</span>
  on <span style="color:#517918">:converge_complete</span> <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#60add5">Etcd</span><span style="color:#666">.</span>lock_release(lock_key)
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h4 id="hipchat-notifications">HipChat Notifications</h4> <p>Event messages can be sent to a team communication tool like HipChat. For example, if a Chef Infra Client run fails:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60add5">Chef</span><span style="color:#666">.</span>event_handler <span style="color:#007020;font-weight:700">do</span>
  on <span style="color:#517918">:run_failed</span> <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>exception<span style="color:#666">|</span>
    hipchat_notify exception<span style="color:#666">.</span>message
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or send an alert on a configuration change:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60add5">Chef</span><span style="color:#666">.</span>event_handler <span style="color:#007020;font-weight:700">do</span>
  on <span style="color:#517918">:resource_updated</span> <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>resource, action<span style="color:#666">|</span>
    <span style="color:#007020;font-weight:700">if</span> resource<span style="color:#666">.</span>to_s <span style="color:#666">==</span> <span style="color:#4070a0">'template[/etc/nginx/nginx.conf]'</span>
      <span style="color:#60add5">Helper</span><span style="color:#666">.</span>hipchat_message(<span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>resource<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0"> was updated by chef"</span>)
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h2 id="handlers-and-cookbooks">Handlers and Cookbooks</h2> <p>The following cookbooks can be used to load handlers during a Chef InfraClient run.</p> <h3 id="chef_handler">chef_handler</h3> <p>Exception and report handlers can be distributed using the <strong>chef_handler</strong> resource. This resource is included with Chef 14 and above. It can be used to enable custom handlers from within recipes and to include product-specific handlers from cookbooks.</p> <p>See the <a href="../resources/chef_handler/index.html">chef_handler Resource</a> documentation for more information.</p> <h3 id="chef-infra-client">Chef Infra Client</h3> <p>Start handlers can be distributed using the <strong>chef-client</strong> cookbook, which will install the handler on the target node during the initial configuration of the node. This ensures that the start handler is always present on the node so that it is available to Chef Infra Client at the start of every run.</p> <h2 id="custom-handlers">Custom Handlers</h2> <p>A custom handler can be created to support any situation. The easiest way to build a custom handler:</p> <ol> <li>Download the <strong>chef_handler</strong> cookbook</li> <li>Create a custom handler</li> <li>Write a recipe using the <strong>chef_handler</strong> resource</li> <li>Add that recipe to a node’s run-list, often as the first recipe in that run-list</li> </ol> <h3 id="syntax">Syntax</h3> <p>The syntax for a handler can vary, depending on what the the situations the handler is being asked to track, the type of handler being used, and so on. All custom exception and report handlers are defined using Ruby and must be a subclass of the <code>Chef::Handler</code> class.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/log'</span>

<span style="color:#007020;font-weight:700">module</span> <span style="color:#0e84b5;font-weight:700">ModuleName</span>
  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">HandlerName</span> <span style="color:#666">&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span>
    <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">report</span>
      <span style="color:#60a0b0;font-style:italic"># Ruby code goes here</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where:</p> <ul> <li>
<code>require</code> ensures that the logging functionality of Chef Infra Client is available to the handler</li> <li>
<code>ModuleName</code> is the name of the module as it exists within the <code>Chef</code> library</li> <li>
<code>HandlerName</code> is the name of the handler as it is used in a recipe</li> <li>
<code>report</code> is an interface that is used to define the custom handler</li> </ul> <p>For example, the following shows a custom handler that sends an email that contains the exception data when a Chef Infra Client run fails:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'net/smtp'</span>

<span style="color:#007020;font-weight:700">module</span> <span style="color:#0e84b5;font-weight:700">OrgName</span>
  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">SendEmail</span> <span style="color:#666">&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span>
    <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">report</span>
      <span style="color:#007020;font-weight:700">if</span> run_status<span style="color:#666">.</span>failed?
        message <span style="color:#666">=</span> <span style="color:#4070a0">"From: sender_name &lt;sender@example.com&gt;</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">"</span>
        message <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">"To: recipient_address &lt;recipient@example.com&gt;</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">"</span>
        message <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">"Subject: chef-client Run Failed</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">"</span>
        message <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">"Date: </span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Time</span><span style="color:#666">.</span>now<span style="color:#666">.</span>rfc2822<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\n\n</span><span style="color:#4070a0">"</span>
        message <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">"Chef run failed on </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">.</span>name<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">"</span>
        message <span style="color:#666">&lt;&lt;</span> <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>run_status<span style="color:#666">.</span>formatted_exception<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0;font-weight:700">\n</span><span style="color:#4070a0">"</span>
        message <span style="color:#666">&lt;&lt;</span> <span style="color:#007020">Array</span>(backtrace)<span style="color:#666">.</span>join(<span style="color:#4070a0">'\n'</span>)
        <span style="color:#60add5">Net</span><span style="color:#666">::</span><span style="color:#60add5">SMTP</span><span style="color:#666">.</span>start(<span style="color:#4070a0">'your.smtp.server'</span>, <span style="color:#40a070">25</span>) <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>smtp<span style="color:#666">|</span>
          smtp<span style="color:#666">.</span>send_message message, <span style="color:#4070a0">'sender@example'</span>, <span style="color:#4070a0">'recipient@example'</span>
        <span style="color:#007020;font-weight:700">end</span>
      <span style="color:#007020;font-weight:700">end</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then is used in a recipe like:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">send_email <span style="color:#4070a0">'blah'</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#60a0b0;font-style:italic"># recipe code</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="report-interface">report Interface</h3> <p>The <code>report</code> interface is used to define how a handler will behave and is a required part of any custom handler. The syntax for the <code>report</code> interface is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">report</span>
  <span style="color:#60a0b0;font-style:italic"># Ruby code</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The Ruby code used to define a custom handler will vary significantly from handler to handler. Chef Infra Client includes two default handlers: <code>error_report</code> and <code>json_file</code>. Their use of the <code>report</code> interface is shown below.</p> <p>The <a href="https://github.com/chef/chef/blob/main/lib/chef/handler/error_report.rb">error_report</a> handler:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/handler'</span>
<span style="color:#007020">require</span> <span style="color:#4070a0">'chef/resource/directory'</span>

<span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">Chef</span>
  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">Handler</span>
    <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">ErrorReport</span> <span style="color:#666">&lt;</span> <span style="color:#666">::</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span>
      <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">report</span>
        <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">FileCache</span><span style="color:#666">.</span>store(<span style="color:#4070a0">'failed-run-data.json'</span>, <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">JSONCompat</span><span style="color:#666">.</span>to_json_pretty(data), <span style="color:#40a070">0640</span>)
        <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>fatal(<span style="color:#4070a0">"Saving node information to </span><span style="color:#70a0d0;font-style:italic">#{</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">FileCache</span><span style="color:#666">.</span>load(<span style="color:#4070a0">'failed-run-data.json'</span>, <span style="color:#007020">false</span>)<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>)
      <span style="color:#007020;font-weight:700">end</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The <a href="https://github.com/chef/chef/blob/main/lib/chef/handler/json_file.rb">json_file</a> handler:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/handler'</span>
<span style="color:#007020">require</span> <span style="color:#4070a0">'chef/resource/directory'</span>

<span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">Chef</span>
  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">Handler</span>
    <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">JsonFile</span> <span style="color:#666">&lt;</span> <span style="color:#666">::</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span>
      <span style="color:#007020">attr_reader</span> <span style="color:#517918">:config</span>
      <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">initialize</span>(config <span style="color:#666">=</span> {})
        @config <span style="color:#666">=</span> config
        @config<span style="color:#666">[</span><span style="color:#517918">:path</span><span style="color:#666">]</span> <span style="color:#666">||=</span> <span style="color:#4070a0">'/var/chef/reports'</span>
        @config
      <span style="color:#007020;font-weight:700">end</span>

      <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">report</span>
        <span style="color:#007020;font-weight:700">if</span> exception
          <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>error(<span style="color:#4070a0">'Creating JSON exception report'</span>)
        <span style="color:#007020;font-weight:700">else</span>
          <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>info(<span style="color:#4070a0">'Creating JSON run report'</span>)
        <span style="color:#007020;font-weight:700">end</span>
        build_report_dir
        savetime <span style="color:#666">=</span> <span style="color:#60add5">Time</span><span style="color:#666">.</span>now<span style="color:#666">.</span>strftime(<span style="color:#4070a0">'%Y%m%d%H%M%S'</span>)
        <span style="color:#60add5">File</span><span style="color:#666">.</span>open(<span style="color:#60add5">File</span><span style="color:#666">.</span>join(config<span style="color:#666">[</span><span style="color:#517918">:path</span><span style="color:#666">]</span>, <span style="color:#4070a0">'chef-run-report-#{savetime}.json'</span>), <span style="color:#4070a0">'w'</span>) <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>file<span style="color:#666">|</span>
          run_data <span style="color:#666">=</span> data
          run_data<span style="color:#666">[</span><span style="color:#517918">:start_time</span><span style="color:#666">]</span> <span style="color:#666">=</span> run_data<span style="color:#666">[</span><span style="color:#517918">:start_time</span><span style="color:#666">].</span>to_s
          run_data<span style="color:#666">[</span><span style="color:#517918">:end_time</span><span style="color:#666">]</span> <span style="color:#666">=</span> run_data<span style="color:#666">[</span><span style="color:#517918">:end_time</span><span style="color:#666">].</span>to_s
          file<span style="color:#666">.</span>puts <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">JSONCompat</span><span style="color:#666">.</span>to_json_pretty(run_data)
        <span style="color:#007020;font-weight:700">end</span>
      <span style="color:#007020;font-weight:700">end</span>

      <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">build_report_dir</span>
        <span style="color:#007020;font-weight:700">unless</span> <span style="color:#60add5">File</span><span style="color:#666">.</span>exist?(config<span style="color:#666">[</span><span style="color:#517918">:path</span><span style="color:#666">]</span>)
          <span style="color:#60add5">FileUtils</span><span style="color:#666">.</span>mkdir_p(config<span style="color:#666">[</span><span style="color:#517918">:path</span><span style="color:#666">]</span>)
          <span style="color:#60add5">File</span><span style="color:#666">.</span>chmod(<span style="color:#40a070">00700</span>, config<span style="color:#666">[</span><span style="color:#517918">:path</span><span style="color:#666">]</span>)
        <span style="color:#007020;font-weight:700">end</span>
      <span style="color:#007020;font-weight:700">end</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="optional-interfaces">Optional Interfaces</h3> <p>The following interfaces may be used in a handler in the same way as the <code>report</code> interface to override the default handler behavior in Chef Infra Client. That said, the following interfaces are not typically used in a handler and, for the most part, are completely unnecessary for a handler to work properly and/or as desired.</p> <h4 id="data">data</h4> <p>The <code>data</code> method is used to return the Hash representation of the <code>run_status</code> object. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">data</span>
  @run_status<span style="color:#666">.</span>to_hash
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h4 id="run_report_safely">run_report_safely</h4> <p>The <code>run_report_safely</code> method is used to run the report handler, rescuing and logging errors that may arise as the handler runs and ensuring that all handlers get a chance to run during a Chef Infra Client run (even if some handlers fail during that run). In general, this method should never be used as an interface in a custom handler unless this default behavior simply must be overridden.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">run_report_safely</span>(run_status)
  run_report_unsafe(run_status)
<span style="color:#007020;font-weight:700">rescue</span> <span style="color:#60add5">Exception</span> <span style="color:#666">=&gt;</span> e
  <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>error(<span style="color:#4070a0">'Report handler #{self.class.name} raised #{e.inspect}'</span>)
  <span style="color:#007020">Array</span>(e<span style="color:#666">.</span>backtrace)<span style="color:#666">.</span>each { <span style="color:#666">|</span>line<span style="color:#666">|</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>error(line) }
<span style="color:#007020;font-weight:700">ensure</span>
  @run_status <span style="color:#666">=</span> <span style="color:#007020">nil</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h4 id="run_report_unsafe">run_report_unsafe</h4> <p>The <code>run_report_unsafe</code> method is used to run the report handler without any error handling. This method should never be used directly in any handler, except during testing of that handler. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">run_report_unsafe</span>(run_status)
  @run_status <span style="color:#666">=</span> run_status
  report
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="run_status-object">run_status Object</h3> <p>The <code>run_status</code> object is initialized by Chef Infra Client before the <code>report</code> interface is run for any handler. The <code>run_status</code> object keeps track of the status of a Chef Infra Client run and will contain some (or all) of the following properties:</p> <table> <col style="width:40%"> <col style="width:60%"> <thead> <tr class="header"> <th>Property</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>all_resources</code></td> <td>A list of all resources that are included in the <code>resource_collection</code> property for the current Chef Infra Client run.</td> </tr> <tr> <td><code>backtrace</code></td> <td>A backtrace associated with the uncaught exception data that caused a Chef Infra Client run to fail, if present; <code>nil</code> for a successful Chef Infra Client run.</td> </tr> <tr> <td><code>elapsed_time</code></td> <td>The amount of time between the start (<code>start_time</code>) and end (<code>end_time</code>) of a Chef Infra Client run.</td> </tr> <tr> <td><code>end_time</code></td> <td>The time at which a Chef Infra Client run ended.</td> </tr> <tr> <td><code>exception</code></td> <td>The uncaught exception data which caused a Chef Infra Client run to fail; <code>nil</code> for a successful Chef Infra Client run.</td> </tr> <tr> <td><code>failed?</code></td> <td>Show that a Chef Infra Client run has failed when uncaught exceptions were raised during a Chef Infra Client run. An exception handler runs when the <code>failed?</code> indicator is <code>true</code>.</td> </tr> <tr> <td><code>node</code></td> <td>The node on which a Chef Infra Client run occurred.</td> </tr> <tr> <td><code>run_context</code></td> <td>An instance of the <code>Chef::RunContext</code> object; used by Chef Infra Client to track the context of the run; provides access to the <code>cookbook_collection</code>, <code>resource_collection</code>, and <code>definitions</code> properties.</td> </tr> <tr> <td><code>start_time</code></td> <td>The time at which a Chef Infra Client run started.</td> </tr> <tr> <td><code>success?</code></td> <td>Show that a Chef Infra Client run succeeded when uncaught exceptions were not raised during a Chef Infra Client run. A report handler runs when the <code>success?</code> indicator is <code>true</code>.</td> </tr> <tr> <td><code>updated_resources</code></td> <td>A list of resources that were marked as updated as a result of a Chef Infra Client run.</td> </tr> </tbody> </table> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>These properties are not always available. For example, a start handler runs at the beginning of Chef Infra Client run, which means that properties like <code>end_time</code> and <code>elapsed_time</code> are still unknown and will be unavailable to the <code>run_status</code> object.</p> </div> </div> <h2 id="examples-1">Examples</h2> <p>The following sections show examples of handlers.</p> <h3 id="cookbook-versions">Cookbook Versions</h3> <p>Community member <code>juliandunn</code> created a custom <a href="https://github.com/juliandunn/cookbook_versions_handler">report handler that logs all of the cookbooks and cookbook versions</a> that were used during a Chef Infra Client run, and then reports after the run is complete. This handler requires the <strong>chef_handler</strong> resource (which is available from the <strong>chef_handler</strong> cookbook).</p> <h4 id="cookbook_versionsrb">cookbook_versions.rb</h4> <p>The following custom handler defines how cookbooks and cookbook versions that are used during a Chef Infra Client run will be compiled into a report using the <code>Chef::Log</code> class in Chef Infra Client:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/log'</span>

<span style="color:#007020;font-weight:700">module</span> <span style="color:#0e84b5;font-weight:700">Opscode</span>
  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">CookbookVersionsHandler</span> <span style="color:#666">&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span>
    <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">report</span>
      cookbooks <span style="color:#666">=</span> run_context<span style="color:#666">.</span>cookbook_collection
      <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>info(<span style="color:#4070a0">'Cookbooks and versions run: #{cookbooks.keys.map {|x| cookbooks[x].name.to_s + '</span> <span style="color:#4070a0">' + cookbooks[x].version} }'</span>)
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h4 id="defaultrb">default.rb</h4> <p>The following recipe is added to the run-list for every node on which a list of cookbooks and versions will be generated as report output after every Chef Infra Client run.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">include_recipe <span style="color:#4070a0">'chef_handler'</span>

cookbook_file <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_handler'</span><span style="color:#666">][</span><span style="color:#4070a0">'handler_path'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/cookbook_versions.rb"</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'cookbook_versions.rb'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  mode <span style="color:#4070a0">'0755'</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>

chef_handler <span style="color:#4070a0">'Opscode::CookbookVersionsHandler'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_handler'</span><span style="color:#666">][</span><span style="color:#4070a0">'handler_path'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/cookbook_versions.rb"</span>
  supports <span style="color:#517918">:report</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This recipe will generate report output similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">[</span><span style="color:#40a070">2013</span><span style="color:#666">-</span><span style="color:#40a070">11</span><span style="color:#666">-</span><span style="color:#40a070">26</span><span style="color:#517918">T03</span>:<span style="color:#40a070">11</span>:<span style="color:#40a070">06</span><span style="color:#666">+</span><span style="color:#40a070">00</span>:<span style="color:#40a070">00</span><span style="color:#666">]</span> <span style="color:#517918">INFO</span>: <span style="color:#60add5">Chef</span> <span style="color:#60add5">Run</span> complete <span style="color:#007020;font-weight:700">in</span> <span style="color:#40a070">0</span><span style="color:#666">.</span><span style="color:#40a070">300029878</span> seconds
<span style="color:#666">[</span><span style="color:#40a070">2013</span><span style="color:#666">-</span><span style="color:#40a070">11</span><span style="color:#666">-</span><span style="color:#40a070">26</span><span style="color:#517918">T03</span>:<span style="color:#40a070">11</span>:<span style="color:#40a070">06</span><span style="color:#666">+</span><span style="color:#40a070">00</span>:<span style="color:#40a070">00</span><span style="color:#666">]</span> <span style="color:#517918">INFO</span>: <span style="color:#60add5">Running</span> report handlers
<span style="color:#666">[</span><span style="color:#40a070">2013</span><span style="color:#666">-</span><span style="color:#40a070">11</span><span style="color:#666">-</span><span style="color:#40a070">26</span><span style="color:#517918">T03</span>:<span style="color:#40a070">11</span>:<span style="color:#40a070">06</span><span style="color:#666">+</span><span style="color:#40a070">00</span>:<span style="color:#40a070">00</span><span style="color:#666">]</span> <span style="color:#517918">INFO</span>: <span style="color:#60add5">Cookbooks</span> <span style="color:#007020;font-weight:700">and</span> versions <span style="color:#517918">run</span>: <span style="color:#666">[</span><span style="color:#4070a0">"chef_handler 1.1.4"</span>, <span style="color:#4070a0">"cookbook_versions_handler 1.0.0"</span><span style="color:#666">]</span>
<span style="color:#666">[</span><span style="color:#40a070">2013</span><span style="color:#666">-</span><span style="color:#40a070">11</span><span style="color:#666">-</span><span style="color:#40a070">26</span><span style="color:#517918">T03</span>:<span style="color:#40a070">11</span>:<span style="color:#40a070">06</span><span style="color:#666">+</span><span style="color:#40a070">00</span>:<span style="color:#40a070">00</span><span style="color:#666">]</span> <span style="color:#517918">INFO</span>: <span style="color:#60add5">Report</span> handlers complete
</code></pre></div>
<h3 id="reporting">Reporting</h3> <p>Start handler functionality was added when Chef started building add-ons for the Chef Infra Server. The Reporting add-on is designed to create reporting data based on a Chef Infra Client run. And since Reporting needs to be able to collect data for the entire Chef Infra Client run, Reporting needs to be enabled before anything else happens at the start of a Chef Infra Client run.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> The start handler used by the Reporting add-on for the Chef Infra Server is always installed using the <strong>chef-client</strong> cookbook. </div> </div> <h4 id="start_handlerrb">start_handler.rb</h4> <p>The following code shows the start handler used by the Reporting add-in for the Chef Infra Server:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/handler'</span>
<span style="color:#007020">require</span> <span style="color:#4070a0">'chef/rest'</span>
<span style="color:#007020">require</span> <span style="color:#4070a0">'chef/version_constraint'</span>

<span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">Chef</span>
  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">Reporting</span>
    <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">StartHandler</span> <span style="color:#666">&lt;</span> <span style="color:#666">::</span><span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span>
      <span style="color:#007020">attr_reader</span> <span style="color:#517918">:config</span>

      <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">initialize</span>(config <span style="color:#666">=</span> {})
        @config <span style="color:#666">=</span> config
      <span style="color:#007020;font-weight:700">end</span>

      <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">report</span>
        version_checker <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">VersionConstraint</span><span style="color:#666">.</span>new(<span style="color:#4070a0">'&lt; 11.6.0'</span>)
        <span style="color:#007020;font-weight:700">if</span> version_checker<span style="color:#666">.</span>include?(<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">VERSION</span>)
          <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>info(<span style="color:#4070a0">'Enabling backported resource reporting Handler'</span>)
          rest <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">REST</span><span style="color:#666">.</span>new(<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:chef_server_url</span><span style="color:#666">]</span>, @run_status<span style="color:#666">.</span>node<span style="color:#666">.</span>name, <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:client_key</span><span style="color:#666">]</span>)
          resource_reporter <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Reporting</span><span style="color:#666">::</span><span style="color:#60add5">ResourceReporter</span><span style="color:#666">.</span>new(rest)
          @run_status<span style="color:#666">.</span>events<span style="color:#666">.</span>register(resource_reporter)

          resource_reporter<span style="color:#666">.</span>run_started(@run_status)
        <span style="color:#007020;font-weight:700">else</span>
          <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>debug(<span style="color:#4070a0">'Chef Version already has new Resource Reporter - skipping startup of backport version'</span>)
        <span style="color:#007020;font-weight:700">end</span>
      <span style="color:#007020;font-weight:700">end</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="json_file-handler">json_file Handler</h3> <p>The <a href="https://github.com/chef/chef/blob/main/lib/chef/handler/json_file.rb">json_file</a> handler is available from the <strong>chef_handler</strong> cookbook and can be used with exceptions and reports. It serializes run status data to a JSON file. This handler may be enabled in one of the following ways.</p> <p>By adding the following lines of Ruby code to either the client.rb file or the solo.rb file, depending on how Chef Infra Client is being run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/handler/json_file'</span>
report_handlers <span style="color:#666">&lt;&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span><span style="color:#666">::</span><span style="color:#60add5">JsonFile</span><span style="color:#666">.</span>new(<span style="color:#517918">:path</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/var/chef/reports'</span>)
exception_handlers <span style="color:#666">&lt;&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span><span style="color:#666">::</span><span style="color:#60add5">JsonFile</span><span style="color:#666">.</span>new(<span style="color:#517918">:path</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/var/chef/reports'</span>)
</code></pre></div>
<p>By using the <strong>chef_handler</strong> resource in a recipe, similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'Chef::Handler::JsonFile'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef/handler/json_file'</span>
  arguments <span style="color:#517918">:path</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'/var/chef/reports'</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>After it has run, the run status data can be loaded and inspected via Interactive Ruby (IRb):</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">irb(main):<span style="color:#40a070">002</span>:<span style="color:#40a070">0</span><span style="color:#666">&gt;</span> <span style="color:#007020">require</span> <span style="color:#4070a0">'json'</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>
irb(main):<span style="color:#40a070">003</span>:<span style="color:#40a070">0</span><span style="color:#666">&gt;</span> <span style="color:#007020">require</span> <span style="color:#4070a0">'chef'</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>
irb(main):<span style="color:#40a070">004</span>:<span style="color:#40a070">0</span><span style="color:#666">&gt;</span> r <span style="color:#666">=</span> <span style="color:#60add5">JSON</span><span style="color:#666">.</span>parse(<span style="color:#60add5">IO</span><span style="color:#666">.</span>read(<span style="color:#4070a0">'/var/chef/reports/chef-run-report-20110322060731.json'</span>)) <span style="color:#666">=&gt;</span> <span style="color:#666">...</span> output truncated
irb(main):<span style="color:#40a070">005</span>:<span style="color:#40a070">0</span><span style="color:#666">&gt;</span> r<span style="color:#666">.</span>keys <span style="color:#666">=&gt;</span> <span style="color:#666">[</span><span style="color:#4070a0">'end_time'</span>, <span style="color:#4070a0">'node'</span>, <span style="color:#4070a0">'updated_resources'</span>, <span style="color:#4070a0">'exception'</span>, <span style="color:#4070a0">'all_resources'</span>, <span style="color:#4070a0">'success'</span>, <span style="color:#4070a0">'elapsed_time'</span>, <span style="color:#4070a0">'start_time'</span>, <span style="color:#4070a0">'backtrace'</span><span style="color:#666">]</span>
irb(main):<span style="color:#40a070">006</span>:<span style="color:#40a070">0</span><span style="color:#666">&gt;</span> r<span style="color:#666">[</span><span style="color:#4070a0">'elapsed_time'</span><span style="color:#666">]</span> <span style="color:#666">=&gt;</span> <span style="color:#40a070">0</span><span style="color:#666">.</span><span style="color:#40a070">00246</span>
</code></pre></div>
<h3 id="error_report-handler">error_report Handler</h3> <p>The <a href="https://github.com/chef/chef/blob/main/lib/chef/handler/error_report.rb">error_report</a> handler is built into Chef Infra Client and can be used for both exceptions and reports. It serializes error report data to a JSON file. This handler may be enabled in one of the following ways.</p> <p>By adding the following lines of Ruby code to either the client.rb file or the solo.rb file, depending on how Chef Infra Client is being run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/handler/error_report'</span>
report_handlers <span style="color:#666">&lt;&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span><span style="color:#666">::</span><span style="color:#60add5">ErrorReport</span><span style="color:#666">.</span>new()
exception_handlers <span style="color:#666">&lt;&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Handler</span><span style="color:#666">::</span><span style="color:#60add5">ErrorReport</span><span style="color:#666">.</span>new()
</code></pre></div>
<p>By using the <a href="../resources/chef_handler/index.html">chef_handler</a> resource in a recipe, similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_handler <span style="color:#4070a0">'Chef::Handler::ErrorReport'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'chef/handler/error_report'</span>
  action <span style="color:#517918">:enable</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="community-handlers">Community Handlers</h3> <p>The following open source handlers are available from the Chef community:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Handler</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><a href="https://github.com/timops/ohai-plugins/blob/master/win32_svc.rb">Airbrake</a></td> <td>A handler that sends exceptions (only) to Airbrake, an application that collects data and aggregates it for review.</td> </tr> <tr> <td><a href="https://github.com/rottenbytes/chef/tree/master/async_handler">Asynchronous Resources</a></td> <td>A handler that asynchronously pushes exception and report handler data to a STOMP queue, from which data can be processed into data storage.</td> </tr> <tr> <td><a href="https://github.com/ampledata/chef-handler-campfire">Campfire</a></td> <td>A handler that collects exception and report handler data and reports it to Campfire, a web-based group chat tool.</td> </tr> <tr> <td><a href="https://github.com/DataDog/chef-handler-datadog">Datadog</a></td> <td>A handler that collects Chef Infra Client stats and sends them into a Datadog newsfeed.</td> </tr> <tr> <td><a href="https://github.com/mmarschall/chef-handler-flowdock">Flowdock</a></td> <td>A handler that collects exception and report handler data and sends it to users via the Flowdock API..</td> </tr> <tr> <td><a href="https://github.com/imeyer/chef-handler-graphite/wiki">Graphite</a></td> <td>A handler that collects exception and report handler data and reports it to Graphite, a graphic rendering application.</td> </tr> <tr> <td><a href="https://github.com/jellybob/chef-gelf/">Graylog2 GELF</a></td> <td>A handler that provides exception and report handler status (including changes) to a Graylog2 server, so that the data can be viewed using Graylog Extended Log Format (GELF).</td> </tr> <tr> <td><a href="https://rubygems.org/gems/chef-handler-growl">Growl</a></td> <td>A handler that collects exception and report handler data and then sends it as a Growl notification.</td> </tr> <tr> <td><a href="https://github.com/mojotech/hipchat/blob/master/lib/hipchat/chef.rb">HipChat</a></td> <td>A handler that collects exception handler data and sends it to HipChat, a hosted private chat service for companies and teams.</td> </tr> <tr> <td><a href="https://rubygems.org/gems/chef-irc-snitch">IRC Snitch</a></td> <td>A handler that notifies administrators (via Internet Relay Chat (IRC)) when a Chef Infra Client run fails.</td> </tr> <tr> <td><a href="https://github.com/marktheunissen/chef-handler-journald">Journald</a></td> <td>A handler that logs an entry to the systemd journal with the Chef Infra Client run status, exception details, configurable priority, and custom details.</td> </tr> <tr> <td><a href="https://github.com/b1-systems/chef-handler-httpapi/">net/http</a></td> <td>A handler that reports the status of a Chef run to any API via net/HTTP.</td> </tr> <tr> <td><a href="https://rubygems.org/gems/chef-handler-mail">Simple Email</a></td> <td>A handler that collects exception and report handler data and then uses pony to send email reports that are based on `.erb` (Embedded Ruby ) templates.</td> </tr> <tr> <td><a href="http://onddo.github.io/chef-handler-sns/">SNS</a></td> <td>A handler that notifies exception and report handler data and sends it to a SNS topic.</td> </tr> <tr> <td><a href="https://github.com/rackspace-cookbooks/chef-slack_handler">Slack</a></td> <td>A handler to send Chef Infra Client run notifications to a Slack channel.</td> </tr> <tr> <td><a href="http://ampledata.org/splunk_storm_chef_handler.html">Splunk Storm</a></td> <td>A handler that supports exceptions and reports for Splunk Storm.</td> </tr> <tr> <td><a href="https://github.com/jblaine/syslog_handler">Syslog</a></td> <td>A handler that logs basic essential information, such as about the success or failure of a Chef Infra Client run.</td> </tr> <tr> <td><a href="https://rubygems.org/gems/chef-handler-updated-resources">Updated Resources</a></td> <td>A handler that provides a simple way to display resources that were updated during a Chef Infra Client run.</td> </tr> <tr> <td><a href="http://onddo.github.io/chef-handler-zookeeper/">ZooKeeper</a></td> <td>A Chef report handler to send Chef run notifications to ZooKeeper.</td> </tr> </tbody> </table> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/handlers/" class="_attribution-link">https://docs.chef.io/handlers/</a>
  </p>
</div>
