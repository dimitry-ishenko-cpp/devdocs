<h1 data-toc="js-project-setup" id="js-project-setup.md">Set up a Kotlin/JS project</h1>
<p id="2d7dfba0">Kotlin/JS projects use Gradle as a build system. To let developers easily manage their Kotlin/JS projects, we offer the <code class="code ">kotlin.multiplatform</code> Gradle plugin that provides project configuration tools together with helper tasks for automating routines typical for JavaScript development. For example, the plugin downloads the <a href="https://yarnpkg.com/" id="551904f1" data-external="true" rel="noopener noreferrer">Yarn</a> package manager for managing <a href="https://www.npmjs.com/" id="6c9216a8" data-external="true" rel="noopener noreferrer">npm</a> dependencies in background and can build a JavaScript bundle from a Kotlin project using <a href="https://webpack.js.org/" id="ca47b4af" data-external="true" rel="noopener noreferrer">webpack</a>. Dependency management and configuration adjustments can be done to a large part directly from the Gradle build file, with the option to override automatically generated configurations for full control.</p>
<p id="8d7e1c1c">You can apply the <code class="code ">org.jetbrains.kotlin.multiplatform</code> plugin to a Gradle project manually in the <code class="code ">build.gradle(.kts)</code> file:</p>
<div class="tabs" id="e4b228b6" data-group="build-script" data-anchors="[ec97f46c,b5bff459,73cfad80,b1593a41,e4b228b6]">
<div class="tabs__content" data-gtm="tab" id="ec97f46c" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">plugins {
    kotlin("multiplatform") version "1.9.0"
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="73cfad80" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '1.9.0'
}
</pre></div>
</div>
<p id="82fa5496">The Kotlin/JS Gradle plugin lets you manage aspects of your project in the <code class="code ">kotlin</code> section of the build script.</p>
<pre class="code" data-language="groovy">kotlin {
    //...
}
</pre>
<p id="db3db496">Inside the <code class="code ">kotlin</code> section, you can manage the following aspects:</p>
<ul class="list _bullet" id="7f0065d">
<li class="list__item" id="2daca0e6"><p><a href="#execution-environments" id="d38278d1">Target execution environment</a>: browser or Node.js</p></li>
<li class="list__item" id="eb7ffae5"><p><a href="#dependencies" id="631d148">Project dependencies</a>: Maven and npm</p></li>
<li class="list__item" id="9da772d5"><p><a href="#run-task" id="ceecd950">Run configuration</a></p></li>
<li class="list__item" id="5ea6a266"><p><a href="#test-task" id="3b3dacdd">Test configuration</a></p></li>
<li class="list__item" id="544396c3"><p><a href="#webpack-bundling" id="6e84c750">Bundling</a> and <a href="#css" id="85741ce0">CSS support</a> for browser projects</p></li>
<li class="list__item" id="58f7e34"><p><a href="#distribution-target-directory" id="4c58fb8a">Target directory</a> and <a href="#module-name" id="7757b6d8">module name</a></p></li>
<li class="list__item" id="3196541"><p><a href="#package-json-customization" id="30598c38">Project's <code class="code ">package.json</code> file</a></p></li>
</ul>
<section class="chapter"><h2 id="execution-environments" data-toc="execution-environments">Execution environments</h2>
<p id="802b5cd5">Kotlin/JS projects can target two different execution environments:</p>
<ul class="list _bullet" id="8c008fb4">
<li class="list__item" id="cac1e466"><p>Browser for client-side scripting in browsers</p></li>
<li class="list__item" id="63bdfe58"><p><a href="https://nodejs.org/" id="391bab86" data-external="true" rel="noopener noreferrer">Node.js</a> for running JavaScript code outside of a browser, for example, for server-side scripting.</p></li>
</ul>
<p id="b9031833">To define the target execution environment for a Kotlin/JS project, add the <code class="code ">js</code> section with <code class="code ">browser {}</code> or <code class="code ">nodejs {}</code> inside.</p>
<pre class="code" data-language="groovy">kotlin {
    js {
        browser {
        }
        binaries.executable()       
    }
}    
</pre>
<p id="91666474">The instruction <code class="code ">binaries.executable()</code> explicitly instructs the Kotlin compiler to emit executable <code class="code ">.js</code> files. This is the default behavior when using the current Kotlin/JS compiler, but the instruction is explicitly required if you are working with the <a href="js-ir-compiler.html" id="7d23fa93">Kotlin/JS IR compiler</a>, or have set <code class="code ">kotlin.js.generate.executable.default=false</code> in your <code class="code ">gradle.properties</code>. In those cases, omitting <code class="code ">binaries.executable()</code> will cause the compiler to only generate Kotlin-internal library files, which can be used from other projects, but not run on their own. (This is typically faster than creating executable files, and can be a possible optimization when dealing with non-leaf modules of your project.)</p>
<p id="f65a7836">The Kotlin/JS plugin automatically configures its tasks for working with the selected environment. This includes downloading and installing the required environment and dependencies for running and testing the application. This allows developers to build, run, and test simple projects without additional configuration. For projects targeting Node.js, there are also an option to use an existing Node.js installation. Learn how to <a href="#use-pre-installed-node-js" id="9a7beeba">use pre-installed Node.js</a>.</p></section><section class="chapter"><h2 id="dependencies" data-toc="dependencies">Dependencies</h2>
<p id="3e745d16">Like any other Gradle projects, Kotlin/JS projects support traditional Gradle <a href="https://docs.gradle.org/current/userguide/declaring_dependencies.html" id="18ca8ea9" data-external="true" rel="noopener noreferrer">dependency declarations</a> in the <code class="code ">dependencies</code> section of the build script.</p>
<div class="tabs" id="df459776" data-group="build-script" data-anchors="[28dc66e,6ba5eafe,7215d75f,f433b7d8,df459776]">
<div class="tabs__content" data-gtm="tab" id="28dc66e" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">dependencies {
    implementation("org.example.myproject", "1.1.0")
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="7215d75f" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">dependencies {
    implementation 'org.example.myproject:1.1.0'
}
</pre></div>
</div>
<p id="54b14d14">The Kotlin Multiplatform Gradle plugin also supports dependency declarations for particular source sets in the <code class="code ">kotlin</code> section of the build script.</p>
<div class="tabs" id="d955756b" data-group="build-script" data-anchors="[2b7d7ddb,de032db7,7ea347c7,902f1758,d955756b]">
<div class="tabs__content" data-gtm="tab" id="2b7d7ddb" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">kotlin {
    sourceSets {
      val jsMain by getting {
            dependencies {
                implementation("org.example.myproject:1.1.0")
            }
        }
    }
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="7ea347c7" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">kotlin {
    sourceSets {
        jsMain {
            dependencies {
                implementation 'org.example.myproject:1.1.0'
            }
        }
    }
}
</pre></div>
</div>
<p id="7273fd30">Please note that not all libraries available for the Kotlin programming language are available when targeting JavaScript: Only libraries that include artifacts for Kotlin/JS can be used.</p>
<p id="e7b96445">If the library you are adding has dependencies on <a href="#npm-dependencies" id="af13e84a">packages from npm</a>, Gradle will automatically resolve these transitive dependencies as well.</p>
<section class="chapter"><h3 id="kotlin-standard-libraries" data-toc="kotlin-standard-libraries">Kotlin standard libraries</h3>
<p id="5c99e27a">The dependencies on the <a href="../index.html" id="a4196e3e" data-external="true" rel="noopener noreferrer">standard library</a> is added automatically. The version of the standard library is the same as the version of the <code class="code ">kotlin-multiplatform</code> plugin.</p>
<p id="aaff029f">The <a href="https://kotlinlang.org/api/latest/kotlin.test/" id="295b836e" data-external="true" rel="noopener noreferrer"><code class="code ">kotlin.test</code></a> API is available for multiplatform tests. When you create a multiplatform project, the Project Wizard automatically adds test dependencies to all the source sets.</p>
<p id="2935a292">If you didn't use the Project Wizard to create your project, you can add the dependencies manually:</p>
<div class="tabs" id="b4de728d" data-group="build-script" data-anchors="[27ca5527,86bab296,517d58fe,6cb02df6,b4de728d]">
<div class="tabs__content" data-gtm="tab" id="27ca5527" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">kotlin {
    sourceSets {
        val commonTest by getting {
            dependencies {
                implementation(kotlin("test")) // This brings all the platform dependencies automatically
            }
        }
    }
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="517d58fe" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">kotlin {
    sourceSets {
        commonTest {
            dependencies {
                implementation kotlin("test") // This brings all the platform dependencies automatically
            }
        }
    }
}
</pre></div>
</div></section><section class="chapter"><h3 id="npm-dependencies" data-toc="npm-dependencies">npm dependencies</h3>
<p id="1da26547">In the JavaScript world, the most common way to manage dependencies is <a href="https://www.npmjs.com/" id="f66f28ef" data-external="true" rel="noopener noreferrer">npm</a>. It offers the biggest public repository of JavaScript modules.</p>
<p id="eedfa059">The Kotlin Multiplatform Gradle plugin lets you declare npm dependencies in the Gradle build script, analogous to how you would declare any other dependencies.</p>
<p id="1e2aa43b">To declare an npm dependency, pass its name and version to the <code class="code ">npm()</code> function inside a dependency declaration. You can also specify one or multiple version range based on <a href="https://docs.npmjs.com/misc/semver#versions" id="5dff2ee3" data-external="true" rel="noopener noreferrer">npm's semver syntax</a>.</p>
<div class="tabs" id="1a36ec57" data-group="build-script" data-anchors="[42cd2fde,19b6fb59,d87d7e70,9808a8e8,1a36ec57]">
<div class="tabs__content" data-gtm="tab" id="42cd2fde" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">dependencies {
    implementation(npm("react", "&gt; 14.0.0 &lt;=16.9.0"))
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="d87d7e70" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">dependencies {
    implementation npm('react', '&gt; 14.0.0 &lt;=16.9.0')
}
</pre></div>
</div>
<p id="3537e68">The plugin uses the <a href="https://yarnpkg.com/lang/en/" id="4ee1aa64" data-external="true" rel="noopener noreferrer">Yarn</a> package manager to download and install NPM dependencies. It works out of the box without additional configuration, but you can tune it to specific needs. Learn how to <a href="#yarn" id="43511da4">configure Yarn in Kotlin Multiplatform Gradle plugin</a>.</p>
<p id="1d903e65">Besides regular dependencies, there are three more types of dependencies that can be used from the Gradle DSL. To learn more about when each type of dependency can best be used, have a look at the official documentation linked from npm:</p>
<ul class="list _bullet" id="7b1d128c">
<li class="list__item" id="82abf70"><p><a href="https://docs.npmjs.com/files/package.json#devdependencies" id="c3f2760" data-external="true" rel="noopener noreferrer">devDependencies</a>, via <code class="code ">devNpm(...)</code>,</p></li>
<li class="list__item" id="b588448c"><p><a href="https://docs.npmjs.com/files/package.json#optionaldependencies" id="e508be2c" data-external="true" rel="noopener noreferrer">optionalDependencies</a> via <code class="code ">optionalNpm(...)</code>, and</p></li>
<li class="list__item" id="43ed3b98"><p><a href="https://docs.npmjs.com/files/package.json#peerdependencies" id="d35264db" data-external="true" rel="noopener noreferrer">peerDependencies</a> via <code class="code ">peerNpm(...)</code>.</p></li>
</ul>
<p id="49d14076">Once an npm dependency is installed, you can use its API in your code as described in <a href="js-interop.html" id="3f75d56b">Calling JS from Kotlin</a>.</p></section></section><section class="chapter"><h2 id="run-task" data-toc="run-task">run task</h2>
<p id="6304e503">The Kotlin/JS plugin provides a <code class="code ">jsRun</code> task that lets you run pure Kotlin/JS projects without additional configuration.</p>
<p id="68c1c81d">For running Kotlin/JS projects in the browser, this task is an alias for the <code class="code ">browserDevelopmentRun</code> task (which is also available in Kotlin multiplatform projects). It uses the <a href="https://webpack.js.org/configuration/dev-server/" id="c591aac8" data-external="true" rel="noopener noreferrer">webpack-dev-server</a> to serve your JavaScript artifacts. If you want to customize the configuration used by <code class="code ">webpack-dev-server</code>, for example adjust the port the server runs on, use the <a href="#webpack-bundling" id="4521da2d">webpack configuration file</a>.</p>
<p id="c6ea5d44">For running Kotlin/JS projects targeting Node.js, use the <code class="code ">jsRun</code> task that is an alias for the <code class="code ">nodeRun</code> task.</p>
<p id="dbc729ea">To run a project, execute the standard lifecycle <code class="code ">jsRun</code> task, or the alias to which it corresponds:</p>
<pre class="code" data-language="bash">./gradlew jsRun
</pre>
<p id="f9a5e435">To automatically trigger a re-build of your application after making changes to the source files, use the Gradle <a href="https://docs.gradle.org/current/userguide/command_line_interface.html#sec:continuous_build" id="e6c92d44" data-external="true" rel="noopener noreferrer">continuous build</a> feature:</p>
<pre class="code" data-language="bash">./gradlew jsRun --continuous
</pre>
<p id="408927d0">or</p>
<pre class="code" data-language="bash">./gradlew jsRun -t
</pre>
<p id="60363359">Once the build of your project has succeeded, the <code class="code ">webpack-dev-server</code> will automatically refresh the browser page.</p></section><section class="chapter"><h2 id="test-task" data-toc="test-task">test task</h2>
<p id="22817e2d">The Kotlin Multiplatform Gradle plugin automatically sets up a test infrastructure for projects. For browser projects, it downloads and installs the <a href="https://karma-runner.github.io/" id="93dae865" data-external="true" rel="noopener noreferrer">Karma</a> test runner with other required dependencies; for Node.js projects, the <a href="https://mochajs.org/" id="9e24df3e" data-external="true" rel="noopener noreferrer">Mocha</a> test framework is used.</p>
<p id="39295b45">The plugin also provides useful testing features, for example:</p>
<ul class="list _bullet" id="cef89d1">
<li class="list__item" id="b753aa2e"><p>Source maps generation</p></li>
<li class="list__item" id="e21c0aff"><p>Test reports generation</p></li>
<li class="list__item" id="beaf3d08"><p>Test run results in the console</p></li>
</ul>
<p id="dbf8b1d3">For running browser tests, the plugin uses <a href="https://chromium.googlesource.com/chromium/src/+/lkgr/headless/README.md" id="98dd7900" data-external="true" rel="noopener noreferrer">Headless Chrome</a> by default. You can also choose other browser to run tests in, by adding the corresponding entries inside the <code class="code ">useKarma</code> section of the build script:</p>
<pre class="code" data-language="groovy">kotlin {
    js {
        browser {
            testTask {
                useKarma {
                    useIe()
                    useSafari()
                    useFirefox()
                    useChrome()
                    useChromeCanary()
                    useChromeHeadless()
                    usePhantomJS()
                    useOpera()
                }
            }
        }
        binaries.executable()
        // ...
    }
}
</pre>
<p id="624e067f">Alternatively, you can add test targets for browsers in the <code class="code ">gradle.properties</code> file:</p>
<pre class="code" data-language="plaintext">kotlin.js.browser.karma.browsers=firefox,safari
</pre>
<p id="af657406">This approach allows you to define a list of browsers for all modules, and then add specific browsers in the build scripts of particular modules.</p>
<p id="b2c4f67a">Please note that the Kotlin Multiplatform Gradle plugin does not automatically install these browsers for you, but only uses those that are available in its execution environment. If you are executing Kotlin/JS tests on a continuous integration server, for example, make sure that the browsers you want to test against are installed.</p>
<p id="5ff1bc4a">If you want to skip tests, add the line <code class="code ">enabled = false</code> to the <code class="code ">testTask</code>.</p>
<pre class="code" data-language="groovy">kotlin {
    js {
        browser {
            testTask {
                enabled = false
            }
        }
        binaries.executable()
        // ...
    }
}
</pre>
<p id="8f07be6e">To run tests, execute the standard lifecycle <code class="code ">check</code> task:</p>
<pre class="code" data-language="bash">./gradlew check
</pre>
<p id="3c45e151">To specify environment variables used by your Node.js test runners (for example, to pass external information to your tests, or to fine-tune package resolution), use the <code class="code ">environment</code> function with a key-value pair inside the <code class="code ">testTask</code> block in your build script:</p>
<pre class="code" data-language="groovy">kotlin {
    js {
        nodejs {
            testTask {
                environment("key", "value")
            }
        }
    }
}        
</pre>
<section class="chapter"><h3 id="karma-configuration" data-toc="karma-configuration">Karma configuration</h3>
<p id="41e48f02">The Kotlin Multiplatform Gradle plugin automatically generates a Karma configuration file at build time which includes your settings from the <a href="#test-task" id="3ccc3e64"><code class="code ">kotlin.js.browser.testTask.useKarma</code> block</a> in your <code class="code ">build.gradle(.kts)</code>. You can find the file at <code class="code ">build/js/packages/projectName-test/karma.conf.js</code>. To make adjustments to the configuration used by Karma, place your additional configuration files inside a directory called <code class="code ">karma.config.d</code> in the root of your project. All <code class="code ">.js</code> configuration files in this directory will be picked up and are automatically merged into the generated <code class="code ">karma.conf.js</code> at build time.</p>
<p id="dbcbe5a4">All karma configuration abilities are well described in Karma's <a href="https://karma-runner.github.io/5.0/config/configuration-file.html" id="1730396a" data-external="true" rel="noopener noreferrer">documentation</a>.</p></section></section><section class="chapter"><h2 id="webpack-bundling" data-toc="webpack-bundling">webpack bundling</h2>
<p id="80d3f6e6">For browser targets, the Kotlin/JS plugin uses the widely known <a href="https://webpack.js.org/" id="7c4b6e1b" data-external="true" rel="noopener noreferrer">webpack</a> module bundler.</p>
<section class="chapter"><h3 id="webpack-version" data-toc="webpack-version">webpack version</h3>
<p id="addc6792">The Kotlin/JS plugin uses webpack 5.</p>
<p id="32d0d052">If you have projects created with plugin versions earlier than 1.5.0, you can temporarily switch back to webpack 4 used in these versions by adding the following line to the project's <code class="code ">gradle.properties</code>:</p>
<pre class="code" data-language="none">kotlin.js.webpack.major.version=4
</pre></section><section class="chapter"><h3 id="webpack-task" data-toc="webpack-task">webpack task</h3>
<p id="90712d8a">The most common webpack adjustments can be made directly via the <code class="code ">kotlin.js.browser.webpackTask</code> configuration block in the Gradle build file:</p>
<ul class="list _bullet" id="feb5e2e4">
<li class="list__item" id="efae6887"><p><code class="code ">outputFileName</code> - the name of the webpacked output file. It will be generated in <code class="code ">&lt;projectDir&gt;/build/dist/&lt;targetName&gt;</code> after an execution of a webpack task. The default value is the project name.</p></li>
<li class="list__item" id="6e3edee8"><p><code class="code ">output.libraryTarget</code> - the module system for the webpacked output. Learn more about <a href="js-modules.html" id="80a18594">available module systems for Kotlin/JS projects</a>. The default value is <code class="code ">umd</code>.</p></li>
</ul>
<pre class="code" data-language="groovy">webpackTask {
    outputFileName = "mycustomfilename.js"
    output.libraryTarget = "commonjs2"
}
</pre>
<p id="cfb0c716">You can also configure common webpack settings to use in bundling, running, and testing tasks in the <code class="code ">commonWebpackConfig</code> block.</p></section><section class="chapter"><h3 id="webpack-configuration-file" data-toc="webpack-configuration-file">webpack configuration file</h3>
<p id="b9219633">The Kotlin Multiplatform Gradle plugin automatically generates a standard webpack configuration file at the build time. It is located in <code class="code ">build/js/packages/projectName/webpack.config.js</code>.</p>
<p id="a40a46b7">If you want to make further adjustments to the webpack configuration, place your additional configuration files inside a directory called <code class="code ">webpack.config.d</code> in the root of your project. When building your project, all <code class="code ">.js</code> configuration files will automatically be merged into the <code class="code ">build/js/packages/projectName/webpack.config.js</code> file. To add a new <a href="https://webpack.js.org/loaders/" id="944622f1" data-external="true" rel="noopener noreferrer">webpack loader</a>, for example, add the following to a <code class="code ">.js</code> file inside the <code class="code ">webpack.config.d</code>:</p>
<aside data-type="note" class="prompt" data-title="" id="e102bd25"><p id="c5dfd6d8">In this case, the configuration object presented in the <code class="code ">config</code> global object. You need to modify it in your script.</p></aside><pre class="code" data-language="groovy">config.module.rules.push({
    test: /\.extension$/,
    loader: 'loader-name'
});
</pre>
<p id="ea7ba0dc">All webpack configuration capabilities are well described in its <a href="https://webpack.js.org/concepts/configuration/" id="9c7fd3f8" data-external="true" rel="noopener noreferrer">documentation</a>.</p></section><section class="chapter"><h3 id="building-executables" data-toc="building-executables">Building executables</h3>
<p id="f667a81e">For building executable JavaScript artifacts through webpack, the Kotlin/JS plugin contains the <code class="code ">browserDevelopmentWebpack</code> and <code class="code ">browserProductionWebpack</code> Gradle tasks.</p>
<ul class="list _bullet" id="faceae3f">
<li class="list__item" id="657b94ab"><p id="1279d32a"><code class="code ">browserDevelopmentWebpack</code> creates development artifacts, which are larger in size, but take little time to create. As such, use the <code class="code ">browserDevelopmentWebpack</code> tasks during active development.</p></li>
<li class="list__item" id="15fa9b"><p id="45d9a32e"><code class="code ">browserProductionWebpack</code> applies <a href="javascript-dce.html" id="f840808a">dead code elimination</a> to the generated artifacts and minifies the resulting JavaScript file, which takes more time, but generates executables that are smaller in size. As such, use the <code class="code ">browserProductionWebpack</code> task when preparing your project for production use.</p></li>
</ul>
<p id="60d6b7e2">Execute either of these tasks to obtain the respective artifacts for development or production. The generated files will be available in <code class="code ">build/dist</code> unless <a href="#distribution-target-directory" id="48eded86">specified otherwise</a>.</p>
<pre class="code" data-language="bash">./gradlew browserProductionWebpack
</pre>
<p id="7a343a26">Note that these tasks will only be available if your target is configured to generate executable files (via <code class="code ">binaries.executable()</code>).</p></section></section><section class="chapter"><h2 id="css" data-toc="css">CSS</h2>
<p id="466dc47">The Kotlin Multiplatform Gradle plugin also provides support for webpack's <a href="https://webpack.js.org/loaders/css-loader/" id="7c0b9ce6" data-external="true" rel="noopener noreferrer">CSS</a> and <a href="https://webpack.js.org/loaders/style-loader/" id="2f176082" data-external="true" rel="noopener noreferrer">style</a> loaders. While all options can be changed by directly modifying the <a href="#webpack-bundling" id="5cc1d9">webpack configuration files</a> that are used to build your project, the most commonly used settings are available directly from the <code class="code ">build.gradle(.kts)</code> file.</p>
<p id="42872c84">To turn on CSS support in your project, set the <code class="code ">cssSupport.enabled</code> option in the Gradle build file in the <code class="code ">commonWebpackConfig</code> block. This configuration is also enabled by default when creating a new project using the wizard.</p>
<div class="tabs" id="6178157d" data-group="build-script" data-anchors="[52318b0e,8708712d,885d0daa,4c7c27c6,6178157d]">
<div class="tabs__content" data-gtm="tab" id="52318b0e" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">browser {
    commonWebpackConfig {
        cssSupport {
            enabled.set(true)
        }
    }
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="885d0daa" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">browser {
    commonWebpackConfig {
        cssSupport {
            it.enabled.set(true)
        }
    }
}
</pre></div>
</div>
<p id="3426397f">Alternatively, you can add CSS support independently for <code class="code ">webpackTask</code>, <code class="code ">runTask</code>, and <code class="code ">testTask</code>.</p>
<div class="tabs" id="e8925a6b" data-group="build-script" data-anchors="[ddce911f,409f2d2f,a978aa4d,40588d1c,e8925a6b]">
<div class="tabs__content" data-gtm="tab" id="ddce911f" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">browser {
    webpackTask {
        cssSupport {
            enabled.set(true)
        }
    }
    runTask {
        cssSupport {
            enabled.set(true)
        }
    }
    testTask {
        useKarma {
            // ...
            webpackConfig.cssSupport {
                enabled.set(true)
            }
        }
    }
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="a978aa4d" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">browser {
    webpackTask {
        cssSupport {
            it.enabled.set(true)
        }
    }
    runTask {
        cssSupport {
            it.enabled.set(true)
        }
    }
    testTask {
        useKarma {
            // ...
            webpackConfig.cssSupport {
                it.enabled.set(true)
            }
        }
    }
}
</pre></div>
</div>
<p id="771fbf19">Activating CSS support in your project helps prevent common errors that occur when trying to use style sheets from an unconfigured project, such as <code class="code ">Module parse failed: Unexpected character '@' (14:0)</code>.</p>
<p id="3a977aa8">You can use <code class="code ">cssSupport.mode</code> to specify how encountered CSS should be handled. The following values are available:</p>
<ul class="list _bullet" id="6b43924">
<li class="list__item" id="d6b0cdb7"><p><code class="code ">"inline"</code> (default): styles are added to the global <code class="code ">&lt;style&gt;</code> tag.</p></li>
<li class="list__item" id="b094589b"><p><code class="code ">"extract"</code>: styles are extracted into a separate file. They can then be included from an HTML page.</p></li>
<li class="list__item" id="1971c86a"><p><code class="code ">"import"</code>: styles are processed as strings. This can be useful if you need access to the CSS from your code (such as <code class="code ">val styles = require("main.css")</code>).</p></li>
</ul>
<p id="9b7dcd13">To use different modes for the same project, use <code class="code ">cssSupport.rules</code>. Here, you can specify a list of <code class="code ">KotlinWebpackCssRules</code>, each of which define a mode, as well as <a href="https://webpack.js.org/configuration/module/#ruleinclude" id="208998f2" data-external="true" rel="noopener noreferrer">include</a> and <a href="https://webpack.js.org/configuration/module/#ruleexclude" id="65c8c924" data-external="true" rel="noopener noreferrer">exclude</a> patterns.</p></section><section class="chapter"><h2 id="node-js" data-toc="node-js">Node.js</h2>
<p id="c1b6bc3f">For Kotlin/JS projects targeting Node.js, the plugin automatically downloads and installs the Node.js environment on the host. You can also use an existing Node.js instance if you have it.</p>
<section class="chapter"><h3 id="use-pre-installed-node-js" data-toc="use-pre-installed-node-js">Use pre-installed Node.js</h3>
<p id="bb8a23b6">If Node.js is already installed on the host where you build Kotlin/JS projects, you can configure the Kotlin/JS Gradle plugin to use it instead of installing its own Node.js instance.</p>
<p id="20112385">To use the pre-installed Node.js instance, add the following lines to your <code class="code ">build.gradle(.kts)</code>:</p>
<div class="tabs" id="5cbd6ae" data-group="build-script" data-anchors="[bc6785be,b50ee54f,ed7a9ff8,e006b2ef,5cbd6ae]">
<div class="tabs__content" data-gtm="tab" id="bc6785be" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">rootProject.plugins.withType&lt;org.jetbrains.kotlin.gradle.targets.js.nodejs.NodeJsRootPlugin&gt; {
    rootProject.the&lt;org.jetbrains.kotlin.gradle.targets.js.nodejs.NodeJsRootExtension&gt;().download = false
    // or true for default behavior
}
 
</pre></div>
<div class="tabs__content" data-gtm="tab" id="ed7a9ff8" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">rootProject.plugins.withType(org.jetbrains.kotlin.gradle.targets.js.nodejs.NodeJsRootPlugin) {
    rootProject.extensions.getByType(org.jetbrains.kotlin.gradle.targets.js.nodejs.NodeJsRootExtension).download = false
}
</pre></div>
</div></section></section><section class="chapter"><h2 id="yarn" data-toc="yarn">Yarn</h2>
<p id="2db48151">To download and install your declared dependencies at build time, the plugin manages its own instance of the <a href="https://yarnpkg.com/lang/en/" id="51b111df" data-external="true" rel="noopener noreferrer">Yarn</a> package manager. It works out of the box without additional configuration, but you can tune it or use Yarn already installed on your host.</p>
<section class="chapter"><h3 id="additional-yarn-features-yarnrc" data-toc="additional-yarn-features-yarnrc">Additional Yarn features: .yarnrc</h3>
<p id="e17dad1b">To configure additional Yarn features, place a <code class="code ">.yarnrc</code> file in the root of your project. At build time, it gets picked up automatically.</p>
<p id="6bfaa29b">For example, to use a custom registry for npm packages, add the following line to a file called <code class="code ">.yarnrc</code> in the project root:</p>
<pre class="code" data-language="plaintext">registry "http://my.registry/api/npm/"
</pre>
<p id="530d5db7">To learn more about <code class="code ">.yarnrc</code>, please visit the <a href="https://classic.yarnpkg.com/en/docs/yarnrc/" id="60e6ad4c" data-external="true" rel="noopener noreferrer">official Yarn documentation</a>.</p></section><section class="chapter"><h3 id="use-pre-installed-yarn" data-toc="use-pre-installed-yarn">Use pre-installed Yarn</h3>
<p id="86a6fc7e">If Yarn is already installed on the host where you build Kotlin/JS projects, you can configure the Kotlin/JS Gradle plugin to use it instead of installing its own Yarn instance.</p>
<p id="385deba0">To use the pre-installed Yarn instance, add the following lines to your <code class="code ">build.gradle(.kts)</code>:</p>
<div class="tabs" id="2e5570fa" data-group="build-script" data-anchors="[a58d45c5,b7245cc8,fc379c55,31728ffc,2e5570fa]">
<div class="tabs__content" data-gtm="tab" id="a58d45c5" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">rootProject.plugins.withType&lt;org.jetbrains.kotlin.gradle.targets.js.yarn.YarnPlugin&gt; {
    rootProject.the&lt;org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension&gt;().download = false
    // or true for default behavior
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="fc379c55" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">rootProject.plugins.withType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnPlugin) {
    rootProject.extensions.getByType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension).download = false
}
 
</pre></div>
</div></section><section class="chapter"><h3 id="version-locking-via-kotlin-js-store" data-toc="version-locking-via-kotlin-js-store">Version locking via kotlin-js-store</h3>
<aside data-type="note" class="prompt" data-title="" id="afd1f121"><p id="fa60082">Version locking via <code class="code ">kotlin-js-store</code> is available since Kotlin 1.6.10.</p></aside><p id="a448684c">The <code class="code ">kotlin-js-store</code> directory in the project root is automatically generated by the Kotlin Multiplatform Gradle plugin to hold the <code class="code ">yarn.lock</code> file, which is necessary for version locking. The lockfile is entirely managed by the Yarn plugin and gets updated during the execution of the <code class="code ">kotlinNpmInstall</code> Gradle task.</p>
<p id="da798cb6">To follow a <a href="https://classic.yarnpkg.com/blog/2016/11/24/lockfiles-for-all/" id="1bf956e9" data-external="true" rel="noopener noreferrer">recommended practice</a>, commit <code class="code ">kotlin-js-store</code> and its contents to your version control system. It ensures that your application is being built with the exact same dependency tree on all machines.</p>
<p id="39e09ae3">If needed, you can change both directory and lockfile names in the build script:</p>
<div class="tabs" id="6f14b8aa" data-group="build-script" data-anchors="[f584867d,4fe6d249,dc7cefe6,6b93ad53,6f14b8aa]">
<div class="tabs__content" data-gtm="tab" id="f584867d" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">rootProject.plugins.withType&lt;org.jetbrains.kotlin.gradle.targets.js.yarn.YarnPlugin&gt; {
    rootProject.the&lt;org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension&gt;().lockFileDirectory =
        project.rootDir.resolve("my-kotlin-js-store")
    rootProject.the&lt;org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension&gt;().lockFileName = "my-yarn.lock"
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="dc7cefe6" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">rootProject.plugins.withType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnPlugin) {
    rootProject.extensions.getByType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension).lockFileDirectory =
        file("my-kotlin-js-store")
    rootProject.extensions.getByType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension).lockFileName = 'my-yarn.lock'
}
</pre></div>
</div>
<aside data-type="warning" class="prompt" data-title="" id="f512653f"><p id="b4067a23">Changing the name of the lockfile may cause dependency inspection tools to no longer pick up the file.</p></aside><p id="f7320223">To learn more about <code class="code ">yarn.lock</code>, please visit the <a href="https://classic.yarnpkg.com/lang/en/docs/yarn-lock/" id="fb22fd36" data-external="true" rel="noopener noreferrer">official Yarn documentation</a>.</p></section><section class="chapter"><h3 id="reporting-that-yarn-lock-has-been-updated" data-toc="reporting-that-yarn-lock-has-been-updated">Reporting that yarn.lock has been updated</h3>
<p id="465a025f">Kotlin/JS provides Gradle settings that could notify you if the <code class="code ">yarn.lock</code> file has been updated. You can use these settings when you want to be notified if <code class="code ">yarn.lock</code> has been changed silently during the CI build process:</p>
<ul class="list _bullet" id="3e352b90">
<li class="list__item" id="f66d859a">
<p><code class="code ">YarnLockMismatchReport</code>, which specifies how changes to the <code class="code ">yarn.lock</code> file are reported. You can use one of the following values: </p>
<ul class="list _bullet" id="fbbac2ea">
<li class="list__item" id="5109df08"><p><code class="code ">FAIL</code> fails the corresponding Gradle task. This is the default.</p></li>
<li class="list__item" id="d4eebc00"><p><code class="code ">WARNING</code> writes the information about changes in the warning log.</p></li>
<li class="list__item" id="837d4a8"><p><code class="code ">NONE</code> disables reporting.</p></li>
</ul>
</li>
<li class="list__item" id="ef1cdef3"><p><code class="code ">reportNewYarnLock</code>, which reports about the recently created <code class="code ">yarn.lock</code> file explicitly. By default, this option is disabled: it's a common practice to generate a new <code class="code ">yarn.lock</code> file at the first start. You can use this option to ensure that the file has been committed to your repository.</p></li>
<li class="list__item" id="80b523a8"><p><code class="code ">yarnLockAutoReplace</code>, which replaces <code class="code ">yarn.lock</code> automatically every time the Gradle task is run.</p></li>
</ul>
<p id="244e2af5">To use these options, update your build script file <code class="code ">build.gradle(.kts)</code> as follows:</p>
<div class="tabs" id="5cf82013" data-group="build-script" data-anchors="[a7575dda,3fe470b1,42bacf62,8651b765,5cf82013]">
<div class="tabs__content" data-gtm="tab" id="a7575dda" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">import org.jetbrains.kotlin.gradle.targets.js.yarn.YarnLockMismatchReport
import org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension

rootProject.plugins.withType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnPlugin::class.java) {
    rootProject.the&lt;YarnRootExtension&gt;().yarnLockMismatchReport =
        YarnLockMismatchReport.WARNING // NONE | FAIL
    rootProject.the&lt;YarnRootExtension&gt;().reportNewYarnLock = false // true
    rootProject.the&lt;YarnRootExtension&gt;().yarnLockAutoReplace = false // true
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="42bacf62" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">import org.jetbrains.kotlin.gradle.targets.js.yarn.YarnLockMismatchReport
import org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension

rootProject.plugins.withType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnPlugin) {
    rootProject.extensions.getByType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension).yarnLockMismatchReport =
        YarnLockMismatchReport.WARNING // NONE | FAIL
    rootProject.extensions.getByType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension).reportNewYarnLock = false // true
    rootProject.extensions.getByType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension).yarnLockAutoReplace = false // true
}
</pre></div>
</div></section><section class="chapter"><h3 id="installing-npm-dependencies-with-ignore-scripts-by-default" data-toc="installing-npm-dependencies-with-ignore-scripts-by-default">Installing npm dependencies with --ignore-scripts by default</h3>
<aside data-type="note" class="prompt" data-title="" id="4d72a337"><p id="370c96b9">Installing npm dependencies with <code class="code ">--ignore-scripts</code> by default is available since Kotlin 1.6.10.</p></aside><p id="23881f9b">To reduce the likelihood of executing malicious code from compromised npm packages, the Kotlin Multiplatform Gradle plugin prevents the execution of <a href="https://docs.npmjs.com/cli/v8/using-npm/scripts#life-cycle-scripts" id="f596b548" data-external="true" rel="noopener noreferrer">lifecycle scripts</a> during the installation of npm dependencies by default.</p>
<p id="229be87e">You can explicitly enable lifecycle scripts execution by adding the following lines to <code class="code ">build.gradle(.kts)</code>:</p>
<div class="tabs" id="897f2db5" data-group="build-script" data-anchors="[c88bdf12,d1884d92,95adb118,a86c1742,897f2db5]">
<div class="tabs__content" data-gtm="tab" id="c88bdf12" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">rootProject.plugins.withType&lt;org.jetbrains.kotlin.gradle.targets.js.yarn.YarnPlugin&gt; { 
    rootProject.the&lt;org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension&gt;().ignoreScripts = false
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="95adb118" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">rootProject.plugins.withType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnPlugin) {
    rootProject.extensions.getByType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension).ignoreScripts = false
}
</pre></div>
</div></section></section><section class="chapter"><h2 id="distribution-target-directory" data-toc="distribution-target-directory">Distribution target directory</h2>
<p id="e4988d3">By default, the results of a Kotlin/JS project build reside in the <code class="code ">/build/dist/&lt;targetName&gt;/&lt;binaryName&gt;</code> directory within the project root.</p>
<aside data-type="note" class="prompt" data-title="" id="ec3e8c14"><p id="7d9a86df">Prior to Kotlin 1.9.0, the default distribution target directory was <code class="code ">/build/distributions</code>.</p></aside><p id="1628e635">To set another location for project distribution files, add the <code class="code ">distribution</code> block inside <code class="code ">browser</code> in the build script and assign a value to the <code class="code ">directory</code> property. Once you run a project build task, Gradle will save the output bundle in this location together with project resources.</p>
<div class="tabs" id="d59e13d9" data-group="build-script" data-anchors="[4104f344,678548e5,77b2d591,b1168bfd,d59e13d9]">
<div class="tabs__content" data-gtm="tab" id="4104f344" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">kotlin {
    js {
        browser {
            distribution {
                directory = File("$projectDir/output/")
            }
        }
        binaries.executable()
        // ...
    }
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="77b2d591" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">kotlin {
    js {
        browser {
            distribution {
                directory = file("$projectDir/output/")
            }
        }
        binaries.executable()
        // ...
    }
}
</pre></div>
</div></section><section class="chapter"><h2 id="module-name" data-toc="module-name">Module name</h2>
<p id="619dc45c">To adjust the name for the JavaScript <em id="ed2b0600" class="">module</em> (which is generated in <code class="code ">build/js/packages/myModuleName</code>), including the corresponding <code class="code ">.js</code> and <code class="code ">.d.ts</code> files, use the <code class="code ">moduleName</code> option:</p>
<pre class="code" data-language="groovy">js {
    moduleName = "myModuleName"
}
</pre>
<p id="4526f68">Note that this does not affect the webpacked output in <code class="code ">build/dist</code>.</p></section><section class="chapter"><h2 id="package-json-customization" data-toc="package-json-customization">package.json customization</h2>
<p id="97ab1b49">The <code class="code ">package.json</code> file holds the metadata of a JavaScript package. Popular package registries such as npm require all published packages to have such a file. They use it to track and manage package publications.</p>
<p id="ac5722f5">The Kotlin Multiplatform Gradle plugin automatically generates <code class="code ">package.json</code> for Kotlin/JS projects during build time. By default, the file contains essential data: name, version, license, and dependencies, and some other package attributes.</p>
<p id="c631d9b5">Aside from basic package attributes, <code class="code ">package.json</code> can define how a JavaScript project should behave, for example, identifying scripts that are available to run.</p>
<p id="c73cc698">You can add custom entries to the project's <code class="code ">package.json</code> via the Gradle DSL. To add custom fields to your <code class="code ">package.json</code>, use the <code class="code ">customField</code> function in the compilations <code class="code ">packageJson</code> block:</p>
<pre class="code" data-language="kotlin">kotlin {
    js {
        compilations["main"].packageJson {
            customField("hello", mapOf("one" to 1, "two" to 2))
        }
    }
}
</pre>
<p id="e615441d">When you build the project, this code will add the following block to the <code class="code ">package.json</code> file:</p>
<pre class="code" data-language="json">"hello": {
    "one": 1,
    "two": 2
}
</pre>
<p id="184bc7c5">Learn more about writing <code class="code ">package.json</code> files for npm registry in the <a href="https://docs.npmjs.com/cli/v6/configuring-npm/package-json" id="d6119986" data-external="true" rel="noopener noreferrer">npm docs</a>.</p></section><section class="chapter"><h2 id="troubleshooting" data-toc="troubleshooting">Troubleshooting</h2>
<p id="eb4bd863">When building a Kotlin/JS project using Kotlin 1.3.xx, you may encounter a Gradle error if one of your dependencies (or any transitive dependency) was built using Kotlin 1.4 or higher: <code class="code ">Could not determine the dependencies of task ':client:jsTestPackageJson'.</code> / <code class="code ">Cannot choose between the following variants</code>. This is a known problem, a workaround is provided <a href="https://youtrack.jetbrains.com/issue/KT-40226" id="feea4470" data-external="true" rel="noopener noreferrer">here</a>.</p></section><div class="last-modified"> Last modified: 06 July 2023</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="wasm-js-interop.html">Interoperability with JavaScript</a> <a class="navigation-links__next" href="running-kotlin-js.html">Run Kotlin/JS</a> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2023 JetBrains s.r.o. and Kotlin Programming Language contributors<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://kotlinlang.org/docs/js-project-setup.html" class="_attribution-link">https://kotlinlang.org/docs/js-project-setup.html</a>
  </p>
</div>
