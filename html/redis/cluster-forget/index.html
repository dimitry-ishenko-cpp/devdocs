<h1 class="command-name">CLUSTER</h1>
<pre>CLUSTER FORGET</pre> <div class="font-semibold text-slate-900">Syntax</div> <pre class="command-syntax">CLUSTER FORGET node-id</pre> <dl class="grid grid-cols-[auto,1fr] gap-x-2 mb-12"> <dt class="font-semibold text-slate-900">Available since:</dt> <dd>3.0.0</dd> <dt class="font-semibold text-slate-900">Time complexity:</dt> <dd>O(1)</dd> <dt class="font-semibold text-slate-900">ACL categories:</dt> <dd> <code>@admin</code><span class="mr-1 last:hidden">,</span> <code>@slow</code><span class="mr-1 last:hidden">,</span> <code>@dangerous</code><span class="mr-1 last:hidden">,</span> </dd> </dl> <p>The command is used in order to remove a node, specified via its node ID, from the set of <em>known nodes</em> of the Redis Cluster node receiving the command. In other words the specified node is removed from the <em>nodes table</em> of the node receiving the command.</p> <p>Because when a given node is part of the cluster, all the other nodes participating in the cluster knows about it, in order for a node to be completely removed from a cluster, the <code>CLUSTER FORGET</code> command must be sent to all the remaining nodes, regardless of the fact they are masters or replicas.</p> <p>However the command cannot simply drop the node from the internal node table of the node receiving the command, it also implements a ban-list, not allowing the same node to be added again as a side effect of processing the <em>gossip section</em> of the heartbeat packets received from other nodes.</p> <h2 id="details-on-why-the-ban-list-is-needed">Details on why the ban-list is needed</h2> <p>In the following example we'll show why the command must not just remove a given node from the nodes table, but also prevent it for being re-inserted again for some time.</p> <p>Let's assume we have four nodes, A, B, C and D. In order to end with just a three nodes cluster A, B, C we may follow these steps:</p> <ol> <li>Reshard all the hash slots from D to nodes A, B, C.</li> <li>D is now empty, but still listed in the nodes table of A, B and C.</li> <li>We contact A, and send <code>CLUSTER FORGET D</code>.</li> <li>B sends node A a heartbeat packet, where node D is listed.</li> <li>A does no longer known node D (see step 3), so it starts a handshake with D.</li> <li>D ends re-added in the nodes table of A.</li> </ol> <p>As you can see in this way removing a node is fragile, we need to send <code>CLUSTER FORGET</code> commands to all the nodes ASAP hoping there are no gossip sections processing in the meantime. Because of this problem the command implements a ban-list with an expire time for each entry.</p> <p>So what the command really does is:</p> <ol> <li>The specified node gets removed from the nodes table.</li> <li>The node ID of the removed node gets added to the ban-list, for 1 minute.</li> <li>The node will skip all the node IDs listed in the ban-list when processing gossip sections received in heartbeat packets from other nodes.</li> </ol> <p>This way we have a 60 second window to inform all the nodes in the cluster that we want to remove a node.</p> <h2 id="special-conditions-not-allowing-the-command-execution">Special conditions not allowing the command execution</h2> <p>The command does not succeed and returns an error in the following cases:</p> <ol> <li>The specified node ID is not found in the nodes table.</li> <li>The node receiving the command is a replica, and the specified node ID identifies its current master.</li> <li>The node ID identifies the same node we are sending the command to.</li> </ol> <h2 id="return">Return</h2> <p><a href="https://redis.io/docs/reference/protocol-spec#resp-simple-strings">Simple string reply</a>: <code>OK</code> if the command was executed successfully, otherwise an error is returned.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2022 Salvatore Sanfilippo<br>Licensed under the Creative Commons Attribution-ShareAlike License 4.0.<br>
    <a href="https://redis.io/commands/cluster-forget/" class="_attribution-link">https://redis.io/commands/cluster-forget/</a>
  </p>
</div>
