<h1 class="command-name">CLUSTER</h1>
<pre>CLUSTER NODES</pre> <div class="font-semibold text-slate-900">Syntax</div> <pre class="command-syntax">CLUSTER NODES</pre> <dl class="grid grid-cols-[auto,1fr] gap-x-2 mb-12"> <dt class="font-semibold text-slate-900">Available since:</dt> <dd>3.0.0</dd> <dt class="font-semibold text-slate-900">Time complexity:</dt> <dd>O(N) where N is the total number of Cluster nodes</dd> <dt class="font-semibold text-slate-900">ACL categories:</dt> <dd> <code>@slow</code><span class="mr-1 last:hidden">,</span> </dd> </dl> <p>Each node in a Redis Cluster has its view of the current cluster configuration, given by the set of known nodes, the state of the connection we have with such nodes, their flags, properties and assigned slots, and so forth.</p> <p><code>CLUSTER NODES</code> provides all this information, that is, the current cluster configuration of the node we are contacting, in a serialization format which happens to be exactly the same as the one used by Redis Cluster itself in order to store on disk the cluster state (however the on disk cluster state has a few additional info appended at the end).</p> <p>Note that normally clients willing to fetch the map between Cluster hash slots and node addresses should use <a href="../cluster-slots.html"><code>CLUSTER SLOTS</code></a> instead. <code>CLUSTER NODES</code>, that provides more information, should be used for administrative tasks, debugging, and configuration inspections. It is also used by <code>redis-cli</code> in order to manage a cluster.</p> <h2 id="serialization-format">Serialization format</h2> <p>The output of the command is just a space-separated CSV string, where each line represents a node in the cluster. Starting from 7.2.0, the output of the command always contains a new auxiliary field called shard-id. The following is an example of output on Redis 7.2.0.</p> <pre tabindex="0">07c37dfeb235213a872192d90877d0cd55635b91 127.0.0.1:30004@31004,,shard-id=69bc080733d1355567173199cff4a6a039a2f024 slave e7d1eecce10fd6bb5eb35b9f99a514335d9ba9ca 0 1426238317239 4 connected
67ed2db8d677e59ec4a4cefb06858cf2a1a89fa1 127.0.0.1:30002@31002,,shard-id=114f6674a35b84949fe567f5dfd41415ee776261 master - 0 1426238316232 2 connected 5461-10922
292f8b365bb7edb5e285caf0b7e6ddc7265d2f4f 127.0.0.1:30003@31003,,shard-id=fdb36c73e72dd027bc19811b7c219ef6e55c550e master - 0 1426238318243 3 connected 10923-16383
6ec23923021cf3ffec47632106199cb7f496ce01 127.0.0.1:30005@31005,,shard-id=114f6674a35b84949fe567f5dfd41415ee776261 slave 67ed2db8d677e59ec4a4cefb06858cf2a1a89fa1 0 1426238316232 5 connected
824fe116063bc5fcf9f4ffd895bc17aee7731ac3 127.0.0.1:30006@31006,,shard-id=fdb36c73e72dd027bc19811b7c219ef6e55c550e slave 292f8b365bb7edb5e285caf0b7e6ddc7265d2f4f 0 1426238317741 6 connected
e7d1eecce10fd6bb5eb35b9f99a514335d9ba9ca 127.0.0.1:30001@31001,,shard-id=69bc080733d1355567173199cff4a6a039a2f024 myself,master - 0 0 1 connected 0-5460
</pre>
<p>Each line is composed of the following fields:</p> <pre tabindex="0">&lt;id&gt; &lt;ip:port@cport[,hostname[,auxiliary_field=value]*]&gt; &lt;flags&gt; &lt;master&gt; &lt;ping-sent&gt; &lt;pong-recv&gt; &lt;config-epoch&gt; &lt;link-state&gt; &lt;slot&gt; &lt;slot&gt; ... &lt;slot&gt;
</pre>
<p>The meaning of each filed is the following:</p> <ol> <li>
<code>id</code>: The node ID, a 40-character globally unique string generated when a node is created and never changed again (unless <code>CLUSTER RESET HARD</code> is used).</li> <li>
<code>ip:port@cport</code>: The node address that clients should contact to run queries.</li> <li>
<code>hostname</code>: A human readable string that can be configured via the <code>cluster-annouce-hostname</code> setting. The max length of the string is 256 characters, excluding the null terminator. The name can contain ASCII alphanumeric characters, '-', and '.' only.</li> <li>
<code>[,auxiliary_field=value]*</code>: A list of comma-separated key-value pairs that represent various node properties, such as <code>shard-id</code>. There is no intrinsic order among auxiliary fields. The auxiliary fields can appear at different position in the list from release to release. Both the key name and value can contain ASCII alphanumeric characters and the characters in <code>!#$%&amp;()*+-.:;&lt;&gt;?@[]^_{|}~</code> only. Auxiliary fields are explained in detail in the section below.</li> <li>
<code>flags</code>: A list of comma separated flags: <code>myself</code>, <code>master</code>, <code>slave</code>, <code>fail?</code>, <code>fail</code>, <code>handshake</code>, <code>noaddr</code>, <code>nofailover</code>, <code>noflags</code>. Flags are explained below.</li> <li>
<code>master</code>: If the node is a replica, and the primary is known, the primary node ID, otherwise the "-" character.</li> <li>
<code>ping-sent</code>: Unix time at which the currently active ping was sent, or zero if there are no pending pings, in milliseconds.</li> <li>
<code>pong-recv</code>: Unix time the last pong was received, in milliseconds.</li> <li>
<code>config-epoch</code>: The configuration epoch (or version) of the current node (or of the current primary if the node is a replica). Each time there is a failover, a new, unique, monotonically increasing configuration epoch is created. If multiple nodes claim to serve the same hash slots, the one with the higher configuration epoch wins.</li> <li>
<code>link-state</code>: The state of the link used for the node-to-node cluster bus. Use this link to communicate with the node. Can be <code>connected</code> or <code>disconnected</code>.</li> <li>
<code>slot</code>: A hash slot number or range. Starting from argument number 9, but there may be up to 16384 entries in total (limit never reached). This is the list of hash slots served by this node. If the entry is just a number, it is parsed as such. If it is a range, it is in the form <code>start-end</code>, and means that the node is responsible for all the hash slots from <code>start</code> to <code>end</code> including the start and end values.</li> </ol> <p>Auxiliary fields are:</p> <ul> <li>
<code>shard-id</code>: a 40-character globally unique string generated when a node is created. A node's shard id changes only when the node joins a different shard via <code>cluster replicate</code> and there the node's shard id is updated to its primary's.</li> </ul> <p>Flags are:</p> <ul> <li>
<code>myself</code>: The node you are contacting.</li> <li>
<code>master</code>: Node is a primary.</li> <li>
<code>slave</code>: Node is a replica.</li> <li>
<code>fail?</code>: Node is in <code>PFAIL</code> state. Not reachable for the node you are contacting, but still logically reachable (not in <code>FAIL</code> state).</li> <li>
<code>fail</code>: Node is in <code>FAIL</code> state. It was not reachable for multiple nodes that promoted the <code>PFAIL</code> state to <code>FAIL</code>.</li> <li>
<code>handshake</code>: Untrusted node, we are handshaking.</li> <li>
<code>noaddr</code>: No address known for this node.</li> <li>
<code>nofailover</code>: Replica will not try to failover.</li> <li>
<code>noflags</code>: No flags at all.</li> </ul> <h2 id="notes-on-published-config-epochs">Notes on published config epochs</h2> <p>Replicas broadcast their primary's config epochs (in order to get an <code>UPDATE</code> message if they are found to be stale), so the real config epoch of the replica (which is meaningless more or less, since they don't serve hash slots) can be only obtained checking the node flagged as <code>myself</code>, which is the entry of the node we are asking to generate <code>CLUSTER NODES</code> output. The other replicas epochs reflect what they publish in heartbeat packets, which is, the configuration epoch of the primaries they are currently replicating.</p> <h2 id="special-slot-entries">Special slot entries</h2> <p>Normally hash slots associated to a given node are in one of the following formats, as already explained above:</p> <ol> <li>Single number: 3894</li> <li>Range: 3900-4000</li> </ol> <p>However node hash slots can be in a special state, used in order to communicate errors after a node restart (mismatch between the keys in the AOF/RDB file, and the node hash slots configuration), or when there is a resharding operation in progress. This two states are <strong>importing</strong> and <strong>migrating</strong>.</p> <p>The meaning of the two states is explained in the Redis Specification, however the gist of the two states is the following:</p> <ul> <li>
<strong>Importing</strong> slots are yet not part of the nodes hash slot, there is a migration in progress. The node will accept queries about these slots only if the <code>ASK</code> command is used.</li> <li>
<strong>Migrating</strong> slots are assigned to the node, but are being migrated to some other node. The node will accept queries if all the keys in the command exist already, otherwise it will emit what is called an <strong>ASK redirection</strong>, to force new keys creation directly in the importing node.</li> </ul> <p>Importing and migrating slots are emitted in the <code>CLUSTER NODES</code> output as follows:</p> <ul> <li>
<strong>Importing slot:</strong> <code>[slot_number-&lt;-importing_from_node_id]</code>
</li> <li>
<strong>Migrating slot:</strong> <code>[slot_number-&gt;-migrating_to_node_id]</code>
</li> </ul> <p>The following are a few examples of importing and migrating slots:</p> <ul> <li><code>[93-&lt;-292f8b365bb7edb5e285caf0b7e6ddc7265d2f4f]</code></li> <li><code>[1002-&lt;-67ed2db8d677e59ec4a4cefb06858cf2a1a89fa1]</code></li> <li><code>[77-&gt;-e7d1eecce10fd6bb5eb35b9f99a514335d9ba9ca]</code></li> <li><code>[16311-&gt;-292f8b365bb7edb5e285caf0b7e6ddc7265d2f4f]</code></li> </ul> <p>Note that the format does not have any space, so <code>CLUSTER NODES</code> output format is plain CSV with space as separator even when this special slots are emitted. However a complete parser for the format should be able to handle them.</p> <p>Note that:</p> <ol> <li>Migration and importing slots are only added to the node flagged as <code>myself</code>. This information is local to a node, for its own slots.</li> <li>Importing and migrating slots are provided as <strong>additional info</strong>. If the node has a given hash slot assigned, it will be also a plain number in the list of hash slots, so clients that don't have a clue about hash slots migrations can just skip this special fields.</li> </ol> <h2 id="return">Return</h2> <p><a href="https://redis.io/docs/reference/protocol-spec#resp-bulk-strings">Bulk string reply</a>: The serialized cluster configuration.</p> <p><strong>A note about the word slave used in this man page and command name</strong>: Starting with Redis 5, if not for backward compatibility, the Redis project no longer uses the word slave. Unfortunately in this command the word slave is part of the protocol, so we'll be able to remove such occurrences only when this API will be naturally deprecated.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2022 Salvatore Sanfilippo<br>Licensed under the Creative Commons Attribution-ShareAlike License 4.0.<br>
    <a href="https://redis.io/commands/cluster-nodes/" class="_attribution-link">https://redis.io/commands/cluster-nodes/</a>
  </p>
</div>
