<h1 class="command-name">XTRIM</h1>
<pre>XTRIM</pre> <div class="font-semibold text-slate-900">Syntax</div> <pre class="command-syntax">XTRIM key &lt;MAXLEN | MINID&gt; [= | ~] threshold [LIMITÂ count]</pre> <dl class="grid grid-cols-[auto,1fr] gap-x-2 mb-12"> <dt class="font-semibold text-slate-900">Available since:</dt> <dd>5.0.0</dd> <dt class="font-semibold text-slate-900">Time complexity:</dt> <dd>O(N), with N being the number of evicted entries. Constant times are very small however, since entries are organized in macro nodes containing multiple entries that can be released with a single deallocation.</dd> <dt class="font-semibold text-slate-900">ACL categories:</dt> <dd> <code>@write</code><span class="mr-1 last:hidden">,</span> <code>@stream</code><span class="mr-1 last:hidden">,</span> <code>@slow</code><span class="mr-1 last:hidden">,</span> </dd> </dl> <p><code>XTRIM</code> trims the stream by evicting older entries (entries with lower IDs) if needed.</p> <p>Trimming the stream can be done using one of these strategies:</p> <ul> <li>
<code>MAXLEN</code>: Evicts entries as long as the stream's length exceeds the specified <code>threshold</code>, where <code>threshold</code> is a positive integer.</li> <li>
<code>MINID</code>: Evicts entries with IDs lower than <code>threshold</code>, where <code>threshold</code> is a stream ID.</li> </ul> <p>For example, this will trim the stream to exactly the latest 1000 items:</p> <pre tabindex="0">XTRIM mystream MAXLEN 1000
</pre>
<p>Whereas in this example, all entries that have an ID lower than 649085820-0 will be evicted:</p> <pre tabindex="0">XTRIM mystream MINID 649085820
</pre>
<p>By default, or when provided with the optional <code>=</code> argument, the command performs exact trimming.</p> <p>Depending on the strategy, exact trimming means:</p> <ul> <li>
<code>MAXLEN</code>: the trimmed stream's length will be exactly the minimum between its original length and the specified <code>threshold</code>.</li> <li>
<code>MINID</code>: the oldest ID in the stream will be exactly the maximum between its original oldest ID and the specified <code>threshold</code>.</li> </ul> <h2 id="nearly-exact-trimming">Nearly exact trimming</h2> <p>Because exact trimming may require additional effort from the Redis server, the optional <code>~</code> argument can be provided to make it more efficient.</p> <p>For example:</p> <pre tabindex="0">XTRIM mystream MAXLEN ~ 1000
</pre>
<p>The <code>~</code> argument between the <code>MAXLEN</code> strategy and the <code>threshold</code> means that the user is requesting to trim the stream so its length is <strong>at least</strong> the <code>threshold</code>, but possibly slightly more. In this case, Redis will stop trimming early when performance can be gained (for example, when a whole macro node in the data structure can't be removed). This makes trimming much more efficient, and it is usually what you want, although after trimming, the stream may have few tens of additional entries over the <code>threshold</code>.</p> <p>Another way to control the amount of work done by the command when using the <code>~</code>, is the <code>LIMIT</code> clause. When used, it specifies the maximal <code>count</code> of entries that will be evicted. When <code>LIMIT</code> and <code>count</code> aren't specified, the default value of 100 * the number of entries in a macro node will be implicitly used as the <code>count</code>. Specifying the value 0 as <code>count</code> disables the limiting mechanism entirely.</p> <h2 id="return">Return</h2> <p><a href="https://redis.io/docs/reference/protocol-spec#resp-integers">Integer reply</a>: The number of entries deleted from the stream.</p> <h2 id="examples">Examples</h2>  <pre class="redis-cli overflow-y-auto max-h-80">
XADD mystream * field1 A field2 B field3 C field4 D
XTRIM mystream MAXLEN 2
XRANGE mystream - +
</pre> <h2>History</h2> <ul> <li>Starting with Redis version 6.2.0: Added the <code>MINID</code> trimming strategy and the <code>LIMIT</code> option.</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2022 Salvatore Sanfilippo<br>Licensed under the Creative Commons Attribution-ShareAlike License 4.0.<br>
    <a href="https://redis.io/commands/xtrim/" class="_attribution-link">https://redis.io/commands/xtrim/</a>
  </p>
</div>
