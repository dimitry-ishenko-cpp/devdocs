<h1 class="command-name">TS.MRANGE</h1>
<pre>TS.MRANGE</pre> <div class="font-semibold text-slate-900">Syntax</div> <pre class="command-syntax">TS.MRANGE fromTimestamp toTimestamp
  [LATEST]
  [FILTER_BY_TS ts...]
  [FILTER_BY_VALUE min max]
  [WITHLABELS | SELECTED_LABELS label...]
  [COUNT count]
  [[ALIGN align] AGGREGATION aggregator bucketDuration [BUCKETTIMESTAMP bt] [EMPTY]]
  FILTER filterExpr...
  [GROUPBY label REDUCE reducer]
</pre> <dl class="grid grid-cols-[auto,1fr] gap-x-2 mb-12"> <dt class="font-semibold text-slate-900">Available in:</dt> <dd> <a href="https://redis.io/docs/stack">Redis Stack</a> / <a href="https://redis.io/docs/stack/timeseries">TimeSeries 1.0.0</a> </dd> <dt class="font-semibold text-slate-900">Time complexity:</dt> <dd>O(n/m+k) where n = Number of data points, m = Chunk size (data points per chunk), k = Number of data points that are in the requested ranges</dd> </dl> <p>Query a range across multiple time series by filters in forward direction</p> <p><a href="#examples">Examples</a></p> <h2 id="required-arguments">Required arguments</h2> <details open> <summary><code>fromTimestamp</code></summary> <p>is start timestamp for the range query (integer UNIX timestamp in milliseconds) or <code>-</code> to denote the timestamp of the earliest sample amongs all time series that passes <code>FILTER filterExpr...</code>.</p> </details> <details open> <summary><code>toTimestamp</code></summary> <p>is end timestamp for the range query (integer UNIX timestamp in milliseconds) or <code>+</code> to denote the timestamp of the latest sample amongs all time series that passes <code>FILTER filterExpr...</code>.</p> </details> <details open> <summary><code>FILTER filterExpr...</code></summary> <p>filters time series based on their labels and label values. Each filter expression has one of the following syntaxes:</p> <ul> <li>
<code>label=value</code>, where <code>label</code> equals <code>value</code>
</li> <li>
<code>label!=value</code>, where <code>label</code> does not equal <code>value</code>
</li> <li>
<code>label=</code>, where <code>key</code> does not have label <code>label</code>
</li> <li>
<code>label!=</code>, where <code>key</code> has label <code>label</code>
</li> <li>
<code>label=(value1,value2,...)</code>, where <code>key</code> with label <code>label</code> equals one of the values in the list</li> <li>
<code>label!=(value1,value2,...)</code>, where key with label <code>label</code> does not equal any of the values in the list</li> </ul> <p><note><b>Notes:</b></note></p> <ul> <li>At least one <code>label=value</code> filter is required.</li> <li>Filters are conjunctive. For example, the FILTER <code>type=temperature room=study</code> means the a time series is a temperature time series of a study room.</li> <li>Don't use whitespaces in the filter expression. </li> </ul> </details> <h2 id="optional-arguments">Optional arguments</h2> <details open> <summary><code>LATEST</code> (since RedisTimeSeries v1.8)</summary> <p>is used when a time series is a compaction. With <code>LATEST</code>, TS.MRANGE also reports the compacted value of the latest possibly partial bucket, given that this bucket's start time falls within <code>[fromTimestamp, toTimestamp]</code>. Without <code>LATEST</code>, TS.MRANGE does not report the latest possibly partial bucket. When a time series is not a compaction, <code>LATEST</code> is ignored.</p> <p>The data in the latest bucket of a compaction is possibly partial. A bucket is <em>closed</em> and compacted only upon arrival of a new sample that <em>opens</em> a new <em>latest</em> bucket. There are cases, however, when the compacted value of the latest possibly partial bucket is also required. In such a case, use <code>LATEST</code>.</p> </details> <details open> <summary><code>FILTER_BY_TS ts...</code> (since RedisTimeSeries v1.6)</summary> <p>filters samples by a list of specific timestamps. A sample passes the filter if its exact timestamp is specified and falls within <code>[fromTimestamp, toTimestamp]</code>.</p> </details> <details open> <summary><code>FILTER_BY_VALUE min max</code> (since RedisTimeSeries v1.6)</summary> <p>filters samples by minimum and maximum values.</p> </details> <details open> <summary><code>WITHLABELS</code></summary> <p>includes in the reply all label-value pairs representing metadata labels of the time series. If <code>WITHLABELS</code> or <code>SELECTED_LABELS</code> are not specified, by default, an empty list is reported as label-value pairs.</p> </details> <details open> <summary><code>SELECTED_LABELS label...</code> (since RedisTimeSeries v1.6)</summary> <p>returns a subset of the label-value pairs that represent metadata labels of the time series. Use when a large number of labels exists per series, but only the values of some of the labels are required. If <code>WITHLABELS</code> or <code>SELECTED_LABELS</code> are not specified, by default, an empty list is reported as label-value pairs.</p> </details> <details open> <summary><code>COUNT count</code></summary> <p>limits the number of returned samples.</p> </details> <details open> <summary><code>ALIGN align</code> (since RedisTimeSeries v1.6)</summary> <p>is a time bucket alignment control for <code>AGGREGATION</code>. It controls the time bucket timestamps by changing the reference timestamp on which a bucket is defined.</p> <p>Values include:</p> <ul> <li>
<code>start</code> or <code>-</code>: The reference timestamp will be the query start interval time (<code>fromTimestamp</code>) which can't be <code>-</code>
</li> <li>
<code>end</code> or <code>+</code>: The reference timestamp will be the query end interval time (<code>toTimestamp</code>) which can't be <code>+</code>
</li> <li>A specific timestamp: align the reference timestamp to a specific time</li> </ul> <p><note><b>Note:</b> When not provided, alignment is set to <code>0</code>.</note></p> </details> <details open> <summary><code>AGGREGATION aggregator bucketDuration</code></summary> <p>per time series, aggregates samples into time buckets, where:</p> <ul> <li> <p><code>aggregator</code> takes one of the following aggregation types:</p> <table> <thead> <tr> <th><code>aggregator</code></th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>avg</code></td> <td>Arithmetic mean of all values</td> </tr> <tr> <td><code>sum</code></td> <td>Sum of all values</td> </tr> <tr> <td><code>min</code></td> <td>Minimum value</td> </tr> <tr> <td><code>max</code></td> <td>Maximum value</td> </tr> <tr> <td><code>range</code></td> <td>Difference between maximum value and minimum value</td> </tr> <tr> <td><code>count</code></td> <td>Number of values</td> </tr> <tr> <td><code>first</code></td> <td>Value with lowest timestamp in the bucket</td> </tr> <tr> <td><code>last</code></td> <td>Value with highest timestamp in the bucket</td> </tr> <tr> <td><code>std.p</code></td> <td>Population standard deviation of the values</td> </tr> <tr> <td><code>std.s</code></td> <td>Sample standard deviation of the values</td> </tr> <tr> <td><code>var.p</code></td> <td>Population variance of the values</td> </tr> <tr> <td><code>var.s</code></td> <td>Sample variance of the values</td> </tr> <tr> <td><code>twa</code></td> <td>Time-weighted average over the bucket's timeframe (since RedisTimeSeries v1.8)</td> </tr> </tbody> </table> </li> <li> <p><code>bucketDuration</code> is duration of each bucket, in milliseconds.</p> </li> </ul> <p>Without <code>ALIGN</code>, bucket start times are multiples of <code>bucketDuration</code>.</p> <p>With <code>ALIGN align</code>, bucket start times are multiples of <code>bucketDuration</code> with remainder <code>align % bucketDuration</code>.</p> <p>The first bucket start time is less than or equal to <code>fromTimestamp</code>.</p> </details> <details open> <summary><code>[BUCKETTIMESTAMP bt]</code> (since RedisTimeSeries v1.8)</summary> <p>controls how bucket timestamps are reported.</p> <table> <thead> <tr> <th><code>bt</code></th> <th>Timestamp reported for each bucket</th> </tr> </thead> <tbody> <tr> <td>
<code>-</code> or <code>low</code>
</td> <td>the bucket's start time (default)</td> </tr> <tr> <td>
<code>+</code> or <code>high</code>
</td> <td>the bucket's end time</td> </tr> <tr> <td>
<code>~</code> or <code>mid</code>
</td> <td>the bucket's mid time (rounded down if not an integer)</td> </tr> </tbody> </table> </details> <details open> <summary><code>[EMPTY]</code> (since RedisTimeSeries v1.8)</summary> <p>is a flag, which, when specified, reports aggregations also for empty buckets.</p> <table> <thead> <tr> <th><code>aggregator</code></th> <th>Value reported for each empty bucket</th> </tr> </thead> <tbody> <tr> <td>
<code>sum</code>, <code>count</code>
</td> <td><code>0</code></td> </tr> <tr> <td><code>last</code></td> <td>The value of the last sample before the bucket's start. <code>NaN</code> when no such sample.</td> </tr> <tr> <td><code>twa</code></td> <td>Average value over the bucket's timeframe based on linear interpolation of the last sample before the bucket's start and the first sample after the bucket's end. <code>NaN</code> when no such samples.</td> </tr> <tr> <td>
<code>min</code>, <code>max</code>, <code>range</code>, <code>avg</code>, <code>first</code>, <code>std.p</code>, <code>std.s</code>
</td> <td><code>NaN</code></td> </tr> </tbody> </table> <p>Regardless of the values of <code>fromTimestamp</code> and <code>toTimestamp</code>, no data is reported for buckets that end before the earliest sample or begin after the latest sample in the time series.</p> </details> <details open> <summary><code>GROUPBY label REDUCE reducer</code> (since RedisTimeSeries v1.6)</summary> <p>splits time series into groups, each group contains time series that share the same value for the provided label name, then aggregates results in each group.</p> <p>When combined with <code>AGGREGATION</code> the <code>GROUPBY</code>/<code>REDUCE</code> is applied post aggregation stage.</p> <ul> <li> <p><code>label</code> is label name. A group is created for all time series that share the same value for this label.</p> </li> <li> <p><code>reducer</code> is an aggregation type used to aggregate the results in each group.</p> <table> <thead> <tr> <th><code>reducer</code></th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>avg</code></td> <td>Arithmetic mean of all non-NaN values (since RedisTimeSeries v1.8)</td> </tr> <tr> <td><code>sum</code></td> <td>Sum of all non-NaN values</td> </tr> <tr> <td><code>min</code></td> <td>Minimum non-NaN value</td> </tr> <tr> <td><code>max</code></td> <td>Maximum non-NaN value</td> </tr> <tr> <td><code>range</code></td> <td>Difference between maximum non-NaN value and minimum non-NaN value (since RedisTimeSeries v1.8)</td> </tr> <tr> <td><code>count</code></td> <td>Number of non-NaN values (since RedisTimeSeries v1.8)</td> </tr> <tr> <td><code>std.p</code></td> <td>Population standard deviation of all non-NaN values (since RedisTimeSeries v1.8)</td> </tr> <tr> <td><code>std.s</code></td> <td>Sample standard deviation of all non-NaN values (since RedisTimeSeries v1.8)</td> </tr> <tr> <td><code>var.p</code></td> <td>Population variance of all non-NaN values (since RedisTimeSeries v1.8)</td> </tr> <tr> <td><code>var.s</code></td> <td>Sample variance of all non-NaN values (since RedisTimeSeries v1.8)</td> </tr> </tbody> </table> </li> </ul> <p><note><b>Notes:</b></note></p> <ul> <li>The produced time series is named <code>&lt;label&gt;=&lt;value&gt;</code>
</li> <li>The produced time series contains two labels with these label array structures: <ul> <li>
<code>__reducer__</code>, the reducer used (e.g., <code>"count"</code>)</li> <li>
<code>__source__</code>, the list of time series keys used to compute the grouped series (e.g., <code>"key1,key2,key3"</code>) </li> </ul> </li> </ul> </details> <p><note><b>Note:</b> An <code>MRANGE</code> command cannot be part of a transaction when running on a Redis cluster.</note></p> <h2 id="return-value">Return value</h2> <p>If <code>GROUPBY label REDUCE reducer</code> is not specified:</p> <ul> <li>
<a href="https://redis.io/docs/reference/protocol-spec#resp-arrays">Array reply</a>: for each time series matching the specified filters, the following is reported: <ul> <li>bulk-string-reply: The time series key name</li> <li>
<a href="https://redis.io/docs/reference/protocol-spec#resp-arrays">Array reply</a>: label-value pairs (<a href="https://redis.io/docs/reference/protocol-spec#resp-bulk-strings">Bulk string reply</a>, <a href="https://redis.io/docs/reference/protocol-spec#resp-bulk-strings">Bulk string reply</a>) <ul> <li>By default, an empty array is reported</li> <li>If <code>WITHLABELS</code> is specified, all labels associated with this time series are reported</li> <li>If <code>SELECTED_LABELS label...</code> is specified, the selected labels are reported (null value when no such label defined)</li> </ul> </li> <li>
<a href="https://redis.io/docs/reference/protocol-spec#resp-arrays">Array reply</a>: timestamp-value pairs (<a href="https://redis.io/docs/reference/protocol-spec#resp-integers">Integer reply</a>, <a href="https://redis.io/docs/reference/protocol-spec#resp-simple-strings">Simple string reply</a> (double)): all samples/aggregations matching the range</li> </ul> </li> </ul> <p>If <code>GROUPBY label REDUCE reducer</code> is specified:</p> <ul> <li>
<a href="https://redis.io/docs/reference/protocol-spec#resp-arrays">Array reply</a>: for each group of time series matching the specified filters, the following is reported: <ul> <li>bulk-string-reply with the format <code>label=value</code> where <code>label</code> is the <code>GROUPBY</code> label argument</li> <li>
<a href="https://redis.io/docs/reference/protocol-spec#resp-arrays">Array reply</a>: label-value pairs (<a href="https://redis.io/docs/reference/protocol-spec#resp-bulk-strings">Bulk string reply</a>, <a href="https://redis.io/docs/reference/protocol-spec#resp-bulk-strings">Bulk string reply</a>): <ul> <li>By default, an empty array is reported</li> <li>If <code>WITHLABELS</code> is specified, the <code>GROUPBY</code> label argument and value are reported</li> <li>If <code>SELECTED_LABELS label...</code> is specified, the selected labels are reported (null value when no such label defined or label does not have the same value for all grouped time series)</li> </ul> </li> <li>
<a href="https://redis.io/docs/reference/protocol-spec#resp-arrays">Array reply</a>: either a single pair (<a href="https://redis.io/docs/reference/protocol-spec#resp-bulk-strings">Bulk string reply</a>, <a href="https://redis.io/docs/reference/protocol-spec#resp-bulk-strings">Bulk string reply</a>): the <code>GROUPBY</code> label argument and value, or empty array if</li> <li>
<a href="https://redis.io/docs/reference/protocol-spec#resp-arrays">Array reply</a>: a single pair (<a href="https://redis.io/docs/reference/protocol-spec#resp-bulk-strings">Bulk string reply</a>, <a href="https://redis.io/docs/reference/protocol-spec#resp-bulk-strings">Bulk string reply</a>): the string <code>__reducer__</code> and the reducer argument</li> <li>
<a href="https://redis.io/docs/reference/protocol-spec#resp-arrays">Array reply</a>: a single pair (<a href="https://redis.io/docs/reference/protocol-spec#resp-bulk-strings">Bulk string reply</a>, <a href="https://redis.io/docs/reference/protocol-spec#resp-bulk-strings">Bulk string reply</a>): the string <code>__source__</code> and the time series key names separated by <code>,</code>
</li> <li>
<a href="https://redis.io/docs/reference/protocol-spec#resp-arrays">Array reply</a>: timestamp-value pairs (<a href="https://redis.io/docs/reference/protocol-spec#resp-integers">Integer reply</a>, <a href="https://redis.io/docs/reference/protocol-spec#resp-simple-strings">Simple string reply</a> (double)): all samples/aggregations matching the range</li> </ul> </li> </ul> <h2 id="examples">Examples</h2> <details open> <summary><b>Retrieve maximum stock price per timestamp</b></summary> <p>Create two stocks and add their prices at three different timestamps.</p> <div class="highlight"><pre tabindex="0" class="chroma"><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.CREATE stock:A LABELS <span class="nb">type</span> stock name A
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.CREATE stock:B LABELS <span class="nb">type</span> stock name B
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MADD stock:A <span class="m">1000</span> <span class="m">100</span> stock:A <span class="m">1010</span> <span class="m">110</span> stock:A <span class="m">1020</span> <span class="m">120</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1000</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1010</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1020</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MADD stock:B <span class="m">1000</span> <span class="m">120</span> stock:B <span class="m">1010</span> <span class="m">110</span> stock:B <span class="m">1020</span> <span class="m">100</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1000</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1010</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1020</span></span></span></pre></div> <p>You can now retrieve the maximum stock price per timestamp.</p> <div class="highlight"><pre tabindex="0" class="chroma"><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MRANGE - + WITHLABELS FILTER <span class="nv">type</span><span class="o">=</span>stock GROUPBY <span class="nb">type</span> REDUCE max
</span></span><span class="line"><span class="cl">1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"type=stock"</span>
</span></span><span class="line"><span class="cl">   2<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"type"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"stock"</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"__reducer__"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"max"</span>
</span></span><span class="line"><span class="cl">      3<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"__source__"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"stock:A,stock:B"</span>
</span></span><span class="line"><span class="cl">   3<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1000</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">120</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1010</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">110</span>
</span></span><span class="line"><span class="cl">      3<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1020</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">120</span></span></span></pre></div> <p>The <code>FILTER type=stock</code> clause returns a single time series representing stock prices. The <code>GROUPBY type REDUCE max</code> clause splits the time series into groups with identical type values, and then, for each timestamp, aggregates all series that share the same type value using the max aggregator.</p> </details> <details open> <summary><b>Calculate average stock price and retrieve maximum average</b></summary> <p>Create two stocks and add their prices at nine different timestamps.</p> <div class="highlight"><pre tabindex="0" class="chroma"><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.CREATE stock:A LABELS <span class="nb">type</span> stock name A
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.CREATE stock:B LABELS <span class="nb">type</span> stock name B
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MADD stock:A <span class="m">1000</span> <span class="m">100</span> stock:A <span class="m">1010</span> <span class="m">110</span> stock:A <span class="m">1020</span> <span class="m">120</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1000</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1010</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1020</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MADD stock:B <span class="m">1000</span> <span class="m">120</span> stock:B <span class="m">1010</span> <span class="m">110</span> stock:B <span class="m">1020</span> <span class="m">100</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1000</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1010</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1020</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MADD stock:A <span class="m">2000</span> <span class="m">200</span> stock:A <span class="m">2010</span> <span class="m">210</span> stock:A <span class="m">2020</span> <span class="m">220</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">2000</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">2010</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">2020</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MADD stock:B <span class="m">2000</span> <span class="m">220</span> stock:B <span class="m">2010</span> <span class="m">210</span> stock:B <span class="m">2020</span> <span class="m">200</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">2000</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">2010</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">2020</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MADD stock:A <span class="m">3000</span> <span class="m">300</span> stock:A <span class="m">3010</span> <span class="m">310</span> stock:A <span class="m">3020</span> <span class="m">320</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">3000</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">3010</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">3020</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MADD stock:B <span class="m">3000</span> <span class="m">320</span> stock:B <span class="m">3010</span> <span class="m">310</span> stock:B <span class="m">3020</span> <span class="m">300</span>
</span></span><span class="line"><span class="cl">1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">3000</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">3010</span>
</span></span><span class="line"><span class="cl">3<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">3020</span></span></span></pre></div> <p>Now, for each stock, calculate the average stock price per a 1000-millisecond timeframe, and then retrieve the stock with the maximum average for that timeframe.</p> <div class="highlight"><pre tabindex="0" class="chroma"><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MRANGE - + WITHLABELS AGGREGATION avg <span class="m">1000</span> FILTER <span class="nv">type</span><span class="o">=</span>stock GROUPBY <span class="nb">type</span> REDUCE max
</span></span><span class="line"><span class="cl">1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"type=stock"</span>
</span></span><span class="line"><span class="cl">   2<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"type"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"stock"</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"__reducer__"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"max"</span>
</span></span><span class="line"><span class="cl">      3<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"__source__"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"stock:A,stock:B"</span>
</span></span><span class="line"><span class="cl">   3<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1000</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">110</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">2000</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">210</span>
</span></span><span class="line"><span class="cl">      3<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">3000</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">310</span></span></span></pre></div> </details> <details open> <summary><b>Group query results</b></summary> <p>Query all time series with the metric label equal to <code>cpu</code>, then group the time series by the value of their <code>metric_name</code> label value and for each group return the maximum value and the time series keys (<em>source</em>) with that value.</p> <div class="highlight"><pre tabindex="0" class="chroma"><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.ADD ts1 <span class="m">1548149180000</span> <span class="m">90</span> labels metric cpu metric_name system
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149180000</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.ADD ts1 <span class="m">1548149185000</span> <span class="m">45</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149185000</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.ADD ts2 <span class="m">1548149180000</span> <span class="m">99</span> labels metric cpu metric_name user
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149180000</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MRANGE - + WITHLABELS FILTER <span class="nv">metric</span><span class="o">=</span>cpu GROUPBY metric_name REDUCE max
</span></span><span class="line"><span class="cl">1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"metric_name=system"</span>
</span></span><span class="line"><span class="cl">   2<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"metric_name"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"system"</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"__reducer__"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"max"</span>
</span></span><span class="line"><span class="cl">      3<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"__source__"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"ts1"</span>
</span></span><span class="line"><span class="cl">   3<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149180000</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">90</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149185000</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">45</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"metric_name=user"</span>
</span></span><span class="line"><span class="cl">   2<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"metric_name"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"user"</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"__reducer__"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"max"</span>
</span></span><span class="line"><span class="cl">      3<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"__source__"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"ts2"</span>
</span></span><span class="line"><span class="cl">   3<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149180000</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">99</span></span></span></pre></div> </details> <details open> <summary><b>Filter query by value</b></summary> <p>Query all time series with the metric label equal to <code>cpu</code>, then filter values larger or equal to 90.0 and smaller or equal to 100.0.</p> <div class="highlight"><pre tabindex="0" class="chroma"><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.ADD ts1 <span class="m">1548149180000</span> <span class="m">90</span> labels metric cpu metric_name system
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149180000</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.ADD ts1 <span class="m">1548149185000</span> <span class="m">45</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149185000</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.ADD ts2 <span class="m">1548149180000</span> <span class="m">99</span> labels metric cpu metric_name user
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149180000</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MRANGE - + FILTER_BY_VALUE <span class="m">90</span> <span class="m">100</span> WITHLABELS FILTER <span class="nv">metric</span><span class="o">=</span>cpu
</span></span><span class="line"><span class="cl">1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"ts1"</span>
</span></span><span class="line"><span class="cl">   2<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"metric"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"cpu"</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"metric_name"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"system"</span>
</span></span><span class="line"><span class="cl">   3<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149180000</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">90</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"ts2"</span>
</span></span><span class="line"><span class="cl">   2<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"metric"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"cpu"</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"metric_name"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"user"</span>
</span></span><span class="line"><span class="cl">   3<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149180000</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">99</span></span></span></pre></div> </details> <details open> <summary><b>Query using a label</b></summary> <p>Query all time series with the metric label equal to <code>cpu</code>, but only return the team label.</p> <div class="highlight"><pre tabindex="0" class="chroma"><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.ADD ts1 <span class="m">1548149180000</span> <span class="m">90</span> labels metric cpu metric_name system team NY
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149180000</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.ADD ts1 <span class="m">1548149185000</span> <span class="m">45</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149185000</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.ADD ts2 <span class="m">1548149180000</span> <span class="m">99</span> labels metric cpu metric_name user team SF
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149180000</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; TS.MRANGE - + SELECTED_LABELS team FILTER <span class="nv">metric</span><span class="o">=</span>cpu
</span></span><span class="line"><span class="cl">1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"ts1"</span>
</span></span><span class="line"><span class="cl">   2<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"team"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"NY"</span>
</span></span><span class="line"><span class="cl">   3<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149180000</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">90</span>
</span></span><span class="line"><span class="cl">      2<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149185000</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">45</span>
</span></span><span class="line"><span class="cl">2<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"ts2"</span>
</span></span><span class="line"><span class="cl">   2<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="s2">"team"</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="s2">"SF"</span>
</span></span><span class="line"><span class="cl">   3<span class="o">)</span> 1<span class="o">)</span> 1<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span> <span class="m">1548149180000</span>
</span></span><span class="line"><span class="cl">         2<span class="o">)</span> <span class="m">99</span></span></span></pre></div> </details> <h2 id="see-also">See also</h2> <p><a href="../ts.range.html"><code>TS.RANGE</code></a> | <a href="../ts.mrevrange.html"><code>TS.MREVRANGE</code></a> | <a href="../ts.revrange.html"><code>TS.REVRANGE</code></a></p> <h2 id="related-topics">Related topics</h2> <p><a href="https://redis.io/docs/stack/timeseries">RedisTimeSeries</a></p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2022 Salvatore Sanfilippo<br>Licensed under the Creative Commons Attribution-ShareAlike License 4.0.<br>
    <a href="https://redis.io/commands/ts.mrange/" class="_attribution-link">https://redis.io/commands/ts.mrange/</a>
  </p>
</div>
