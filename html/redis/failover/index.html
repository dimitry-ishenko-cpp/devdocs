<h1 class="command-name">FAILOVER</h1>
<pre>FAILOVER</pre> <div class="font-semibold text-slate-900">Syntax</div> <pre class="command-syntax">FAILOVER [TO host port [FORCE]] [ABORT] [TIMEOUT milliseconds]</pre> <dl class="grid grid-cols-[auto,1fr] gap-x-2 mb-12"> <dt class="font-semibold text-slate-900">Available since:</dt> <dd>6.2.0</dd> <dt class="font-semibold text-slate-900">Time complexity:</dt> <dd>O(1)</dd> <dt class="font-semibold text-slate-900">ACL categories:</dt> <dd> <code>@admin</code><span class="mr-1 last:hidden">,</span> <code>@slow</code><span class="mr-1 last:hidden">,</span> <code>@dangerous</code><span class="mr-1 last:hidden">,</span> </dd> </dl> <p>This command will start a coordinated failover between the currently-connected-to master and one of its replicas. The failover is not synchronous, instead a background task will handle coordinating the failover. It is designed to limit data loss and unavailability of the cluster during the failover. This command is analogous to the <a href="../cluster-failover.html"><code>CLUSTER FAILOVER</code></a> command for non-clustered Redis and is similar to the failover support provided by sentinel.</p> <p>The specific details of the default failover flow are as follows:</p> <ol> <li>The master will internally start a <code>CLIENT PAUSE WRITE</code>, which will pause incoming writes and prevent the accumulation of new data in the replication stream.</li> <li>The master will monitor its replicas, waiting for a replica to indicate that it has fully consumed the replication stream. If the master has multiple replicas, it will only wait for the first replica to catch up.</li> <li>The master will then demote itself to a replica. This is done to prevent any dual master scenarios. NOTE: The master will not discard its data, so it will be able to rollback if the replica rejects the failover request in the next step.</li> <li>The previous master will send a special PSYNC request to the target replica, <code>PSYNC FAILOVER</code>, instructing the target replica to become a master.</li> <li>Once the previous master receives acknowledgement the <code>PSYNC FAILOVER</code> was accepted it will unpause its clients. If the PSYNC request is rejected, the master will abort the failover and return to normal.</li> </ol> <p>The field <code>master_failover_state</code> in <code>INFO replication</code> can be used to track the current state of the failover, which has the following values:</p> <ul> <li>
<code>no-failover</code>: There is no ongoing coordinated failover.</li> <li>
<code>waiting-for-sync</code>: The master is waiting for the replica to catch up to its replication offset.</li> <li>
<code>failover-in-progress</code>: The master has demoted itself, and is attempting to hand off ownership to a target replica.</li> </ul> <p>If the previous master had additional replicas attached to it, they will continue replicating from it as chained replicas. You will need to manually execute a <a href="../replicaof.html"><code>REPLICAOF</code></a> on these replicas to start replicating directly from the new master.</p> <h2 id="optional-arguments">Optional arguments</h2> <p>The following optional arguments exist to modify the behavior of the failover flow:</p> <ul> <li> <p><code>TIMEOUT</code> <em>milliseconds</em> -- This option allows specifying a maximum time a master will wait in the <code>waiting-for-sync</code> state before aborting the failover attempt and rolling back. This is intended to set an upper bound on the write outage the Redis cluster can experience. Failovers typically happen in less than a second, but could take longer if there is a large amount of write traffic or the replica is already behind in consuming the replication stream. If this value is not specified, the timeout can be considered to be "infinite".</p> </li> <li> <p><code>TO</code> <em>HOST</em> <em>PORT</em> -- This option allows designating a specific replica, by its host and port, to failover to. The master will wait specifically for this replica to catch up to its replication offset, and then failover to it.</p> </li> <li> <p><code>FORCE</code> -- If both the <code>TIMEOUT</code> and <code>TO</code> options are set, the force flag can also be used to designate that that once the timeout has elapsed, the master should failover to the target replica instead of rolling back. This can be used for a best-effort attempt at a failover without data loss, but limiting write outage.</p> </li> </ul> <p>NOTE: The master will always rollback if the <code>PSYNC FAILOVER</code> request is rejected by the target replica.</p> <h2 id="failover-abort">Failover abort</h2> <p>The failover command is intended to be safe from data loss and corruption, but can encounter some scenarios it can not automatically remediate from and may get stuck. For this purpose, the <code>FAILOVER ABORT</code> command exists, which will abort an ongoing failover and return the master to its normal state. The command has no side effects if issued in the <code>waiting-for-sync</code> state but can introduce multi-master scenarios in the <code>failover-in-progress</code> state. If a multi-master scenario is encountered, you will need to manually identify which master has the latest data and designate it as the master and have the other replicas.</p> <p>NOTE: <a href="../replicaof.html"><code>REPLICAOF</code></a> is disabled while a failover is in progress, this is to prevent unintended interactions with the failover that might cause data loss.</p> <h2 id="return">Return</h2> <p><a href="https://redis.io/docs/reference/protocol-spec#resp-simple-strings">Simple string reply</a>: <code>OK</code> if the command was accepted and a coordinated failover is in progress. An error if the operation cannot be executed.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2022 Salvatore Sanfilippo<br>Licensed under the Creative Commons Attribution-ShareAlike License 4.0.<br>
    <a href="https://redis.io/commands/failover/" class="_attribution-link">https://redis.io/commands/failover/</a>
  </p>
</div>
