<h1 title="Interface SegmentAllocator" class="title">Interface SegmentAllocator</h1> <section class="class-description" id="class-description"> <dl class="notes"> <dt>All Known Subinterfaces:</dt> <dd><code><a href="arena.html" title="interface in java.lang.foreign">Arena</a><sup><a href="arena.html#preview-java.lang.foreign.Arena">PREVIEW</a></sup></code></dd> </dl> <dl class="notes"> <dt>Functional Interface:</dt> <dd>This is a functional interface and can therefore be used as the assignment target for a lambda expression or method reference.</dd> </dl>  <pre class="lang-java" data-language="java">@FunctionalInterface public interface SegmentAllocator</pre> <div class="preview-block" id="preview-java.lang.foreign.SegmentAllocator">
<span class="preview-label"><code>SegmentAllocator</code> is a preview API of the Java platform.</span> <div class="preview-comment">Programs can only use <code>SegmentAllocator</code> when preview features are enabled.</div> <div class="preview-comment">Preview features may be removed in a future release, or upgraded to permanent features of the Java platform.</div> </div> <div class="block">An object that may be used to allocate <a href="memorysegment.html" title="interface in java.lang.foreign">memory segments</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup>. Clients implementing this interface must implement the <a href="#allocate(long,long)"><code>allocate(long, long)</code></a> method. A segment allocator defines several methods which can be useful to create segments from several kinds of Java values such as primitives and arrays. <p> <code>SegmentAllocator</code> is a <a href="../functionalinterface.html" title="annotation interface in java.lang">functional interface</a>. Clients can easily obtain a new segment allocator by using either a lambda expression or a method reference: </p>
<div class="snippet-container"> <pre class="lang-java" data-language="java"><code class="language-java">SegmentAllocator autoAllocator = (byteSize, byteAlignment) -&gt; Arena.ofAuto().allocate(byteSize, byteAlignment);
</code></pre> </div> <p> This interface defines factories for commonly used allocators: </p>
<ul> <li>
<a href="#slicingAllocator(java.lang.foreign.MemorySegment)"><code>slicingAllocator(MemorySegment)</code></a> obtains an efficient slicing allocator, where memory is allocated by repeatedly slicing the provided memory segment;</li> <li>
<a href="#prefixAllocator(java.lang.foreign.MemorySegment)"><code>prefixAllocator(MemorySegment)</code></a> obtains an allocator which wraps a segment and recycles its content upon each new allocation request.</li> </ul> <p> Passing a segment allocator to an API can be especially useful in circumstances where a client wants to communicate <em>where</em> the results of a certain operation (performed by the API) should be stored, as a memory segment. For instance, <a href="linker.html#downcallHandle(java.lang.foreign.FunctionDescriptor,java.lang.foreign.Linker.Option...)">downcall method handles</a><sup><a href="linker.html#preview-java.lang.foreign.Linker">PREVIEW</a></sup> can accept an additional <a href="segmentallocator.html" title="interface in java.lang.foreign"><code>SegmentAllocator</code></a><sup><a href="#preview-java.lang.foreign.SegmentAllocator">PREVIEW</a></sup> parameter if the underlying foreign function is known to return a struct by-value. Effectively, the allocator parameter tells the linker where to store the return value of the foreign function.</p>
</div> <dl class="notes"> <dt>API Note:</dt> <dd>Unless otherwise specified, the <a href="#allocate(long,long)"><code>allocate(long, long)</code></a> method is not thread-safe. Furthermore, memory segments allocated by a segment allocator can be associated with different lifetimes, and can even be backed by overlapping regions of memory. For these reasons, clients should generally only interact with a segment allocator they own. <p> Clients should consider using an <a href="arena.html" title="interface in java.lang.foreign">arena</a><sup><a href="arena.html#preview-java.lang.foreign.Arena">PREVIEW</a></sup> instead, which, provides strong thread-safety, lifetime and non-overlapping guarantees.</p>
</dd> </dl> </section> <section class="summary"> <section class="method-summary" id="method-summary"> <h2>Method Summary</h2> <div id="method-summary-table">  <div id="method-summary-table.tabpanel" role="tabpanel"> <table class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">                                                                      <tr>
<th>Modifier and Type</th>
<th>Method</th>
<th>Description</th>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocate(long)" class="member-name-link">allocate</a><wbr>(long byteSize)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given size.</div> </td>
</tr>
<tr>
<td><code><a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocate(long,long)" class="member-name-link">allocate</a><wbr>(long byteSize,
 long byteAlignment)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given size and alignment constraint.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocate(java.lang.foreign.AddressLayout,java.lang.foreign.MemorySegment)" class="member-name-link">allocate</a><wbr>(<a href="addresslayout.html" title="interface in java.lang.foreign">AddressLayout</a><sup><a href="addresslayout.html#preview-java.lang.foreign.AddressLayout">PREVIEW</a></sup> layout,
 <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup> value)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given address value.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocate(java.lang.foreign.MemoryLayout)" class="member-name-link">allocate</a><wbr>(<a href="memorylayout.html" title="interface in java.lang.foreign">MemoryLayout</a><sup><a href="memorylayout.html#preview-java.lang.foreign.MemoryLayout">PREVIEW</a></sup> layout)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocate(java.lang.foreign.ValueLayout.OfByte,byte)" class="member-name-link">allocate</a><wbr>(<a href="valuelayout.ofbyte.html" title="interface in java.lang.foreign">ValueLayout.OfByte</a><sup><a href="valuelayout.ofbyte.html#preview-java.lang.foreign.ValueLayout.OfByte">PREVIEW</a></sup> layout,
 byte value)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given byte value.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocate(java.lang.foreign.ValueLayout.OfChar,char)" class="member-name-link">allocate</a><wbr>(<a href="valuelayout.ofchar.html" title="interface in java.lang.foreign">ValueLayout.OfChar</a><sup><a href="valuelayout.ofchar.html#preview-java.lang.foreign.ValueLayout.OfChar">PREVIEW</a></sup> layout,
 char value)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given char value.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocate(java.lang.foreign.ValueLayout.OfDouble,double)" class="member-name-link">allocate</a><wbr>(<a href="valuelayout.ofdouble.html" title="interface in java.lang.foreign">ValueLayout.OfDouble</a><sup><a href="valuelayout.ofdouble.html#preview-java.lang.foreign.ValueLayout.OfDouble">PREVIEW</a></sup> layout,
 double value)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given double value.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocate(java.lang.foreign.ValueLayout.OfFloat,float)" class="member-name-link">allocate</a><wbr>(<a href="valuelayout.offloat.html" title="interface in java.lang.foreign">ValueLayout.OfFloat</a><sup><a href="valuelayout.offloat.html#preview-java.lang.foreign.ValueLayout.OfFloat">PREVIEW</a></sup> layout,
 float value)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given float value.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocate(java.lang.foreign.ValueLayout.OfInt,int)" class="member-name-link">allocate</a><wbr>(<a href="valuelayout.ofint.html" title="interface in java.lang.foreign">ValueLayout.OfInt</a><sup><a href="valuelayout.ofint.html#preview-java.lang.foreign.ValueLayout.OfInt">PREVIEW</a></sup> layout,
 int value)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given int value.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocate(java.lang.foreign.ValueLayout.OfLong,long)" class="member-name-link">allocate</a><wbr>(<a href="valuelayout.oflong.html" title="interface in java.lang.foreign">ValueLayout.OfLong</a><sup><a href="valuelayout.oflong.html#preview-java.lang.foreign.ValueLayout.OfLong">PREVIEW</a></sup> layout,
 long value)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given long value.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocate(java.lang.foreign.ValueLayout.OfShort,short)" class="member-name-link">allocate</a><wbr>(<a href="valuelayout.ofshort.html" title="interface in java.lang.foreign">ValueLayout.OfShort</a><sup><a href="valuelayout.ofshort.html#preview-java.lang.foreign.ValueLayout.OfShort">PREVIEW</a></sup> layout,
 short value)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given short value.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocateArray(java.lang.foreign.MemoryLayout,long)" class="member-name-link">allocateArray</a><wbr>(<a href="memorylayout.html" title="interface in java.lang.foreign">MemoryLayout</a><sup><a href="memorylayout.html#preview-java.lang.foreign.MemoryLayout">PREVIEW</a></sup> elementLayout,
 long count)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given element layout and size.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocateArray(java.lang.foreign.ValueLayout.OfByte,byte...)" class="member-name-link">allocateArray</a><wbr>(<a href="valuelayout.ofbyte.html" title="interface in java.lang.foreign">ValueLayout.OfByte</a><sup><a href="valuelayout.ofbyte.html#preview-java.lang.foreign.ValueLayout.OfByte">PREVIEW</a></sup> elementLayout,
 byte... elements)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given byte elements.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocateArray(java.lang.foreign.ValueLayout.OfChar,char...)" class="member-name-link">allocateArray</a><wbr>(<a href="valuelayout.ofchar.html" title="interface in java.lang.foreign">ValueLayout.OfChar</a><sup><a href="valuelayout.ofchar.html#preview-java.lang.foreign.ValueLayout.OfChar">PREVIEW</a></sup> elementLayout,
 char... elements)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given char elements.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocateArray(java.lang.foreign.ValueLayout.OfDouble,double...)" class="member-name-link">allocateArray</a><wbr>(<a href="valuelayout.ofdouble.html" title="interface in java.lang.foreign">ValueLayout.OfDouble</a><sup><a href="valuelayout.ofdouble.html#preview-java.lang.foreign.ValueLayout.OfDouble">PREVIEW</a></sup> elementLayout,
 double... elements)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given double elements.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocateArray(java.lang.foreign.ValueLayout.OfFloat,float...)" class="member-name-link">allocateArray</a><wbr>(<a href="valuelayout.offloat.html" title="interface in java.lang.foreign">ValueLayout.OfFloat</a><sup><a href="valuelayout.offloat.html#preview-java.lang.foreign.ValueLayout.OfFloat">PREVIEW</a></sup> elementLayout,
 float... elements)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given float elements.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocateArray(java.lang.foreign.ValueLayout.OfInt,int...)" class="member-name-link">allocateArray</a><wbr>(<a href="valuelayout.ofint.html" title="interface in java.lang.foreign">ValueLayout.OfInt</a><sup><a href="valuelayout.ofint.html#preview-java.lang.foreign.ValueLayout.OfInt">PREVIEW</a></sup> elementLayout,
 int... elements)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given int elements.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocateArray(java.lang.foreign.ValueLayout.OfLong,long...)" class="member-name-link">allocateArray</a><wbr>(<a href="valuelayout.oflong.html" title="interface in java.lang.foreign">ValueLayout.OfLong</a><sup><a href="valuelayout.oflong.html#preview-java.lang.foreign.ValueLayout.OfLong">PREVIEW</a></sup> elementLayout,
 long... elements)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given long elements.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocateArray(java.lang.foreign.ValueLayout.OfShort,short...)" class="member-name-link">allocateArray</a><wbr>(<a href="valuelayout.ofshort.html" title="interface in java.lang.foreign">ValueLayout.OfShort</a><sup><a href="valuelayout.ofshort.html#preview-java.lang.foreign.ValueLayout.OfShort">PREVIEW</a></sup> elementLayout,
 short... elements)</wbr></code></td>
<td> <div class="block">Allocates a memory segment with the given layout and initializes it with the given short elements.</div> </td>
</tr>
<tr>
<td><code>default <a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup></code></td>
<td><code><a href="#allocateUtf8String(java.lang.String)" class="member-name-link">allocateUtf8String</a><wbr>(<a href="../string.html" title="class in java.lang">String</a> str)</wbr></code></td>
<td> <div class="block">Converts a Java string into a UTF-8 encoded, null-terminated C string, storing the result into a memory segment.</div> </td>
</tr>
<tr>
<td><code>static <a href="segmentallocator.html" title="interface in java.lang.foreign">SegmentAllocator</a><sup><a href="#preview-java.lang.foreign.SegmentAllocator">PREVIEW</a></sup></code></td>
<td><code><a href="#prefixAllocator(java.lang.foreign.MemorySegment)" class="member-name-link">prefixAllocator</a><wbr>(<a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup> segment)</wbr></code></td>
<td> <div class="block">Returns a segment allocator which responds to allocation requests by recycling a single segment.</div> </td>
</tr>
<tr>
<td><code>static <a href="segmentallocator.html" title="interface in java.lang.foreign">SegmentAllocator</a><sup><a href="#preview-java.lang.foreign.SegmentAllocator">PREVIEW</a></sup></code></td>
<td><code><a href="#slicingAllocator(java.lang.foreign.MemorySegment)" class="member-name-link">slicingAllocator</a><wbr>(<a href="memorysegment.html" title="interface in java.lang.foreign">MemorySegment</a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup> segment)</wbr></code></td>
<td> <div class="block">Returns a segment allocator which responds to allocation requests by returning consecutive slices obtained from the provided segment.</div> </td>
</tr>
</table> </div> </div> </section> </section> <section class="details"> <section class="method-details" id="method-detail"> <h2>Method Details</h2>  </section><section class="detail" id="allocateUtf8String(java.lang.String)"> <h3>allocateUtf8String</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocateUtf8String(String str)</pre> <div class="block">Converts a Java string into a UTF-8 encoded, null-terminated C string, storing the result into a memory segment. <p> This method always replaces malformed-input and unmappable-character sequences with this charset's default replacement byte array. The <a href="../../nio/charset/charsetencoder.html" title="class in java.nio.charset"><code>CharsetEncoder</code></a> class should be used when more control over the encoding process is required. </p>
<p> If the given string contains any <code>'\0'</code> characters, they will be copied as well. This means that, depending on the method used to read the string, such as <a href="memorysegment.html#getUtf8String(long)"><code>MemorySegment.getUtf8String(long)</code></a><sup><a href="memorysegment.html#preview-java.lang.foreign.MemorySegment">PREVIEW</a></sup>, the string will appear truncated when read again.</p>
</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method copies the contents of the provided Java string into a new memory segment obtained by calling <code>this.allocate(str.length() + 1)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>str</code> - the Java string to be converted into a C string.</dd> <dt>Returns:</dt> <dd>a new native segment containing the converted C string.</dd> </dl> </section><section class="detail" id="allocate(java.lang.foreign.ValueLayout.OfByte,byte)"> <h3>allocate</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocate(ValueLayout.OfBytePREVIEW layout, byte value)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given byte value.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocate(layout)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>layout</code> - the layout of the block of memory to be allocated.</dd> <dd>
<code>value</code> - the value to be set on the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocate(java.lang.foreign.ValueLayout.OfChar,char)"> <h3>allocate</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocate(ValueLayout.OfCharPREVIEW layout, char value)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given char value.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocate(layout)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>layout</code> - the layout of the block of memory to be allocated.</dd> <dd>
<code>value</code> - the value to be set on the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocate(java.lang.foreign.ValueLayout.OfShort,short)"> <h3>allocate</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocate(ValueLayout.OfShortPREVIEW layout, short value)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given short value.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocate(layout)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>layout</code> - the layout of the block of memory to be allocated.</dd> <dd>
<code>value</code> - the value to be set on the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocate(java.lang.foreign.ValueLayout.OfInt,int)"> <h3>allocate</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocate(ValueLayout.OfIntPREVIEW layout, int value)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given int value.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocate(layout)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>layout</code> - the layout of the block of memory to be allocated.</dd> <dd>
<code>value</code> - the value to be set on the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocate(java.lang.foreign.ValueLayout.OfFloat,float)"> <h3>allocate</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocate(ValueLayout.OfFloatPREVIEW layout, float value)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given float value.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocate(layout)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>layout</code> - the layout of the block of memory to be allocated.</dd> <dd>
<code>value</code> - the value to be set on the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocate(java.lang.foreign.ValueLayout.OfLong,long)"> <h3>allocate</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocate(ValueLayout.OfLongPREVIEW layout, long value)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given long value.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocate(layout)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>layout</code> - the layout of the block of memory to be allocated.</dd> <dd>
<code>value</code> - the value to be set on the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocate(java.lang.foreign.ValueLayout.OfDouble,double)"> <h3>allocate</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocate(ValueLayout.OfDoublePREVIEW layout, double value)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given double value.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocate(layout)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>layout</code> - the layout of the block of memory to be allocated.</dd> <dd>
<code>value</code> - the value to be set on the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocate(java.lang.foreign.AddressLayout,java.lang.foreign.MemorySegment)"> <h3>allocate</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocate(AddressLayoutPREVIEW layout, MemorySegmentPREVIEW value)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given address value. The address value might be narrowed according to the platform address size (see <a href="valuelayout.html#ADDRESS"><code>ValueLayout.ADDRESS</code></a><sup><a href="valuelayout.html#preview-java.lang.foreign.ValueLayout">PREVIEW</a></sup>).</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocate(layout)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>layout</code> - the layout of the block of memory to be allocated.</dd> <dd>
<code>value</code> - the value to be set on the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocateArray(java.lang.foreign.ValueLayout.OfByte,byte...)"> <h3>allocateArray</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocateArray(ValueLayout.OfBytePREVIEW elementLayout, byte... elements)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given byte elements.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocateArray(layout, array.length)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>elementLayout</code> - the element layout of the array to be allocated.</dd> <dd>
<code>elements</code> - the byte elements to be copied to the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocateArray(java.lang.foreign.ValueLayout.OfShort,short...)"> <h3>allocateArray</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocateArray(ValueLayout.OfShortPREVIEW elementLayout, short... elements)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given short elements.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocateArray(layout, array.length)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>elementLayout</code> - the element layout of the array to be allocated.</dd> <dd>
<code>elements</code> - the short elements to be copied to the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocateArray(java.lang.foreign.ValueLayout.OfChar,char...)"> <h3>allocateArray</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocateArray(ValueLayout.OfCharPREVIEW elementLayout, char... elements)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given char elements.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocateArray(layout, array.length)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>elementLayout</code> - the element layout of the array to be allocated.</dd> <dd>
<code>elements</code> - the char elements to be copied to the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocateArray(java.lang.foreign.ValueLayout.OfInt,int...)"> <h3>allocateArray</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocateArray(ValueLayout.OfIntPREVIEW elementLayout, int... elements)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given int elements.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocateArray(layout, array.length)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>elementLayout</code> - the element layout of the array to be allocated.</dd> <dd>
<code>elements</code> - the int elements to be copied to the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocateArray(java.lang.foreign.ValueLayout.OfFloat,float...)"> <h3>allocateArray</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocateArray(ValueLayout.OfFloatPREVIEW elementLayout, float... elements)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given float elements.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocateArray(layout, array.length)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>elementLayout</code> - the element layout of the array to be allocated.</dd> <dd>
<code>elements</code> - the float elements to be copied to the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocateArray(java.lang.foreign.ValueLayout.OfLong,long...)"> <h3>allocateArray</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocateArray(ValueLayout.OfLongPREVIEW elementLayout, long... elements)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given long elements.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocateArray(layout, array.length)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>elementLayout</code> - the element layout of the array to be allocated.</dd> <dd>
<code>elements</code> - the long elements to be copied to the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocateArray(java.lang.foreign.ValueLayout.OfDouble,double...)"> <h3>allocateArray</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocateArray(ValueLayout.OfDoublePREVIEW elementLayout, double... elements)</pre> <div class="block">Allocates a memory segment with the given layout and initializes it with the given double elements.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocateArray(layout, array.length)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>elementLayout</code> - the element layout of the array to be allocated.</dd> <dd>
<code>elements</code> - the double elements to be copied to the newly allocated memory block.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocate(java.lang.foreign.MemoryLayout)"> <h3>allocate</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocate(MemoryLayoutPREVIEW layout)</pre> <div class="block">Allocates a memory segment with the given layout.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocate(layout.byteSize(), layout.byteAlignment())</code>.</dd> <dt>Parameters:</dt> <dd>
<code>layout</code> - the layout of the block of memory to be allocated.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> </dl> </section><section class="detail" id="allocateArray(java.lang.foreign.MemoryLayout,long)"> <h3>allocateArray</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocateArray(MemoryLayoutPREVIEW elementLayout, long count)</pre> <div class="block">Allocates a memory segment with the given element layout and size.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocate(MemoryLayout.sequenceLayout(count, elementLayout))</code>.</dd> <dt>Parameters:</dt> <dd>
<code>elementLayout</code> - the array element layout.</dd> <dd>
<code>count</code> - the array element count.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> <dt>Throws:</dt> <dd>
<code><a href="../illegalargumentexception.html" title="class in java.lang">IllegalArgumentException</a></code> - if <code>elementLayout.byteSize() * count</code> overflows.</dd> <dd>
<code><a href="../illegalargumentexception.html" title="class in java.lang">IllegalArgumentException</a></code> - if <code>count &lt; 0</code>.</dd> </dl> </section><section class="detail" id="allocate(long)"> <h3>allocate</h3> <pre class="lang-java" data-language="java">default MemorySegmentPREVIEW allocate(long byteSize)</pre> <div class="block">Allocates a memory segment with the given size.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>the default implementation for this method calls <code>this.allocate(byteSize, 1)</code>.</dd> <dt>Parameters:</dt> <dd>
<code>byteSize</code> - the size (in bytes) of the block of memory to be allocated.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> <dt>Throws:</dt> <dd>
<code><a href="../illegalargumentexception.html" title="class in java.lang">IllegalArgumentException</a></code> - if <code>byteSize &lt; 0</code>
</dd> </dl> </section><section class="detail" id="allocate(long,long)"> <h3>allocate</h3> <pre class="lang-java" data-language="java">MemorySegmentPREVIEW allocate(long byteSize, long byteAlignment)</pre> <div class="block">Allocates a memory segment with the given size and alignment constraint.</div> <dl class="notes"> <dt>Parameters:</dt> <dd>
<code>byteSize</code> - the size (in bytes) of the block of memory to be allocated.</dd> <dd>
<code>byteAlignment</code> - the alignment (in bytes) of the block of memory to be allocated.</dd> <dt>Returns:</dt> <dd>a segment for the newly allocated memory block.</dd> <dt>Throws:</dt> <dd>
<code><a href="../illegalargumentexception.html" title="class in java.lang">IllegalArgumentException</a></code> - if <code>byteSize &lt; 0</code>, <code>byteAlignment &lt;= 0</code>, or if <code>byteAlignment</code> is not a power of 2.</dd> </dl> </section><section class="detail" id="slicingAllocator(java.lang.foreign.MemorySegment)"> <h3>slicingAllocator</h3> <pre class="lang-java" data-language="java">static SegmentAllocatorPREVIEW slicingAllocator(MemorySegmentPREVIEW segment)</pre> <div class="block">Returns a segment allocator which responds to allocation requests by returning consecutive slices obtained from the provided segment. Each new allocation request will return a new slice starting at the current offset (modulo additional padding to satisfy alignment constraint), with given size. <p> The returned allocator throws <a href="../indexoutofboundsexception.html" title="class in java.lang"><code>IndexOutOfBoundsException</code></a> when a slice of the provided segment with the requested size and alignment cannot be found.</p>
</div> <dl class="notes"> <dt>Implementation Note:</dt> <dd>A slicing allocator is not <em>thread-safe</em>.</dd> <dt>Parameters:</dt> <dd>
<code>segment</code> - the segment which the returned allocator should slice from.</dd> <dt>Returns:</dt> <dd>a new slicing allocator</dd> </dl> </section><section class="detail" id="prefixAllocator(java.lang.foreign.MemorySegment)"> <h3>prefixAllocator</h3> <pre class="lang-java" data-language="java">static SegmentAllocatorPREVIEW prefixAllocator(MemorySegmentPREVIEW segment)</pre> <div class="block">Returns a segment allocator which responds to allocation requests by recycling a single segment. Each new allocation request will return a new slice starting at the segment offset <code>0</code>, hence the name <em>prefix allocator</em>. Equivalent to (but likely more efficient than) the following code: <div class="snippet-container"> <pre class="lang-java" data-language="java"><code class="language-java">MemorySegment segment = ...
SegmentAllocator prefixAllocator = (size, align) -&gt; segment.asSlice(0, size, align);
</code></pre> </div> The returned allocator throws <a href="../indexoutofboundsexception.html" title="class in java.lang"><code>IndexOutOfBoundsException</code></a> when a slice of the provided segment with the requested size and alignment cannot be found.</div> <dl class="notes"> <dt>API Note:</dt> <dd>A prefix allocator can be useful to limit allocation requests in case a client knows that they have fully processed the contents of the allocated segment before the subsequent allocation request takes place.</dd> <dt>Implementation Note:</dt> <dd>While a prefix allocator is <em>thread-safe</em>, concurrent access on the same recycling allocator might cause a thread to overwrite contents written to the underlying segment by a different thread.</dd> <dt>Parameters:</dt> <dd>
<code>segment</code> - the memory segment to be recycled by the returned allocator.</dd> <dt>Returns:</dt> <dd>an allocator which recycles an existing segment upon each new allocation request.</dd> </dl> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1993, 2023, Oracle and/or its affiliates. All rights reserved.<br>Documentation extracted from Debian's OpenJDK Development Kit package.<br>Licensed under the GNU General Public License, version 2, with the Classpath Exception.<br>Various third party code in OpenJDK is licensed under different licenses (see Debian package).<br>Java and OpenJDK are trademarks or registered trademarks of Oracle and/or its affiliates.<br>
    <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/foreign/SegmentAllocator.html" class="_attribution-link">https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/foreign/SegmentAllocator.html</a>
  </p>
</div>
