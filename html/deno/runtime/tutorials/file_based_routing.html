<h1>File-based routing</h1>
<div>
<p>If you've used frameworks like <a href="https://nextjs.org/">Next.js</a>, you might be familiar with file based routing - you add a file in a specific directory and it automatically becomes a route. This tutorial demonstrates how to create a simple HTTP server that uses file based routing.</p> <h2 id="route-requests" tabindex="-1">Route requests </h2> <p>Create a new file called <code data-language="ts">server.ts</code>. This file will be used to route requests. Set up an async function called <code data-language="ts">handler</code> that takes a request object as an argument:</p> <div>
<div class="markdownBlockTitle">server.ts</div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> path <span class="token operator">=</span> url<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
  <span class="token keyword">const</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>method<span class="token punctuation">;</span>
  <span class="token keyword">let</span> module<span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    module <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.ts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"Not found"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">404</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> module<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"Method not implemented"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">501</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Deno<span class="token punctuation">.</span><span class="token function">serve</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
</div>
<p>The <code data-language="ts">handler</code> function sets up a path variable which contains the path, extracted from the request URL, and a method variable which contains the request method.</p> <p>It then tries to import a module based on the path. If the module is not found, it returns a 404 response.</p> <p>If the module is found, it checks if the module has a method handler for the request method. If the method handler is found, it calls the method handler with the request object. If the method handler is not found, it returns a 501 response.</p> <p>Finally, it serves the handler function using <code data-language="ts">Deno.serve</code>.</p> <blockquote> <p>The path could be any valid URL path such as <code data-language="ts">/users</code>, <code data-language="ts">/posts</code>, etc. For paths like <code data-language="ts">/users</code>, the file <code data-language="ts">./users.ts</code> will be imported. However, deeper paths like <code data-language="ts">/org/users</code> will require a file <code data-language="ts">./org/users.ts</code>. You can create nested routes by creating nested directories and files.</p> </blockquote> <h2 id="handle-requests" tabindex="-1">Handle requests </h2> <p>Create a new file called <code data-language="ts">users.ts</code> in the same directory as <code data-language="ts">server.ts</code>. This file will be used to handle requests to the <code data-language="ts">/users</code> path. We'll use a <code data-language="ts">GET</code> request as an example. You could add more HTTP methods such as <code data-language="ts">POST</code>, <code data-language="ts">PUT</code>, <code data-language="ts">DELETE</code>, etc.</p> <p>In <code data-language="ts">users.ts</code>, set up an async function called <code data-language="ts">GET</code> that takes a request object as an argument:</p> <div>
<div class="markdownBlockTitle">users.ts</div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span>_req<span class="token operator">:</span> Request<span class="token punctuation">)</span><span class="token operator">:</span> Response <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"Hello from user.ts"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>   </div>
</div>
<h2 id="start-the-server" tabindex="-1">Start the server </h2> <p>To start the server, run the following command:</p> <div class="relative">
<pre class="language-sh" tabindex="0"><code data-language="sh">deno run --allow-net --allow-read server.ts
</code></pre>   </div>
<p>This will start the server on <code data-language="ts">localhost:8080</code>. You can now make a <code data-language="ts">GET</code> request to <code data-language="ts">localhost:8000/users</code> and you should see the response <code data-language="ts">Hello from user.ts</code>.</p> <p>This command requires the <code data-language="ts">--allow-net</code> and <code data-language="ts">--allow-read</code> <a href="../fundamentals/security.html">permissions flags</a> to allow access to the network to start the server and to read the <code data-language="ts">users.ts</code> file from the file system.</p> <p>ðŸ¦• Now you can set up routing in your apps based on file structure. You can extend this example to add more routes and methods as needed.</p> <p><small>Thanks to <a href="https://github.com/naishe">@naishe</a> for contributing this tutorial.</small></p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018â€“2024 the Deno authors<br>Licensed under the MIT License.<br>
    <a href="https://docs.deno.com/runtime/tutorials/file_based_routing" class="_attribution-link">https://docs.deno.com/runtime/tutorials/file_based_routing</a>
  </p>
</div>
