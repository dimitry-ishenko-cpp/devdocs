<h1>Web Platform APIs</h1>
<div>
<p>One way Deno simplifies web and cloud development is by using standard Web Platform APIs (like <code data-language="ts">fetch</code>, WebSockets and more) over proprietary APIs. This means if you've ever built for the browser, you're likely already familiar with Deno, and if you're learning Deno, you're also investing in your knowledge of the web.</p> <p><a href="https://docs.deno.com/api/web/" class="docs-cta runtime-cta">Explore supported Web APIs</a></p> <p>Below we'll highlight some of the standard Web APIs that Deno supports.</p> <p>To check if a Web Platform API is available in Deno, you can click on <a href="https://developer.mozilla.org/en-US/docs/Web/API#interfaces">the interface on MDN</a> and refer to <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController#browser_compatibility">its Browser Compatibility table</a>.</p> <h2 id="fetch" tabindex="-1">fetch </h2> <p>The <a href="https://docs.deno.com/api/web/~/fetch"><code data-language="ts">fetch</code></a> API can be used to make HTTP requests. It is implemented as specified in the <a href="https://fetch.spec.whatwg.org/">WHATWG <code data-language="ts">fetch</code> spec</a>.</p> <h3 id="spec-deviations" tabindex="-1">Spec deviations </h3> <ul> <li>The Deno user agent does not have a cookie jar. As such, the <code data-language="ts">set-cookie</code> header on a response is not processed, or filtered from the visible response headers.</li> <li>Deno does not follow the same-origin policy, because the Deno user agent currently does not have the concept of origins, and it does not have a cookie jar. This means Deno does not need to protect against leaking authenticated data cross origin. Because of this Deno does not implement the following sections of the WHATWG <code data-language="ts">fetch</code> specification: <ul> <li>Section <code data-language="ts">3.1. 'Origin' header</code>.</li> <li>Section <code data-language="ts">3.2. CORS protocol</code>.</li> <li>Section <code data-language="ts">3.5. CORB</code>.</li> <li>Section <code data-language="ts">3.6. 'Cross-Origin-Resource-Policy' header</code>.</li> <li>
<code data-language="ts">Atomic HTTP redirect handling</code>.</li> <li>The <code data-language="ts">opaqueredirect</code> response type.</li> </ul> </li> <li>A <code data-language="ts">fetch</code> with a <code data-language="ts">redirect</code> mode of <code data-language="ts">manual</code> will return a <code data-language="ts">basic</code> response rather than an <code data-language="ts">opaqueredirect</code> response.</li> <li>The specification is vague on how <a href="https://fetch.spec.whatwg.org/#scheme-fetch"><code data-language="ts">file:</code> URLs are to be handled</a>. Firefox is the only mainstream browser that implements fetching <code data-language="ts">file:</code> URLs, and even then it doesn't work by default. As of Deno 1.16, Deno supports fetching local files. See the next section for details.</li> <li>The <code data-language="ts">request</code> and <code data-language="ts">response</code> header guards are implemented, but unlike browsers do not have any constraints on which header names are allowed.</li> <li>The <code data-language="ts">referrer</code>, <code data-language="ts">referrerPolicy</code>, <code data-language="ts">mode</code>, <code data-language="ts">credentials</code>, <code data-language="ts">cache</code>, <code data-language="ts">integrity</code>, <code data-language="ts">keepalive</code>, and <code data-language="ts">window</code> properties and their relevant behaviours in <code data-language="ts">RequestInit</code> are not implemented. The relevant fields are not present on the <code data-language="ts">Request</code> object.</li> <li>Request body upload streaming is supported (on HTTP/1.1 and HTTP/2). Unlike the current fetch proposal, the implementation supports duplex streaming.</li> <li>The <code data-language="ts">set-cookie</code> header is not concatenated when iterated over in the <code data-language="ts">headers</code> iterator. This behaviour is in the <a href="https://github.com/whatwg/fetch/pull/1346">process of being specified</a>.</li> </ul> <h3 id="fetching-local-files" tabindex="-1">Fetching local files </h3> <p>Deno supports fetching <code data-language="ts">file:</code> URLs. This makes it easier to write code that uses the same code path on a server as local, as well as easier to author code that works both with the Deno CLI and Deno Deploy.</p> <p>Deno only supports absolute file URLs, this means that <code data-language="ts">fetch("./some.json")</code> will not work. It should be noted though that if <a href="#location"><code data-language="ts">--location</code></a> is specified, relative URLs use the <code data-language="ts">--location</code> as the base, but a <code data-language="ts">file:</code> URL cannot be passed as the <code data-language="ts">--location</code>.</p> <p>To be able to fetch a resource, relative to the current module, which would work if the module is local or remote, you should to use <code data-language="ts">import.meta.url</code> as the base. For example:</p> <div class="relative">
<pre class="language-js" tabindex="0"><code data-language="js"><span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">"./config.json"</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>Notes on fetching local files:</p> <ul> <li>Permissions are applied to reading resources, so an appropriate <code data-language="ts">--allow-read</code> permission is needed to be able to read a local file.</li> <li>Fetching locally only supports the <code data-language="ts">GET</code> method, and will reject the promise with any other method.</li> <li>A file that does not exist simply rejects the promise with a vague <code data-language="ts">TypeError</code>. This is to avoid the potential of fingerprinting attacks.</li> <li>No headers are set on the response. Therefore it is up to the consumer to determine things like the content type or content length.</li> <li>Response bodies are streamed from the Rust side, so large files are available in chunks, and can be cancelled.</li> </ul> <h2 id="customevent-and-eventtarget" tabindex="-1">CustomEvent and EventTarget </h2> <p>The <a href="https://docs.deno.com/api/web/~/Event">DOM Event API</a> can be used to dispatch and listen to events happening in an application. It is implemented as specified in the <a href="https://dom.spec.whatwg.org/#events">WHATWG DOM spec</a>.</p> <h3 id="spec-deviations-1" tabindex="-1">Spec deviations </h3> <ul> <li>Events do not bubble, because Deno does not have a DOM hierarchy, so there is no tree for Events to bubble/capture through.</li> <li>
<code data-language="ts">timeStamp</code> property is always set to <code data-language="ts">0</code>.</li> </ul> <h2 id="typings" tabindex="-1">Typings </h2> <p>The TypeScript definitions for the implemented web APIs can be found in the <a href="https://github.com/denoland/deno/blob/2.1.3/cli/tsc/dts/lib.deno.shared_globals.d.ts"><code data-language="ts">lib.deno.shared_globals.d.ts</code></a> and <a href="https://github.com/denoland/deno/blob/2.1.3/cli/tsc/dts/lib.deno.window.d.ts"><code data-language="ts">lib.deno.window.d.ts</code></a> files.</p> <p>Definitions that are specific to workers can be found in the <a href="https://github.com/denoland/deno/blob/2.1.3/cli/tsc/dts/lib.deno.worker.d.ts"><code data-language="ts">lib.deno.worker.d.ts</code></a> file.</p> <h2 id="location" tabindex="-1">Location </h2> <p>Deno supports the <a href="https://docs.deno.com/api/web/~/Location"><code data-language="ts">location</code></a> global from the web.</p> <h3 id="location-flag" tabindex="-1">Location flag </h3> <p>There is no "web page" whose URL we can use for a location in a Deno process. We instead allow users to emulate a document location by specifying one on the CLI using the <code data-language="ts">--location</code> flag. It can be a <code data-language="ts">http</code> or <code data-language="ts">https</code> URL.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// deno run --location https://example.com/path main.ts</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// "https://example.com/path"</span>
</code></pre>   </div>
<p>You must pass <code data-language="ts">--location &lt;href&gt;</code> for this to work. If you don't, any access to the <code data-language="ts">location</code> global will throw an error.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// deno run main.ts</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// error: Uncaught ReferenceError: Access to "location", run again with --location &lt;href&gt;.</span>
</code></pre>   </div>
<p>Setting <code data-language="ts">location</code> or any of its fields will normally cause navigation in browsers. This is not applicable in Deno, so it will throw in this situation.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// deno run --location https://example.com/path main.ts</span>

location<span class="token punctuation">.</span>pathname <span class="token operator">=</span> <span class="token string">"./foo"</span><span class="token punctuation">;</span>
<span class="token comment">// error: Uncaught NotSupportedError: Cannot set "location.pathname".</span>
</code></pre>   </div>
<h3 id="extended-usage" tabindex="-1">Extended usage </h3> <p>On the web, resource resolution (excluding modules) typically uses the value of <code data-language="ts">location.href</code> as the root on which to base any relative URLs. This affects some web APIs adopted by Deno.</p> <h4 id="fetch-api" tabindex="-1">Fetch API </h4> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// deno run --location https://api.github.com/ --allow-net main.ts</span>

<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"./orgs/denoland"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Fetches "https://api.github.com/orgs/denoland".</span>
</code></pre>   </div>
<p>The <code data-language="ts">fetch()</code> call above would throw if the <code data-language="ts">--location</code> flag was not passed, since there is no web-analogous location to base it onto.</p> <h4 id="worker-modules" tabindex="-1">Worker modules </h4> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// deno run --location https://example.com/index.html --allow-net main.ts</span>

<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"./workers/hello.ts"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"module"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Fetches worker module at "https://example.com/workers/hello.ts".</span>
</code></pre>   </div>

<div class="admonition note"> <div class="title">Note</div>  <p>For the above use cases, it is preferable to pass URLs in full rather than relying on <code data-language="ts">--location</code>. You can manually base a relative URL using the <code data-language="ts">URL</code> constructor if needed.</p> 
</div>  <p>The <code data-language="ts">--location</code> flag is intended for those who have a specific purpose in mind for emulating a document location and are aware that this will only work at application-level. However, you may also use it to silence errors from a dependency which is frivolously accessing the <code data-language="ts">location</code> global.</p> <h2 id="web-storage" tabindex="-1">Web Storage </h2> <p>The <a href="https://docs.deno.com/api/web/storage">Web Storage API</a> provides an API for storing string keys and values. Persisting data works similar to a browser, and has a 10MB storage limit. The global <code data-language="ts">sessionStorage</code> object only persists data for the current execution context, while <code data-language="ts">localStorage</code> persists data from execution to execution.</p> <p>In a browser, <code data-language="ts">localStorage</code> persists data uniquely per origin (effectively the protocol plus hostname plus port). As of Deno 1.16, Deno has a set of rules to determine what is a unique storage location:</p> <ul> <li>When using the <code data-language="ts">--location</code> flag, the origin for the location is used to uniquely store the data. That means a location of <code data-language="ts">http://example.com/a.ts</code> and <code data-language="ts">http://example.com/b.ts</code> and <code data-language="ts">http://example.com:80/</code> would all share the same storage, but <code data-language="ts">https://example.com/</code> would be different.</li> <li>If there is no location specifier, but there is a <code data-language="ts">--config</code> configuration file specified, the absolute path to that configuration file is used. That means <code data-language="ts">deno run --config deno.jsonc a.ts</code> and <code data-language="ts">deno run --config deno.jsonc b.ts</code> would share the same storage, but <code data-language="ts">deno run --config tsconfig.json a.ts</code> would be different.</li> <li>If there is no configuration or location specifier, Deno uses the absolute path to the main module to determine what storage is shared. The Deno REPL generates a "synthetic" main module that is based off the current working directory where <code data-language="ts">deno</code> is started from. This means that multiple invocations of the REPL from the same path will share the persisted <code data-language="ts">localStorage</code> data.</li> </ul> <p>To set, get and remove items from <code data-language="ts">localStorage</code>, you can use the following:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// Set an item in localStorage</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">"myDemo"</span><span class="token punctuation">,</span> <span class="token string">"Deno App"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read an item from localStorage</span>
<span class="token keyword">const</span> cat <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"myDemo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Remove an item from localStorage</span>
localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">"myDemo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Remove all items from localStorage</span>
localStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h2 id="web-workers" tabindex="-1">Web Workers </h2> <p>Deno supports the <a href="https://docs.deno.com/api/web/workers"><code data-language="ts">Web Worker API</code></a>.</p> <p>Workers can be used to run code on multiple threads. Each instance of <code data-language="ts">Worker</code> is run on a separate thread, dedicated only to that worker.</p> <p>Currently Deno supports only <code data-language="ts">module</code> type workers; thus it's essential to pass the <code data-language="ts">type: "module"</code> option when creating a new worker.</p> <p>Use of relative module specifiers in the main worker are only supported with <code data-language="ts">--location &lt;href&gt;</code> passed on the CLI. This is not recommended for portability. You can instead use the <code data-language="ts">URL</code> constructor and <code data-language="ts">import.meta.url</code> to easily create a specifier for some nearby script. Dedicated workers, however, have a location and this capability by default.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// Good</span>
<span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./worker.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"module"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Bad</span>
<span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./worker.js"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./worker.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"classic"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"./worker.js"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"module"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>As with regular modules, you can use top-level <code data-language="ts">await</code> in worker modules. However, you should be careful to always register the message handler before the first <code data-language="ts">await</code>, since messages can be lost otherwise. This is not a bug in Deno, it's just an unfortunate interaction of features, and it also happens in all browsers that support module workers.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> delay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"jsr:@std/async@1/delay"</span><span class="token punctuation">;</span>

<span class="token comment">// First await: waits for a second, then continues running the module.</span>
<span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The message handler is only set after that 1s delay, so some of the messages</span>
<span class="token comment">// that reached the worker during that second might have been fired when no</span>
<span class="token comment">// handler was registered.</span>
self<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h3 id="instantiation-permissions" tabindex="-1">Instantiation permissions </h3> <p>Creating a new <code data-language="ts">Worker</code> instance is similar to a dynamic import; therefore Deno requires appropriate permission for this action.</p> <p>For workers using local modules; <code data-language="ts">--allow-read</code> permission is required:</p> <div>
<div class="markdownBlockTitle">main.ts</div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./worker.ts"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"module"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
</div>
<div>
<div class="markdownBlockTitle">worker.ts</div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
</div>
<div class="relative">
<pre class="language-shell" tabindex="0"><code data-language="shell">$ deno run main.ts
error: Uncaught PermissionDenied: <span class="token builtin class-name">read</span> access to <span class="token string">"./worker.ts"</span>, run again with the --allow-read flag

$ deno run --allow-read main.ts
hello world
</code></pre>   </div>
<p>For workers using remote modules; <code data-language="ts">--allow-net</code> permission is required:</p> <div>
<div class="markdownBlockTitle">main.ts</div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"https://example.com/worker.ts"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"module"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
</div>
<div>
<div class="markdownBlockTitle">worker.ts</div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// This file is hosted at https://example.com/worker.ts</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
</div>
<div class="relative">
<pre class="language-shell" tabindex="0"><code data-language="shell">$ deno run main.ts
error: Uncaught PermissionDenied: net access to <span class="token string">"https://example.com/worker.ts"</span>, run again with the --allow-net flag

$ deno run --allow-net main.ts
hello world
</code></pre>   </div>
<h3 id="using-deno-in-a-worker" tabindex="-1">Using Deno in a worker </h3> <div>
<div class="markdownBlockTitle">main.js</div>
<div class="relative">
<pre class="language-js" tabindex="0"><code data-language="js"><span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./worker.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"./log.txt"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
</div>
<div>
<div class="markdownBlockTitle">worker.js</div>
<div class="relative">
<pre class="language-js" tabindex="0"><code data-language="js">self<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> filename <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">readTextFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>   </div>
</div>
<div>
<div class="markdownBlockTitle">log.txt</div>
<div class="relative">
<pre class="language-text" tabindex="0"><code data-language="text">hello world
</code></pre>   </div>
</div>
<div class="relative">
<pre class="language-shell" tabindex="0"><code data-language="shell">$ deno run --allow-read main.js
hello world
</code></pre>   </div>
<h3 id="specifying-worker-permissions" tabindex="-1">Specifying worker permissions </h3> 
<div class="admonition caution"> <div class="title">Caution</div>  <p>This is an unstable Deno feature. Learn more about <a href="../fundamentals/stability_and_releases.html#unstable-apis">unstable features</a>.</p> 
</div>  <p>The permissions available for the worker are analogous to the CLI permission flags, meaning every permission enabled there can be disabled at the level of the Worker API. You can find a more detailed description of each of the permission options <a href="../fundamentals/security.html">here</a>.</p> <p>By default a worker will inherit permissions from the thread it was created in, however in order to allow users to limit the access of this worker we provide the <code data-language="ts">deno.permissions</code> option in the worker API.</p> <p>For permissions that support granular access you can pass in a list of the desired resources the worker will have access to, and for those who only have the on/off option you can pass true/false respectively:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./worker.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  deno<span class="token operator">:</span> <span class="token punctuation">{</span>
    permissions<span class="token operator">:</span> <span class="token punctuation">{</span>
      net<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"deno.land"</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      read<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span><span class="token string">"./file_1.txt"</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span><span class="token string">"./file_2.txt"</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      write<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>Granular access permissions receive both absolute and relative routes as arguments, however take into account that relative routes will be resolved relative to the file the worker is instantiated in, not the path the worker file is currently in:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span><span class="token string">"./worker/worker.js"</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>href<span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
    deno<span class="token operator">:</span> <span class="token punctuation">{</span>
      permissions<span class="token operator">:</span> <span class="token punctuation">{</span>
        read<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">"/home/user/Documents/deno/worker/file_1.txt"</span><span class="token punctuation">,</span>
          <span class="token string">"./worker/file_2.txt"</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>Both <code data-language="ts">deno.permissions</code> and its children support the option <code data-language="ts">"inherit"</code>, which implies it will borrow its parent permissions:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// This worker will inherit its parent permissions</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./worker.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  deno<span class="token operator">:</span> <span class="token punctuation">{</span>
    permissions<span class="token operator">:</span> <span class="token string">"inherit"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// This worker will inherit only the net permissions of its parent</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./worker.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  deno<span class="token operator">:</span> <span class="token punctuation">{</span>
    permissions<span class="token operator">:</span> <span class="token punctuation">{</span>
      env<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      hrtime<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      net<span class="token operator">:</span> <span class="token string">"inherit"</span><span class="token punctuation">,</span>
      ffi<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      read<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      run<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      write<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>Not specifying the <code data-language="ts">deno.permissions</code> option or one of its children will cause the worker to inherit by default:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// This worker will inherit its parent permissions</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./worker.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// This worker will inherit all the permissions of its parent BUT net</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./worker.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  deno<span class="token operator">:</span> <span class="token punctuation">{</span>
    permissions<span class="token operator">:</span> <span class="token punctuation">{</span>
      net<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>You can disable the permissions of the worker all together by passing <code data-language="ts">"none"</code> to the <code data-language="ts">deno.permissions</code> option:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// This worker will not have any permissions enabled</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./worker.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  deno<span class="token operator">:</span> <span class="token punctuation">{</span>
    permissions<span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h2 id="deviations-of-other-apis-from-spec" tabindex="-1">Deviations of other APIs from spec </h2> <h3 id="cache-api" tabindex="-1">Cache API </h3> <p>Only the following APIs are implemented:</p> <ul> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/open">CacheStorage::open()</a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/has">CacheStorage::has()</a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/delete">CacheStorage::delete()</a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache/match">Cache::match()</a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache/put">Cache::put()</a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache/delete">Cache::delete()</a></li> </ul> <p>A few things that are different compared to browsers:</p> <ol> <li>You cannot pass relative paths to the APIs. The request can be an instance of Request or URL or a url string.</li> <li>
<code data-language="ts">match()</code> &amp; <code data-language="ts">delete()</code> don't support query options yet.</li> </ol> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018–2024 the Deno authors<br>Licensed under the MIT License.<br>
    <a href="https://docs.deno.com/runtime/reference/web_platform_apis" class="_attribution-link">https://docs.deno.com/runtime/reference/web_platform_apis</a>
  </p>
</div>
