<h1>Testing</h1>
<div>
<p>Deno provides a built-in test runner for writing and running tests in both JavaScript and TypeScript. This makes it easy to ensure your code is reliable and functions as expected without needing to install any additional dependencies or tools. The <code data-language="ts">deno test</code> runner allows you fine-grained control over permissions for each test, ensuring that code does not do anything unexpected.</p> <p>In addition to the built-in test runner, you can also use other test runners from the JS ecosystem, such as Jest, Mocha, or AVA, with Deno. We will not cover these in this document however.</p> <h2 id="writing-tests" tabindex="-1">Writing Tests </h2> <p>To define a test in Deno, you use the <code data-language="ts">Deno.test()</code> function. Here are some examples:</p> <div>
<div class="markdownBlockTitle">my_test.ts</div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> assertEquals <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"jsr:@std/assert"</span><span class="token punctuation">;</span>

Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"simple test"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token function">assertEquals</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> delay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"jsr:@std/async"</span><span class="token punctuation">;</span>

Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"async test"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">assertEquals</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"read file test"</span><span class="token punctuation">,</span>
  permissions<span class="token operator">:</span> <span class="token punctuation">{</span> read<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> Deno<span class="token punctuation">.</span><span class="token function">readTextFileSync</span><span class="token punctuation">(</span><span class="token string">"./somefile.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertEquals</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">"expected content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
</div>
<p>If you prefer a "jest-like" <code data-language="ts">expect</code> style of assertions, the Deno standard library provides an <a href="https://jsr.io/@std/expect"><code data-language="ts">expect</code></a> function that can be used in place of <code data-language="ts">assertEquals</code>:</p> <div>
<div class="markdownBlockTitle">my_test.ts</div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"jsr:@std/expect"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./add.js"</span><span class="token punctuation">;</span>

Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"add function adds two numbers correctly"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
</div>
<h2 id="running-tests" tabindex="-1">Running Tests </h2> <p>To run your tests, use the <a href="../reference/cli/test.html"><code data-language="ts">deno test</code></a> subcommand.</p> <p>If run without a file name or directory name, this subcommand will automatically find and execute all tests in the current directory (recursively) that match the glob <code data-language="ts">{*_,*.,}test.{ts, tsx, mts, js, mjs, jsx}</code>.</p> <div class="relative">
<pre class="language-sh" tabindex="0"><code data-language="sh"><span class="token comment"># Run all tests in the current directory and all sub-directories</span>
deno <span class="token builtin class-name">test</span>

<span class="token comment"># Run all tests in the util directory</span>
deno <span class="token builtin class-name">test</span> util/

<span class="token comment"># Run just my_test.ts</span>
deno <span class="token builtin class-name">test</span> my_test.ts

<span class="token comment"># Run test modules in parallel</span>
deno <span class="token builtin class-name">test</span> <span class="token parameter variable">--parallel</span>

<span class="token comment"># Pass additional arguments to the test file that are visible in `Deno.args`</span>
deno <span class="token builtin class-name">test</span> my_test.ts -- <span class="token parameter variable">-e</span> <span class="token parameter variable">--foo</span> <span class="token parameter variable">--bar</span>

<span class="token comment"># Provide permission for deno to read from the filesystem, which is necessary</span>
<span class="token comment"># for the final test above to pass</span>
deno <span class="token builtin class-name">test</span> --allow-read my_test.ts
</code></pre>   </div>
<h2 id="test-steps" tabindex="-1">Test Steps </h2> <p>Deno also supports test steps, which allow you to break down tests into smaller, manageable parts. This is useful for setup and teardown operations within a test:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts">Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"database operations"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  using db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> t<span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token string">"insert user"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Insert user logic</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> t<span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token string">"insert book"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Insert book logic</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h2 id="command-line-filtering" tabindex="-1">Command line filtering </h2> <p>Deno allows you to run specific tests or groups of tests using the <code data-language="ts">--filter</code> option on the command line. This option accepts either a string or a pattern to match test names. Filtering does not affect steps; if a test name matches the filter, all of its steps are executed.</p> <p>Consider the following tests:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts">Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"my-test"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"test-1"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"test-2"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h3 id="filtering-by-string" tabindex="-1">Filtering by string </h3> <p>To run all tests that contain the word "my" in their names, use:</p> <div class="relative">
<pre class="language-sh" tabindex="0"><code data-language="sh">deno <span class="token builtin class-name">test</span> <span class="token parameter variable">--filter</span> <span class="token string">"my"</span> tests/
</code></pre>   </div>
<p>This command will execute <code data-language="ts">my-test</code> because it contains the word "my".</p> <h3 id="filtering-by-pattern" tabindex="-1">Filtering by Pattern </h3> <p>To run tests that match a specific pattern, use:</p> <div class="relative">
<pre class="language-sh" tabindex="0"><code data-language="sh">deno <span class="token builtin class-name">test</span> <span class="token parameter variable">--filter</span> <span class="token string">"/test-*\d/"</span> tests/
</code></pre>   </div>
<p>This command will run <code data-language="ts">test-1</code> and <code data-language="ts">test-2</code> because they match the pattern <code data-language="ts">test-*</code> followed by a digit.</p> <p>To indicate that you are using a pattern (regular expression), wrap your filter value with forward slashes <code data-language="ts">/</code>, much like JavaScript’s syntax for regular expressions.</p> <h3 id="including-and-excluding-test-files-in-the-configuration-file" tabindex="-1">Including and excluding test files in the configuration file </h3> <p>You can also filter tests by specifying paths to include or exclude in the <a href="configuration.html">Deno configuration file</a>.</p> <p>For example, if you want to only test <code data-language="ts">src/fetch_test.ts</code> and <code data-language="ts">src/signal_test.ts</code> and exclude everything in <code data-language="ts">out/</code>:</p> <div class="relative">
<pre class="language-json" tabindex="0"><code data-language="json"><span class="token punctuation">{</span>
  <span class="token property">"test"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"src/fetch_test.ts"</span><span class="token punctuation">,</span>
      <span class="token string">"src/signal_test.ts"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>   </div>
<p>Or more likely:</p> <div class="relative">
<pre class="language-json" tabindex="0"><code data-language="json"><span class="token punctuation">{</span>
  <span class="token property">"test"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"exclude"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"out/"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>   </div>
<h2 id="test-definition-selection" tabindex="-1">Test definition selection </h2> <p>Deno provides two options for selecting tests within the test definitions themselves: ignoring tests and focusing on specific tests.</p> <h3 id="ignoring%2Fskipping-tests" tabindex="-1">Ignoring/Skipping Tests </h3> <p>You can ignore certain tests based on specific conditions using the <code data-language="ts">ignore</code> boolean in the test definition. If <code data-language="ts">ignore</code> is set to <code data-language="ts">true</code>, the test will be skipped. This is useful, for example, if you only want a test to run on a specific operating system.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts">Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"do macOS feature"</span><span class="token punctuation">,</span>
  ignore<span class="token operator">:</span> Deno<span class="token punctuation">.</span>build<span class="token punctuation">.</span>os <span class="token operator">!==</span> <span class="token string">"darwin"</span><span class="token punctuation">,</span> <span class="token comment">// This test will be ignored if not running on macOS</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do MacOS feature here</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>If you want to ignore a test without passing any conditions, you can use the <code data-language="ts">ignore()</code> function from the <code data-language="ts">Deno.test</code> object:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts">Deno<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token string">"my test"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// your test code</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h3 id="only-run-specific-tests" tabindex="-1">Only Run Specific Tests </h3> <p>If you want to focus on a particular test and ignore the rest, you can use the <code data-language="ts">only</code> option. This tells the test runner to run only the tests with <code data-language="ts">only</code> set to true. Multiple tests can have this option set. However, if any test is flagged with only, the overall test run will always fail, as this is intended to be a temporary measure for debugging.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts">Deno<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token string">"my test"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// some test code</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>or</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts">Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"Focus on this test only"</span><span class="token punctuation">,</span>
  only<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// Only this test will run</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// test complicated stuff here</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h2 id="failing-fast" tabindex="-1">Failing fast </h2> <p>If you have a long-running test suite and wish for it to stop on the first failure, you can specify the <code data-language="ts">--fail-fast</code> flag when running the suite.</p> <div class="relative">
<pre class="language-shell" tabindex="0"><code data-language="shell">deno <span class="token builtin class-name">test</span> --fail-fast
</code></pre>   </div>
<p>This will cause the test runner to stop execution after the first test failure.</p> <h2 id="reporters" tabindex="-1">Reporters </h2> <p>Deno includes three built-in reporters to format test output:</p> <ul> <li>
<code data-language="ts">pretty</code> (default): Provides a detailed and readable output.</li> <li>
<code data-language="ts">dot</code>: Offers a concise output, useful for quickly seeing test results.</li> <li>
<code data-language="ts">junit</code>: Produces output in JUnit XML format, which is useful for integrating with CI/CD tools.</li> </ul> <p>You can specify which reporter to use with the --reporter flag:</p> <div class="relative">
<pre class="language-sh" tabindex="0"><code data-language="sh"><span class="token comment"># Use the default pretty reporter</span>
deno <span class="token builtin class-name">test</span>

<span class="token comment"># Use the dot reporter for concise output</span>
deno <span class="token builtin class-name">test</span> <span class="token parameter variable">--reporter</span><span class="token operator">=</span>dot

<span class="token comment"># Use the JUnit reporter</span>
deno <span class="token builtin class-name">test</span> <span class="token parameter variable">--reporter</span><span class="token operator">=</span>junit
</code></pre>   </div>
<p>Additionally, you can write the JUnit report to a file while still getting human-readable output in the terminal by using the <code data-language="ts">--junit-path</code> flag:</p> <div class="relative">
<pre class="language-sh" tabindex="0"><code data-language="sh">deno <span class="token builtin class-name">test</span> --junit-path<span class="token operator">=</span>./report.xml
</code></pre>   </div>
<h2 id="spying%2C-mocking-(test-doubles)%2C-stubbing-and-faking-time" tabindex="-1">Spying, mocking (test doubles), stubbing and faking time </h2> <p>The <a href="standard_library.html">Deno Standard Library</a> provides a set of functions to help you write tests that involve spying, mocking, and stubbing. Check out the <a href="https://jsr.io/@std/testing">@std/testing documentation on JSR</a> for more information on each of these utilities.</p> <h2 id="coverage" tabindex="-1">Coverage </h2> <p>Deno will collect test coverage into a directory for your code if you specify the <code data-language="ts">--coverage</code> flag when starting <code data-language="ts">deno test</code>. This coverage information is acquired directly from the V8 JavaScript engine, ensuring high accuracy.</p> <p>This can then be further processed from the internal format into well known formats like <code data-language="ts">lcov</code> with the <a href="../reference/cli/coverage.html"><code data-language="ts">deno coverage</code></a> tool.</p> <h2 id="behavior-driven-development" tabindex="-1">Behavior-Driven Development </h2> <p>With the <a href="https://jsr.io/@std/testing/doc/bdd/~">@std/testing/bdd</a> module you can write your tests in a familiar format for grouping tests and adding setup/teardown hooks used by other JavaScript testing frameworks like Jasmine, Jest, and Mocha.</p> <p>The <code data-language="ts">describe</code> function creates a block that groups together several related tests. The <code data-language="ts">it</code> function registers an individual test case. For example:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"jsr:@std/testing/bdd"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"jsr:@std/expect"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./add.js"</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"add function"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"adds two numbers correctly"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"handles negative numbers"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>Check out the <a href="https://jsr.io/@std/testing/doc/bdd/~">documentation on JSR</a> for more information on these functions and hooks.</p> <h2 id="documentation-tests" tabindex="-1">Documentation Tests </h2> <p>Deno allows you to evaluate code snippets written in JSDoc or markdown files. This ensures the examples in your documentation are up-to-date and functional.</p> <h3 id="example-code-blocks" tabindex="-1">Example code blocks </h3> <div>
<div class="markdownBlockTitle">example.ts</div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">/**
 * # Examples
 *
 * ```ts
 * import { assertEquals } from "jsr:@std/assert/equals";
 *
 * const sum = add(1, 2);
 * assertEquals(sum, 3);
 * ```
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>   </div>
</div>
<p>The triple backticks mark the start and end of code blocks, the language is determined by the language identifier attribute which may be one of the following:</p> <ul> <li><code data-language="ts">js</code></li> <li><code data-language="ts">javascript</code></li> <li><code data-language="ts">mjs</code></li> <li><code data-language="ts">cjs</code></li> <li><code data-language="ts">jsx</code></li> <li><code data-language="ts">ts</code></li> <li><code data-language="ts">typescript</code></li> <li><code data-language="ts">mts</code></li> <li><code data-language="ts">cts</code></li> <li><code data-language="ts">tsx</code></li> </ul> <p>If no language identifier is specified then the language is inferred from media type of the source document that the code block is extracted from.</p> <div class="relative">
<pre class="language-sh" tabindex="0"><code data-language="sh">deno <span class="token builtin class-name">test</span> <span class="token parameter variable">--doc</span> example.ts
</code></pre>   </div>
<p>The above command will extract this example, turn it into a pseudo test case that looks like below:</p> <div>
<div class="markdownBlockTitle">example.ts$4-10.ts</div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> assertEquals <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"jsr:@std/assert/equals"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"file:///path/to/example.ts"</span><span class="token punctuation">;</span>

Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"example.ts$4-10.ts"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">assertEquals</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
</div>
<p>and then run it as a standalone module living in the same directory as the module being documented.</p> 
<div class="admonition tip"> <div class="title">Want to type-check only?</div>  <p>If you want to type-check your code snippets in JSDoc and markdown files without actually running them, you can use <a href="../reference/cli/check.html"><code data-language="ts">deno check</code></a> command with <code data-language="ts">--doc</code> option (for JSDoc) or with <code data-language="ts">--doc-only</code> option (for markdown) instead.</p> 
</div>  <h3 id="exported-items-are-automatically-imported" tabindex="-1">Exported items are automatically imported </h3> <p>Looking at the generated test code above, you will notice that it includes the <code data-language="ts">import</code> statement to import the <code data-language="ts">add</code> function even though the original code block does not have it. When documenting a module, any items exported from the module are automatically included in the generated test code using the same name.</p> <p>Let's say we have the following module:</p> <div>
<div class="markdownBlockTitle">example.ts</div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">/**
 * # Examples
 *
 * ```ts
 * import { assertEquals } from "jsr:@std/assert/equals";
 *
 * const sum = add(ONE, getTwo());
 * assertEquals(sum, 3);
 * ```
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ONE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">getTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>   </div>
</div>
<p>This will get converted to the following test case:</p> <div>
<div class="markdownBlockTitle">example.ts$4-10.ts</div>
<div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> assertEquals <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"jsr:@std/assert/equals"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add<span class="token punctuation">,</span> <span class="token constant">ONE</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> getTwo <span class="token keyword">from</span> <span class="token string">"file:///path/to/example.ts"</span><span class="token punctuation">;</span>

Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"example.ts$4-10.ts"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">ONE</span><span class="token punctuation">,</span> <span class="token function">getTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">assertEquals</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
</div>
<h3 id="skipping-code-blocks" tabindex="-1">Skipping code blocks </h3> <p>You can skip the evaluation of code blocks by adding the <code data-language="ts">ignore</code> attribute.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">/**
 * This code block will not be run.
 *
 * ```ts ignore
 * await sendEmail("deno@example.com");
 * ```
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span>to<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// send an email to the given address...</span>
<span class="token punctuation">}</span>
</code></pre>   </div>
<h2 id="sanitizers" tabindex="-1">Sanitizers </h2> <p>The test runner offers several sanitizers to ensure that the test behaves in a reasonable and expected way.</p> <h3 id="resource-sanitizer" tabindex="-1">Resource sanitizer </h3> <p>The resource sanitizer ensures that all I/O resources created during a test are closed, to prevent leaks.</p> <p>I/O resources are things like <code data-language="ts">Deno.FsFile</code> handles, network connections, <code data-language="ts">fetch</code> bodies, timers, and other resources that are not automatically garbage collected.</p> <p>You should always close resources when you are done with them. For example, to close a file:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Do something with the file</span>
file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;- Always close the file when you are done with it</span>
</code></pre>   </div>
<p>To close a network connection:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> conn <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hostname<span class="token operator">:</span> <span class="token string">"example.com"</span><span class="token punctuation">,</span> port<span class="token operator">:</span> <span class="token number">80</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Do something with the connection</span>
conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;- Always close the connection when you are done with it</span>
</code></pre>   </div>
<p>To close a <code data-language="ts">fetch</code> body:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"https://example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Do something with the response</span>
<span class="token keyword">await</span> response<span class="token punctuation">.</span>body<span class="token operator">?.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;- Always cancel the body when you are done with it, if you didn't consume it otherwise</span>
</code></pre>   </div>
<p>This sanitizer is enabled by default, but can be disabled in this test with <code data-language="ts">sanitizeResources: false</code>:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts">Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"leaky resource test"</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  sanitizeResources<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h3 id="async-operation-sanitizer" tabindex="-1">Async operation sanitizer </h3> <p>The async operation sanitizer ensures that all async operations started in a test are completed before the test ends. This is important because if an async operation is not awaited, the test will end before the operation is completed, and the test will be marked as successful even if the operation may have actually failed.</p> <p>You should always await all async operations in your tests. For example:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts">Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"async operation test"</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>This sanitizer is enabled by default, but can be disabled with <code data-language="ts">sanitizeOps: false</code>:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts">Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"leaky operation test"</span><span class="token punctuation">,</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    crypto<span class="token punctuation">.</span>subtle<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>
      <span class="token string">"SHA-256"</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">TextEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">100000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  sanitizeOps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h3 id="exit-sanitizer" tabindex="-1">Exit sanitizer </h3> <p>The exit sanitizer ensures that tested code doesn’t call <code data-language="ts">Deno.exit()</code>, which could signal a false test success.</p> <p>This sanitizer is enabled by default, but can be disabled with <code data-language="ts">sanitizeExit: false</code>.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts">Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"false success"</span><span class="token punctuation">,</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Deno<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  sanitizeExit<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This test never runs, because the process exits during "false success" test</span>
Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"failing test"</span><span class="token punctuation">,</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"this test fails"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h2 id="snapshot-testing" tabindex="-1">Snapshot testing </h2> <p>The <a href="standard_library.html">Deno Standard Library</a> includes a <a href="https://jsr.io/@std/testing/doc/snapshot/~">snapshot module</a> that allows developers to write tests by comparing values against reference snapshots. These snapshots are serialized representations of the original values and are stored alongside the test files.</p> <p>Snapshot testing enables catching a wide array of bugs with very little code. It is particularly helpful in situations where it is difficult to precisely express what should be asserted, without requiring a prohibitive amount of code, or where the assertions a test makes are expected to change often.</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018–2024 the Deno authors<br>Licensed under the MIT License.<br>
    <a href="https://docs.deno.com/runtime/fundamentals/testing" class="_attribution-link">https://docs.deno.com/runtime/fundamentals/testing</a>
  </p>
</div>
