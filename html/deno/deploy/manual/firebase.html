<h1>Connect to Firebase</h1>
<div>
<p>Firebase is a platform developed by Google for creating mobile and web applications. Its features include authentication primitives for log in and a NoSQL datastore, Firestore, that you can persist data to.</p> <p>This tutorial covers how to connect to Firebase from an application deployed on Deno Deploy.</p> <p>You can find a more comprehensive tutorial that builds a sample application on top of Firebase <a href="../tutorials/tutorial-firebase.html">here</a>.</p> <h2 id="get-credentials-from-firebase" tabindex="-1">Get credentials from Firebase </h2> <blockquote> <p>This tutorial assumes that you've already created a project in Firebase and added a web application to your project.</p> </blockquote> <ol> <li> <p>Navigate to your project in Firebase and click on <strong>Project Settings</strong></p> </li> <li> <p>Scroll down until you see a card with your app name, and a code sample that includes a <code data-language="ts">firebaseConfig</code>object. It should look something like the below. Keep this handy. We will use it later:</p> <div class="relative">
<pre class="language-js" tabindex="0"><code data-language="js"><span class="token keyword">var</span> firebaseConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">"APIKEY"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">authDomain</span><span class="token operator">:</span> <span class="token string">"example-12345.firebaseapp.com"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">projectId</span><span class="token operator">:</span> <span class="token string">"example-12345"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">storageBucket</span><span class="token operator">:</span> <span class="token string">"example-12345.appspot.com"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">messagingSenderId</span><span class="token operator">:</span> <span class="token string">"1234567890"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">appId</span><span class="token operator">:</span> <span class="token string">"APPID"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>   </div>
</li> </ol> <h2 id="create-a-project-in-deno-deploy" tabindex="-1">Create a Project in Deno Deploy </h2> <ol> <li> <p>Go to <a href="https://dash.deno.com/new">https://dash.deno.com/new</a> (Sign in with GitHub if you didn't already) and click on <strong>+ Empty Project</strong> under <strong>Deploy from the command line</strong>.</p> </li> <li> <p>Now click on the <strong>Settings</strong> button available on the project page.</p> </li> <li> <p>Navigate to the <strong>Environment Variables</strong> section and add the following:</p> <dl> <dt><code data-language="ts">FIREBASE_USERNAME</code></dt> <dd>The Firebase user (email address) that was added above.</dd> <dt><code data-language="ts">FIREBASE_PASSWORD</code></dt> <dd>The Firebase user password that was added above.</dd> <dt><code data-language="ts">FIREBASE_CONFIG</code></dt> <dd>The configuration of the Firebase application as a JSON string.</dd> </dl> <p>The configuration needs to be a valid JSON string to be readable by the application. If the code snippet given when setting up looked like this:</p> <div class="relative">
<pre class="language-js" tabindex="0"><code data-language="js"><span class="token keyword">var</span> firebaseConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">"APIKEY"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">authDomain</span><span class="token operator">:</span> <span class="token string">"example-12345.firebaseapp.com"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">projectId</span><span class="token operator">:</span> <span class="token string">"example-12345"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">storageBucket</span><span class="token operator">:</span> <span class="token string">"example-12345.appspot.com"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">messagingSenderId</span><span class="token operator">:</span> <span class="token string">"1234567890"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">appId</span><span class="token operator">:</span> <span class="token string">"APPID"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>You would need to set the value of the string to this (noting that spacing and new lines are not required):</p> <div class="relative">
<pre class="language-json" tabindex="0"><code data-language="json"><span class="token punctuation">{</span>
  <span class="token property">"apiKey"</span><span class="token operator">:</span> <span class="token string">"APIKEY"</span><span class="token punctuation">,</span>
  <span class="token property">"authDomain"</span><span class="token operator">:</span> <span class="token string">"example-12345.firebaseapp.com"</span><span class="token punctuation">,</span>
  <span class="token property">"projectId"</span><span class="token operator">:</span> <span class="token string">"example-12345"</span><span class="token punctuation">,</span>
  <span class="token property">"storageBucket"</span><span class="token operator">:</span> <span class="token string">"example-12345.appspot.com"</span><span class="token punctuation">,</span>
  <span class="token property">"messagingSenderId"</span><span class="token operator">:</span> <span class="token string">"1234567890"</span><span class="token punctuation">,</span>
  <span class="token property">"appId"</span><span class="token operator">:</span> <span class="token string">"APPID"</span>
<span class="token punctuation">}</span>
</code></pre>   </div>
</li> </ol> <h2 id="write-code-that-connects-to-firebase" tabindex="-1">Write code that connects to Firebase </h2> <p>The first thing we will do is import the <code data-language="ts">XMLHttpRequest</code> polyfill that Firebase needs to work under Deploy as well as a polyfill for <code data-language="ts">localStorage</code> to allow the Firebase auth to persist logged in users:</p> <div class="relative">
<pre class="language-js" tabindex="0"><code data-language="js"><span class="token keyword">import</span> <span class="token string">"https://deno.land/x/xhr@0.1.1/mod.ts"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> installGlobals <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https://deno.land/x/virtualstorage@0.1.0/mod.ts"</span><span class="token punctuation">;</span>
<span class="token function">installGlobals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<blockquote> <p>ℹ️ we are using the current version of packages at the time of the writing of this tutorial. They may not be up-to-date and you may want to double check current versions.</p> </blockquote> <p>Because Deploy has a lot of the web standard APIs, it is best to use the web libraries for Firebase under deploy. Currently v9 is in still in beta for Firebase, so we will use v8:</p> <div class="relative">
<pre class="language-js" tabindex="0"><code data-language="js"><span class="token keyword">import</span> firebase <span class="token keyword">from</span> <span class="token string">"https://esm.sh/firebase@9.17.0/app"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"https://esm.sh/firebase@9.17.0/auth"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"https://esm.sh/firebase@9.17.0/firestore"</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>Now we need to setup our Firebase application. We will be getting the configuration from the environment variables we set up previously and get references to the parts of Firebase we are going to use:</p> <div class="relative">
<pre class="language-js" tabindex="0"><code data-language="js"><span class="token keyword">const</span> firebaseConfig <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>Deno<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"FIREBASE_CONFIG"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> firebaseApp <span class="token operator">=</span> firebase<span class="token punctuation">.</span><span class="token function">initializeApp</span><span class="token punctuation">(</span>firebaseConfig<span class="token punctuation">,</span> <span class="token string">"example"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> auth <span class="token operator">=</span> firebase<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span>firebaseApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> firebase<span class="token punctuation">.</span><span class="token function">firestore</span><span class="token punctuation">(</span>firebaseApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>Ok, we are almost done. We just need to create our middleware application and add the <code data-language="ts">localStorage</code> middleware we imported:</p> <div class="relative">
<pre class="language-js" tabindex="0"><code data-language="js"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">virtualStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>And then we need to add middleware to authenticate the user. In this tutorial we are simply grabbing the username and password from the environment variables we will be setting up, but this could easily be adapted to redirect a user to a sign-in page if they are not logged in:</p> <div class="relative">
<pre class="language-js" tabindex="0"><code data-language="js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> signedInUid <span class="token operator">=</span> ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"LOGGED_IN_UID"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> signedInUser <span class="token operator">=</span> signedInUid <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>signedInUid<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>signedInUid <span class="token operator">||</span> <span class="token operator">!</span>signedInUser <span class="token operator">||</span> <span class="token operator">!</span>auth<span class="token punctuation">.</span>currentUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> creds <span class="token operator">=</span> <span class="token keyword">await</span> auth<span class="token punctuation">.</span><span class="token function">signInWithEmailAndPassword</span><span class="token punctuation">(</span>
      Deno<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"FIREBASE_USERNAME"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      Deno<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"FIREBASE_PASSWORD"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> creds<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      users<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"LOGGED_IN_UID"</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>signedInUser <span class="token operator">&amp;&amp;</span> signedInUid<span class="token punctuation">.</span>uid <span class="token operator">!==</span> auth<span class="token punctuation">.</span>currentUser<span class="token operator">?.</span>uid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> auth<span class="token punctuation">.</span><span class="token function">updateCurrentUser</span><span class="token punctuation">(</span>signedInUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h2 id="deploy-the-application-to-deno-deploy" tabindex="-1">Deploy the application to Deno Deploy </h2> <p>Once you have finished writing your application, you can deploy it on Deno Deploy.</p> <p>To do this, go back to your project page at <code data-language="ts">https://dash.deno.com/projects/&lt;project-name&gt;</code>.</p> <p>You should see a couple of options to deploy:</p> <ul> <li><a href="ci_github.html">Github integration</a></li> <li>
<a href="deployctl.html"><code data-language="ts">deployctl</code></a><div class="relative">
<pre class="language-sh" tabindex="0"><code data-language="sh">deployctl deploy <span class="token parameter variable">--project</span><span class="token operator">=</span><span class="token operator">&lt;</span>project-name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>application-file-name<span class="token operator">&gt;</span>
</code></pre>   </div>
</li> </ul> <p>Unless you want to add a build step, we recommend that you select the Github integration.</p> <p>For more details on the different ways to deploy on Deno Deploy and the different configuration options, read <a href="how-to-deploy.html">here</a>.</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018–2024 the Deno authors<br>Licensed under the MIT License.<br>
    <a href="https://docs.deno.com/deploy/manual/firebase" class="_attribution-link">https://docs.deno.com/deploy/manual/firebase</a>
  </p>
</div>
