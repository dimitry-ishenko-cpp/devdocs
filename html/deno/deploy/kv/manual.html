<h1>Deno KV Quick Start</h1>
<div>
<p><strong>Deno KV</strong> is a <a href="https://en.wikipedia.org/wiki/Key%E2%80%93value_database">key-value database</a> built directly into the Deno runtime, available in the <a href="../../api/deno/~/deno.kv.html"><code data-language="ts">Deno.Kv</code> namespace</a>. It can be used for many kinds of data storage use cases, but excels at storing simple data structures that benefit from very fast reads and writes. Deno KV is available in the Deno CLI and on <a href="manual/on_deploy.html">Deno Deploy</a>.</p> <p><deno-admonition></deno-admonition></p> <p>Let's walk through the key features of Deno KV.</p> <h2 id="opening-a-database" tabindex="-1">Opening a database </h2> <p>In your Deno program, you can get a reference to a KV database using <a href="../../api/deno/~/deno.openkv.html"><code data-language="ts">Deno.openKv()</code></a>. You may pass in an optional file system path to where you'd like to store your database, otherwise one will be created for you based on the current working directory of your script.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> kv <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">openKv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h2 id="creating%2C-updating%2C-and-reading-a-key-value-pair" tabindex="-1">Creating, updating, and reading a key-value pair </h2> <p>Data in Deno KV is stored as key-value pairs, much like properties of a JavaScript object literal or a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a>. <a href="manual/key_space.html">Keys</a> are represented as an array of JavaScript types, like <code data-language="ts">string</code>, <code data-language="ts">number</code>, <code data-language="ts">bigint</code>, or <code data-language="ts">boolean</code>. Values can be arbitrary JavaScript objects. In this example, we create a key-value pair representing a user's UI preferences, and save it with <a href="../../api/deno/~/deno.kv.prototype.set.html"><code data-language="ts">kv.set()</code></a>.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> kv <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">openKv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> prefs <span class="token operator">=</span> <span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token string">"ada"</span><span class="token punctuation">,</span>
  theme<span class="token operator">:</span> <span class="token string">"dark"</span><span class="token punctuation">,</span>
  language<span class="token operator">:</span> <span class="token string">"en-US"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"preferences"</span><span class="token punctuation">,</span> <span class="token string">"ada"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> prefs<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>Once a key-value pair is set, you can read it from the database with <a href="../../api/deno/~/deno.kv.prototype.get.html"><code data-language="ts">kv.get()</code></a>:</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"preferences"</span><span class="token punctuation">,</span> <span class="token string">"ada"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>versionstamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>Both <code data-language="ts">get</code> and <code data-language="ts">list</code> <a href="manual/operations.html">operations</a> return a <a href="../../api/deno/~/deno.kventry.html">KvEntry</a> object with the following properties:</p> <ul> <li>
<code data-language="ts">key</code> - the array key you used to set the value</li> <li>
<code data-language="ts">value</code> - the JavaScript object you set for this key</li> <li>
<code data-language="ts">versionstamp</code> - a generated value used to determine if a key has been updated.</li> </ul> <p>The <code data-language="ts">set</code> operation is also used to update objects that already exist for a given key. When a key's value is updated, its <code data-language="ts">versionstamp</code> will change to a new generated value.</p> <h2 id="listing-several-key-value-pairs" tabindex="-1">Listing several key-value pairs </h2> <p>To get values for a finite number of keys, you may use <a href="../../api/deno/~/deno.kv.prototype.getmany.html"><code data-language="ts">kv.getMany()</code></a>. Pass in several keys as arguments, and you'll receive an array of values for each key. Note that <strong>values and versionstamps can be <code data-language="ts">null</code></strong> if no value exists for the given key(s).</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> kv <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">openKv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">getMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">"preferences"</span><span class="token punctuation">,</span> <span class="token string">"ada"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">"preferences"</span><span class="token punctuation">,</span> <span class="token string">"grace"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token comment">// ["preferences", "ada"]</span>
result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// { ... }</span>
result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>versionstamp<span class="token punctuation">;</span> <span class="token comment">// "00000000000000010000"</span>
result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token comment">// ["preferences", "grace"]</span>
result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// null</span>
result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>versionstamp<span class="token punctuation">;</span> <span class="token comment">// null</span>
</code></pre>   </div>
<p>Often, it is useful to retrieve a list of key-value pairs from all keys that share a given prefix. This type of operation is possible using <a href="../../api/deno/~/deno.kv.prototype.list.html"><code data-language="ts">kv.list()</code></a>. In this example, we get a list of key-value pairs that share the <code data-language="ts">"preferences"</code> prefix.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> kv <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">openKv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> entries <span class="token operator">=</span> kv<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">{</span> prefix<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"preferences"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entry <span class="token keyword">of</span> entries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["preferences", "ada"]</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { ... }</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>versionstamp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "00000000000000010000"</span>
<span class="token punctuation">}</span>
</code></pre>   </div>
<p>Returned keys are ordered lexicographically based on the next component of the key after the prefix. So KV pairs with these keys:</p> <ul> <li><code data-language="ts">["preferences", "ada"]</code></li> <li><code data-language="ts">["preferences", "bob"]</code></li> <li><code data-language="ts">["preferences", "cassie"]</code></li> </ul> <p>Will be returned in that order by <code data-language="ts">kv.list()</code>.</p> <p>Read operations can either be performed in <a href="manual/operations.html"><strong>strong or eventual consistency mode</strong></a>. Strong consistency mode guarantees that the read operation will return the most recently written value. Eventual consistency mode may return a stale value, but is faster. By contrast, writes are always performed in strong consistency mode.</p> <h2 id="deleting-key-value-pairs" tabindex="-1">Deleting key-value pairs </h2> <p>You can delete a key from the database using <a href="../../api/deno/~/deno.kv.prototype.delete.html"><code data-language="ts">kv.delete()</code></a>. No action is taken if no value is found for the given key.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> kv <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">openKv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"preferences"</span><span class="token punctuation">,</span> <span class="token string">"alan"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h2 id="atomic-transactions" tabindex="-1">Atomic transactions </h2> <p>Deno KV is capable of executing <a href="manual/transactions.html">atomic transactions</a>, which enables you to conditionally execute one or many data manipulation operations at once. In the following example, we create a new preferences object only if it hasn't been created already.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> kv <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">openKv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"preferences"</span><span class="token punctuation">,</span> <span class="token string">"alan"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token string">"alan"</span><span class="token punctuation">,</span>
  theme<span class="token operator">:</span> <span class="token string">"light"</span><span class="token punctuation">,</span>
  language<span class="token operator">:</span> <span class="token string">"en-GB"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">atomic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">{</span> key<span class="token punctuation">,</span> versionstamp<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// `null` versionstamps mean 'no value'</span>
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Preferences did not yet exist. Inserted!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Preferences already exist."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>   </div>
<p>Learn more about transactions in Deno KV <a href="manual/transactions.html">here</a>.</p> <h2 id="improve-querying-with-secondary-indexes" tabindex="-1">Improve querying with secondary indexes </h2> <p><a href="manual/secondary_indexes.html">Secondary indexes</a> store the same data by multiple keys, allowing for simpler queries of the data you need. Let's say that we need to be able to access user preferences by both username AND email. To enable this, you could provide a function that wraps the logic to save the preferences to create two indexes.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> kv <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">openKv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">savePreferences</span><span class="token punctuation">(</span>prefs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"preferences"</span><span class="token punctuation">,</span> prefs<span class="token punctuation">.</span>username<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// Set the primary key</span>
  <span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> prefs<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Set the secondary key's value to be the primary key</span>
  <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"preferencesByEmail"</span><span class="token punctuation">,</span> prefs<span class="token punctuation">.</span>email<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Use as before...</span>
  <span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"preferences"</span><span class="token punctuation">,</span> username<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getByEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Look up the key by email, then second lookup for actual data</span>
  <span class="token keyword">const</span> r1 <span class="token operator">=</span> <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"preferencesByEmail"</span><span class="token punctuation">,</span> email<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> r2 <span class="token operator">=</span> <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>r1<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> r2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>   </div>
<p>Learn more about <a href="manual/secondary_indexes.html">secondary indexes in the manual here</a>.</p> <h2 id="watching-for-updates-in-deno-kv" tabindex="-1">Watching for updates in Deno KV </h2> <p>You can also listen for updates from Deno KV with <code data-language="ts">kv.watch()</code>, which will emit a new value or values of the key or keys you provide. In the below chat example, we watch for updates on the key <code data-language="ts">["last_message_id", roomId]</code>. We retrieve <code data-language="ts">messageId</code>, which we then use with <code data-language="ts">kv.list()</code> to grab all the new messages from <code data-language="ts">seen</code> and <code data-language="ts">messageId</code>.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">let</span> seen <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>messageId<span class="token punctuation">]</span> <span class="token keyword">of</span> kv<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"last_message_id"</span><span class="token punctuation">,</span> roomId<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newMessages <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">fromAsync</span><span class="token punctuation">(</span>kv<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    start<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"messages"</span><span class="token punctuation">,</span> roomId<span class="token punctuation">,</span> seen<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    end<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"messages"</span><span class="token punctuation">,</span> roomId<span class="token punctuation">,</span> messageId<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> websocket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>newMessages<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  seen <span class="token operator">=</span> messageId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>   </div>
<p>Learn more about <a href="manual/operations.html#watch">using Deno KV watch here</a>.</p> <h2 id="production-usage" tabindex="-1">Production usage </h2> <p>Deno KV is available for use in live applications on <a href="manual/on_deploy.html">Deno Deploy</a>. In production, Deno KV is backed by <a href="https://www.foundationdb.org/">FoundationDB</a>, the open source key-value store created by Apple.</p> <p><strong>No additional configuration is necessary</strong> to run your Deno programs that use KV on Deploy - a new Deploy database will be provisioned for you when required by your code. Learn more about Deno KV on Deno Deploy <a href="manual/on_deploy.html">here</a>.</p> <h2 id="testing" tabindex="-1">Testing </h2> <p>By default, <a href="../../api/deno/~/deno.openkv.html"><code data-language="ts">Deno.openKv()</code></a> creates or opens a persistent store based on the path from which the script that invoked it was run. This isn't usually desirable for tests, which need to produce the same behavior when run many times in a row.</p> <p>To test code that uses Deno KV, you can use the special argument <code data-language="ts">":memory:"</code> to create an ephemeral Deno KV datastore.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">setDisplayName</span><span class="token punctuation">(</span>
  kv<span class="token operator">:</span> Deno<span class="token punctuation">.</span>Kv<span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  displayname<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"preferences"</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> <span class="token string">"displayname"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> displayname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getDisplayName</span><span class="token punctuation">(</span>
  kv<span class="token operator">:</span> Deno<span class="token punctuation">.</span>Kv<span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"preferences"</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> <span class="token string">"displayname"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>value <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"Preferences"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> kv <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">openKv</span><span class="token punctuation">(</span><span class="token string">":memory:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> t<span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token string">"can set displayname"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> displayName <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDisplayName</span><span class="token punctuation">(</span>kv<span class="token punctuation">,</span> <span class="token string">"example"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertEquals</span><span class="token punctuation">(</span>displayName<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> <span class="token function">setDisplayName</span><span class="token punctuation">(</span>kv<span class="token punctuation">,</span> <span class="token string">"example"</span><span class="token punctuation">,</span> <span class="token string">"Exemplary User"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> displayName <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDisplayName</span><span class="token punctuation">(</span>kv<span class="token punctuation">,</span> <span class="token string">"example"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertEquals</span><span class="token punctuation">(</span>displayName<span class="token punctuation">,</span> <span class="token string">"Exemplary User"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<p>This works because Deno KV is backed by SQLite when run for local development. Just like in-memory SQLite databases, multiple ephemeral Deno KV stores can exist at once without interfering with one another. For more information about special database addressing modes, see <a href="https://www.sqlite.org/inmemorydb.html">the SQLite docs on the topic</a>.</p> <h2 id="next-steps" tabindex="-1">Next steps </h2> <p>At this point, you're just beginning to scratch the surface with Deno KV. Be sure to check out our guide on the <a href="manual/key_space.html">Deno KV key space</a>, and a collection of <a href="tutorials.html">tutorials and example applications</a> here.</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018–2024 the Deno authors<br>Licensed under the MIT License.<br>
    <a href="https://docs.deno.com/deploy/kv/manual" class="_attribution-link">https://docs.deno.com/deploy/kv/manual</a>
  </p>
</div>
