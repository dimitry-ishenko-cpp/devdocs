<h1>Operations</h1>
<div>
<p><deno-admonition></deno-admonition></p> <p>The Deno KV API provides a set of operations that can be performed on the key space.</p> <p>There are two operations that read data from the store, and five operations that write data to the store.</p> <p>Read operations can either be performed in strong or eventual consistency mode. Strong consistency mode guarantees that the read operation will return the most recently written value. Eventual consistency mode may return a stale value, but is faster.</p> <p>Write operations are always performed in strong consistency mode.</p> <h2 id="get" tabindex="-1">
<code data-language="ts">get</code> </h2> <p>The <code data-language="ts">get</code> operation returns the value and versionstamp associated with a given key. If a value does not exist, get returns a <code data-language="ts">null</code> value and versionstamp.</p> <p>There are two APIs that can be used to perform a <code data-language="ts">get</code> operation. The <a href="../../../api/deno/~/deno.kv.prototype.get.html"><code data-language="ts">Deno.Kv.prototype.get(key, options?)</code></a> API, which can be used to read a single key, and the <a href="../../../api/deno/~/deno.kv.prototype.getmany.html"><code data-language="ts">Deno.Kv.prototype.getMany(keys, options?)</code></a> API, which can be used to read multiple keys at once.</p> <p>Get operations are performed as a "snapshot read" in all consistency modes. This means that when retrieving multiple keys at once, the values returned will be consistent with each other.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"config"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["config"], value: "value", versionstamp: "000002fa526aaccb0000" }</span>

<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"config"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> consistency<span class="token operator">:</span> <span class="token string">"eventual"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["config"], value: "value", versionstamp: "000002fa526aaccb0000" }</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>res1<span class="token punctuation">,</span> res2<span class="token punctuation">,</span> res3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">getMany</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"sam"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"taylor"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"alex"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "sam"], value: "sam", versionstamp: "00e0a2a0f0178b270000" }</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "taylor"], value: "taylor", versionstamp: "0059e9035e5e7c5e0000" }</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "alex"], value: "alex", versionstamp: "00a44a3c3e53b9750000" }</span>
</code></pre>   </div>
<h2 id="list" tabindex="-1">
<code data-language="ts">list</code> </h2> <p>The <code data-language="ts">list</code> operation returns a list of keys that match a given selector. The associated values and versionstamps for these keys are also returned. There are 2 different selectors that can be used to filter the keys matched.</p> <p>The <code data-language="ts">prefix</code> selector matches all keys that start with the given prefix key parts, but not inclusive of an exact match of the key. The prefix selector may optionally be given a <code data-language="ts">start</code> OR <code data-language="ts">end</code> key to limit the range of keys returned. The <code data-language="ts">start</code> key is inclusive, and the <code data-language="ts">end</code> key is exclusive.</p> <p>The <code data-language="ts">range</code> selector matches all keys that are lexicographically between the given <code data-language="ts">start</code> and <code data-language="ts">end</code> keys. The <code data-language="ts">start</code> key is inclusive, and the <code data-language="ts">end</code> key is exclusive.</p> <blockquote> <p>Note: In the case of the prefix selector, the <code data-language="ts">prefix</code> key must consist only of full (not partial) key parts. For example, if the key <code data-language="ts">["foo", "bar"]</code> exists in the store, then the prefix selector <code data-language="ts">["foo"]</code> will match it, but the prefix selector <code data-language="ts">["f"]</code> will not.</p> </blockquote> <p>The list operation may optionally be given a <code data-language="ts">limit</code> to limit the number of keys returned.</p> <p>List operations can be performed using the <a href="../../../api/deno/~/deno.kv.prototype.list.html"><code data-language="ts">Deno.Kv.prototype.list&lt;string&gt;(selector, options?)</code></a> method. This method returns a <code data-language="ts">Deno.KvListIterator</code> that can be used to iterate over the keys returned. This is an async iterator, and can be used with <code data-language="ts">for await</code> loops.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// Return all users</span>
<span class="token keyword">const</span> iter <span class="token operator">=</span> kv<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">list</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> prefix<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> res <span class="token keyword">of</span> iter<span class="token punctuation">)</span> users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "alex"], value: "alex", versionstamp: "00a44a3c3e53b9750000" }</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "sam"], value: "sam", versionstamp: "00e0a2a0f0178b270000" }</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "taylor"], value: "taylor", versionstamp: "0059e9035e5e7c5e0000" }</span>

<span class="token comment">// Return the first 2 users</span>
<span class="token keyword">const</span> iter <span class="token operator">=</span> kv<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">list</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> prefix<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> limit<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> res <span class="token keyword">of</span> iter<span class="token punctuation">)</span> users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "alex"], value: "alex", versionstamp: "00a44a3c3e53b9750000" }</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "sam"], value: "sam", versionstamp: "00e0a2a0f0178b270000" }</span>

<span class="token comment">// Return all users lexicographically after "taylor"</span>
<span class="token keyword">const</span> iter <span class="token operator">=</span> kv<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">list</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> prefix<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> start<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"taylor"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> res <span class="token keyword">of</span> iter<span class="token punctuation">)</span> users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "taylor"], value: "taylor", versionstamp: "0059e9035e5e7c5e0000" }</span>

<span class="token comment">// Return all users lexicographically before "taylor"</span>
<span class="token keyword">const</span> iter <span class="token operator">=</span> kv<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">list</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> prefix<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"taylor"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> res <span class="token keyword">of</span> iter<span class="token punctuation">)</span> users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "alex"], value: "alex", versionstamp: "00a44a3c3e53b9750000" }</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "sam"], value: "sam", versionstamp: "00e0a2a0f0178b270000" }</span>

<span class="token comment">// Return all users starting with characters between "a" and "n"</span>
<span class="token keyword">const</span> iter <span class="token operator">=</span> kv<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">list</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> start<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"n"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> res <span class="token keyword">of</span> iter<span class="token punctuation">)</span> users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "alex"], value: "alex", versionstamp: "00a44a3c3e53b9750000" }</span>
</code></pre>   </div>
<p>The list operation reads data from the store in batches. The size of each batch can be controlled using the <code data-language="ts">batchSize</code> option. The default batch size is 500 keys. Data within a batch is read in a single snapshot read, so the values are consistent with each other. Consistency modes apply to each batch of data read. Across batches, data is not consistent. The borders between batches is not visible from the API as the iterator returns individual keys.</p> <p>The list operation can be performed in reverse order by setting the <code data-language="ts">reverse</code> option to <code data-language="ts">true</code>. This will return the keys in lexicographically descending order. The <code data-language="ts">start</code> and <code data-language="ts">end</code> keys are still inclusive and exclusive respectively, and are still interpreted as lexicographically ascending.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token comment">// Return all users in reverse order, ending with "sam"</span>
<span class="token keyword">const</span> iter <span class="token operator">=</span> kv<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">list</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> prefix<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> start<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"sam"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  reverse<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> res <span class="token keyword">of</span> iter<span class="token punctuation">)</span> users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "taylor"], value: "taylor", versionstamp: "0059e9035e5e7c5e0000" }</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { key: ["users", "sam"], value: "sam", versionstamp: "00e0a2a0f0178b270000" }</span>
</code></pre>   </div>
<blockquote> <p>Note: in the above example we set the <code data-language="ts">start</code> key to <code data-language="ts">["users", "sam"]</code>, even though the first key returned is <code data-language="ts">["users", "taylor"]</code>. This is because the <code data-language="ts">start</code> and <code data-language="ts">end</code> keys are always evaluated in lexicographically ascending order, even when the list operation is performed in reverse order (which returns the keys in lexicographically descending order).</p> </blockquote> <h2 id="set" tabindex="-1">
<code data-language="ts">set</code> </h2> <p>The <code data-language="ts">set</code> operation sets the value of a key in the store. If the key does not exist, it is created. If the key already exists, its value is overwritten.</p> <p>The <code data-language="ts">set</code> operation can be performed using the <a href="../../../api/deno/~/deno.kv.prototype.set.html"><code data-language="ts">Deno.Kv.prototype.set(key, value)</code></a> method. This method returns a <code data-language="ts">Promise</code> that resolves to a <code data-language="ts">Deno.KvCommitResult</code> object, which contains the <code data-language="ts">versionstamp</code> of the commit.</p> <p>Set operations are always performed in strong consistency mode.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"alex"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"alex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>versionstamp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "00a44a3c3e53b9750000"</span>
</code></pre>   </div>
<h2 id="delete" tabindex="-1">
<code data-language="ts">delete</code> </h2> <p>The <code data-language="ts">delete</code> operation deletes a key from the store. If the key does not exist, the operation is a no-op.</p> <p>The <code data-language="ts">delete</code> operation can be performed using the <a href="../../../api/deno/~/deno.kv.prototype.delete.html"><code data-language="ts">Deno.Kv.prototype.delete(key)</code></a> method.</p> <p>Delete operations are always performed in strong consistency mode.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"alex"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h2 id="sum" tabindex="-1">
<code data-language="ts">sum</code> </h2> <p>The <code data-language="ts">sum</code> operation atomically adds a value to a key in the store. If the key does not exist, it is created with the value of the sum. If the key already exists, its value is added to the sum.</p> <p>The <code data-language="ts">sum</code> operation can only be performed as part of an atomic operation. The <a href="../../../api/deno/~/deno.atomicoperation.prototype.mutate.html"><code data-language="ts">Deno.AtomicOperation.prototype.mutate({ type: "sum", value })</code></a> method can be used to add a sum mutation to an atomic operation.</p> <p>The sum operation can only be performed on values of type <code data-language="ts">Deno.KvU64</code>. Both the operand and the value in the store must be of type <code data-language="ts">Deno.KvU64</code>.</p> <p>If the new value of the key is greater than <code data-language="ts">2^64 - 1</code> or less than <code data-language="ts">0</code>, the sum operation wraps around. For example, if the value in the store is <code data-language="ts">2^64 - 1</code> and the operand is <code data-language="ts">1</code>, the new value will be <code data-language="ts">0</code>.</p> <p>Sum operations are always performed in strong consistency mode.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">atomic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">"sum"</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"accounts"</span><span class="token punctuation">,</span> <span class="token string">"alex"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Deno</span><span class="token punctuation">.</span><span class="token function">KvU64</span><span class="token punctuation">(</span><span class="token number">100n</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h2 id="min" tabindex="-1">
<code data-language="ts">min</code> </h2> <p>The <code data-language="ts">min</code> operation atomically sets a key to the minimum of its current value and a given value. If the key does not exist, it is created with the given value. If the key already exists, its value is set to the minimum of its current value and the given value.</p> <p>The <code data-language="ts">min</code> operation can only be performed as part of an atomic operation. The <a href="../../../api/deno/~/deno.atomicoperation.prototype.mutate.html"><code data-language="ts">Deno.AtomicOperation.prototype.mutate({ type: "min", value })</code></a> method can be used to add a min mutation to an atomic operation.</p> <p>The min operation can only be performed on values of type <code data-language="ts">Deno.KvU64</code>. Both the operand and the value in the store must be of type <code data-language="ts">Deno.KvU64</code>.</p> <p>Min operations are always performed in strong consistency mode.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">atomic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">"min"</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"accounts"</span><span class="token punctuation">,</span> <span class="token string">"alex"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Deno</span><span class="token punctuation">.</span><span class="token function">KvU64</span><span class="token punctuation">(</span><span class="token number">100n</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h2 id="max" tabindex="-1">
<code data-language="ts">max</code> </h2> <p>The <code data-language="ts">max</code> operation atomically sets a key to the maximum of its current value and a given value. If the key does not exist, it is created with the given value. If the key already exists, its value is set to the maximum of its current value and the given value.</p> <p>The <code data-language="ts">max</code> operation can only be performed as part of an atomic operation. The <a href="../../../api/deno/~/deno.atomicoperation.prototype.mutate.html"><code data-language="ts">Deno.AtomicOperation.prototype.mutate({ type: "max", value })</code></a> method can be used to add a max mutation to an atomic operation.</p> <p>The max operation can only be performed on values of type <code data-language="ts">Deno.KvU64</code>. Both the operand and the value in the store must be of type <code data-language="ts">Deno.KvU64</code>.</p> <p>Max operations are always performed in strong consistency mode.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">await</span> kv<span class="token punctuation">.</span><span class="token function">atomic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">"max"</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"accounts"</span><span class="token punctuation">,</span> <span class="token string">"alex"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Deno</span><span class="token punctuation">.</span><span class="token function">KvU64</span><span class="token punctuation">(</span><span class="token number">100n</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>   </div>
<h2 id="watch" tabindex="-1">
<code data-language="ts">watch</code> </h2> <p>The <code data-language="ts">watch</code> operation accepts an array of keys, and returns a <a href="https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream"><code data-language="ts">ReadableStream</code></a>, which emits a new value whenever any of the watched keys change their <code data-language="ts">versionstamp</code>. The emitted value is an array of <a href="../../../api/deno/~/deno.kventrymaybe.html">Deno.KvEntryMaybe</a> objects.</p> <p>Note that the returned stream does not return every single intermediate state of the watched keys, but keeps you up to date with the latest state of keys. This means if a key is modified multiple times quickly, you may not receive a notification for every change, but the latest state of the key.</p> <div class="relative">
<pre class="language-ts" tabindex="0"><code data-language="ts"><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">openKv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> stream <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"foo"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"bar"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entries <span class="token keyword">of</span> stream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token comment">// ["foo"]</span>
  entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// "bar"</span>
  entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>versionstamp<span class="token punctuation">;</span> <span class="token comment">// "00000000000000010000"</span>
  entries<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token comment">// ["bar"]</span>
  entries<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// null</span>
  entries<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>versionstamp<span class="token punctuation">;</span> <span class="token comment">// null</span>
<span class="token punctuation">}</span>
</code></pre>   </div>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018–2024 the Deno authors<br>Licensed under the MIT License.<br>
    <a href="https://docs.deno.com/deploy/kv/manual/operations" class="_attribution-link">https://docs.deno.com/deploy/kv/manual/operations</a>
  </p>
</div>
